{% load static %}{% load custom_filters %}<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DLL - LMSTC Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    {% load static %}
    <script>
        // Define the path to ph.json using Django's static file handling
        const phJsonPath = "{% static 'data/ph.json' %}";
    </script>
    <style>
        body {
            font-family: "Inter", sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f3f4f6;
        }
        
        .sidebar-gradient {
            background: linear-gradient(180deg, #4a90e2 0%, #2a6dbd 100%);
        }
        
        /* Sidebar collapse styles */
        .sidebar {
            width: 16rem;
            transition: width 0.3s ease-in-out, transform 0.3s ease-in-out;
            position: relative;
            z-index: 10;
        }
        
        .sidebar.collapsed {
            width: 4rem;
        }
        
        .sidebar.collapsed .sidebar-text {
            opacity: 0;
            visibility: hidden;
        }
        
        .sidebar.collapsed .sidebar-logo-text {
            opacity: 0;
            visibility: hidden;
        }
        
        .sidebar.collapsed .dropdown-toggle .fa-chevron-down {
            opacity: 0;
        }
        
        .sidebar-text {
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        
        .sidebar-logo-text {
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        
        .main-content {
            transition: margin-left 0.3s ease-in-out;
            margin-left: 0;
        }
        
        
        .overlay-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            flex-direction: column;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        
        .overlay-page.active {
            opacity: 1;
            visibility: visible;
        }
        
        .overlay-page button {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #4a90e2;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.2s ease-in-out;
        }
        
        .overlay-page button:hover {
            background-color: #2a6dbd;
        }
        
        .dropdown-menu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        
        .dropdown-menu.active {
            max-height: 200px;
        }
        
        .container-card {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            padding: 2rem;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        
        th {
            background-color: #f9fafb;
            font-weight: 600;
            color: #4b5563;
            text-transform: uppercase;
            font-size: 0.75rem;
        }
        
        .pagination-button {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            border: 1px solid #d1d5db;
            background-color: white;
            color: #4b5563;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
        }
        
        .pagination-button:hover:not(.active) {
            background-color: #f3f4f6;
        }
        
        .pagination-button.active {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }
        
        .modal-close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #4b5563;
        }
        
        #notificationContainer {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 4000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
        }
        
        .notification {
            background-color: #4CAF50;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
            display: flex;
            align-items: center;
            min-width: 250px;
        }
        
        .notification.active {
            opacity: 1;
            visibility: visible;
        }
        
        .notification.success {
            background-color: #4CAF50;
        }
        
        .notification.error {
            background-color: #EF4444;
        }
        
        .notification.info {
            background-color: #3B82F6;
        }
        
        .notification .icon {
            margin-right: 10px;
            font-size: 1.25rem;
        }

        .pagination-controls {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-top: 1rem;
            gap: 1rem;
        }

        .pagination-info {
            color: #6b7280;
            font-size: 0.875rem;
        }

        .pagination-nav {
            display: flex;
            gap: 0.25rem;
        }

        .pagination-nav button {
            padding: 0.5rem 0.75rem;
            border: 1px solid #d1d5db;
            background-color: white;
            color: #374151;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .pagination-nav button:hover:not(:disabled) {
            background-color: #f3f4f6;
        }

        .pagination-nav button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-nav button.active {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .items-per-page {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: #374151;
        }

        .items-per-page select {
            padding: 0.25rem 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            background-color: white;
        }

        .filter-control {
            display: flex;
            flex-direction: column;
        }

        @media (min-width: 768px) {
            .filter-control {
                flex-direction: row;
                align-items: center;
                gap: 0.5rem;
            }
        }

        .filter-control label {
            white-space: nowrap;
        }

        /* ✅ FIXED NOTIFICATION BOX STYLES */
        #notification-box {
            position: absolute;
            right: 0;
            top: 100%;
            margin-top: 8px;
            width: 320px;
            background: white;
            color: black;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            z-index: 50;
            border: 1px solid #e5e7eb;
        }

        #notification-box.hidden {
            display: none;
        }
/* Sliding Toggle Switch Styles */
        .switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #4a90e2;
        }

        input:checked + .slider:before {
            transform: translateX(20px);
        }

        /* Auto-collapse sidebar styles */
        .sidebar.auto-collapse {
            width: 4rem;
        }

        .sidebar.auto-collapse .sidebar-text {
            opacity: 0;
            visibility: hidden;
        }

        .sidebar.auto-collapse .sidebar-logo-text {
            opacity: 0;
            visibility: hidden;
        }

        .sidebar.auto-collapse .dropdown-toggle .fa-chevron-down {
            opacity: 0;
        }

        .sidebar.auto-collapse:hover {
            width: 16rem;
        }

        .sidebar.auto-collapse:hover .sidebar-text {
            opacity: 1;
            visibility: visible;
        }

        .sidebar.auto-collapse:hover .sidebar-logo-text {
            opacity: 1;
            visibility: visible;
        }

        .sidebar.auto-collapse:hover .dropdown-toggle .fa-chevron-down {
            opacity: 1;
        }

        /* Calendar Styles */
        .calendar-container {
            font-family: 'Inter', sans-serif;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: linear-gradient(135deg, #4a90e2, #2a6dbd);
            color: white;
            border-radius: 0.5rem;
        }

        .calendar-nav-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 0.5rem;
            border-radius: 0.25rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .calendar-nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background-color: #e5e7eb;
            border-radius: 0.5rem;
            overflow: hidden;
        }

        .calendar-day-header {
            background-color: #f3f4f6;
            padding: 0.75rem 0.5rem;
            text-align: center;
            font-weight: 600;
            font-size: 0.875rem;
            color: #374151;
        }

        .calendar-day {
            background-color: white;
            min-height: 80px;
            padding: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .calendar-day:hover {
            background-color: #f9fafb;
        }

        .calendar-day.other-month {
            background-color: #f9fafb;
            color: #9ca3af;
        }

        .calendar-day.selected {
            background-color: #dbeafe;
            border: 2px solid #3b82f6;
        }

        .calendar-day.today {
            background-color: #fef3c7;
            border: 2px solid #f59e0b;
        }

        .calendar-day-number {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .calendar-event {
            background-color: #3b82f6;
            color: white;
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            margin-bottom: 0.125rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .calendar-event:hover {
            background-color: #2563eb;
        }

        .calendar-event.enrollment {
            background-color: #10b981;
        }

        .calendar-event.enrollment:hover {
            background-color: #059669;
        }

        .calendar-event.departmental {
            background-color: #8b5cf6;
        }

        .calendar-event.departmental:hover {
            background-color: #7c3aed;
        }

        .event-indicator {
            position: absolute;
            bottom: 0.25rem;
            right: 0.25rem;
            width: 0.5rem;
            height: 0.5rem;
            border-radius: 50%;
            background-color: #ef4444;
        }

        /* Enhanced Collapse Arrow Button Styling */
        #sidebarToggleBtn {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05));
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 10px;
            padding: 10px 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(15px);
            box-shadow: 
                0 4px 15px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        #sidebarToggleBtn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        #sidebarToggleBtn:hover::before {
            left: 100%;
        }

        #sidebarToggleBtn:hover {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.1));
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-2px) scale(1.02);
            box-shadow: 
                0 8px 25px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        #sidebarToggleBtn:active {
            transform: translateY(0) scale(0.98);
            box-shadow: 
                0 2px 10px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        #sidebarToggleBtn:focus {
            outline: none;
            box-shadow: 
                0 0 0 3px rgba(255, 255, 255, 0.3),
                0 4px 15px rgba(0, 0, 0, 0.1);
        }

        #sidebarToggleIcon {
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
            color: rgba(255, 255, 255, 0.95);
        }

        /* Arrow animation on hover */
        #sidebarToggleBtn:hover #sidebarToggleIcon {
            transform: scale(1.15);
            color: rgba(255, 255, 255, 1);
            filter: drop-shadow(0 3px 6px rgba(0, 0, 0, 0.3));
        }

        /* Sidebar header styling enhancement */
        .sidebar-header {
            position: relative;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
            margin-bottom: 1rem;
        }

        /* Logo enhancement */
        .sidebar-header img {
            transition: all 0.3s ease;
        }

        .sidebar-header:hover img {
            transform: scale(1.05);
            filter: brightness(1.1);
        }
    </style>
</head>
<body class="flex h-screen bg-gray-100">
    <!-- Messages Notification -->
    {% if messages %}
        <div id="notice-message" class="notification active" style="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 9999;">
            {% for message in messages %}
                <i class="icon fas fa-info-circle"></i>
                <span>{{ message }}</span>
            {% endfor %}
        </div>
        <script>
            setTimeout(function(){
                const notice = document.getElementById('notice-message');
                if (notice) {
                    notice.classList.remove('active');
                    setTimeout(() => {
                        notice.remove();
                    }, 300);
                }
            }, 3000);
        </script>
    {% endif %}

    <!-- Overlay Page -->
    <div id="overlayPage" class="overlay-page">
        <p id="overlayText"></p>
        <button id="goBackBtn">Go Back</button>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <!-- Add Program Modal -->
    <div id="addProgramModal" class="modal">
        <div class="modal-content">
            <button class="modal-close-btn" id="closeProgramModalBtn">&times;</button>
            <h3 class="text-2xl font-bold text-blue-500 mb-6 text-center">Add New Program</h3>
            <form id="addProgramForm" method="POST" action="{% url 'add_program' %}" enctype="multipart/form-data" class="space-y-4">
                {% csrf_token %}
                <div>
                    <label for="programName" class="block text-gray-700 text-sm font-bold mb-2">Program Name</label>
                    <input type="text" id="programName" name="program_name" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:ring-blue-500 focus:border-blue-500" placeholder="Enter program name" required>
                </div>
                <div>
                    <label for="programDescription" class="block text-gray-700 text-sm font-bold mb-2">Description</label>
                    <textarea id="programDescription" name="program_detail" rows="3" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:ring-blue-500 focus:border-blue-500" placeholder="Enter program description" required></textarea>
                </div>
                <div>
                    <label for="programSchedule" class="block text-gray-700 text-sm font-bold mb-2">Schedule</label>
                    <input type="text" id="programSchedule" name="program_sched" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., Monday-Friday 8:00 AM - 5:00 PM" required>
                </div>
                <div>
                    <label for="programTrainer" class="block text-gray-700 text-sm font-bold mb-2">Trainer</label>
                    <input type="text" id="programTrainer" name="program_trainor" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:ring-blue-500 focus:border-blue-500" placeholder="Enter trainer name">
                </div>
                <div>
                    <label for="programSkills" class="block text-gray-700 text-sm font-bold mb-2">Skills</label>
                    <input type="text" id="programSkills" name="program_skill" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:ring-blue-500 focus:border-blue-500" placeholder="Enter required skills">
                </div>
                <div>
                    <label for="programImage" class="block text-gray-700 text-sm font-bold mb-2">Program Image</label>
                    <input type="file" id="programImage" name="program_image" accept="image/*" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:ring-blue-500 focus:border-blue-500">
                    <p class="text-xs text-gray-500 mt-1">Optional: Upload an image for the program</p>
                </div>
                <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded-md w-full hover:bg-blue-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                    <i class="fas fa-plus mr-2"></i>Add Program
                </button>
            </form>
        </div>
    </div>

    <!-- Trainer Registration Modal -->
    <div id="trainerRegistrationModal" class="modal">
        <div class="modal-content">
            <button class="modal-close-btn" id="closeModalBtn">&times;</button>
            <h3 class="text-2xl font-bold text-blue-500 mb-6 text-center">Trainer Registration</h3>
            <form id="trainerRegistrationForm" method="POST" action="{% url 'Dashboard_trainor' %}" class="space-y-4">
                {% csrf_token %}
                <div>
                    <label for="fullname" class="block text-gray-700 text-sm font-bold mb-2">Full Name</label>
                    <input type="text" id="fullname" name="fullname" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:ring-blue-500 focus:border-blue-500" placeholder="Enter full name" required>
                </div>
                <div>
                    <label for="email" class="block text-gray-700 text-sm font-bold mb-2">Email</label>
                    <input type="email" id="email" name="email" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:ring-blue-500 focus:border-blue-500" placeholder="Enter email" required>
                </div>
                <div>
                    <label for="password" class="block text-gray-700 text-sm font-bold mb-2">Password</label>
                    <div class="relative">
                        <input type="password" id="password" name="password" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:ring-blue-500 focus:border-blue-500 pr-10" placeholder="Enter password" required>
                        <button type="button" id="togglePassword" class="absolute inset-y-0 right-0 px-3 flex items-center text-gray-600">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <div>
                    <label for="expertise" class="block text-gray-700 text-sm font-bold mb-2">Programs</label>
                    <select name="expertise" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:ring-blue-500 focus:border-blue-500" required>
                        <option value="">Select program</option>
                        {% for prog in Programss %}
                            <option value="{{ prog.id }}">{{ prog.program_name }}</option>
                        {% empty %}
                            <option disabled>No programs available</option>
                        {% endfor %}
                    </select>
                </div>
                <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded-md w-full hover:bg-blue-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                    Register Trainer
                </button>
            </form>
        </div>
    </div>


    <!-- Applicant Details Modal -->
    <div id="applicantModal" class="modal">
        <div class="modal-content" style="max-width: 1000px; width: 95%; max-height: 90vh; overflow-y: auto; background-color: #ffffff; border-radius: 0.75rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); padding: 2.5rem; border: 1px solid #e2e8f0;">
            <button class="modal-close-btn" onclick="closeApplicantModal()" style="position: absolute; top: 1rem; right: 1rem; background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #4b5563;">&times;</button>
            
            <!-- Header Section -->
            <div class="relative mb-8 flex flex-col md:flex-row items-center justify-between">
                <div class="text-center md:text-left md:flex-grow">
                    <p class="text-lg font-bold text-gray-800">Technical Education and Skills Development Authority</p>
                    <p class="text-md text-gray-600">Pangasiwaan sa Edukasyong Teknikal at Pagpapaunlad ng Kasanayan</p>
                    <p class="text-sm text-gray-500 mt-2">MIS 03 – 01 (ver. 2020)</p>
                    <h1 class="text-2xl font-extrabold text-gray-900 mt-6 mb-4 uppercase tracking-wide">Learners Profile Form</h1>
                </div>
                <div class="mt-4 md:mt-0 md:ml-8 flex-shrink-0">
                    <div style="position: relative; width: 128px; height: 128px; border: 2px dashed #94a3b8; border-radius: 0.5rem; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; color: #64748b; font-size: 0.875rem; overflow: hidden;">
                        <img id="modal-profile-picture" src="" alt="ID Picture" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 5;">
                        <div style="position: relative; z-index: 15; pointer-events: none;">
                            <span class="text-xs">ID Picture</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Section 1: T2MIS Auto Generated -->
            <div class="mb-8">
                <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1.5rem; color: #1a202c; border-bottom: 2px solid #e2e8f0; padding-bottom: 0.5rem;">1. T2MIS Auto Generated</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label style="display: block; font-size: 0.875rem; font-weight: 500; color: #4a5568; margin-bottom: 0.5rem;">1.1. Unique Learner Identifier (ULI) Number:</label>
                        <input type="text" style="display: block; width: 100%; padding: 0.75rem 1rem; font-size: 1rem; line-height: 1.5; color: #4a5568; background-color: #f7fafc; border: 1px solid #cbd5e0; border-radius: 0.5rem;" placeholder="ULI-XXXX-XXXX-XXXX" readonly disabled value="None">
                    </div>
                    <div>
                        <label style="display: block; font-size: 0.875rem; font-weight: 500; color: #4a5568; margin-bottom: 0.5rem;">1.2. Entry Date:</label>
                        <input type="date" id="modal-entry-date" style="display: block; width: 100%; padding: 0.75rem 1rem; font-size: 1rem; line-height: 1.5; color: #4a5568; background-color: #f7fafc; border: 1px solid #cbd5e0; border-radius: 0.5rem;" disabled>
                    </div>
                </div>
            </div>
            
            <!-- Section 2: Learner/Manpower Profile -->
            <div class="mb-8">
                <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1.5rem; color: #1a202c; border-bottom: 2px solid #e2e8f0; padding-bottom: 0.5rem;">2. Learner/Manpower Profile</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label class="text-sm font-semibold text-gray-600 flex justify-start">2.1 Name</label>
                        <input type="text" id="modal-last-name" class="w-full border rounded p-2" disabled>
                        <input type="text" id="modal-first-name" class="w-full border rounded p-2" disabled>
                        <input type="text" id="modal-middle-name" class="w-full border rounded p-2" disabled>
                    </div>
                    <!-- Address -->
                    <div class="space-y-2">
                        <label class="text-sm font-semibold text-gray-600 flex justify-start">2.2 Complete Permanent Mailing Address</label>
                        <input type="text" id="modal-region-name" class="w-full border rounded p-2" disabled>
                        <input type="text" id="modal-province-name" class="w-full border rounded p-2" disabled>
                        <input type="text" id="modal-city-name" class="w-full border rounded p-2" disabled>
                        <input type="text" id="modal-barangay-name" class="w-full border rounded p-2" disabled>
                        <input type="text" id="modal-district" class="w-full border rounded p-2" disabled>
                        <input type="text" id="modal-street" class="w-full border rounded p-2" disabled>
                        <input type="text" id="modal-email" class="w-full border rounded p-2" disabled>
                        <input type="text" id="modal-contact-number" class="w-full border rounded p-2" disabled>
                        <input type="text" id="modal-nationality" class="w-full border rounded p-2" disabled>
                    </div>
                </div>
            </div>
            
            <div>
                <h2 class="font-bold text-lg text-blue-700 mb-2 flex justify-start">3. Personal Information</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="text-sm font-semibold text-gray-600 flex justify-start">3.1 Sex</label>
                        <input type="text" id="modal-sex" class="w-full border rounded p-2" disabled>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-600 flex justify-start">3.2 Civil Status</label>
                        <input type="text" id="modal-civil-status" class="w-full border rounded p-2" disabled>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-600 flex justify-start">3.3 Employment Status (Before the Training)</label>
                        <input type="text" id="modal-employment-status" class="w-full border rounded p-2" disabled>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-600 flex justify-start">Monthly Income</label>
                        <input type="text" id="modal-monthly-income" class="w-full border rounded p-2 mt-1" disabled>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-600 flex justify-start">Date Hired</label>
                        <input type="date" id="modal-date-hired" class="w-full border rounded p-2 mt-1" disabled>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-600 flex justify-start">Company Name</label>
                        <input type="text" id="modal-company-name" class="w-full border rounded p-2 mt-1" disabled>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-600 flex justify-start">3.4. Birthdate</label>
                        <input type="text" id="modal-birthdate" class="w-full border rounded p-2 mt-1" disabled>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-600 flex justify-start">Age</label>
                        <input type="number" id="modal-age" class="w-full border rounded p-2 mt-1" disabled>
                    </div>
                    <div class="md:col-span-2">
                        <label class="text-sm font-semibold text-gray-600 flex justify-start">3.5. Birthplace</label>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-2 mt-1">
                            <input type="text" id="modal-birthplace-region" class="border rounded p-2" disabled>
                            <input type="text" id="modal-birthplace-province" class="border rounded p-2" disabled>
                            <input type="text" id="modal-birthplace-city" class="border rounded p-2" disabled>
                        </div>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-600 flex justify-start">3.6. Educational Attainment</label>
                        <input type="text" id="modal-educational-attainment" class="w-full border rounded p-2 mt-1" disabled>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-600 flex justify-start">3.7. Parent/Guardian</label>
                        <input type="text" id="modal-parent-guardian" class="w-full border rounded p-2 mt-1" disabled>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-600 flex justify-start">Complete Permanent Mailing Address</label>
                        <input type="text" id="modal-permanent-address" class="w-full border rounded p-2 mt-1" disabled>
                    </div>
                </div>
            </div>
            
            <div>
                <h2 class="font-bold text-lg text-blue-700 mb-2 flex justify-start">
                    4. Learner/Trainee/Student (Clients) Classification
                </h2>
                <div id="modal-classifications" class="border rounded p-2 text-left min-h-[40px]"></div>
            </div>
            
            <div>
                <h2 class="font-bold text-lg text-blue-700 mb-2 flex justify-start">
                    5. Type of Disability (For Persons with Disability only)
                </h2>
                <div id="modal-disability-type" class="border rounded p-2 text-left min-h-[40px]"></div>
            </div>
            
            <div>
                <h2 class="font-bold text-lg text-blue-700 mb-2 flex justify-start">
                    6. Cause of Disability (For Persons with Disability only)
                </h2>
                <div id="modal-disability-causes" class="border rounded p-2 text-left min-h-[40px]"></div>
            </div>
            
            <div class="space-y-2 mt-4">
                <label class="font-bold text-lg text-blue-700 mb-2 flex justify-start">7. Name of Course/Qualification</label>
                <input type="text" id="modal-course-qualification" class="w-full border rounded p-2" disabled>
                <label class="font-bold text-lg text-blue-700 mb-2 flex justify-start">8. Scholarship Package (TWSP, PESFA, STEP, others)</label>
                <input type="text" id="modal-scholarship" class="w-full border rounded p-2" disabled>
            </div>
            
            <div class="mt-6">
                <div class="border-l-4 border-blue-600 bg-blue-50 p-4 text-sm text-gray-700 rounded text-center">
                    <p class="font-bold text-lg text-blue-700 mb-2">9. Privacy Disclaimer</p>
                    <p>
                        I hereby allow TESDA to use/post my contact details, name, email, cellphone/landline nos. and other
                        information I provided which may be used for processing of my scholarship application, for employment
                        opportunities and for the survey of TESDA programs.
                    </p>
                </div>
                <div class="mt-6">
                    <h2 class="font-bold text-lg text-blue-700 mb-2">10. Applicant's Signature</h2>
                    <p class="text-sm text-gray-600 mb-6">This is to certify that the information stated above is true and correct.</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="space-y-4 md:col-span-2">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Applicant's Name</label>
                                <input type="text" id="modal-applicant-name" class="w-full border border-gray-300 rounded p-2" disabled>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Date Accomplished</label>
                                <input type="text" id="modal-date-accomplished" class="w-full border border-gray-300 rounded p-2" disabled>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Continue with other form sections... -->
                <div class="bg-white border-t border-gray-200 p-4 shadow-lg mt-10 sticky">
                    <div class="flex justify-end gap-3">
                        {% if ProgAPP %}
                        <form method="post" action="{% url 'approve_application' ProgAPP.id %}" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="bg-green-600 hover:bg-green-700 focus:ring-2 focus:ring-green-500 focus:ring-offset-2 text-white px-6 py-2 rounded-lg font-medium transition-colors duration-200">
                                Approve
                            </button>
                        </form>
                        {% endif %}
                        
                        <button class="bg-blue-600 hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 text-white px-6 py-2 rounded-lg font-medium transition-colors duration-200" onclick="closeApplicantModal()">
                            Close
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Approved Details Modal -->
    <div id="approvedModal" class="modal">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeApprovedModal()">&times;</button>
            <h3 class="text-2xl font-bold mb-4">Applicant Details</h3>
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h1 class="text-2xl font-bold text-blue-700">DLL-LMSTC Registration Form</h1>
                    <p class="text-lg font-semibold text-gray-700 flex justify-start">LEARNERS PROFILE FORM</p>
                </div>
                <div class="w-24 h-24 bg-gray-200 flex items-center justify-center text-gray-500 border relative cursor-pointer overflow-hidden rounded">
                    <img id="modal-profile-picture" src="/placeholder.svg" alt="Profile Picture">
                </div>
            </div>
            
            <!-- Form content similar to your original modal -->
            <h2 class="font-bold text-lg text-blue-700 mb-2 flex justify-start">1. TWMS Auto Generated</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="text-sm font-semibold text-gray-600 flex justify-start">1.1 Unique Learner Identifier (ULI) Number:</label>
                    <input type="text" class="w-full border rounded p-2 mt-1" placeholder="" disabled value="None">
                </div>
                <div>
                    <label class="text-sm font-semibold text-gray-600 flex justify-start">1.2 Entry Date:</label>
                    <input type="date" id="modal-entry-date" class="w-full border rounded p-2" disabled>
                </div>
            </div>
            
            <div>
                <h2 class="font-bold text-lg text-blue-700 mb-2 flex justify-start">2. Learner/Manpower Profile</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label class="text-sm font-semibold text-gray-600 flex justify-start">2.1 Name</label>
                        <input type="text" id="modal-last-name" class="w-full border rounded p-2" disabled>
                        <input type="text" id="modal-first-name" class="w-full border rounded p-2" disabled>
                        <input type="text" id="modal-middle-name" class="w-full border rounded p-2" disabled>
                    </div>
                    <!-- Address -->
                    <div class="space-y-2">
                        <label class="text-sm font-semibold text-gray-600 flex justify-start">2.2 Complete Permanent Mailing Address</label>
                        <input type="text" id="modal-region-name" class="w-full border rounded p-2" disabled>
                        <input type="text" id="modal-province-name" class="w-full border rounded p-2" disabled>
                        <input type="text" id="modal-city-name" class="w-full border rounded p-2" disabled>
                        <input type="text" id="modal-barangay-name" class="w-full border rounded p-2" disabled>
                        <input type="text" id="modal-district" class="w-full border rounded p-2" disabled>
                        <input type="text" id="modal-street" class="w-full border rounded p-2" disabled>
                        <input type="text" id="modal-email" class="w-full border rounded p-2" disabled>
                        <input type="text" id="modal-contact-number" class="w-full border rounded p-2" disabled>
                        <input type="text" id="modal-nationality" class="w-full border rounded p-2" disabled>
                    </div>
                </div>
            </div>
            
            <div>
                <h2 class="font-bold text-lg text-blue-700 mb-2 flex justify-start">3. Personal Information</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="text-sm font-semibold text-gray-600 flex justify-start">3.1 Sex</label>
                        <input type="text" id="modal-sex" class="w-full border rounded p-2" disabled>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-600 flex justify-start">3.2 Civil Status</label>
                        <input type="text" id="modal-civil-status" class="w-full border rounded p-2" disabled>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-600 flex justify-start">3.3 Employment Status (Before the Training)</label>
                        <input type="text" id="modal-employment-status" class="w-full border rounded p-2" disabled>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-600 flex justify-start">Monthly Income</label>
                        <input type="text" id="modal-monthly-income" class="w-full border rounded p-2 mt-1" disabled>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-600 flex justify-start">Date Hired</label>
                        <input type="date" id="modal-date-hired" class="w-full border rounded p-2 mt-1" disabled>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-600 flex justify-start">Company Name</label>
                        <input type="text" id="modal-company-name" class="w-full border rounded p-2 mt-1" disabled>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-600 flex justify-start">3.4. Birthdate</label>
                        <input type="text" id="modal-birthdate" class="w-full border rounded p-2 mt-1" disabled>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-600 flex justify-start">Age</label>
                        <input type="number" id="modal-age" class="w-full border rounded p-2 mt-1" disabled>
                    </div>
                    <div class="md:col-span-2">
                        <label class="text-sm font-semibold text-gray-600 flex justify-start">3.5. Birthplace</label>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-2 mt-1">
                            <input type="text" id="modal-birthplace-region" class="border rounded p-2" disabled>
                            <input type="text" id="modal-birthplace-province" class="border rounded p-2" disabled>
                            <input type="text" id="modal-birthplace-city" class="border rounded p-2" disabled>
                        </div>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-600 flex justify-start">3.6. Educational Attainment</label>
                        <input type="text" id="modal-educational-attainment" class="w-full border rounded p-2 mt-1" disabled>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-600 flex justify-start">3.7. Parent/Guardian</label>
                        <input type="text" id="modal-parent-guardian" class="w-full border rounded p-2 mt-1" disabled>
                    </div>
                    <div>
                        <label class="text-sm font-semibold text-gray-600 flex justify-start">Complete Permanent Mailing Address</label>
                        <input type="text" id="modal-permanent-address" class="w-full border rounded p-2 mt-1" disabled>
                    </div>
                </div>
            </div>
            
            <div>
                <h2 class="font-bold text-lg text-blue-700 mb-2 flex justify-start">
                    4. Learner/Trainee/Student (Clients) Classification
                </h2>
                <div id="modal-classifications" class="border rounded p-2 text-left min-h-[40px]"></div>
            </div>
            
            <div>
                <h2 class="font-bold text-lg text-blue-700 mb-2 flex justify-start">
                    5. Type of Disability (For Persons with Disability only)
                </h2>
                <div id="modal-disability-type" class="border rounded p-2 text-left min-h-[40px]"></div>
            </div>
            
            <div>
                <h2 class="font-bold text-lg text-blue-700 mb-2 flex justify-start">
                    6. Cause of Disability (For Persons with Disability only)
                </h2>
                <div id="modal-disability-causes" class="border rounded p-2 text-left min-h-[40px]"></div>
            </div>
            
            <div class="space-y-2 mt-4">
                <label class="font-bold text-lg text-blue-700 mb-2 flex justify-start">7. Name of Course/Qualification</label>
                <input type="text" id="modal-course-qualification" class="w-full border rounded p-2" disabled>
                <label class="font-bold text-lg text-blue-700 mb-2 flex justify-start">8. Scholarship Package (TWSP, PESFA, STEP, others)</label>
                <input type="text" id="modal-scholarship" class="w-full border rounded p-2" disabled>
            </div>
            
            <div class="mt-6">
                <div class="border-l-4 border-blue-600 bg-blue-50 p-4 text-sm text-gray-700 rounded text-center">
                    <p class="font-bold text-lg text-blue-700 mb-2">9. Privacy Disclaimer</p>
                    <p>
                        I hereby allow TESDA to use/post my contact details, name, email, cellphone/landline nos. and other
                        information I provided which may be used for processing of my scholarship application, for employment
                        opportunities and for the survey of TESDA programs.
                    </p>
                </div>
                <div class="mt-6">
                    <h2 class="font-bold text-lg text-blue-700 mb-2">10. Applicant's Signature</h2>
                    <p class="text-sm text-gray-600 mb-6">This is to certify that the information stated above is true and correct.</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="space-y-4 md:col-span-2">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Applicant's Name</label>
                                <input type="text" id="modal-applicant-name" class="w-full border border-gray-300 rounded p-2" disabled>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Date Accomplished</label>
                                <input type="text" id="modal-date-accomplished" class="w-full border border-gray-300 rounded p-2" disabled>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Continue with other form sections... -->
            <div class="bg-white border-t border-gray-200 p-4 shadow-lg mt-10">
                <button class="bg-blue-600 hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 text-white px-6 py-2 rounded-lg font-medium transition-colors duration-200" onclick="closeApprovedModal()">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Decline Modal -->
    <div id="declineModal" class="modal">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeDeclineModal()">&times;</button>
            <h2 class="text-xl font-semibold mb-4 text-red-600">Decline Application</h2>
            <p class="mb-4 text-gray-700">Are you sure you want to decline <span id="declineApplicantName" class="font-bold"></span>'s application?</p>
            <form id="declineForm" method="POST" action="{% url 'decline_application' %}">
                {% csrf_token %}
                <input type="hidden" name="application_id" id="declineApplicationId">
                
                <label for="commonReason" class="block text-sm font-medium text-gray-700 mb-1">Select a reason</label>
                <select id="commonReason" class="w-full mb-4 border-gray-300 rounded-lg text-black" onchange="updateReasonText()">
                    <option value="">-- Choose a reason --</option>
                    <option value="Incomplete application">Incomplete application</option>
                    <option value="Does not meet qualifications">Does not meet qualifications</option>
                    <option value="Other">Other</option>
                </select>
                
                <label for="declineReason" class="block text-sm font-medium text-gray-700 mb-1">Reason for Decline</label>
                <textarea id="declineReason" name="decline_reason" rows="3" class="w-full p-2 border border-gray-300 rounded-lg mb-4 text-black" placeholder="Write custom reason or select from above"></textarea>
                
                <div class="flex justify-end gap-2">
                    <button type="button" onclick="closeDeclineModal()" class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded-lg">
                        Cancel
                    </button>
                    <button type="submit" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">
                        Confirm Decline
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Walk-in Registration Modal -->
    <div id="walkinModal" class="modal">
        <div class="modal-content" style="max-width: 600px; max-height: 95vh; overflow-y: auto;">
            <button class="modal-close-btn" onclick="closeWalkinModal()">&times;</button>
            
            <!-- Step 1: Create Account -->
            <div id="walkinStep1" class="walkin-step">
                <h3 class="text-2xl font-bold text-blue-500 mb-6 text-center">Walk-in Registration - Step 1</h3>
                <p class="text-gray-600 mb-4 text-center">Enter the applicant's full name to create an account</p>
                <div class="space-y-4">
                    <div>
                        <label for="walkinFullName" class="block text-gray-700 text-sm font-bold mb-2">Full Name *</label>
                        <input type="text" id="walkinFullName" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:ring-blue-500 focus:border-blue-500" placeholder="Enter full name (e.g., Juan Dela Cruz)" required>
                    </div>
                </div>
                <div class="flex justify-end mt-6">
                    <button type="button" onclick="createWalkinAccount()" class="bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 transition-colors">
                        <i class="fas fa-user-plus mr-2"></i>Create Account
                    </button>
                </div>
            </div>

            <!-- Step 2: Select Program -->
            <div id="walkinStep2" class="walkin-step" style="display: none;">
                <h3 class="text-2xl font-bold text-blue-500 mb-6 text-center">Walk-in Registration - Step 2</h3>
                <p class="text-gray-600 mb-4 text-center">Select the program to apply for</p>
                <div class="space-y-4">
                    <div>
                        <label for="walkinProgram" class="block text-gray-700 text-sm font-bold mb-2">Program to Apply *</label>
                        <select id="walkinProgram" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:ring-blue-500 focus:border-blue-500" required>
                            <option value="">Select program</option>
                            {% for prog in Programss %}
                                <option value="{{ prog.id }}">{{ prog.program_name }}</option>
                            {% empty %}
                                <option disabled>No programs available</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="flex justify-between mt-6">
                    <button type="button" onclick="showWalkinStep(1)" class="bg-gray-500 text-white px-6 py-2 rounded-md hover:bg-gray-600 transition-colors">
                        <i class="fas fa-arrow-left mr-2"></i>Back
                    </button>
                    <button type="button" onclick="applyWalkinProgram()" class="bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 transition-colors">
                        <i class="fas fa-paper-plane mr-2"></i>Submit Application
                    </button>
                </div>
            </div>

            <!-- Step 3: Account Created -->
            <div id="walkinStep3" class="walkin-step" style="display: none;">
                <h3 class="text-2xl font-bold text-green-500 mb-6 text-center">Walk-in Registration Complete!</h3>
                <div class="bg-green-50 border border-green-200 rounded-lg p-6 mb-6">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-check-circle text-green-500 text-2xl mr-3"></i>
                        <h4 class="text-lg font-semibold text-green-800">Account Created Successfully</h4>
                    </div>
                    <div class="space-y-3">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Username:</label>
                                <div class="bg-white border rounded px-3 py-2 font-mono text-blue-600" id="walkinUsername">-</div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Password:</label>
                                <div class="bg-white border rounded px-3 py-2 font-mono text-blue-600" id="walkinPassword">-</div>
                            </div>
                        </div>
                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Application Status:</label>
                            <div class="bg-yellow-100 border border-yellow-300 rounded px-3 py-2 text-yellow-800">
                                <i class="fas fa-clock mr-2"></i>Pending Approval (Queue #<span id="walkinQueueNumber">-</span>)
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                    <h5 class="font-semibold text-blue-800 mb-2">
                        <i class="fas fa-info-circle mr-2"></i>Important Information
                    </h5>
                    <ul class="text-sm text-blue-700 space-y-1">
                        <li>• Please save these credentials for the applicant</li>
                        <li>• The application is now in the approval queue</li>
                        <li>• The applicant will be notified once approved</li>
                    </ul>
                </div>
                <div class="flex justify-center">
                    <button type="button" onclick="closeWalkinModal()" class="bg-green-500 text-white px-6 py-2 rounded-md hover:bg-green-600 transition-colors">
                        <i class="fas fa-check mr-2"></i>Complete
                    </button>
                </div>
            </div>

            <!-- Hidden data storage -->
            <input type="hidden" id="walkinApplicantId">
            <input type="hidden" id="walkinApplicationId">
        </div>
    </div>

    <!-- View Program Modal -->
    <div id="viewProgramModal" class="modal">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeViewProgramModal()">&times;</button>
            <h3 class="text-2xl font-bold text-blue-500 mb-6 text-center">Program Details</h3>
            <div class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Program Name</label>
                            <div id="viewProgramName" class="bg-gray-50 border rounded w-full py-2 px-3 text-gray-700"></div>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Schedule</label>
                            <div id="viewProgramSchedule" class="bg-gray-50 border rounded w-full py-2 px-3 text-gray-700"></div>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Trainer</label>
                            <div id="viewProgramTrainer" class="bg-gray-50 border rounded w-full py-2 px-3 text-gray-700"></div>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Skills</label>
                            <div id="viewProgramSkills" class="bg-gray-50 border rounded w-full py-2 px-3 text-gray-700"></div>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Description</label>
                            <div id="viewProgramDescription" class="bg-gray-50 border rounded w-full py-2 px-3 text-gray-700 min-h-[100px]"></div>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Program Image</label>
                            <div class="bg-gray-50 border rounded w-full py-2 px-3 text-center">
                                <img id="viewProgramImage" src="" alt="Program Image" class="max-w-full h-32 object-cover mx-auto rounded" style="display: none;">
                                <span id="viewProgramImagePlaceholder" class="text-gray-500">No image available</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Program Modal -->
    <div id="editProgramModal" class="modal">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeEditProgramModal()">&times;</button>
            <h3 class="text-2xl font-bold text-blue-500 mb-6 text-center">Edit Program</h3>
            <form id="editProgramForm" method="POST" enctype="multipart/form-data" class="space-y-4">
                {% csrf_token %}
                <input type="hidden" id="editProgramId" name="program_id">
                <div>
                    <label for="editProgramName" class="block text-gray-700 text-sm font-bold mb-2">Program Name</label>
                    <input type="text" id="editProgramName" name="program_name" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div>
                    <label for="editProgramDescription" class="block text-gray-700 text-sm font-bold mb-2">Description</label>
                    <textarea id="editProgramDescription" name="program_detail" rows="3" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:ring-blue-500 focus:border-blue-500" required></textarea>
                </div>
                <div>
                    <label for="editProgramSchedule" class="block text-gray-700 text-sm font-bold mb-2">Schedule</label>
                    <input type="text" id="editProgramSchedule" name="program_sched" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div>
                    <label for="editProgramTrainer" class="block text-gray-700 text-sm font-bold mb-2">Trainer</label>
                    <input type="text" id="editProgramTrainer" name="program_trainor" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="editProgramSkills" class="block text-gray-700 text-sm font-bold mb-2">Skills</label>
                    <input type="text" id="editProgramSkills" name="program_skill" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="editProgramImage" class="block text-gray-700 text-sm font-bold mb-2">Program Image</label>
                    <input type="file" id="editProgramImage" name="program_image" accept="image/*" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:ring-blue-500 focus:border-blue-500">
                    <p class="text-xs text-gray-500 mt-1">Leave empty to keep current image</p>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" onclick="closeEditProgramModal()" class="bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 transition-colors">
                        Cancel
                    </button>
                    <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                        <i class="fas fa-save mr-2"></i>Update Program
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Program Confirmation Modal -->
    <div id="deleteProgramModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <button class="modal-close-btn" onclick="closeDeleteProgramModal()">&times;</button>
            <h3 class="text-2xl font-bold text-red-500 mb-6 text-center">Delete Program</h3>
            <div class="text-center">
                <i class="fas fa-exclamation-triangle text-red-500 text-6xl mb-4"></i>
                <p class="text-lg text-gray-700 mb-2">Are you sure you want to delete this program?</p>
                <p class="text-sm text-gray-500 mb-6">This action cannot be undone.</p>
                <div class="bg-red-50 border border-red-200 rounded p-4 mb-6">
                    <p class="text-red-700 font-semibold">Program to be deleted:</p>
                    <p id="deleteProgramName" class="text-red-600 font-bold text-lg"></p>
                </div>
                <div class="flex justify-center space-x-3">
                    <button type="button" onclick="closeDeleteProgramModal()" class="bg-gray-500 text-white px-6 py-2 rounded-md hover:bg-gray-600 transition-colors">
                        Cancel
                    </button>
                    <button type="button" id="confirmDeleteProgram" class="bg-red-500 text-white px-6 py-2 rounded-md hover:bg-red-600 transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50">
                        <i class="fas fa-trash mr-2"></i>Delete Program
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Event Creation/Edit Modal -->
    <div id="eventModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <button class="modal-close-btn" onclick="closeEventModal()">&times;</button>
            <h3 id="eventModalTitle" class="text-2xl font-bold text-blue-500 mb-6 text-center">Create New Event</h3>
            
            <form id="eventForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Event Title</label>
                    <input type="text" id="eventTitle" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                    <select id="eventCategory" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" onchange="toggleEnrollmentFields()" required>
                        <option value="">Select Category</option>
                        <option value="enrollment">Enrollment</option>
                        <option value="departmental">Departmental</option>
                    </select>
                </div>

                <div id="enrollmentFields" class="hidden space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Batch</label>
                            <select id="eventBatch" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Select Batch</option>
                                <option value="1">Batch 1</option>
                                <option value="2">Batch 2</option>
                                <option value="3">Batch 3</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Trimester</label>
                            <select id="eventTrimester" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Select Trimester</option>
                                <option value="1">1st Semester</option>
                                <option value="2">2nd Semester</option>
                                <option value="3">3rd Semester</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Start Date</label>
                        <input type="date" id="eventStartDate" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">End Date</label>
                        <input type="date" id="eventEndDate" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                        <input type="time" id="eventStartTime" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">End Time</label>
                        <input type="time" id="eventEndTime" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                    <textarea id="eventDescription" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Event description..."></textarea>
                </div>

                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeEventModal()" class="bg-gray-500 text-white px-6 py-2 rounded-md hover:bg-gray-600 transition-colors">
                        Cancel
                    </button>
                    <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition-colors">
                        <i class="fas fa-save mr-2"></i>Save Event
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Collapsible Sidebar -->
    <aside id="sidebar" class="sidebar sidebar-gradient text-white flex flex-col p-4 shadow-lg rounded-r-lg">
        
        <div class="flex items-center mb-8 sidebar-header">
            <div class="flex items-center flex-1">
                <img src="{% static 'Images/icon.png' %}" alt="Logo" class="mr-3 rounded-full w-10 h-10 shadow-lg">
                <h1 class="text-xl font-bold sidebar-logo-text text-white drop-shadow-sm">DLL - LMSTC</h1>
            </div>
            <!-- Enhanced Arrow Toggle Button -->
            <button id="sidebarToggleBtn" class="text-white focus:outline-none" title="Toggle Sidebar">
                <i id="sidebarToggleIcon" class="fas fa-arrow-left"></i>
            </button>
        </div>
        
        <nav class="flex-1">
            <ul>
                <li class="mb-4">
                    <a href="#" class="nav-link flex items-center p-2 rounded-lg bg-blue-700" data-page="Dashboard" data-content-type="dashboard">
                        <i class="fas fa-tachometer-alt mr-3"></i>
                        <span class="sidebar-text">Dashboard</span>
                    </a>
                </li>
                <li class="mb-4">
                    <div class="dropdown-toggle flex items-center p-2 rounded-lg hover:bg-blue-600 transition-colors cursor-pointer">
                        <i class="fas fa-user-graduate mr-3"></i>
                        <span class="sidebar-text">Applicant Profile</span>
                        <i class="fas fa-chevron-down ml-auto text-xs transition-transform duration-300 transform sidebar-text"></i>
                    </div>
                    <ul class="dropdown-menu ml-6 mt-2 space-y-2">
                        <li>
                            <a href="#" class="nav-link flex items-center p-2 rounded-lg hover:bg-blue-600 transition-colors" data-page="Applicant List" data-content-type="applicant-list">
                                <i class="fas fa-clipboard-list mr-3"></i>
                                <span class="sidebar-text">Applicant List</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="nav-link flex items-center p-2 rounded-lg hover:bg-blue-600 transition-colors" data-page="Approved Applicants" data-content-type="approved-applicants">
                                <i class="fas fa-user-check mr-3"></i>
                                <span class="sidebar-text">Approved Applicants</span>
                            </a>
                        </li>
                    </ul>
                </li>
                <li class="mb-4">
                    <div class="dropdown-toggle flex items-center p-2 rounded-lg hover:bg-blue-600 transition-colors cursor-pointer">
                        <i class="fas fa-briefcase mr-3"></i>
                        <span class="sidebar-text">Job Posting</span>
                        <i class="fas fa-chevron-down ml-auto text-xs transition-transform duration-300 transform sidebar-text"></i>
                    </div>
                    <ul class="dropdown-menu ml-6 mt-2 space-y-2">
                        <li>
                            <a href="#" class="nav-link flex items-center p-2 rounded-lg hover:bg-blue-600 transition-colors" data-page="Active Jobs" data-content-type="active-jobs">
                                <i class="fas fa-briefcase mr-3"></i>
                                <span class="sidebar-text">Active Jobs</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="nav-link flex items-center p-2 rounded-lg hover:bg-blue-600 transition-colors" data-page="Archived Jobs" data-content-type="archived-jobs">
                                <i class="fas fa-archive mr-3"></i>
                                <span class="sidebar-text">Archived Jobs</span>
                            </a>
                        </li>
                    </ul>
                </li>
                <li class="mb-4">
                    <a href="#" class="nav-link flex items-center p-2 rounded-lg hover:bg-blue-600 transition-colors" data-page="Program Management" data-content-type="program-management">
                        <i class="fas fa-graduation-cap mr-3"></i>
                        <span class="sidebar-text">Program</span>
                    </a>
                </li>
                <li class="mb-4">
                    <div class="dropdown-toggle flex items-center p-2 rounded-lg hover:bg-blue-600 transition-colors cursor-pointer">
                        <i class="fas fa-file-alt mr-3"></i>
                        <span class="sidebar-text">Document Management</span>
                        <i class="fas fa-chevron-down ml-auto text-xs transition-transform duration-300 transform sidebar-text"></i>
                    </div>
                    <ul class="dropdown-menu ml-6 mt-2 space-y-2">
                        <li>
                            <a href="#" class="nav-link flex items-center p-2 rounded-lg hover:bg-blue-600 transition-colors" data-page="Document Management" data-content-type="document-management">
                                <i class="fas fa-folder-open mr-3"></i>
                                <span class="sidebar-text">Documents</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="nav-link flex items-center p-2 rounded-lg hover:bg-blue-600 transition-colors" data-page="Program" data-content-type="programs">
                                <i class="fas fa-chart-bar mr-3"></i>
                                <span class="sidebar-text">Report</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="nav-link flex items-center p-2 rounded-lg hover:bg-blue-600 transition-colors" data-page="Ticket" data-content-type="ticket">
                                <i class="fas fa-ticket-alt mr-3"></i>
                                <span class="sidebar-text">Ticket</span>
                            </a>
                        </li>
                    </ul>
                </li>
                <li class="mb-4">
                    </a>
                </li>
                <li class="mb-4">
                    <a href="#" class="nav-link flex items-center p-2 rounded-lg hover:bg-blue-600 transition-colors" data-page="Trainor" data-content-type="trainor-list">
                        <i class="fas fa-chalkboard-teacher mr-3"></i>
                        <span class="sidebar-text">Trainor</span>
                    </a>
                </li>
                <li class="mb-4">
                    <a href="#" class="nav-link flex items-center p-2 rounded-lg hover:bg-blue-600 transition-colors" data-page="Enrollments" data-content-type="clone">
                        <i class="fas fa-clone mr-3"></i>
                        <span class="sidebar-text">Enrollments</span>
                    </a>
                </li>
            </ul>
        </nav>
        <div class="mt-auto">
            <a href="{% url 'logout_view' %}" class="flex items-center p-2 rounded-lg hover:bg-blue-600 transition-colors">
                <i class="fas fa-sign-out-alt mr-3"></i>
                <span class="sidebar-text">Sign Out</span>
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <main id="mainContent" class="flex-1 p-8 overflow-y-auto main-content">
        <header class="flex items-center justify-between mb-6">
            <h2 class="text-3xl font-bold text-blue-700">Admin Control Panel</h2>
            <div class="flex items-center space-x-4">
                <!-- ✅ FIXED NOTIFICATION BELL -->
                <div class="relative">
                    <button id="bell-btn" class="relative focus:outline-none p-2 rounded-full hover:bg-blue-100 transition-colors">
                        <img src="{% static 'Images/bell.png' %}" alt="Bell" class="w-6 h-6" />
                        <span id="notification-badge" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold">0</span>
                    </button>
                    <div id="notification-box" class="hidden absolute right-0 top-full mt-2 w-80 bg-white text-black rounded-lg shadow-lg z-50 border border-gray-200">
                        <div class="p-4 border-b font-bold text-blue-600 flex justify-between items-center">
                            <span>Notifications</span>
                            <button id="mark-all-read" class="text-sm text-gray-500 hover:text-blue-600 transition-colors">Mark all read</button>
                        </div>
                        <div id="notifications-list" class="max-h-64 overflow-y-auto">
                            <div class="p-4 text-center text-gray-500">Loading notifications...</div>
                        </div>
                    </div>
                </div>
                <div class="text-gray-600">Welcome Back</div>
                <div class="text-xl font-bold text-yellow-400">{{ Dashboard_username }}</div>
                <img src="{% static 'Images/user.png' %}" class="w-12 h-12 rounded-full bg-white/30" alt="User" />
            </div>
        </header>

        <h2 class="text-3xl font-bold text-gray-800 mb-6" id="mainContentTitle">Dashboard</h2>

        <!-- Dashboard Content -->
        <div id="dashboardContent">
            <!-- Summary Cards -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                <div class="bg-white p-6 rounded-lg shadow-md border border-gray-200 flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600">No. of Applicant</p>
                        <p class="text-2xl font-bold text-gray-800">{{counted_applicants}}</p>
                    </div>
                    <i class="fas fa-user-plus text-blue-500 text-3xl"></i>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md border border-gray-200 flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600">No. of Approved Applicant</p>
                        <p class="text-2xl font-bold text-gray-800">{{counted_approved}}</p>
                    </div>
                    <i class="fas fa-user-check text-green-500 text-3xl"></i>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md border border-gray-200 flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600">No. of Drop Out</p>
                        <p class="text-2xl font-bold text-gray-800">0</p>
                    </div>
                    <i class="fas fa-user-times text-red-500 text-3xl"></i>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md border border-gray-200 flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600">No. of Programs</p>
                        <p class="text-2xl font-bold text-gray-800">{{counted_programs}}</p>
                    </div>
                    <i class="fas fa-book-open text-purple-500 text-3xl"></i>
                </div>
            </div>

            <!-- Walk-in Application Section -->
            <div class="bg-white p-6 rounded-lg shadow-md border border-gray-200 mb-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-bold text-gray-800">Walk-in Applications</h3>
                    <button id="newWalkinBtn" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                        <i class="fas fa-plus mr-2"></i>New Walk-in
                    </button>
                </div>
                
                <!-- Walk-in Stats Cards -->
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
                    <div class="bg-gradient-to-r from-blue-50 to-blue-100 p-4 rounded-lg border border-blue-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-blue-600 font-medium">Total Applicants</p>
                                <p class="text-2xl font-bold text-blue-800">{{ counted_applicants }}</p>
                            </div>
                            <i class="fas fa-walking text-blue-500 text-2xl"></i>
                        </div>
                    </div>
                    <div class="bg-gradient-to-r from-green-50 to-green-100 p-4 rounded-lg border border-green-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-green-600 font-medium">Approved</p>
                                <p class="text-2xl font-bold text-green-800">{{ counted_approved }}</p>
                            </div>
                            <i class="fas fa-check-circle text-green-500 text-2xl"></i>
                        </div>
                    </div>
                    <div class="bg-gradient-to-r from-yellow-50 to-yellow-100 p-4 rounded-lg border border-yellow-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-yellow-600 font-medium">Programs</p>
                                <p class="text-2xl font-bold text-yellow-800">{{ counted_programs }}</p>
                            </div>
                            <i class="fas fa-graduation-cap text-yellow-500 text-2xl"></i>
                        </div>
                    </div>
                </div>

                <!-- Walk-in Queue Table -->
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead>
                            <tr>
                                <th class="py-3 px-4 bg-gray-50 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Queue #</th>
                                <th class="py-3 px-4 bg-gray-50 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Name</th>
                                <th class="py-3 px-4 bg-gray-50 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Program Interest</th>
                                <th class="py-3 px-4 bg-gray-50 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Time Arrived</th>
                                <th class="py-3 px-4 bg-gray-50 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Status</th>
                                <th class="py-3 px-4 bg-gray-50 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            {% if walkin_applicants %}
                                {% for app in walkin_applicants %}
                                    <tr class="hover:bg-gray-50">
                                        <td class="py-3 px-4 text-sm text-gray-900">{{ app.queue_number|default:forloop.counter }}</td>
                                        <td class="py-3 px-4 text-sm font-medium text-gray-900">
                                            {% if app.profile %}
                                                {{ app.profile.first_name }} {{ app.profile.middle_name }} {{ app.profile.last_name }}
                                            {% else %}
                                                {{ app.applicant.first_name }} {{ app.applicant.last_name }}
                                            {% endif %}
                                            <br><small class="text-gray-500">Username: {{ app.applicant.username }}</small>
                                        </td>
                                            <td class="py-3 px-4 text-sm text-gray-600">{{ app.program.program_name }}</td>
                                            <td class="py-3 px-4 text-sm text-gray-600">{{ app.applied_at|date:"M d, Y H:i" }}</td>
                                            <td class="py-3 px-4">
                                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full 
                                                    {% if app.status == 'Approved' %}bg-green-100 text-green-800
                                                    {% elif app.status == 'Pending' %}bg-yellow-100 text-yellow-800
                                                    {% else %}bg-red-100 text-red-800{% endif %}">
                                                    {{ app.status }}
                                                </span>
                                            </td>
                                            <td class="py-3 px-4 text-sm">
                                                <button onclick="viewApplicantDetails('{{ app.applicant.id }}')" 
                                                        class="text-blue-600 hover:text-blue-800 mr-2">
                                                    <i class="fas fa-eye"></i> View
                                                </button>
                                                {% if app.status == 'Pending' %}
                                                    <button onclick="approveWalkIn('{{ app.id }}')" 
                                                            class="text-green-600 hover:text-green-800 mr-2">
                                                        <i class="fas fa-check"></i> Approve
                                                    </button>
                                                    <button onclick="declineWalkIn('{{ app.id }}')" 
                                                            class="text-red-600 hover:text-red-800">
                                                        <i class="fas fa-times"></i> Decline
                                                    </button>
                                                {% endif %}
                                            </td>
                                        </tr>
                                {% empty %}
                                    <tr>
                                        <td colspan="6" class="text-center py-8 text-gray-500">
                                            <i class="fas fa-users text-4xl mb-2 text-gray-300"></i>
                                            <p class="text-lg">No walk-in applicants today</p>
                                            <p class="text-sm">Walk-in applicants will appear here when they arrive</p>
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="6" class="text-center py-8 text-gray-500">
                                        <i class="fas fa-users text-4xl mb-2 text-gray-300"></i>
                                        <p class="text-lg">No walk-in applicants today</p>
                                        <p class="text-sm">Walk-in applicants will appear here when they arrive</p>
                                    </td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
                <div class="bg-white p-4 rounded-lg shadow-md">
                    <h3 class="text-center font-semibold text-gray-700 mb-3 text-sm">Program Enrollment Distribution</h3>
                    <div class="flex justify-center">
                        <canvas id="doughnutChart" width="400" height="300" class="max-w-full"></canvas>
                    </div>
                </div>
                <div class="bg-white p-4 rounded-lg shadow-md flex flex-col justify-center items-center">
                    <h3 class="font-semibold text-gray-700 mb-3 text-sm">Monthly Application Trends</h3>
                    <div class="flex justify-center w-full">
                        <canvas id="barChart" width="400" height="300" class="max-w-full"></canvas>
                    </div>
                </div>
            </div>

            <!-- Summary Table -->
            <div class="container-card">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Summary Count of Applicants and Approved Applicants</h3>
                {% if Programss %}
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead>
                            <tr>
                                <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider rounded-tl-md">Program Name</th>
                                <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider">Number of Application</th>
                                <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider rounded-tr-md">Number of Approved Applicants</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            {% for prog in combined_programs %}
                                <tr class="odd:bg-gray-100">
                                    <td class="py-2 px-4 whitespace-nowrap">{{ prog.program_name }}</td>
                                    <td class="py-2 px-4 whitespace-nowrap">{{ prog.applied_count }}</td>
                                    <td class="py-2 px-4 whitespace-nowrap">{{ prog.approved_count }}</td>
                                </tr>
                            {% empty %}
                                <tr><td colspan="3" class="text-center">No programs found</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                    <h2>No programs available</h2>
                {% endif %}
            </div>
        </div>

        <!-- Clone Content -->
        <div id="cloneContent" class="hidden">

            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800">Enrollment Management</h3>
                <button onclick="showNewEventModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                    <i class="fas fa-plus mr-2"></i>Create Event
                </button>
            </div>

            <!-- Event Categories -->
            <div class="mb-6">
                <div class="flex space-x-4">
                    <button id="enrollmentCategoryBtn" onclick="selectCategory('enrollment')" 
                            class="px-4 py-2 rounded-lg bg-blue-600 text-white font-medium transition-colors">
                        <i class="fas fa-graduation-cap mr-2"></i>Enrollment
                    </button>
                    <button id="departmentalCategoryBtn" onclick="selectCategory('departmental')" 
                            class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 font-medium hover:bg-gray-300 transition-colors">
                        <i class="fas fa-building mr-2"></i>Departmental
                    </button>
                </div>
            </div>

            <!-- Batch and Trimester Selection (for Enrollment category) -->
            <div id="enrollmentControls" class="mb-6">
                <div class="bg-white p-4 rounded-lg shadow-md border border-gray-200">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">Batch & Trimester Selection</h4>
                    
                    <!-- Batch Selection -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Select Batch:</label>
                        <div class="flex space-x-3">
                            <button onclick="selectBatch(1)" id="batch1Btn" 
                                    class="batch-btn px-4 py-2 rounded-lg bg-blue-600 text-white font-medium transition-colors">
                                Batch 1
                            </button>
                            <button onclick="selectBatch(2)" id="batch2Btn" 
                                    class="batch-btn px-4 py-2 rounded-lg bg-gray-200 text-gray-700 font-medium hover:bg-gray-300 transition-colors">
                                Batch 2
                            </button>
                            <button onclick="selectBatch(3)" id="batch3Btn" 
                                    class="batch-btn px-4 py-2 rounded-lg bg-gray-200 text-gray-700 font-medium hover:bg-gray-300 transition-colors">
                                Batch 3
                            </button>
                        </div>
                    </div>

                    <!-- Trimester Selection -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Select Trimester:</label>
                        <div class="flex space-x-3">
                            <button onclick="selectTrimester(1)" id="trimester1Btn" 
                                    class="trimester-btn px-4 py-2 rounded-lg bg-green-600 text-white font-medium transition-colors">
                                1st Semester
                            </button>
                            <button onclick="selectTrimester(2)" id="trimester2Btn" 
                                    class="trimester-btn px-4 py-2 rounded-lg bg-gray-200 text-gray-700 font-medium hover:bg-gray-300 transition-colors">
                                2nd Semester
                            </button>
                            <button onclick="selectTrimester(3)" id="trimester3Btn" 
                                    class="trimester-btn px-4 py-2 rounded-lg bg-gray-200 text-gray-700 font-medium hover:bg-gray-300 transition-colors">
                                3rd Semester
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Calendar and Events Layout -->
            <div class="grid grid-cols-1 xl:grid-cols-3 gap-8 mb-8">
                <!-- Calendar Section - Takes 2/3 width on xl screens -->
                <div class="xl:col-span-2 bg-white p-8 rounded-xl shadow-lg border border-gray-100">
                    <div class="flex items-center justify-between mb-6">
                        <h4 class="text-xl font-bold text-gray-800 flex items-center">
                            <i class="fas fa-calendar-alt mr-3 text-blue-600"></i>Event Calendar
                        </h4>
                        <div class="text-sm text-gray-500">
                            <span id="currentMonthYear"></span>
                        </div>
                    </div>
                    <div id="enrollmentCalendar" class="calendar-container">
                        <!-- Calendar will be generated by JavaScript -->
                    </div>
                </div>

                <!-- Event Management Panel - Takes 1/3 width on xl screens -->
                <div class="bg-white p-8 rounded-xl shadow-lg border border-gray-100">
                    <h4 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-cog mr-3 text-green-600"></i>Event Management
                    </h4>
                    
                    <!-- Quick Actions -->
                    <div class="space-y-3 mb-6">
                        <button onclick="showNewEventModal()" class="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white px-4 py-3 rounded-lg text-sm font-medium transition-all duration-200 transform hover:scale-105 shadow-md">
                            <i class="fas fa-plus mr-2"></i>Create Event
                        </button>
                        <button onclick="editSelectedEvent()" class="w-full bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white px-4 py-3 rounded-lg text-sm font-medium transition-all duration-200 transform hover:scale-105 shadow-md">
                            <i class="fas fa-edit mr-2"></i>Edit Event
                        </button>
                        <button onclick="archiveSelectedEvent()" class="w-full bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white px-4 py-3 rounded-lg text-sm font-medium transition-all duration-200 transform hover:scale-105 shadow-md">
                            <i class="fas fa-archive mr-2"></i>Archive Event
                        </button>
                        <button onclick="removeSelectedEvent()" class="w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-4 py-3 rounded-lg text-sm font-medium transition-all duration-200 transform hover:scale-105 shadow-md">
                            <i class="fas fa-trash mr-2"></i>Remove Event
                        </button>
                    </div>

                    <!-- Selected Event Info -->
                    <div id="selectedEventInfo" class="bg-gradient-to-br from-gray-50 to-gray-100 p-6 rounded-xl border border-gray-200 shadow-inner">
                        <div class="text-center">
                            <i class="fas fa-calendar-check text-3xl text-gray-400 mb-3"></i>
                            <p class="text-gray-600 text-sm font-medium">Select an event from the calendar or table to manage it</p>
                            <p class="text-gray-500 text-xs mt-2">Click on any event to view details and actions</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Events Table -->
            <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
                <div class="bg-gradient-to-r from-gray-50 to-gray-100 px-8 py-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h4 class="text-xl font-bold text-gray-800 flex items-center">
                            <i class="fas fa-list-alt mr-3 text-purple-600"></i>Events List
                        </h4>
                        <div class="flex items-center space-x-4">
                            <div class="text-sm text-gray-600">
                                <span id="eventCount">0</span> events found
                            </div>
                            <button onclick="refreshEventsList()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                <i class="fas fa-sync-alt mr-2"></i>Refresh
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Table Container with better spacing -->
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gradient-to-r from-gray-100 to-gray-200">
                            <tr>
                                <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">
                                    <div class="flex items-center">
                                        <input type="checkbox" id="selectAllEvents" onchange="toggleAllEvents()" 
                                            class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                        <span class="ml-2">Select</span>
                                    </div>
                                </th>
                                <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">
                                    <i class="fas fa-tag mr-2"></i>Event Title
                                </th>
                                <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">
                                    <i class="fas fa-folder mr-2"></i>Category
                                </th>
                                <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">
                                    <i class="fas fa-calendar-day mr-2"></i>Start Date
                                </th>
                                <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">
                                    <i class="fas fa-calendar-check mr-2"></i>End Date
                                </th>
                                <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">
                                    <i class="fas fa-layer-group mr-2"></i>Batch/Trimester
                                </th>
                                <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">
                                    <i class="fas fa-info-circle mr-2"></i>Status
                                </th>
                                <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">
                                    <i class="fas fa-cogs mr-2"></i>Actions
                                </th>
                            </tr>
                        </thead>
                        <tbody id="eventsTableBody" class="bg-white divide-y divide-gray-100">
                            <!-- Events will be populated by JavaScript -->
                            <tr id="noEventsRow" class="hidden">
                                <td colspan="8" class="px-6 py-12 text-center">
                                    <div class="flex flex-col items-center justify-center">
                                        <i class="fas fa-calendar-times text-4xl text-gray-300 mb-4"></i>
                                        <h3 class="text-lg font-medium text-gray-500 mb-2">No Events Found</h3>
                                        <p class="text-gray-400 text-sm mb-4">Create your first event to get started</p>
                                        <button onclick="showNewEventModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                                            <i class="fas fa-plus mr-2"></i>Create Event
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </div>

        <!-- Program Management Content -->
        <div id="programManagementContent" class="container-card hidden">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 gap-4">
                <h3 class="text-xl font-bold text-gray-800">Program Management</h3>
                <div class="flex flex-col md:flex-row gap-4 w-full md:w-auto">
                    <!-- Search Filter -->
                    <div class="filter-control">
                        <label for="programSearchFilter" class="block text-sm font-medium text-gray-700 mb-1">Search Programs:</label>
                        <input type="text" id="programSearchFilter" placeholder="Search by program name..." class="w-full md:w-auto px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <!-- Items Per Page -->
                    <div class="items-per-page">
                        <label for="programItemsPerPage" class="block text-sm font-medium text-gray-700 mb-1">Show entries:</label>
                        <select id="programItemsPerPage" class="px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <option value="5">5</option>
                            <option value="10" selected>10</option>
                            <option value="25">25</option>
                            <option value="50">50</option>
                        </select>
                    </div>
                    <!-- Add Program Button -->
                    <div class="flex items-end">
                        <button id="addProgramBtn" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                            <i class="fas fa-plus mr-2"></i>Add Program
                        </button>
                    </div>
                </div>
            </div>

            <!-- Program Table -->
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead>
                        <tr>
                            <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider rounded-tl-md">Program Name</th>
                            <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider">Schedule</th>
                            <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider">Trainer</th>
                            <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider">Skills</th>
                            <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider rounded-tr-md">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="programTableBody" class="bg-white divide-y divide-gray-200">
                        {% if Programss %}
                            {% for program in Programss %}
                            <tr class="hover:bg-gray-50 transition-colors duration-200">
                                <td class="py-4 px-4 text-sm font-medium text-gray-900">
                                    <div class="flex items-center">
                                        <i class="fas fa-graduation-cap text-blue-500 mr-2"></i>
                                        {{ program.program_name }}
                                    </div>
                                </td>

                                <td class="py-4 px-4 text-sm text-gray-700">
                                    <div class="flex items-center">
                                        <i class="fas fa-clock text-green-500 mr-2"></i>
                                        {{ program.program_sched|default:"Schedule TBD" }}
                                    </div>
                                </td>
                                <td class="py-4 px-4 text-sm text-gray-700">
                                    <div class="flex items-center">
                                        <i class="fas fa-user-tie text-purple-500 mr-2"></i>
                                        {{ program.program_trainor|default:"No trainer assigned" }}
                                    </div>
                                </td>
                                <td class="py-4 px-4 text-sm text-gray-700">
                                    <div class="flex items-center">
                                        <i class="fas fa-tools text-orange-500 mr-2"></i>
                                        {{ program.program_skill|default:"Skills not specified" }}
                                    </div>
                                </td>
                                <td class="py-4 px-4 text-sm text-gray-500">
                                    <div class="flex items-center space-x-2">
                                        <button class="view-program-btn text-blue-600 hover:text-blue-900 transition-colors duration-200" 
                                                title="View Details"
                                                data-program-id="{{ program.id }}"
                                                data-program-name="{{ program.program_name }}"
                                                data-program-description="{{ program.program_detail|default:'No description available' }}"
                                                data-program-schedule="{{ program.program_sched|default:'Schedule TBD' }}"
                                                data-program-trainer="{{ program.program_trainor|default:'No trainer assigned' }}"
                                                data-program-skills="{{ program.program_skill|default:'Skills not specified' }}"
                                                data-program-image="{% if program.program_image %}{{ program.program_image.url }}{% endif %}">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="edit-program-btn text-green-600 hover:text-green-900 transition-colors duration-200" 
                                                title="Edit Program"
                                                data-program-id="{{ program.id }}"
                                                data-program-name="{{ program.program_name }}"
                                                data-program-description="{{ program.program_detail|default:'' }}"
                                                data-program-schedule="{{ program.program_sched|default:'' }}"
                                                data-program-trainer="{{ program.program_trainor|default:'' }}"
                                                data-program-skills="{{ program.program_skill|default:'' }}">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="delete-program-btn text-red-600 hover:text-red-900 transition-colors duration-200" 
                                                title="Delete Program"
                                                data-program-id="{{ program.id }}"
                                                data-program-name="{{ program.program_name }}">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        {% else %}
                            <tr id="programNoDataRow">
                                <td colspan="8" class="text-center py-8 text-gray-500">
                                    <i class="fas fa-graduation-cap text-4xl mb-2 text-gray-300"></i>
                                    <p class="text-lg">No programs available</p>
                                    <p class="text-sm">Click "Add Program" to create your first program</p>
                                </td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>

            <!-- Pagination Controls -->
            <div class="pagination-controls">
                <div class="pagination-info" id="programPaginationInfo">
                    {% if Programss %}
                        Showing {{ Programss|length }} program{{ Programss|length|pluralize }} total
                    {% else %}
                        Showing 0 programs
                    {% endif %}
                </div>
                <div class="pagination-nav" id="programPaginationNav">
                    <button onclick="changeProgramPage('prev')" id="programPrevBtn" disabled>Previous</button>
                    <div id="programPageNumbers"></div>
                    <button onclick="changeProgramPage('next')" id="programNextBtn" disabled>Next</button>
                </div>
            </div>
        </div>

        <!-- Report Content -->
        <div id="programsContent" class="container-card hidden">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 gap-4">
                <h3 class="text-xl font-bold text-gray-800">Reports</h3>
                <div class="flex flex-col md:flex-row gap-4 w-full md:w-auto">
                    <!-- Year Filter -->
                    <div class="filter-control">
                        <label for="reportYearFilter" class="block text-sm font-medium text-gray-700 mb-1">Filter by Year:</label>
                        <select id="reportYearFilter" onchange="filterReportsByYear()" class="w-full md:w-auto px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <option value="all">All Years</option>
                            <option value="2025" selected>2025</option>
                            <option value="2024">2024</option>
                            <option value="2023">2023</option>
                            <option value="2022">2022</option>
                        </select>
                    </div>
                    <!-- Program Filter -->
                    <div class="filter-control">
                        <label for="reportProgramFilter" class="block text-sm font-medium text-gray-700 mb-1">Filter by Program:</label>
                        <select id="reportProgramFilter" onchange="filterReportsByProgram()" class="w-full md:w-auto px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <option value="all">All Programs</option>
                            {% for program in Programss %}
                                <option value="{{ program.program_name }}">{{ program.program_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <!-- Status Filter -->
                    <div class="filter-control">
                        <label for="reportStatusFilter" class="block text-sm font-medium text-gray-700 mb-1">Filter by Status:</label>
                        <select id="reportStatusFilter" onchange="filterReportsByStatus()" class="w-full md:w-auto px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <option value="all">All Status</option>
                            <option value="approved">Approved (Current)</option>
                            <option value="complete">Complete (Passed)</option>
                        </select>
                    </div>
                </div>
            </div>
            <div id="reportCardsContainer" class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                {% for prog in Programss %}
                <!-- Approved (Current) Card -->
                <div class="bg-white p-6 rounded-lg shadow-md border border-gray-200 report-card"
                     data-program="{{ prog.program_name }}"
                     data-year="2025"
                     data-status="approved">
                    <div class="flex items-center justify-between mb-3">
                        <p class="text-lg font-semibold text-gray-800">{{ prog.program_name }}</p>
                        <span class="px-3 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded-full">
                            <i class="fas fa-user-check mr-1"></i>Approved
                        </span>
                    </div>
                    <p class="text-sm text-gray-600 mb-2">Program Trainor: {{ prog.program_trainor }}</p>
                    <p class="text-sm text-gray-600 mb-2">Approved Applicants: <span class="font-semibold text-blue-600">{{ prog.approved_count }}</span></p>
                    <p class="text-sm text-gray-600 mb-4">Year: <span class="font-medium text-blue-600">2025</span></p>
                    <div class="flex gap-2">
                        <button onclick="openProgramModal('{{ prog.id }}', 'approved')" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 text-sm">
                            <i class="fas fa-list mr-1"></i>View Approved List
                        </button>
                    </div>
                </div>
                
                <!-- Complete (Passed) Card -->
                <div class="bg-white p-6 rounded-lg shadow-md border border-gray-200 report-card"
                     data-program="{{ prog.program_name }}"
                     data-year="2025"
                     data-status="complete">
                    <div class="flex items-center justify-between mb-3">
                        <p class="text-lg font-semibold text-gray-800">{{ prog.program_name }}</p>
                        <span class="px-3 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full">
                            <i class="fas fa-graduation-cap mr-1"></i>Complete
                        </span>
                    </div>
                    <p class="text-sm text-gray-600 mb-2">Program Trainor: {{ prog.program_trainor }}</p>
                    <p class="text-sm text-gray-600 mb-2">Completed Applicants: <span class="font-semibold text-green-600">{{ prog.passed_count }}</span></p>
                    <p class="text-sm text-gray-600 mb-4">Year: <span class="font-medium text-blue-600">2025</span></p>
                    <div class="flex gap-2">
                        <button onclick="openProgramModal('{{ prog.id }}', 'complete')" class="bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 text-sm">
                            <i class="fas fa-certificate mr-1"></i>View Completed List
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
            <!-- No Results Message -->
            <div id="noReportsMessage" class="text-center py-8 text-gray-500 hidden">
                <i class="fas fa-search text-4xl mb-2 text-gray-300"></i>
                <p class="text-lg">No reports found</p>
                <p class="text-sm">Try adjusting your filters</p>
            </div>
        </div>

        <script>
        // Global filter variables for reports
        let reportCurrentYearFilter = 'all';
        let reportCurrentProgramFilter = 'all';
        let reportCurrentStatusFilter = 'all';

        // Filter reports by year
        function filterReportsByYear() {
            const yearFilter = document.getElementById('reportYearFilter').value;
            reportCurrentYearFilter = yearFilter;
            applyReportFilters();
        }

        // Filter reports by program
        function filterReportsByProgram() {
            const programFilter = document.getElementById('reportProgramFilter').value;
            reportCurrentProgramFilter = programFilter;
            applyReportFilters();
        }

        // Filter reports by status
        function filterReportsByStatus() {
            const statusFilter = document.getElementById('reportStatusFilter').value;
            reportCurrentStatusFilter = statusFilter;
            applyReportFilters();
        }

        // Apply all filters
        function applyReportFilters() {
            const reportCards = document.querySelectorAll('.report-card');
            const noResultsMessage = document.getElementById('noReportsMessage');
            let visibleCount = 0;

            reportCards.forEach(card => {
                const cardYear = card.getAttribute('data-year');
                const cardProgram = card.getAttribute('data-program');
                const cardStatus = card.getAttribute('data-status');
                
                let showCard = true;

                // Apply year filter
                if (reportCurrentYearFilter !== 'all' && cardYear !== reportCurrentYearFilter) {
                    showCard = false;
                }

                // Apply program filter
                if (reportCurrentProgramFilter !== 'all' && cardProgram !== reportCurrentProgramFilter) {
                    showCard = false;
                }

                // Apply status filter
                if (reportCurrentStatusFilter !== 'all' && cardStatus !== reportCurrentStatusFilter) {
                    showCard = false;
                }

                if (showCard) {
                    card.style.display = 'block';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });

            // Show/hide no results message
            if (visibleCount === 0) {
                noResultsMessage.classList.remove('hidden');
            } else {
                noResultsMessage.classList.add('hidden');
            }
        }

        // Update the openProgramModal function to use selected year
        function openProgramModal(programId) {
            const modal = document.getElementById('programModal');
            const modalTitle = document.getElementById('modalProgramTitle');
            const modalTableBody = document.getElementById('modalTableBody');
            
            // Get program data
            const program = programData[programId];
            
            if (!program) {
                alert('Program data not found');
                return;
            }

            // Get selected year for modal title
            const selectedYear = document.getElementById('reportYearFilter').value;
            const displayYear = selectedYear === 'all' ? '2025' : selectedYear;
            
            // Update modal title with selected year
            modalTitle.textContent = `${program.name} Master List Year ${displayYear}`;
            
            // Clear existing table content
            modalTableBody.innerHTML = '';
            
            // Populate table with student data
            if (program.students && program.students.length > 0) {
                program.students.forEach((student, index) => {
                    const row = document.createElement('tr');
                    row.className = index % 2 === 0 ? 'bg-gray-50' : 'bg-white';
                    row.innerHTML = `
                        <td class="border border-gray-300 p-3">${index + 1}</td>
                        <td class="border border-gray-300 p-3">${student.name}</td>
                        <td class="border border-gray-300 p-3">${student.program}</td>
                        <td class="border border-gray-300 p-3">${student.contact}</td>
                        <td class="border border-gray-300 p-3">${student.address}</td>
                        <td class="border border-gray-300 p-3">
                            <span class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium">
                                ${student.status}
                            </span>
                        </td>
                    `;
                    modalTableBody.appendChild(row);
                });
            } else {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="6" class="border border-gray-300 p-4 text-center text-gray-500">
                        No approved applicants found for this program in ${displayYear}
                    </td>
                `;
                modalTableBody.appendChild(row);
            }
            
            // Store current program ID and year for other functions
            modal.dataset.currentProgramId = programId;
            modal.dataset.currentYear = displayYear;
            
            // Show modal
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        // Update PDF download function to include year
        function downloadProgramPDF() {
            const modal = document.getElementById('programModal');
            const programId = modal.dataset.currentProgramId;
            const currentYear = modal.dataset.currentYear || '2025';
            const program = programData[programId];
            
            if (!program) {
                alert('Program data not found');
                return;
            }
            
            // Create a temporary element for PDF generation
            const tempElement = document.createElement('div');
            tempElement.style.cssText = `
                font-family: Arial, sans-serif;
                padding: 20px;
                background: white;
                color: black;
                width: 800px;
                margin: 0 auto;
            `;
            
            tempElement.innerHTML = `
                <div style="text-align: center; margin-bottom: 30px; border-bottom: 2px solid #1e40af; padding-bottom: 15px;">
                    <h1 style="color: #1e40af; margin: 0; font-size: 24px;">Lucena Manpower Skill Training Center</h1>
                    <h2 style="color: #374151; margin: 10px 0; font-size: 18px;">Dalubhasaan Ng Lungsod Ng Lucena</h2>
                    <h3 style="color: #374151; margin: 5px 0; font-size: 16px;">${program.name} Master List Year ${currentYear}</h3>
                </div>
                ${document.querySelector('#programModal .overflow-x-auto').innerHTML}
            `;
            
            // Add to body temporarily
            document.body.appendChild(tempElement);
            
            // Generate PDF
            const opt = {
                margin: [10, 10, 10, 10],
                filename: `${program.name.replace(/\s+/g, '_')}_Master_List_${currentYear}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: {
                    scale: 2,
                    useCORS: true,
                    letterRendering: true
                },
                jsPDF: {
                    unit: 'mm',
                    format: 'a4',
                    orientation: 'landscape'
                }
            };
            
            html2pdf().set(opt).from(tempElement).save().then(() => {
                // Remove temporary element
                document.body.removeChild(tempElement);
            });
        }

        // Initialize report filters when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Set default year filter to 2025
            const yearFilter = document.getElementById('reportYearFilter');
            if (yearFilter) {
                yearFilter.value = '2025';
                applyReportFilters();
            }
        });
        </script>

        <!-- Program Modal -->
        <div id="programModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-6xl max-h-[90vh] overflow-y-auto relative mx-4">
                <button onclick="closeProgramModal()" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-2xl font-bold z-10">
                    &times;
                </button>
                
                <!-- Header Section -->
                <div class="text-center mb-6 border-b pb-4">
                    <div class="flex items-center justify-center mb-4">
                        <img src="{% static 'Images/icon.png' %}" alt="Logo" class="w-16 h-16 mr-4">
                        <div>
                            <h1 class="text-2xl font-bold text-blue-700">Lucena Manpower Skill Training Center</h1>
                            <h2 class="text-lg text-gray-600">Dalubhasaan Ng Lungsod Ng Lucena</h2>
                        </div>
                    </div>
                    <h3 id="modalProgramTitle" class="text-xl font-bold text-gray-800">Program Master List Year 2025</h3>
                </div>

                <!-- Table Section -->
                <div class="overflow-x-auto">
                    <table class="w-full table-auto border-collapse border border-gray-300">
                        <thead>
                            <tr class="bg-blue-500 text-white">
                                <th class="border border-gray-300 p-3 text-left font-semibold">No.</th>
                                <th class="border border-gray-300 p-3 text-left font-semibold">Student Name</th>
                                <th class="border border-gray-300 p-3 text-left font-semibold">Program Applied</th>
                                <th class="border border-gray-300 p-3 text-left font-semibold">Contact</th>
                                <th class="border border-gray-300 p-3 text-left font-semibold">Address</th>
                                <th class="border border-gray-300 p-3 text-left font-semibold">Status</th>
                            </tr>
                        </thead>
                        <tbody id="modalTableBody">
                            <!-- Table content will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>

                <!-- Action Buttons -->
                <div class="flex justify-end mt-6 space-x-4 border-t pt-4">
                    <button onclick="printProgramReport()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                        <i class="fas fa-print mr-2"></i>Print Report
                    </button>
                    <button onclick="downloadProgramPDF()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                        <i class="fas fa-download mr-2"></i>Download PDF
                    </button>
                    <button onclick="closeProgramModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                        Close
                    </button>
                </div>
            </div>
        </div>

        <script>
        // Program data - simplified approach
        const programData = {};

        function openProgramModal(programId) {
            const modal = document.getElementById('programModal');
            const modalTitle = document.getElementById('modalProgramTitle');
            const modalTableBody = document.getElementById('modalTableBody');
            
            // Get program data
            const program = programData[programId];
            
            if (!program) {
                alert('Program data not found');
                return;
            }
            
            // Update modal title
            modalTitle.textContent = `${program.name} Master List Year 2025`;
            
            // Clear existing table content
            modalTableBody.innerHTML = '';
            
            // Populate table with student data
            if (program.students && program.students.length > 0) {
                program.students.forEach((student, index) => {
                    const row = document.createElement('tr');
                    row.className = index % 2 === 0 ? 'bg-gray-50' : 'bg-white';
                    row.innerHTML = `
                        <td class="border border-gray-300 p-3">${index + 1}</td>
                        <td class="border border-gray-300 p-3">${student.name}</td>
                        <td class="border border-gray-300 p-3">${student.program}</td>
                        <td class="border border-gray-300 p-3">${student.contact}</td>
                        <td class="border border-gray-300 p-3">${student.address}</td>
                        <td class="border border-gray-300 p-3">
                            <span class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium">
                                ${student.status}
                            </span>
                        </td>
                    `;
                    modalTableBody.appendChild(row);
                });
            } else {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="6" class="border border-gray-300 p-4 text-center text-gray-500">
                        No approved applicants found for this program
                    </td>
                `;
                modalTableBody.appendChild(row);
            }
            
            // Store current program ID for other functions
            modal.dataset.currentProgramId = programId;
            
            // Show modal
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeProgramModal() {
            const modal = document.getElementById('programModal');
            modal.classList.remove('flex');
            modal.classList.add('hidden');
        }

        function printProgramReport() {
            const modalContent = document.querySelector('#programModal .bg-white');
            const printWindow = window.open('', '_blank');
            
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Program Report</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #3b82f6; color: white; }
                        tr:nth-child(even) { background-color: #f9f9f9; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .logo { width: 60px; height: 60px; }
                        @media print {
                            .no-print { display: none; }
                        }
                    </style>
                </head>
                <body>
                    ${modalContent.innerHTML.replace(/class="[^"]*no-print[^"]*"/g, 'style="display:none"')}
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.print();
        }

        function downloadProgramPDF() {
            const modal = document.getElementById('programModal');
            const programId = modal.dataset.currentProgramId;
            const program = programData[programId];
            
            if (!program) {
                alert('Program data not found');
                return;
            }
            
            // Create a temporary element for PDF generation
            const tempElement = document.createElement('div');
            tempElement.style.cssText = `
                font-family: Arial, sans-serif;
                padding: 20px;
                background: white;
                color: black;
                width: 800px;
                margin: 0 auto;
            `;
            
            tempElement.innerHTML = `
                <div style="text-align: center; margin-bottom: 30px; border-bottom: 2px solid #1e40af; padding-bottom: 15px;">
                    <h1 style="color: #1e40af; margin: 0; font-size: 24px;">Lucena Manpower Skill Training Center</h1>
                    <h2 style="color: #374151; margin: 10px 0; font-size: 18px;">Dalubhasaan Ng Lungsod Ng Lucena</h2>
                    <h3 style="color: #374151; margin: 5px 0; font-size: 16px;">${program.name} Master List Year 2025</h3>
                </div>
                ${document.querySelector('#programModal .overflow-x-auto').innerHTML}
            `;
            
            // Add to body temporarily
            document.body.appendChild(tempElement);
            
            // Generate PDF
            const opt = {
                margin: [10, 10, 10, 10],
                filename: `${program.name.replace(/\s+/g, '_')}_Master_List_2025.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: {
                     scale: 2,
                    useCORS: true,
                    letterRendering: true
                 },
                jsPDF: {
                     unit: 'mm',
                     format: 'a4',
                     orientation: 'landscape'
                 }
            };
            
            html2pdf().set(opt).from(tempElement).save().then(() => {
                // Remove temporary element
                document.body.removeChild(tempElement);
            });
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('programModal');
            if (event.target === modal) {
                closeProgramModal();
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const modal = document.getElementById('programModal');
                if (!modal.classList.contains('hidden')) {
                    closeProgramModal();
                }
            }
        });
        </script>

        <!-- Advanced Document Management System -->
        <div id="documentManagementContent" class="container-card hidden">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800">Document Management</h3>
                <button onclick="showDocumentUpload()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                    <i class="fas fa-upload mr-2"></i>Upload Documents
                </button>
            </div>

            <!-- Document Management Tabs -->
            <div class="mb-6">
                <nav class="flex space-x-8" aria-label="Tabs">
                    <button onclick="showDocTab('overview')" id="docTab-overview" class="doc-tab-active whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                        <i class="fas fa-tachometer-alt mr-2"></i>Overview
                    </button>
                    <button onclick="showDocTab('ocr')" id="docTab-ocr" class="doc-tab whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                        <i class="fas fa-eye mr-2"></i>OCR Processing
                    </button>
                    <button onclick="showDocTab('bulk')" id="docTab-bulk" class="doc-tab whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                        <i class="fas fa-layer-group mr-2"></i>Bulk Operations
                    </button>
                    <button onclick="showDocTab('search')" id="docTab-search" class="doc-tab whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                        <i class="fas fa-search mr-2"></i>Document Search
                    </button>
                    <button onclick="showDocTab('applicant-profiles')" id="docTab-applicant-profiles" class="doc-tab whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                        <i class="fas fa-users mr-2"></i>Applicant Profiles
                    </button>
                </nav>
            </div>

            <!-- Tab Content -->
            <div id="docContent-overview" class="doc-content">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 p-6 rounded-lg text-white">
                        <div class="flex items-center">
                            <i class="fas fa-file-alt text-3xl mr-4"></i>
                            <div>
                                <p class="text-blue-100">Total Documents</p>
                                <p class="text-2xl font-bold">1,247</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gradient-to-r from-green-500 to-green-600 p-6 rounded-lg text-white">
                        <div class="flex items-center">
                            <i class="fas fa-check-circle text-3xl mr-4"></i>
                            <div>
                                <p class="text-green-100">Approved</p>
                                <p class="text-2xl font-bold">892</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gradient-to-r from-yellow-500 to-yellow-600 p-6 rounded-lg text-white">
                        <div class="flex items-center">
                            <i class="fas fa-clock text-3xl mr-4"></i>
                            <div>
                                <p class="text-yellow-100">Pending Review</p>
                                <p class="text-2xl font-bold">234</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 p-6 rounded-lg text-white">
                        <div class="flex items-center">
                            <i class="fas fa-signature text-3xl mr-4"></i>
                            <div>
                                <p class="text-purple-100">Signed Documents</p>
                                <p class="text-2xl font-bold">567</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Documents -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h4 class="text-lg font-semibold mb-4">Recent Documents</h4>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Document</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Version</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <i class="fas fa-file-pdf text-red-500 mr-3"></i>
                                            <span class="text-sm font-medium text-gray-900">Application_Form_2025.pdf</span>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Application</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Approved</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">v2.1</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <button class="text-blue-600 hover:text-blue-900 mr-3">View</button>
                                        <button class="text-green-600 hover:text-green-900">Download</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>


            <!-- OCR Processing Tab -->
            <div id="docContent-ocr" class="doc-content hidden">
                <div class="bg-white rounded-lg shadow p-6">
                    <h4 class="text-lg font-semibold mb-4">OCR Document Processing</h4>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center">
                                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                                <p class="text-gray-500 mb-4">Upload Excel document for OCR processing</p>
                                <button onclick="openFileSelectionModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                    Choose File
                                </button>
                            </div>
                            <div class="mt-4">
                                <h5 class="font-medium mb-2">Processing Status</h5>
                                <div id="ocrStatus" class="text-sm text-gray-600">Ready to process files</div>
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>


            <!-- Bulk Operations Tab -->
            <div id="docContent-bulk" class="doc-content hidden">
                <div class="bg-white rounded-lg shadow p-6">
                    <h4 class="text-lg font-semibold mb-4">Bulk Document Operations</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div class="border rounded-lg p-4">
                                <h5 class="font-medium mb-2">Bulk Upload</h5>
                                <p class="text-sm text-gray-600 mb-3">Upload multiple documents at once</p>
                                <button class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
                                    <i class="fas fa-upload mr-2"></i>Select Files
                                </button>
                            </div>
                            
                            <div class="border rounded-lg p-4">
                                <h5 class="font-medium mb-2">Bulk Download</h5>
                                <p class="text-sm text-gray-600 mb-3">Download selected documents as ZIP</p>
                                <button class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700" onclick="openBulkDownloadModal()">
                                    <i class="fas fa-download mr-2"></i>Download Selected
                                </button>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="border rounded-lg p-4">
                                <h5 class="font-medium mb-2">Bulk Review</h5>
                                <p class="text-sm text-gray-600 mb-3">Review multiple applications for completeness</p>
                                <button class="w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700" onclick="openBulkReviewModal()">
                                    <i class="fas fa-search mr-2"></i>Review All
                                </button>
                            </div>
                            
                            <div class="border rounded-lg p-4">
                                <h5 class="font-medium mb-2">Bulk Approval</h5>
                                <p class="text-sm text-gray-600 mb-3">Approve multiple documents</p>
                                <button class="w-full bg-orange-600 text-white py-2 rounded-lg hover:bg-orange-700" onclick="openBulkApprovalModal()">
                                    <i class="fas fa-check-double mr-2"></i>Approve Selected
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Document Search Tab -->
            <div id="docContent-search" class="doc-content hidden">
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h4 class="text-lg font-semibold">Document Search</h4>
                        <div class="flex space-x-4">
                            <!-- Search Bar -->
                            <div class="flex space-x-2">
                                <input type="text" id="documentSearchInput" placeholder="Search by applicant name..." 
                                       class="border border-gray-300 rounded-lg px-3 py-2 text-sm w-64">
                                <button onclick="performDocumentSearch()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm">
                                    <i class="fas fa-search mr-2"></i>Search
                                </button>
                            </div>
                            <!-- Show Entities Dropdown -->
                            <select id="documentShowEntities" onchange="changeDocumentEntitiesPerPage()" class="border border-gray-300 rounded-lg px-3 py-2 text-sm">
                                <option value="5">Show 5</option>
                                <option value="10" selected>Show 10</option>
                            </select>
                            <!-- Filter Controls -->
                            <div class="flex space-x-2">
                                <select id="documentBatchFilter" class="border border-gray-300 rounded-lg px-3 py-2 text-sm">
                                    <option value="">All Batches</option>
                                    <option value="batch_1">Batch 1</option>
                                    <option value="batch_2">Batch 2</option>
                                    <option value="batch_3">Batch 3</option>
                                    <option value="batch_4">Batch 4</option>
                                    <option value="batch_5">Batch 5</option>
                                </select>
                                <select id="documentProgramFilter" class="border border-gray-300 rounded-lg px-3 py-2 text-sm">
                                    <option value="">All Programs</option>
                                    {% for program in programs %}
                                    <option value="{{ program.id }}">{{ program.program_name }}</option>
                                    {% endfor %}
                                </select>
                                <button onclick="applyDocumentFilters()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm">
                                    <i class="fas fa-filter mr-2"></i>Filter
                                </button>
                                <button onclick="clearDocumentFilters()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm">
                                    <i class="fas fa-times mr-2"></i>Clear
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Document Search Results Table -->
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white border border-gray-200 rounded-lg">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Document Type</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Applicant Name</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Program</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Upload Date</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Batch</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="documentSearchTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Mock data will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <div id="documentSearchPagination" class="flex items-center justify-between mt-6">
                        <div class="text-sm text-gray-700">
                            Showing <span id="documentResultsStart">0</span> to <span id="documentResultsEnd">0</span> of <span id="documentResultsTotal">0</span> results
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="previousDocumentPage()" id="documentPrevBtn" class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50">
                                Previous
                            </button>
                            <button onclick="nextDocumentPage()" id="documentNextBtn" class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50">
                                Next
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Applicant Profiles Tab -->
            <div id="docContent-applicant-profiles" class="doc-content hidden">
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h4 class="text-lg font-semibold">Applicant Profile Information</h4>
                        <div class="flex space-x-4">
                            <!-- Filter Controls -->
                            <div class="flex space-x-2">
                                <select id="batchFilter" class="border border-gray-300 rounded-lg px-3 py-2 text-sm">
                                    <option value="">All Batches</option>
                                    <option value="1st-trimester">1st Trimester</option>
                                    <option value="2nd-trimester">2nd Trimester</option>
                                    <option value="3rd-trimester">3rd Trimester</option>
                                </select>
                                <select id="yearFilter" class="border border-gray-300 rounded-lg px-3 py-2 text-sm">
                                    <option value="">All Years</option>
                                    <option value="2024">2024</option>
                                    <option value="2025">2025</option>
                                    <option value="2026">2026</option>
                                </select>
                                <select id="programFilter" class="border border-gray-300 rounded-lg px-3 py-2 text-sm">
                                    <option value="">All Programs</option>
                                    <option value="welding">Welding</option>
                                    <option value="automotive">Automotive</option>
                                    <option value="electrical">Electrical</option>
                                    <option value="plumbing">Plumbing</option>
                                    <option value="carpentry">Carpentry</option>
                                </select>
                                <button onclick="applyApplicantFilters()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm">
                                    <i class="fas fa-filter mr-2"></i>Filter
                                </button>
                                <button onclick="clearApplicantFilters()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm">
                                    <i class="fas fa-times mr-2"></i>Clear
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Learner Profiles Table -->
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white border border-gray-200 rounded-lg">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID Picture</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Full Name</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Program Completed</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Entry Date</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Batch</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="applicantProfilesTableBody" class="bg-white divide-y divide-gray-200">
                                {% for learner_profile in profile %}
                                <tr class="hover:bg-gray-50">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex-shrink-0 h-12 w-12">
                                            {% if learner_profile.id_picture %}
                                                <img class="h-12 w-12 rounded-full object-cover border-2 border-gray-200" 
                                                     src="{{ learner_profile.id_picture.url }}" 
                                                     alt="ID Picture"
                                                     onerror="this.src='/static/images/default-avatar.png'">
                                            {% else %}
                                                <img class="h-12 w-12 rounded-full object-cover border-2 border-gray-200" 
                                                     src="/static/images/default-avatar.png" 
                                                     alt="Default Avatar">
                                            {% endif %}
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm font-medium text-gray-900">
                                            {{ learner_profile.first_name }} {{ learner_profile.middle_name|default:"" }} {{ learner_profile.last_name }}
                                        </div>
                                        <div class="text-sm text-gray-500">{{ learner_profile.email }}</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {% for passed_program in learner_profile.user.passed_programs.all %}
                                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800 mr-1 mb-1">
                                                {{ passed_program.program_name }}
                                            </span>
                                        {% empty %}
                                            {% for approved_program in learner_profile.user.approved_programs.all %}
                                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800 mr-1 mb-1">
                                                    {{ approved_program.program.program_name }} (In Progress)
                                                </span>
                                            {% empty %}
                                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">
                                                    No Program
                                                </span>
                                            {% endfor %}
                                        {% endfor %}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                        {{ learner_profile.entry_date|date:"Y-m-d"|default:"N/A" }}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                        {% if learner_profile.course_or_qualification %}
                                            {{ learner_profile.course_or_qualification }}
                                        {% else %}
                                            N/A
                                        {% endif %}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <button onclick="viewLearnerProfile({{ learner_profile.id }})" class="text-blue-600 hover:text-blue-900 mr-3">
                                            <i class="fas fa-eye mr-1"></i>View
                                        </button>
                                        <button onclick="downloadLearnerProfile({{ learner_profile.id }})" class="text-green-600 hover:text-green-900">
                                            <i class="fas fa-download mr-1"></i>Download
                                        </button>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="6" class="px-6 py-4 text-center text-gray-500">
                                        <i class="fas fa-users text-4xl mb-4"></i>
                                        <p>No learner profiles found</p>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <div class="flex items-center justify-between mt-6">
                        <div class="text-sm text-gray-700">
                            Showing <span class="font-medium">1</span> to <span class="font-medium">3</span> of <span class="font-medium">3</span> results
                        </div>
                        <div class="flex space-x-2">
                            <button class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50">
                                Previous
                            </button>
                            <button class="px-3 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-lg">
                                1
                            </button>
                            <button class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50">
                                Next
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
        // Document Management Tab Functions
        function showDocTab(tabName) {
            // Hide all content
            document.querySelectorAll('.doc-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('[id^="docTab-"]').forEach(tab => {
                tab.classList.remove('doc-tab-active');
                tab.classList.add('doc-tab');
            });
            
            // Show selected content
            document.getElementById('docContent-' + tabName).classList.remove('hidden');
            
            // Add active class to selected tab
            const activeTab = document.getElementById('docTab-' + tabName);
            activeTab.classList.add('doc-tab-active');
            activeTab.classList.remove('doc-tab');
        }

        function showDocumentUpload() {
            document.getElementById('uploadDocumentModal').classList.remove('hidden');
        }

        function closeUploadDocumentModal() {
            document.getElementById('uploadDocumentModal').classList.add('hidden');
            resetUploadForm();
        }

        function selectDocumentType(type) {
            // Reset all selections
            document.querySelectorAll('input[name="document_type"]').forEach(radio => {
                radio.checked = false;
                radio.closest('.border-2').classList.remove('border-blue-500', 'border-green-500', 'border-purple-500');
                radio.closest('.border-2').classList.add('border-gray-200');
            });

            // Select the chosen type
            const selectedRadio = document.getElementById(`type_${type}`);
            selectedRadio.checked = true;
            
            // Update visual selection
            const container = selectedRadio.closest('.border-2');
            container.classList.remove('border-gray-200');
            if (type === 'applicant_profile') {
                container.classList.add('border-blue-500');
            } else if (type === 'manual') {
                container.classList.add('border-green-500');
            } else if (type === 'policy') {
                container.classList.add('border-purple-500');
            }

            // Show form fields
            showDocumentFields(type);
            
            // Enable upload button
            document.getElementById('uploadBtn').disabled = false;
        }

        function showDocumentFields(type) {
            // Hide all specific fields first
            document.getElementById('applicantProfileFields').classList.add('hidden');
            document.getElementById('manualPolicyFields').classList.add('hidden');
            document.getElementById('policySpecificFields').classList.add('hidden');
            
            // Show common form
            document.getElementById('documentDetailsForm').classList.remove('hidden');
            
            // Show type-specific fields
            if (type === 'applicant_profile') {
                document.getElementById('applicantProfileFields').classList.remove('hidden');
            } else if (type === 'manual' || type === 'policy') {
                document.getElementById('manualPolicyFields').classList.remove('hidden');
                
                if (type === 'policy') {
                    document.getElementById('policySpecificFields').classList.remove('hidden');
                }
                
                // Load categories for the selected type
                loadCategories(type);
            }
        }

        function loadCategories(type) {
            // This would typically make an AJAX call to get categories
            // For now, we'll populate with sample data
            const categorySelect = document.querySelector('select[name="category_id"]');
            categorySelect.innerHTML = '<option value="">Select a category...</option>';
            
            if (type === 'manual') {
                categorySelect.innerHTML += `
                    <option value="1">Training Materials</option>
                    <option value="2">Equipment Manuals</option>
                    <option value="3">Safety Procedures</option>
                    <option value="4">Assessment Guides</option>
                `;
            } else if (type === 'policy') {
                categorySelect.innerHTML += `
                    <option value="5">Academic Policies</option>
                    <option value="6">Administrative Policies</option>
                    <option value="7">Safety Policies</option>
                    <option value="8">Student Conduct</option>
                `;
            }
        }

        function handleFileSelect(input) {
            const file = input.files[0];
            if (file) {
                // Check file size (10MB limit)
                if (file.size > 10 * 1024 * 1024) {
                    alert('File size must be less than 10MB');
                    input.value = '';
                    return;
                }
                
                // Show file preview
                document.getElementById('fileUploadArea').classList.add('hidden');
                document.getElementById('filePreview').classList.remove('hidden');
                document.getElementById('fileName').textContent = file.name;
            }
        }

        function removeFile() {
            document.getElementById('documentFile').value = '';
            document.getElementById('fileUploadArea').classList.remove('hidden');
            document.getElementById('filePreview').classList.add('hidden');
        }

        function resetUploadForm() {
            document.getElementById('documentUploadForm').reset();
            document.getElementById('documentDetailsForm').classList.add('hidden');
            document.getElementById('applicantProfileFields').classList.add('hidden');
            document.getElementById('manualPolicyFields').classList.add('hidden');
            document.getElementById('policySpecificFields').classList.add('hidden');
            document.getElementById('uploadBtn').disabled = true;
            
            // Reset visual selections
            document.querySelectorAll('.border-2').forEach(container => {
                container.classList.remove('border-blue-500', 'border-green-500', 'border-purple-500');
                container.classList.add('border-gray-200');
            });
            
            removeFile();
        }

        function uploadDocument() {
            const form = document.getElementById('documentUploadForm');
            const formData = new FormData(form);
            
            // Show loading state
            const uploadBtn = document.getElementById('uploadBtn');
            const originalText = uploadBtn.innerHTML;
            uploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Uploading...';
            uploadBtn.disabled = true;
            
            // Make AJAX request to upload document
            fetch('/upload-document/', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Document uploaded successfully!');
                    closeUploadDocumentModal();
                    // Refresh the document list if needed
                    performDocumentSearch();
                } else {
                    alert('Error uploading document: ' + (data.error || 'Unknown error'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error uploading document. Please try again.');
            })
            .finally(() => {
                uploadBtn.innerHTML = originalText;
                uploadBtn.disabled = false;
            });
        }

        // Document Search Functions
        let documentCurrentPage = 1;
        let documentTotalResults = 0;
        let documentResultsPerPage = 10;

        // Mock document data with applicant names
        const mockDocuments = [
            {
                id: 1,
                documentType: "Application Form",
                applicantName: "John Smith",
                program: "Welding",
                uploadDate: "2024-01-15",
                batch: "batch_1"
            },
            {
                id: 2,
                documentType: "ID Copy",
                applicantName: "Maria Garcia",
                program: "Automotive",
                uploadDate: "2024-01-20",
                batch: "batch_2"
            },
            {
                id: 3,
                documentType: "Certificate",
                applicantName: "Robert Johnson",
                program: "Electrical",
                uploadDate: "2024-02-01",
                batch: "batch_1"
            },
            {
                id: 4,
                documentType: "Transcript",
                applicantName: "Lisa Brown",
                program: "Carpentry",
                uploadDate: "2024-02-10",
                batch: "batch_3"
            },
            {
                id: 5,
                documentType: "Medical Certificate",
                applicantName: "David Wilson",
                program: "Plumbing",
                uploadDate: "2024-02-15",
                batch: "batch_2"
            },
            {
                id: 6,
                documentType: "Application Form",
                applicantName: "Sarah Davis",
                program: "Welding",
                uploadDate: "2024-03-01",
                batch: "batch_4"
            },
            {
                id: 7,
                documentType: "ID Copy",
                applicantName: "Michael Miller",
                program: "Automotive",
                uploadDate: "2024-03-05",
                batch: "batch_1"
            },
            {
                id: 8,
                documentType: "Certificate",
                applicantName: "Jennifer Taylor",
                program: "Electrical",
                uploadDate: "2024-03-10",
                batch: "batch_5"
            },
            {
                id: 9,
                documentType: "Transcript",
                applicantName: "Christopher Anderson",
                program: "Carpentry",
                uploadDate: "2024-03-15",
                batch: "batch_2"
            },
            {
                id: 10,
                documentType: "Medical Certificate",
                applicantName: "Amanda Thomas",
                program: "Plumbing",
                uploadDate: "2024-03-20",
                batch: "batch_3"
            },
            {
                id: 11,
                documentType: "Application Form",
                applicantName: "James Jackson",
                program: "Welding",
                uploadDate: "2024-04-01",
                batch: "batch_1"
            },
            {
                id: 12,
                documentType: "ID Copy",
                applicantName: "Jessica White",
                program: "Automotive",
                uploadDate: "2024-04-05",
                batch: "batch_4"
            }
        ];

        function performDocumentSearch() {
            const searchQuery = document.getElementById('documentSearchInput').value.toLowerCase();
            const batchFilter = document.getElementById('documentBatchFilter').value;
            const programFilter = document.getElementById('documentProgramFilter').value;

            // Filter documents based on search criteria
            let filteredDocuments = mockDocuments.filter(doc => {
                let matchesSearch = true;
                let matchesBatch = true;
                let matchesProgram = true;

                // Search by applicant name (first or last name)
                if (searchQuery) {
                    const nameParts = doc.applicantName.toLowerCase().split(' ');
                    matchesSearch = nameParts.some(part => part.includes(searchQuery)) || 
                                   doc.applicantName.toLowerCase().includes(searchQuery);
                }

                // Filter by batch
                if (batchFilter) {
                    matchesBatch = doc.batch === batchFilter;
                }

                // Filter by program
                if (programFilter) {
                    matchesProgram = doc.program.toLowerCase().includes(programFilter.toLowerCase());
                }

                return matchesSearch && matchesBatch && matchesProgram;
            });

            displayDocumentSearchResults(filteredDocuments);
        }

        function displayDocumentSearchResults(documents) {
            const tableBody = document.getElementById('documentSearchTableBody');
            documentTotalResults = documents.length;

            if (documents.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-4 text-center text-gray-500">
                            <i class="fas fa-search text-4xl mb-4"></i>
                            <p>No documents found matching your criteria</p>
                        </td>
                    </tr>
                `;
                updateDocumentPagination(0, 0, 0);
                return;
            }

            // Calculate pagination
            const startIndex = (documentCurrentPage - 1) * documentResultsPerPage;
            const endIndex = Math.min(startIndex + documentResultsPerPage, documents.length);
            const pageDocuments = documents.slice(startIndex, endIndex);

            // Generate table rows
            let tableHTML = '';
            pageDocuments.forEach(doc => {
                tableHTML += `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${doc.documentType}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900">${doc.applicantName}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                                ${doc.program}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${doc.uploadDate}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${doc.batch.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button onclick="viewDocument(${doc.id})" class="text-blue-600 hover:text-blue-900">
                                <i class="fas fa-eye mr-1"></i>View
                            </button>
                        </td>
                    </tr>
                `;
            });

            tableBody.innerHTML = tableHTML;
            updateDocumentPagination(startIndex + 1, endIndex, documentTotalResults);
        }

        function updateDocumentPagination(start, end, total) {
            document.getElementById('documentResultsStart').textContent = start;
            document.getElementById('documentResultsEnd').textContent = end;
            document.getElementById('documentResultsTotal').textContent = total;

            // Update button states
            const prevBtn = document.getElementById('documentPrevBtn');
            const nextBtn = document.getElementById('documentNextBtn');
            
            prevBtn.disabled = documentCurrentPage <= 1;
            nextBtn.disabled = documentCurrentPage >= Math.ceil(total / documentResultsPerPage);
        }

        function previousDocumentPage() {
            if (documentCurrentPage > 1) {
                documentCurrentPage--;
                performDocumentSearch();
            }
        }

        function nextDocumentPage() {
            const maxPages = Math.ceil(documentTotalResults / documentResultsPerPage);
            if (documentCurrentPage < maxPages) {
                documentCurrentPage++;
                performDocumentSearch();
            }
        }

        function changeDocumentEntitiesPerPage() {
            const showEntities = document.getElementById('documentShowEntities');
            documentResultsPerPage = parseInt(showEntities.value);
            documentCurrentPage = 1; // Reset to first page
            performDocumentSearch();
        }

        function applyDocumentFilters() {
            documentCurrentPage = 1; // Reset to first page
            performDocumentSearch();
        }

        function clearDocumentFilters() {
            document.getElementById('documentSearchInput').value = '';
            document.getElementById('documentBatchFilter').value = '';
            document.getElementById('documentProgramFilter').value = '';
            documentCurrentPage = 1;
            performDocumentSearch();
        }

        function viewDocument(documentId) {
            alert(`Viewing document with ID: ${documentId}`);
            // Implement actual document viewing logic here
        }

        // Add event listeners for document search
        document.addEventListener('DOMContentLoaded', function() {
            // Add enter key support for document search input
            const documentSearchInput = document.getElementById('documentSearchInput');
            if (documentSearchInput) {
                documentSearchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        documentCurrentPage = 1;
                        performDocumentSearch();
                    }
                });
            }

            // Add change listeners for document filters
            const documentFilters = ['documentBatchFilter', 'documentProgramFilter'];
            documentFilters.forEach(filterId => {
                const element = document.getElementById(filterId);
                if (element) {
                    element.addEventListener('change', function() {
                        documentCurrentPage = 1;
                        performDocumentSearch();
                    });
                }
            });

            // Load initial document search results
            performDocumentSearch();
        });

        // Applicant Profile Functions
        function applyApplicantFilters() {
            const batchFilter = document.getElementById('batchFilter').value;
            const yearFilter = document.getElementById('yearFilter').value;
            const programFilter = document.getElementById('programFilter').value;
            
            const tableRows = document.querySelectorAll('#applicantProfilesTableBody tr');
            let visibleCount = 0;
            
            tableRows.forEach(row => {
                const batch = row.querySelector('td:nth-child(5)').textContent.trim();
                const entryDate = row.querySelector('td:nth-child(4)').textContent.trim();
                const program = row.querySelector('td:nth-child(3) span').textContent.trim();
                
                const entryYear = entryDate ? entryDate.split('-')[0] : '';
                
                let showRow = true;
                
                // Apply batch filter
                if (batchFilter && !batch.toLowerCase().includes(batchFilter.replace('-', ' ').toLowerCase())) {
                    showRow = false;
                }
                
                // Apply year filter
                if (yearFilter && entryYear !== yearFilter) {
                    showRow = false;
                }
                
                // Apply program filter
                if (programFilter && !program.toLowerCase().includes(programFilter.toLowerCase())) {
                    showRow = false;
                }
                
                if (showRow) {
                    row.style.display = '';
                    visibleCount++;
                } else {
                    row.style.display = 'none';
                }
            });
            
            // Update pagination info
            updateApplicantPaginationInfo(visibleCount);
        }

        function clearApplicantFilters() {
            document.getElementById('batchFilter').value = '';
            document.getElementById('yearFilter').value = '';
            document.getElementById('programFilter').value = '';
            
            const tableRows = document.querySelectorAll('#applicantProfilesTableBody tr');
            tableRows.forEach(row => {
                row.style.display = '';
            });
            
            updateApplicantPaginationInfo(tableRows.length);
        }

        function updateApplicantPaginationInfo(visibleCount) {
            const paginationInfo = document.querySelector('.text-sm.text-gray-700');
            if (paginationInfo) {
                paginationInfo.innerHTML = `Showing <span class="font-medium">1</span> to <span class="font-medium">${visibleCount}</span> of <span class="font-medium">${visibleCount}</span> results`;
            }
        }

        function viewApplicantProfile(profileId) {
            // Create modal for viewing applicant profile details
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50';
            modal.id = 'applicantProfileModal';
            
            modal.innerHTML = `
                <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-medium text-gray-900">Applicant Profile Details</h3>
                            <button onclick="closeApplicantProfileModal()" class="text-gray-400 hover:text-gray-600">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        <div class="mt-2 px-7 py-3">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="space-y-4">
                                    <div class="text-center">
                                        <img class="mx-auto h-32 w-32 rounded-full object-cover border-4 border-gray-200" 
                                             src="/media/uploads/id_pictures/default-avatar.png" 
                                             alt="Profile Picture"
                                             onerror="this.src='/static/images/default-avatar.png'">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Full Name</label>
                                        <p class="mt-1 text-sm text-gray-900">Juan Dela Cruz</p>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Email</label>
                                        <p class="mt-1 text-sm text-gray-900">juan.delacruz@email.com</p>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Contact Number</label>
                                        <p class="mt-1 text-sm text-gray-900">+63 912 345 6789</p>
                                    </div>
                                </div>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Program Applied</label>
                                        <p class="mt-1 text-sm text-gray-900">Welding</p>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Entry Date</label>
                                        <p class="mt-1 text-sm text-gray-900">January 15, 2024</p>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Batch</label>
                                        <p class="mt-1 text-sm text-gray-900">1st Trimester</p>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Address</label>
                                        <p class="mt-1 text-sm text-gray-900">123 Main St, Barangay Sample, City, Province</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="items-center px-4 py-3">
                            <div class="flex justify-end space-x-3">
                                <button onclick="downloadApplicantProfile(${profileId})" class="px-4 py-2 bg-green-500 text-white text-base font-medium rounded-md shadow-sm hover:bg-green-600">
                                    <i class="fas fa-download mr-2"></i>Download PDF
                                </button>
                                <button onclick="closeApplicantProfileModal()" class="px-4 py-2 bg-gray-500 text-white text-base font-medium rounded-md shadow-sm hover:bg-gray-600">
                                    Close
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeApplicantProfileModal();
                }
            });
        }

        function closeApplicantProfileModal() {
            const modal = document.getElementById('applicantProfileModal');
            if (modal) {
                modal.remove();
            }
        }

        function downloadApplicantProfile(profileId) {
            // In a real implementation, this would generate and download a PDF
            // For now, we'll show a notification
            showNotification('PDF download started for Profile ID: ' + profileId, 'success');
            
            // Close the modal after initiating download
            closeApplicantProfileModal();
        }

        // Learner Profile Functions
        function viewLearnerProfile(profileId) {
            // Fetch learner profile data via AJAX
            fetch(`/get_learner_profile/${profileId}/`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showLearnerProfileModal(data.profile);
                    } else {
                        showNotification('Error loading profile: ' + data.error, 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showNotification('Error loading profile', 'error');
                });
        }

        function showLearnerProfileModal(profile) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50';
            modal.id = 'learnerProfileModal';
            
            const programsHtml = profile.programs && profile.programs.length > 0 
                ? profile.programs.map(prog => `<span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800 mr-1">${prog}</span>`).join('')
                : '<span class="text-gray-500">No programs completed</span>';
            
            modal.innerHTML = `
                <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-medium text-gray-900">Learner Profile Details</h3>
                            <button onclick="closeLearnerProfileModal()" class="text-gray-400 hover:text-gray-600">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        <div class="mt-2 px-7 py-3">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="space-y-4">
                                    <div class="text-center">
                                        <img class="mx-auto h-32 w-32 rounded-full object-cover border-4 border-gray-200" 
                                             src="${profile.id_picture || '/static/images/default-avatar.png'}" 
                                             alt="Profile Picture"
                                             onerror="this.src='/static/images/default-avatar.png'">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Full Name</label>
                                        <p class="mt-1 text-sm text-gray-900">${profile.full_name}</p>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Email</label>
                                        <p class="mt-1 text-sm text-gray-900">${profile.email}</p>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Contact Number</label>
                                        <p class="mt-1 text-sm text-gray-900">${profile.contact_number || 'N/A'}</p>
                                    </div>
                                </div>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Programs Completed</label>
                                        <div class="mt-1">${programsHtml}</div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Entry Date</label>
                                        <p class="mt-1 text-sm text-gray-900">${profile.entry_date || 'N/A'}</p>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Batch/Course</label>
                                        <p class="mt-1 text-sm text-gray-900">${profile.course_or_qualification || 'N/A'}</p>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Address</label>
                                        <p class="mt-1 text-sm text-gray-900">${profile.address || 'N/A'}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="items-center px-4 py-3">
                            <div class="flex justify-end space-x-3">
                                <button onclick="downloadLearnerProfile(${profile.id})" class="px-4 py-2 bg-green-500 text-white text-base font-medium rounded-md shadow-sm hover:bg-green-600">
                                    <i class="fas fa-download mr-2"></i>Download PDF
                                </button>
                                <button onclick="closeLearnerProfileModal()" class="px-4 py-2 bg-gray-500 text-white text-base font-medium rounded-md shadow-sm hover:bg-gray-600">
                                    Close
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeLearnerProfileModal();
                }
            });
        }

        function closeLearnerProfileModal() {
            const modal = document.getElementById('learnerProfileModal');
            if (modal) {
                modal.remove();
            }
        }

        function downloadLearnerProfile(profileId) {
            // Create a form and submit it to trigger the download
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = `/download_learner_profile/${profileId}/`;
            
            // Add CSRF token
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
            const csrfInput = document.createElement('input');
            csrfInput.type = 'hidden';
            csrfInput.name = 'csrfmiddlewaretoken';
            csrfInput.value = csrfToken;
            form.appendChild(csrfInput);
            
            document.body.appendChild(form);
            form.submit();
            document.body.removeChild(form);
            
            showNotification('PDF download started for Learner Profile ID: ' + profileId, 'success');
            closeLearnerProfileModal();
        }

        // Utility function to show notifications
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg text-white ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 
                'bg-blue-500'
            }`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas ${
                        type === 'success' ? 'fa-check-circle' : 
                        type === 'error' ? 'fa-exclamation-circle' : 
                        'fa-info-circle'
                    } mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }
        </script>

        <style>
        .doc-tab {
            color: #6b7280;
            border-color: transparent;
        }
        
        .doc-tab:hover {
            color: #374151;
            border-color: #d1d5db;
        }
        
        .doc-tab-active {
            color: #2563eb;
            border-color: #3b82f6;
        }
        </style>
        
        <!-- Applicant List Content -->
        <div id="applicantListContent" class="container-card hidden">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 gap-4">
                <h3 class="text-xl font-bold text-gray-800">Applicant List</h3>
                <div class="flex flex-col md:flex-row gap-4 w-full md:w-auto">
                    <!-- Program Filter -->
                    <div class="filter-control">
                        <label for="applicantProgramFilter" class="block text-sm font-medium text-gray-700 mb-1">Filter by Program:</label>
                        <select id="applicantProgramFilter" onchange="filterApplicantsByProgram()" class="w-full md:w-auto px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <option value="all">All Programs</option>
                            {% for program in Programss %}
                                <option value="{{ program.program_name }}">{{ program.program_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <!-- Items Per Page -->
                    <div class="items-per-page">
                        <label for="applicantItemsPerPage" class="block text-sm font-medium text-gray-700 mb-1">Show entries:</label>
                        <select id="applicantItemsPerPage" onchange="changeApplicantItemsPerPage()" class="px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <option value="5">5</option>
                            <option value="10" selected>10</option>
                            <option value="25">25</option>
                            <option value="50">50</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead>
                        <tr>
                            <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider rounded-tl-md">Applicant Name</th>
                            <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider">Program Applied</th>
                            <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider">Application Type</th>
                            <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider">Application Date</th>
                            <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider">Status</th>
                            <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider rounded-tr-md">Action</th>
                        </tr>
                    </thead>
                    <tbody id="applicantTableBody" class="bg-white divide-y divide-gray-200">
                        {% if applicants %}
                            {% for application in applicants %}
                            <tr class="hover:bg-gray-50 applicant-row" data-program="{{ application.program.program_name }}">
                                <td class="py-2 px-4 whitespace-nowrap">
                                    {% with profile=application.applicant.learner_profile.first %}
                                        {% if profile %}
                                            {{ profile.first_name }} {{ profile.last_name }}
                                        {% else %}
                                            {{ application.applicant.first_name }} {{ application.applicant.last_name }}
                                        {% endif %}
                                    {% endwith %}
                                </td>
                                <td class="py-2 px-4 whitespace-nowrap">{{ application.program.program_name }}</td>
                                <td class="py-2 px-4 whitespace-nowrap">
                                    {% if application|lookup:"__class__.__name__" == "ProgramApplication" %}
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                                            Online
                                        </span>
                                    {% elif application|lookup:"__class__.__name__" == "WalkInApplication" %}
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                            Walk-in
                                        </span>
                                    {% else %}
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">
                                            Unknown
                                        </span>
                                    {% endif %}
                                </td>
                                <td class="py-2 px-4 whitespace-nowrap">{{ application.applied_at }}</td>
                                <td class="py-2 px-4 whitespace-nowrap">
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                                        {{ application.status }}
                                    </span>
                                </td>
                                <td class="py-2 px-4 whitespace-nowrap space-x-2">
                                    {% if application.applicant.learner_profile.first %}
                                        <button onclick="openApplicantModal('{{ application.applicant.learner_profile.first.pk }}')" class="text-blue-600 hover:text-blue-800">View</button>
                                    {% else %}
                                        <span class="text-gray-400">No Profile</span>
                                    {% endif %}
                                    <button onclick="openDeclineModal('{{ application.id }}', '{% with profile=application.applicant.learner_profile.first %}{% if profile %}{{ profile.first_name }} {{ profile.last_name }}{% else %}{{ application.applicant.first_name }} {{ application.applicant.last_name }}{% endif %}{% endwith %}')" class="text-red-600 hover:text-red-800">Decline</button>
                                </td>
                            </tr>
                            {% endfor %}
                        {% else %}
                            <tr id="applicantNoDataRow">
                                <td colspan="6" class="text-center py-4 text-gray-500">No applicants yet.</td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
            
            <!-- Pagination Controls -->
            <div class="pagination-controls">
                <div class="pagination-info" id="applicantPaginationInfo">
                    Showing 1 to 10 of 0 entries
                </div>
                <div class="pagination-nav" id="applicantPaginationNav">
                    <button onclick="changeApplicantPage('prev')" id="applicantPrevBtn">Previous</button>
                    <div id="applicantPageNumbers"></div>
                    <button onclick="changeApplicantPage('next')" id="applicantNextBtn">Next</button>
                </div>
            </div>
        </div>

        <!-- Approved Applicants Content -->
        <div id="approvedApplicantsContent" class="container-card hidden">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 gap-4">
                <h3 class="text-xl font-bold text-gray-800">Approved Applicants</h3>
                <div class="flex flex-col md:flex-row gap-4 w-full md:w-auto">
                    <!-- Program Filter -->
                    <div class="filter-control">
                        <label for="approvedProgramFilter" class="block text-sm font-medium text-gray-700 mb-1">Filter by Program:</label>
                        <select id="approvedProgramFilter" onchange="filterApprovedByProgram()" class="w-full md:w-auto px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <option value="all">All Programs</option>
                            {% for program in Programss %}
                                <option value="{{ program.program_name }}">{{ program.program_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <!-- Items Per Page -->
                    <div class="items-per-page">
                        <label for="approvedItemsPerPage" class="block text-sm font-medium text-gray-700 mb-1">Show entries:</label>
                        <select id="approvedItemsPerPage" onchange="changeApprovedItemsPerPage()" class="px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <option value="5">5</option>
                            <option value="10" selected>10</option>
                            <option value="25">25</option>
                            <option value="50">50</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead>
                        <tr>
                            <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider rounded-tl-md">Applicant Name</th>
                            <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider">Program Applied</th>
                            <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider">Application Type</th>
                            <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider rounded-tr-md">Action</th>
                        </tr>
                    </thead>
                    <tbody id="approvedTableBody" class="bg-white divide-y divide-gray-200">
                        {% for approved in approved_applicants %}
                        <tr class="hover:bg-gray-50 approved-row" data-program="{{ approved.program.program_name }}">
                            <td class="py-2 px-4 whitespace-nowrap">
                                {% with profile=approved.applicant.learner_profile.first %}
                                    {% if profile %}
                                        {{ profile.first_name }} {{ profile.last_name }}
                                    {% else %}
                                        {{ approved.applicant.first_name }} {{ approved.applicant.last_name }}
                                    {% endif %}
                                {% endwith %}
                            </td>
                            <td class="py-2 px-4 whitespace-nowrap">{{ approved.program.program_name }}</td>
                            <td class="py-2 px-4 whitespace-nowrap">
                                {% if approved.original_application|lookup:"__class__.__name__" == "ProgramApplication" %}
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                                        Online
                                    </span>
                                {% elif approved.original_application|lookup:"__class__.__name__" == "WalkInApplication" %}
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                        Walk-in
                                    </span>
                                {% else %}
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">
                                        Unknown
                                    </span>
                                {% endif %}
                            </td>
                            <td class="py-2 px-4 whitespace-nowrap space-x-2">
                                {% if approved.applicant.learner_profile.first %}
                                    <button onclick="openApprovedModal('{{ approved.applicant.learner_profile.first.pk }}')" class="text-blue-600 hover:text-blue-800">View</button>
                                    <button onclick="downloadApplicantProfileAsPDF('{{ approved.applicant.learner_profile.first.pk }}', '{{ approved.applicant.username }}', '{{ approved.program.program_name }}')" class="text-green-600 hover:text-green-800">Download PDF</button>
                                {% else %}
                                    <span class="text-gray-400">No Profile</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% empty %}
                        <tr id="approvedNoDataRow">
                            <td colspan="4" class="text-center text-gray-500 py-4">No approved applicants found.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <!-- Pagination Controls -->
            <div class="pagination-controls">
                <div class="pagination-info" id="approvedPaginationInfo">
                    Showing 1 to 10 of 0 entries
                </div>
                <div class="pagination-nav" id="approvedPaginationNav">
                    <button onclick="changeApprovedPage('prev')" id="approvedPrevBtn">Previous</button>
                    <div id="approvedPageNumbers"></div>
                    <button onclick="changeApprovedPage('next')" id="approvedNextBtn">Next</button>
                </div>
            </div>
        </div>

        <!-- Active Jobs Content -->
        <div id="activeJobsContent" class="container-card hidden">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Active Jobs</h3>
            <div class="flex justify-between items-center mb-4">
                <div class="flex items-center space-x-2">
                    <label for="activeJobsSearch" class="text-gray-700">Search:</label>
                    <input type="text" id="activeJobsSearch" class="border border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Search...">
                </div>
                <button onclick="openAddJobModal()" id="postJobBtn" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                    <i class="fas fa-plus mr-2"></i>Post Job
                </button>
            </div>
            
            <!-- Modal Window for Add Job -->
            <div id="addJobModal" class="fixed inset-0 bg-black/50 flex items-center justify-center hidden">
                <div class="bg-white w-[50rem] max-w-full max-h-[90vh] overflow-y-auto p-6 rounded-lg relative">
                    <button onclick="closeAddJobModal()" class="absolute top-2 right-2 text-blue-900 font-bold text-xl">&times;</button>
                    <h2 class="text-2xl font-bold text-blue-900 mb-4">Add New Job</h2>
                    
                    <form id="addJobForm" method="POST" action="{% url 'add_job' %}" class="space-y-4">
                        {% csrf_token %}
                        <!-- Job Title -->
                        <div>
                            <label class="block text-gray-700 font-semibold">Job Title</label>
                            <input name="job_title" type="text" class="w-full border rounded p-2" placeholder="Enter job title" required>
                        </div>
                        
                        <!-- Company -->
                        <div>
                            <label class="block text-gray-700 font-semibold">Company</label>
                            <input name="company" type="text" class="w-full border rounded p-2" placeholder="Enter company name" required>
                        </div>
                        
                        <!-- Address -->
                        <div>
                            <label class="block text-gray-700 font-semibold">Address</label>
                            <input name='address' type="text" class="w-full border rounded p-2" placeholder="Enter address" required>
                        </div>
                        
                        <!-- Job Description -->
                        <div>
                            <label class="block text-gray-700 font-semibold">Job Description</label>
                            <textarea name="job_description" class="w-full border rounded p-2" rows="3" placeholder="Enter job description" required></textarea>
                        </div>
                        
                        <!-- Availability & Program dropdowns -->
                        <div class="flex space-x-2">
                            <div class="flex-1">
                                <label class="block text-gray-700 font-semibold">Availability</label>
                                <select name="availability" class="w-full border rounded p-2" required>
                                    <option value="">Select duration</option>
                                    <option>1 Week</option>
                                    <option>2 Weeks</option>
                                    <option>1 Month</option>
                                    <option>2 Months</option>
                                    <option>3 Months</option>
                                </select>
                            </div>
                            <div class="flex-1">
                                <label class="block text-gray-700 font-semibold">Program</label>
                                <select name="expertise" class="w-full border rounded p-2 text-black bg-white" required>
                                    <option value="" class="text-black">Select program</option>
                                    {% for prog in Programss %}
                                        <option value="{{ prog.id }}" class="text-black">{{ prog.program_name }}</option>
                                    {% empty %}
                                        <option class="text-black" disabled>No programs available</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        
                        <!-- Skills input section -->
                        <div>
                            <label class="block text-gray-700 font-semibold mb-1">Skills</label>
                            
                            <!-- Container for tags -->
                            <div id="skillContainer"
                                 class="w-full border rounded p-2 mb-3 flex flex-wrap gap-2 min-h-[40px] items-center">
                                <!-- Tags with hidden inputs will appear here -->
                            </div>
                            
                            <!-- Suggested skills -->
                            <div class="bg-gray-50 p-3 rounded-lg">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-gray-700 font-semibold">Suggested based on user profile</span>
                                    <button type="button" class="text-gray-400 hover:text-gray-600 text-sm">&times;</button>
                                </div>
                                <div class="flex flex-wrap gap-2">
                                    <button type="button" class="skill-btn px-3 py-1 bg-white border rounded-full text-sm hover:bg-gray-100">Wiring and harness installation</button>
                                    <button type="button" class="skill-btn px-3 py-1 bg-white border rounded-full text-sm hover:bg-gray-100">Assembling vehicle engines and parts</button>
                                    <button type="button" class="skill-btn px-3 py-1 bg-white border rounded-full text-sm hover:bg-gray-100">Baking</button>
                                    <button type="button" class="skill-btn px-3 py-1 bg-white border rounded-full text-sm hover:bg-gray-100">Electrical wiring and installation</button>
                                    <button type="button" class="skill-btn px-3 py-1 bg-white border rounded-full text-sm hover:bg-gray-100">Testing and troubleshooting gadgets</button>
                                    <button type="button" class="skill-btn px-3 py-1 bg-white border rounded-full text-sm hover:bg-gray-100">Haircutting and styling</button>
                                    <button type="button" class="skill-btn px-3 py-1 bg-white border rounded-full text-sm hover:bg-gray-100">Client assessment</button>
                                    <button type="button" class="skill-btn px-3 py-1 bg-white border rounded-full text-sm hover:bg-gray-100">Installing air-conditioning units</button>
                                    <button type="button" class="skill-btn px-3 py-1 bg-white border rounded-full text-sm hover:bg-gray-100">Arc welding techniques</button>
                                    <button type="button" class="skill-btn px-3 py-1 bg-white border rounded-full text-sm hover:bg-gray-100">Garment construction</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Email/Link -->
                        <div>
                            <label class="block text-gray-700 font-semibold">Email or Link</label>
                            <input name="email_or_link" type="text" class="w-full border rounded p-2" placeholder="Enter email or link to job post" required>
                        </div>
                        
                        <!-- Submit Button -->
                        <button type="submit" class="w-full bg-blue-900 text-white font-bold py-2 rounded hover:bg-blue-800">Post Job</button>
                    </form>
                </div>
            </div>
            
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead>
                        <tr>
                            <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider rounded-tl-md">Job Title</th>
                            <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider">Posted Date</th>
                            <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider">Status</th>
                            <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider rounded-tr-md">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        {% for job in jobss|dictsortreversed:"posted_at" %}
                        <tr class="hover:bg-gray-50">
                            <td class="py-2 px-4 whitespace-nowrap">{{ job.job_title }}</td>
                            <td class="py-2 px-4 whitespace-nowrap">{{ job.posted_at }}</td>
                            <td class="py-2 px-4 whitespace-nowrap">
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                    {{ job.status }}
                                </span>
                            </td>
                            <td class="py-2 px-4 whitespace-nowrap space-x-2">
                                <button
                                     onclick="openViewModals(this)"
                                     class="text-yellow-600 hover:text-yellow-800"
                                    data-title="{{ job.job_title }}"
                                    data-company="{{ job.company }}"
                                    data-address="{{ job.address }}"
                                    data-description="{{ job.job_description }}"
                                    data-availability="{{ job.availability }}"
                                    data-program="{{ job.program.program_name }}"
                                    data-skills="{{ job.skills|join:',' }}"
                                    data-email="{{ job.email_or_link }}"
                                    data-job-id="{{ job.id }}">
                                    View
                                </button>
                                <button class="text-red-600 hover:text-red-800">Archive</button>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="4" class="text-center py-4">No jobs posted yet.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Your existing View Job Modal (keep as is) -->
        <div id="viewJobModal" class="fixed inset-0 bg-black/50 flex items-center justify-center hidden z-50">
            <div class="bg-white w-[50rem] max-w-full max-h-[90vh] overflow-y-auto p-6 rounded-lg relative">
                <button onclick="closeViewJobModal()" class="absolute top-2 right-2 text-blue-900 font-bold text-xl">&times;</button>
                <h2 class="text-2xl font-bold text-blue-900 mb-4">Job Details</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-700 font-semibold">Job Title</label>
                        <input id="view-title" type="text" class="w-full border rounded p-2 bg-gray-100" disabled>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold">Company</label>
                        <input id="view-company" type="text" class="w-full border rounded p-2 bg-gray-100" disabled>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold">Address</label>
                        <input id="view-address" type="text" class="w-full border rounded p-2 bg-gray-100" disabled>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold">Job Description</label>
                        <textarea id="view-description" class="w-full border rounded p-2 bg-gray-100" rows="3" disabled></textarea>
                    </div>
                    <div class="flex space-x-2">
                        <div class="flex-1">
                            <label class="block text-gray-700 font-semibold">Availability</label>
                            <input id="view-availability" type="text" class="w-full border rounded p-2 bg-gray-100" disabled>
                        </div>
                        <div class="flex-1">
                            <label class="block text-gray-700 font-semibold">Program</label>
                            <input id="view-program" type="text" class="w-full border rounded p-2 bg-gray-100" disabled>
                        </div>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold">Skills</label>
                        <div id="view-skills" class="flex flex-wrap gap-2 p-2 border rounded bg-gray-100 min-h-[40px] text-sm text-blue-800"></div>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold">Email or Link</label>
                        <input id="view-email" type="text" class="w-full border rounded p-2 bg-gray-100" disabled>
                    </div>
                </div>
                <div class="flex space-x-2 mt-4">
                    <button id="edit-button" onclick="toggleEditMode()" class="bg-blue-500 text-white px-4 py-2 rounded">
                        Edit
                    </button>
                    <button id="update-button" onclick="updateJobDetails()" class="bg-green-500 text-white px-4 py-2 rounded hidden">
                        Update
                    </button>
                </div>
            </div>
        </div>

        <!-- Archived Jobs Content -->
        <div id="archivedJobsContent" class="container-card hidden">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Archived Jobs</h3>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead>
                        <tr>
                            <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider rounded-tl-md">Job Title</th>
                            <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider">Posted Date</th>
                            <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider">Status</th>
                            <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider">Reason for Archiving</th>
                            <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider rounded-tr-md">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        {% for job in archived_jobs %}
                        <tr class="hover:bg-gray-50">
                            <td class="py-2 px-4 whitespace-nowrap">{{ job.job_title }}</td>
                            <td class="py-2 px-4 whitespace-nowrap">{{ job.posted_at }}</td>
                            <td class="py-2 px-4 whitespace-nowrap">
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-300 text-gray-800">
                                    Archived
                                </span>
                            </td>
                            <td class="py-2 px-4 whitespace-nowrap">{{ job.archive_reason|default:"N/A" }}</td>
                            <td class="py-2 px-4 whitespace-nowrap space-x-2">
                                <button class="text-blue-600 hover:text-blue-800">View</button>
                                <button class="text-green-600 hover:text-green-800">Restore</button>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="text-center py-4">No archived jobs yet.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Trainor List Content -->
        <div id="trainorListContent" class="container-card hidden">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 gap-4">
                <h3 class="text-xl font-bold text-gray-800">Trainer List</h3>
                <div class="flex flex-col md:flex-row gap-4 w-full md:w-auto">
                    <!-- Program Filter -->
                    <div class="filter-control">
                        <label for="trainerProgramFilter" class="block text-sm font-medium text-gray-700 mb-1">Filter by Program:</label>
                        <select id="trainerProgramFilter" onchange="filterTrainersByProgram()" class="w-full md:w-auto px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <option value="all">All Programs</option>
                            {% for program in Programss %}
                                <option value="{{ program.program_name }}">{{ program.program_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <!-- Items Per Page -->
                    <div class="items-per-page">
                        <label for="trainerItemsPerPage" class="block text-sm font-medium text-gray-700 mb-1">Show entries:</label>
                        <select id="trainerItemsPerPage" onchange="changeTrainerItemsPerPage()" class="px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <option value="5">5</option>
                            <option value="10" selected>10</option>
                            <option value="25">25</option>
                            <option value="50">50</option>
                        </select>
                    </div>
                    <!-- Add Trainer Button -->
                    <div class="flex items-end">
                        <button id="addTrainorBtn" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                            <i class="fas fa-plus mr-2"></i>Add Trainer
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead>
                        <tr>
                            <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider rounded-tl-md">Trainer Name</th>
                            <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider">Email</th>
                            <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider">Program Assigned</th>
                            <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider">Date Joined</th>
                            <th class="py-3 px-4 bg-blue-500 text-left text-xs font-semibold text-white uppercase tracking-wider rounded-tr-md">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="trainerTableBody" class="bg-white divide-y divide-gray-200">
                        {% if trainers %}
                            {% for trainer in trainers %}
                            <tr class="hover:bg-gray-50 trainer-row" data-program="{% if trainer.program %}{{ trainer.program.program_name }}{% else %}No Program{% endif %}">
                                <td class="py-2 px-4 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0 h-10 w-10">
                                            <div class="h-10 w-10 rounded-full bg-blue-500 flex items-center justify-center">
                                                <span class="text-white font-medium text-sm">
                                                    {{ trainer.user.first_name|first|default:trainer.user.username|first }}{{ trainer.user.last_name|first|default:"" }}
                                                </span>
                                            </div>
                                        </div>
                                        <div class="ml-4">
                                            <div class="text-sm font-medium text-gray-900">
                                                {% if trainer.user.first_name and trainer.user.last_name %}
                                                    {{ trainer.user.first_name }} {{ trainer.user.last_name }}
                                                {% else %}
                                                    {{ trainer.user.username }}
                                                {% endif %}
                                            </div>
                                            <div class="text-sm text-gray-500">
                                                @{{ trainer.user.username }}
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td class="py-2 px-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">{{ trainer.user.email }}</div>
                                </td>
                                <td class="py-2 px-4 whitespace-nowrap">
                                    {% if trainer.program %}
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                            {{ trainer.program.program_name }}
                                        </span>
                                    {% else %}
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">
                                            No Program Assigned
                                        </span>
                                    {% endif %}
                                </td>
                                <td class="py-2 px-4 whitespace-nowrap text-sm text-gray-500">
                                    {{ trainer.user.date_joined|date:"M d, Y" }}
                                </td>
                                <td class="py-2 px-4 whitespace-nowrap text-sm font-medium space-x-2">
                                    <button onclick="viewTrainerDetails('{{ trainer.id }}')" class="text-blue-600 hover:text-blue-800">
                                        <i class="fas fa-eye mr-1"></i>View
                                    </button>
                                    <button onclick="editTrainer('{{ trainer.id }}')" class="text-yellow-600 hover:text-yellow-800">
                                        <i class="fas fa-edit mr-1"></i>Edit
                                    </button>
                                    <button onclick="deleteTrainer('{{ trainer.id }}', '{% if trainer.user.first_name %}{{ trainer.user.first_name }} {{ trainer.user.last_name }}{% else %}{{ trainer.user.username }}{% endif %}')" class="text-red-600 hover:text-red-800">
                                        <i class="fas fa-trash mr-1"></i>Delete
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        {% else %}
                            <tr id="trainerNoDataRow">
                                <td colspan="5" class="text-center py-4 text-gray-500">No trainers found.</td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
            
            <!-- Pagination Controls -->
            <div class="pagination-controls">
                <div class="pagination-info" id="trainerPaginationInfo">
                    Showing 1 to 10 of 0 entries
                </div>
                <div class="pagination-nav" id="trainerPaginationNav">
                    <button onclick="changeTrainerPage('prev')" id="trainerPrevBtn">Previous</button>
                    <div id="trainerPageNumbers"></div>
                    <button onclick="changeTrainerPage('next')" id="trainerNextBtn">Next</button>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Sidebar Toggle Functionality
        document.addEventListener('DOMContentLoaded', function() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const sidebarToggleBtn = document.getElementById('sidebarToggleBtn');
            const sidebarToggleIcon = document.getElementById('sidebarToggleIcon');
            
            // Initialize sidebar state
            updateSidebarState();
            
            // Add event listener for the arrow toggle button
            sidebarToggleBtn.addEventListener('click', function() {
                // Toggle the auto-collapse class on the sidebar
                sidebar.classList.toggle('auto-collapse');
                updateSidebarState();
            });
            
            // Function to update sidebar state and arrow icon
            function updateSidebarState() {
                if (sidebar.classList.contains('auto-collapse')) {
                    // Sidebar is collapsed - show right arrow to expand
                    sidebarToggleIcon.className = 'fas fa-arrow-right';
                    mainContent.style.marginLeft = '4rem';
                } else {
                    // Sidebar is expanded - show left arrow to collapse
                    sidebarToggleIcon.className = 'fas fa-arrow-left';
                    mainContent.style.marginLeft = '0';
                }
            }
        });

        // ✅ FIXED NOTIFICATION SYSTEM
        let notificationInterval;

        async function loadNotifications() {
            try {
                const response = await fetch('/get-notifications/');
                if (!response.ok) throw new Error('Failed to fetch notifications');
                const data = await response.json();
                updateNotificationBadge(data.unread_count);
                populateNotificationsList(data.notifications);
            } catch (error) {
                console.error('Error loading notifications:', error);
                document.getElementById('notifications-list').innerHTML = '<div class="p-4 text-center text-red-500">Error loading notifications</div>';
            }
        }

        function updateNotificationBadge(count) {
            const badge = document.getElementById('notification-badge');
            if (count > 0) {
                badge.textContent = count > 99 ? '99+' : count;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }

        function populateNotificationsList(notifications) {
            const list = document.getElementById('notifications-list');
            
            if (notifications.length === 0) {
                list.innerHTML = '<div class="p-4 text-center text-gray-500">No notifications</div>';
                return;
            }
            
            list.innerHTML = notifications.map(notification => `
                <div class="notification-item p-3 border-b hover:bg-gray-50 cursor-pointer ${!notification.is_read ? 'bg-blue-50' : ''}"
                     data-notification-id="${notification.id}"
                    onclick="markNotificationAsRead(${notification.id})">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <p class="text-sm font-medium text-gray-900 ${!notification.is_read ? 'font-bold' : ''}">${notification.title}</p>
                            <p class="text-xs text-gray-600 mt-1">${notification.message}</p>
                            <div class="flex justify-between items-center mt-2">
                                <span class="text-xs text-gray-400">${notification.created_at}</span>
                                <span class="text-xs px-2 py-1 rounded-full ${getNotificationTypeColor(notification.notification_type)}">
                                    ${notification.notification_type}
                                </span>
                            </div>
                        </div>
                        ${!notification.is_read ? '<div class="w-2 h-2 bg-blue-500 rounded-full ml-2 mt-1"></div>' : ''}
                    </div>
                </div>
            `).join('');
        }

        function getNotificationTypeColor(type) {
            switch(type) {
                case 'approval': return 'bg-green-100 text-green-800';
                case 'rejection': return 'bg-red-100 text-red-800';
                case 'application': return 'bg-blue-100 text-blue-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        async function markNotificationAsRead(notificationId) {
            try {
                const response = await fetch(`/mark-notification-read/${notificationId}/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                        'Content-Type': 'application/json',
                    }
                });
                if (response.ok) {
                    // Update the notification item visually
                    const notificationItem = document.querySelector(`[data-notification-id="${notificationId}"]`);
                    if (notificationItem) {
                        notificationItem.classList.remove('unread');
                    }
                    // Reload notifications to update badge
                    loadNotifications();
                }
            } catch (error) {
                console.error('Error marking notification as read:', error);
            }
        }

        async function markAllNotificationsRead() {
            try {
                const response = await fetch('/mark-all-notifications-read/', {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                        'Content-Type': 'application/json',
                    }
                });
                if (response.ok) {
                    loadNotifications();
                    showNotification('All notifications marked as read', 'success');
                }
            } catch (error) {
                console.error('Error marking all notifications as read:', error);
                showNotification('Error marking notifications as read', 'error');
            }
        }

        // ✅ FIXED BELL BUTTON CLICK HANDLER
        document.addEventListener('DOMContentLoaded', function() {
            const bellBtn = document.getElementById('bell-btn');
            const notificationBox = document.getElementById('notification-box');
            const markAllReadBtn = document.getElementById('mark-all-read');
            
            if (bellBtn && notificationBox) {
                // Load notifications on page load
                loadNotifications();
                
                // Set up auto-refresh every 30 seconds
                notificationInterval = setInterval(loadNotifications, 30000);
                
                // ✅ FIXED: Bell button click handler with explicit show/hide
                bellBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Instead of toggle, explicitly show/hide
                    if (notificationBox.classList.contains('hidden')) {
                        notificationBox.classList.remove('hidden');
                        // Reload notifications when opening
                        loadNotifications();
                    } else {
                        notificationBox.classList.add('hidden');
                    }
                });
                
                // Mark all read button
                if (markAllReadBtn) {
                    markAllReadBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        markAllNotificationsRead();
                    });
                }
                
                // Close notification box when clicking outside
                document.addEventListener('click', function(e) {
                    if (!bellBtn.contains(e.target) && !notificationBox.contains(e.target)) {
                        notificationBox.classList.add('hidden');
                    }
                });
            }
        });

        // Clean up interval when page unloads
        window.addEventListener('beforeunload', function() {
            if (notificationInterval) {
                clearInterval(notificationInterval);
            }
        });

        // Pagination and filtering variables
        let applicantCurrentPage = 1;
        let applicantItemsPerPage = 10;
        let applicantTotalItems = 0;
        let applicantData = [];
        let applicantFilteredData = [];
        let applicantCurrentFilter = 'all';

        let approvedCurrentPage = 1;
        let approvedItemsPerPage = 10;
        let approvedTotalItems = 0;
        let approvedData = [];
        let approvedFilteredData = [];
        let approvedCurrentFilter = 'all';

        // Initialize pagination when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize applicant data
            const applicantRows = document.querySelectorAll('.applicant-row');
            applicantData = Array.from(applicantRows);
            applicantFilteredData = applicantData;
            applicantTotalItems = applicantFilteredData.length;
            
            // Initialize approved data
            const approvedRows = document.querySelectorAll('.approved-row');
            approvedData = Array.from(approvedRows);
            approvedFilteredData = approvedData;
            approvedTotalItems = approvedFilteredData.length;
            
            // Setup initial pagination
            updateApplicantPagination();
            updateApprovedPagination();
        });

        // Filter applicants by program
        function filterApplicantsByProgram() {
            const programFilter = document.getElementById('applicantProgramFilter').value;
            applicantCurrentFilter = programFilter;
            applicantCurrentPage = 1;
            
            if (programFilter === 'all') {
                applicantFilteredData = applicantData;
            } else {
                applicantFilteredData = applicantData.filter(row => {
                    return row.getAttribute('data-program') === programFilter;
                });
            }
            
            applicantTotalItems = applicantFilteredData.length;
            
            // Show no data message if no results
            const noDataRow = document.getElementById('applicantNoDataRow');
            if (applicantFilteredData.length === 0 && !noDataRow) {
                const tableBody = document.getElementById('applicantTableBody');
                const newRow = document.createElement('tr');
                newRow.id = 'applicantNoDataRow';
                newRow.innerHTML = `<td colspan="5" class="text-center py-4 text-gray-500">No matching applicants found.</td>`;
                tableBody.appendChild(newRow);
            } else if (applicantFilteredData.length > 0 && noDataRow) {
                noDataRow.remove();
            }
            
            updateApplicantPagination();
        }

        // Filter approved applicants by program
        function filterApprovedByProgram() {
            const programFilter = document.getElementById('approvedProgramFilter').value;
            approvedCurrentFilter = programFilter;
            approvedCurrentPage = 1;
            
            if (programFilter === 'all') {
                approvedFilteredData = approvedData;
            } else {
                approvedFilteredData = approvedData.filter(row => {
                    return row.getAttribute('data-program') === programFilter;
                });
            }
            
            approvedTotalItems = approvedFilteredData.length;
            
            // Show no data message if no results
            const noDataRow = document.getElementById('approvedNoDataRow');
            if (approvedFilteredData.length === 0 && !noDataRow) {
                const tableBody = document.getElementById('approvedTableBody');
                const newRow = document.createElement('tr');
                newRow.id = 'approvedNoDataRow';
                newRow.innerHTML = `<td colspan="3" class="text-center py-4 text-gray-500">No matching approved applicants found.</td>`;
                tableBody.appendChild(newRow);
            } else if (approvedFilteredData.length > 0 && noDataRow) {
                noDataRow.remove();
            }
            
            updateApprovedPagination();
        }

        // Applicant List Pagination Functions
        function changeApplicantItemsPerPage() {
            const select = document.getElementById('applicantItemsPerPage');
            applicantItemsPerPage = parseInt(select.value);
            applicantCurrentPage = 1;
            updateApplicantPagination();
        }

        function changeApplicantPage(direction) {
            const totalPages = Math.ceil(applicantTotalItems / applicantItemsPerPage);
            
            if (direction === 'prev' && applicantCurrentPage > 1) {
                applicantCurrentPage--;
            } else if (direction === 'next' && applicantCurrentPage < totalPages) {
                applicantCurrentPage++;
            } else if (typeof direction === 'number') {
                applicantCurrentPage = direction;
            }
            
            updateApplicantPagination();
        }

        function updateApplicantPagination() {
            const totalPages = Math.ceil(applicantTotalItems / applicantItemsPerPage);
            const startIndex = (applicantCurrentPage - 1) * applicantItemsPerPage;
            const endIndex = startIndex + applicantItemsPerPage;
            
            // Hide all rows
            applicantData.forEach(row => row.style.display = 'none');
            
            // Show current page rows from filtered data
            for (let i = startIndex; i < endIndex && i < applicantTotalItems; i++) {
                if (applicantFilteredData[i]) {
                    applicantFilteredData[i].style.display = '';
                }
            }
            
            // Update pagination info
            const actualEnd = Math.min(endIndex, applicantTotalItems);
            const actualStart = applicantTotalItems > 0 ? startIndex + 1 : 0;
            document.getElementById('applicantPaginationInfo').textContent =
                 `Showing ${actualStart} to ${actualEnd} of ${applicantTotalItems} entries${applicantCurrentFilter !== 'all' ? ' (filtered)' : ''}`;
            
            // Update pagination buttons
            document.getElementById('applicantPrevBtn').disabled = applicantCurrentPage === 1;
            document.getElementById('applicantNextBtn').disabled = applicantCurrentPage === totalPages || totalPages === 0;
            
            // Update page numbers
            updateApplicantPageNumbers(totalPages);
        }

        function updateApplicantPageNumbers(totalPages) {
            const pageNumbersDiv = document.getElementById('applicantPageNumbers');
            pageNumbersDiv.innerHTML = '';
            
            const maxVisiblePages = 5;
            let startPage = Math.max(1, applicantCurrentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const button = document.createElement('button');
                button.textContent = i;
                button.onclick = () => changeApplicantPage(i);
                if (i === applicantCurrentPage) {
                    button.classList.add('active');
                }
                pageNumbersDiv.appendChild(button);
            }
        }

        // Approved Applicants Pagination Functions
        function changeApprovedItemsPerPage() {
            const select = document.getElementById('approvedItemsPerPage');
            approvedItemsPerPage = parseInt(select.value);
            approvedCurrentPage = 1;
            updateApprovedPagination();
        }

        function changeApprovedPage(direction) {
            const totalPages = Math.ceil(approvedTotalItems / approvedItemsPerPage);
            
            if (direction === 'prev' && approvedCurrentPage > 1) {
                approvedCurrentPage--;
            } else if (direction === 'next' && approvedCurrentPage < totalPages) {
                approvedCurrentPage++;
            } else if (typeof direction === 'number') {
                approvedCurrentPage = direction;
            }
            
            updateApprovedPagination();
        }

        function updateApprovedPagination() {
            const totalPages = Math.ceil(approvedTotalItems / approvedItemsPerPage);
            const startIndex = (approvedCurrentPage - 1) * approvedItemsPerPage;
            const endIndex = startIndex + approvedItemsPerPage;
            
            // Hide all rows
            approvedData.forEach(row => row.style.display = 'none');
            
            // Show current page rows from filtered data
            for (let i = startIndex; i < endIndex && i < approvedTotalItems; i++) {
                if (approvedFilteredData[i]) {
                    approvedFilteredData[i].style.display = '';
                }
            }
            
            // Update pagination info
            const actualEnd = Math.min(endIndex, approvedTotalItems);
            const actualStart = approvedTotalItems > 0 ? startIndex + 1 : 0;
            document.getElementById('approvedPaginationInfo').textContent =
                 `Showing ${actualStart} to ${actualEnd} of ${approvedTotalItems} entries${approvedCurrentFilter !== 'all' ? ' (filtered)' : ''}`;
            
            // Update pagination buttons
            document.getElementById('approvedPrevBtn').disabled = approvedCurrentPage === 1;
            document.getElementById('approvedNextBtn').disabled = approvedCurrentPage === totalPages || totalPages === 0;
            
            // Update page numbers
            updateApprovedPageNumbers(totalPages);
        }

        function updateApprovedPageNumbers(totalPages) {
            const pageNumbersDiv = document.getElementById('approvedPageNumbers');
            pageNumbersDiv.innerHTML = '';
            
            const maxVisiblePages = 5;
            let startPage = Math.max(1, approvedCurrentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const button = document.createElement('button');
                button.textContent = i;
                button.onclick = () => changeApprovedPage(i);
                if (i === approvedCurrentPage) {
                    button.classList.add('active');
                }
                pageNumbersDiv.appendChild(button);
            }
        }

        // Update the showContent function to reinitialize pagination when switching tabs
        function showContent(contentType, pageName) {
            hideAllContent();
            mainContentTitle.textContent = pageName;
            
            switch(contentType) {
                case 'dashboard':
                    dashboardContent.classList.remove('hidden');
                    break;
                case 'programs':
                    programsContent.classList.remove('hidden');
                    break;
                case 'applicant-list':
                    applicantListContent.classList.remove('hidden');
                    // Reinitialize applicant pagination
                    setTimeout(() => {
                        const applicantRows = document.querySelectorAll('.applicant-row');
                        applicantData = Array.from(applicantRows);
                        
                        // Apply current filter
                        if (applicantCurrentFilter === 'all') {
                            applicantFilteredData = applicantData;
                        } else {
                            applicantFilteredData = applicantData.filter(row => {
                                return row.getAttribute('data-program') === applicantCurrentFilter;
                            });
                        }
                        
                        applicantTotalItems = applicantFilteredData.length;
                        updateApplicantPagination();
                    }, 100);
                    break;
                case 'approved-applicants':
                    approvedApplicantsContent.classList.remove('hidden');
                    // Reinitialize approved pagination
                    setTimeout(() => {
                        const approvedRows = document.querySelectorAll('.approved-row');
                        approvedData = Array.from(approvedRows);
                        
                        // Apply current filter
                        if (approvedCurrentFilter === 'all') {
                            approvedFilteredData = approvedData;
                        } else {
                            approvedFilteredData = approvedData.filter(row => {
                                return row.getAttribute('data-program') === approvedCurrentFilter;
                            });
                        }
                        
                        approvedTotalItems = approvedFilteredData.length;
                        updateApprovedPagination();
                    }, 100);
                    break;
                case 'active-jobs':
                    activeJobsContent.classList.remove('hidden');
                    break;
                case 'archived-jobs':
                    archivedJobsContent.classList.remove('hidden');
                    break;
                case 'trainor-list':
                    trainorListContent.classList.remove('hidden');
                    break;
                case 'overlay':
                    overlayText.textContent = `You are on the ${pageName} page`;
                    overlayPage.classList.add('active');
                    break;
                case 'program-management':
                    document.getElementById('programManagementContent').classList.remove('hidden');
                    break;
                case 'document-management':
                    document.getElementById('documentManagementContent').classList.remove('hidden');
                    // Initialize the first tab (overview) by default
                    showDocTab('overview');
                    break;
            }
        }

        // Chart.js initialization - Program Enrollment Distribution
        const doughnutCtx = document.getElementById('doughnutChart').getContext('2d');
        
        // Program data - dynamic from Django template
        const chartLabels = [];
        
        const approvedCounts = [];
        const totalCounts = [];
        
        // Calculate approval rates (percentage)
        const approvalRates = approvedCounts.map((approved, index) => {
            const total = totalCounts[index];
            return total > 0 ? Math.round((approved / total) * 100) : 0;
        });
        
        // Generate colors for each program
        const colors = [
            '#3B82F6', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6',
            '#06B6D4', '#84CC16', '#F97316', '#EC4899', '#6366F1'
        ];
        
        new Chart(doughnutCtx, {
            type: 'bar',
            data: {
                labels: chartLabels,
                datasets: [{
                    label: 'Approval Rate (%)',
                    data: approvalRates,
                    backgroundColor: colors.slice(0, chartLabels.length),
                    borderWidth: 1,
                    borderColor: '#ffffff',
                    indexAxis: 'y' // This makes it horizontal
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const programIndex = context.dataIndex;
                                const approved = programData[programIndex].approved;
                                const total = programData[programIndex].total;
                                const rate = total > 0 ? Math.round((approved / total) * 100) : 0;
                                return [
                                    `Approved: ${approved}`,
                                    `Total Applied: ${total}`,
                                    `Approval Rate: ${rate}%`
                                ];
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Approval Rate (%)',
                            color: '#6B7280',
                            font: {
                                weight: 'bold'
                            }
                        },
                        beginAtZero: true
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Programs',
                            color: '#6B7280',
                            font: {
                                weight: 'bold'
                            }
                        }
                    }
                }
            }
        });

        const barCtx = document.getElementById('barChart').getContext('2d');
        new Chart(barCtx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                datasets: [{
                    label: 'Applications',
                    data: [45, 52, 38, 67, 73, 89, 95, 78, 65, 82, 91, 76],
                    backgroundColor: 'rgba(59, 130, 246, 0.2)',
                    borderColor: '#3B82F6',
                    borderWidth: 2,
                    pointBackgroundColor: '#3B82F6',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointRadius: 4,
                    tension: 0.3, // Smooth curves
                    fill: true
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                    }
                },
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Months',
                            color: '#6B7280',
                            font: {
                                weight: 'bold'
                            }
                        },
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Number of Applications',
                            color: '#6B7280',
                            font: {
                                weight: 'bold'
                            }
                        },
                        beginAtZero: true,
                        grid: {
                            color: '#E5E7EB'
                        }
                    }
                }
            }
        });

        // Navigation functionality
        document.addEventListener('DOMContentLoaded', () => {
            const navLinks = document.querySelectorAll('.nav-link');
            const dropdownToggles = document.querySelectorAll('.dropdown-toggle');
            const mainContentTitle = document.getElementById('mainContentTitle');
            
            // Content areas
            const dashboardContent = document.getElementById('dashboardContent');
            const cloneContent = document.getElementById('cloneContent');
            const programsContent = document.getElementById('programsContent');
            const applicantListContent = document.getElementById('applicantListContent');
            const approvedApplicantsContent = document.getElementById('approvedApplicantsContent');
            const activeJobsContent = document.getElementById('activeJobsContent');
            const archivedJobsContent = document.getElementById('archivedJobsContent');
            const trainorListContent = document.getElementById('trainorListContent');
            const overlayPage = document.getElementById('overlayPage');
            const overlayText = document.getElementById('overlayText');
            const goBackBtn = document.getElementById('goBackBtn');

            // Modal elements
            const trainerRegistrationModal = document.getElementById('trainerRegistrationModal');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const addTrainorBtn = document.getElementById('addTrainorBtn');
            const togglePassword = document.getElementById('togglePassword');
            const passwordInput = document.getElementById('password');

            function hideAllContent() {
                dashboardContent.classList.add('hidden');
                cloneContent.classList.add('hidden');
                programsContent.classList.add('hidden');
                applicantListContent.classList.add('hidden');
                approvedApplicantsContent.classList.add('hidden');
                activeJobsContent.classList.add('hidden');
                archivedJobsContent.classList.add('hidden');
                trainorListContent.classList.add('hidden');
                document.getElementById('programManagementContent').classList.add('hidden');
                document.getElementById('documentManagementContent').classList.add('hidden');
                overlayPage.classList.remove('active');
            }

            function showContent(contentType, pageName) {
                hideAllContent();
                mainContentTitle.textContent = pageName;

                switch(contentType) {
                    case 'dashboard':
                        dashboardContent.classList.remove('hidden');
                        break;
                    case 'clone':
                        cloneContent.classList.remove('hidden');
                        break;
                    case 'programs':
                        programsContent.classList.remove('hidden');
                        break;
                    case 'applicant-list':
                        applicantListContent.classList.remove('hidden');
                        break;
                    case 'approved-applicants':
                        approvedApplicantsContent.classList.remove('hidden');
                        break;
                    case 'active-jobs':
                        activeJobsContent.classList.remove('hidden');
                        break;
                    case 'archived-jobs':
                        archivedJobsContent.classList.remove('hidden');
                        break;
                    case 'trainor-list':
                        trainorListContent.classList.remove('hidden');
                        break;
                    case 'overlay':
                        overlayText.textContent = `You are on the ${pageName} page`;
                        overlayPage.classList.add('active');
                        break;
                    case 'program-management':
                        document.getElementById('programManagementContent').classList.remove('hidden');
                        break;
                    case 'document-management':
                        document.getElementById('documentManagementContent').classList.remove('hidden');
                        break;
                }
            }

            // Navigation event listeners
            navLinks.forEach(link => {
                link.addEventListener('click', (event) => {
                    event.preventDefault();
                    const pageName = event.currentTarget.dataset.page;
                    const contentType = event.currentTarget.dataset.contentType;
                    showContent(contentType, pageName);
                    
                    // Update active state
                    navLinks.forEach(nav => nav.classList.remove('bg-blue-700'));
                    link.classList.add('bg-blue-700');
                });
            });

            // Dropdown toggles
            dropdownToggles.forEach(toggle => {
                toggle.addEventListener('click', () => {
                    const dropdownMenu = toggle.nextElementSibling;
                    const dropdownChevron = toggle.querySelector('.fa-chevron-down');
                    if (dropdownMenu && dropdownChevron) {
                        dropdownMenu.classList.toggle('active');
                        dropdownChevron.classList.toggle('rotate-180');
                    }
                });
            });

            // Modal functionality
            if (addTrainorBtn) {
                addTrainorBtn.addEventListener('click', () => {
                    trainerRegistrationModal.classList.add('active');
                });
            }

            if (closeModalBtn) {
                closeModalBtn.addEventListener('click', () => {
                    trainerRegistrationModal.classList.remove('active');
                });
            }

            if (togglePassword && passwordInput) {
                togglePassword.addEventListener('click', () => {
                    const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                    passwordInput.setAttribute('type', type);
                    togglePassword.querySelector('i').classList.toggle('fa-eye');
                    togglePassword.querySelector('i').classList.toggle('fa-eye-slash');
                });
            }

            // Go back button
            if (goBackBtn) {
                goBackBtn.addEventListener('click', () => {
                    overlayPage.classList.remove('active');
                });
            }

            // Initialize with dashboard
            showContent('dashboard', 'Dashboard');
        });

        // Modal functions for applicant details
        async function openApplicantModal(profileId) {
            try {
                const modal = document.getElementById('applicantModal');
                modal.classList.add('active');
                
                const response = await fetch(`/api/profile/${profileId}/`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const applicantData = await response.json();
                populateApplicantModal(applicantData);
            } catch (error) {
                console.error('Error fetching applicant data:', error);
                alert('Error loading applicant data. Please try again.');
            }
        }

        function populateApplicantModal(data) {
            // Basic information
            document.getElementById('modal-entry-date').value = data.entry_date || '';
            document.getElementById('modal-last-name').value = data.last_name || '';
            document.getElementById('modal-first-name').value = data.first_name || '';
            document.getElementById('modal-middle-name').value = data.middle_name || '';
            
            // Address
            document.getElementById('modal-region-name').value = data.region_name || '';
            document.getElementById('modal-province-name').value = data.province_name || '';
            document.getElementById('modal-city-name').value = data.city_name || '';
            document.getElementById('modal-barangay-name').value = data.barangay_name || '';
            document.getElementById('modal-district').value = data.district || '';
            document.getElementById('modal-street').value = data.street || '';
            document.getElementById('modal-email').value = data.email || '';
            document.getElementById('modal-contact-number').value = data.contact_number || '';
            document.getElementById('modal-nationality').value = data.nationality || '';
            
            // Personal information
            document.getElementById('modal-sex').value = data.sex || '';
            document.getElementById('modal-civil-status').value = data.civil_status || '';
            document.getElementById('modal-employment-status').value = data.employment_status || '';
            document.getElementById('modal-monthly-income').value = data.monthly_income || '';
            document.getElementById('modal-date-hired').value = data.date_hired || '';
            document.getElementById('modal-company-name').value = data.company_name || '';
            document.getElementById('modal-birthdate').value = data.birthdate || '';
            document.getElementById('modal-age').value = data.age || '';
            
            // Birthplace
            document.getElementById('modal-birthplace-region').value = data.birthplace_regionb_name || '';
            document.getElementById('modal-birthplace-province').value = data.birthplace_provinceb_name || '';
            document.getElementById('modal-birthplace-city').value = data.birthplace_cityb_name || '';
            
            // Other information
            document.getElementById('modal-educational-attainment').value = data.educational_attainment || '';
            document.getElementById('modal-parent-guardian').value = data.parent_guardian || '';
            document.getElementById('modal-permanent-address').value = data.permanent_address || '';
            document.getElementById('modal-course-qualification').value = data.course_or_qualification || '';
            document.getElementById('modal-applicant-name').value = data.applicant_name || '';
            document.getElementById('modal-date-accomplished').value = data.date_accomplished || '';
            
            // Classifications
            const classificationsDiv = document.getElementById('modal-classifications');
            classificationsDiv.innerHTML = '';
            if (data.classifications && data.classifications.length > 0) {
                data.classifications.forEach(classification => {
                    const span = document.createElement('span');
                    span.className = 'inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded mr-2 mb-2';
                    span.textContent = classification.name;
                    classificationsDiv.appendChild(span);
                });
            } else {
                classificationsDiv.textContent = 'None specified';
            }
            
            // Disability type
            document.getElementById('modal-disability-type').textContent = data.disability_type?.name || 'None';
            
            // Disability causes
            const causesDiv = document.getElementById('modal-disability-causes');
            causesDiv.innerHTML = '';
            if (data.disability_causes && data.disability_causes.length > 0) {
                data.disability_causes.forEach(cause => {
                    const span = document.createElement('span');
                    span.className = 'inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded mr-2 mb-2';
                    span.textContent = cause.name;
                    causesDiv.appendChild(span);
                });
            } else {
                causesDiv.textContent = 'None';
            }
            
            // Profile picture
            const profilePic = document.getElementById('modal-profile-picture');
            if (data.id_picture) {
                profilePic.src = data.id_picture;
                profilePic.alt = "Profile Picture";
            } else {
                profilePic.src = "/static/default-profile.png";
                profilePic.alt = "No Profile Picture";
            }
        }

        function closeApplicantModal() {
            const modal = document.getElementById('applicantModal');
            modal.classList.remove('active');
        }

        // Modal functions for approved applicant details
        async function openApprovedModal(profileId) {
            try {
                const modal = document.getElementById('approvedModal');
                modal.classList.add('active');
                
                const response = await fetch(`/api/profile/${profileId}/`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const applicantData = await response.json();
                populateApprovedModal(applicantData); // Use separate function
            } catch (error) {
                console.error('Error fetching applicant data:', error);
                alert('Error loading applicant data. Please try again.');
            }
        }
        
        function populateApprovedModal(data) {
            // Basic information
            document.querySelector('#approvedModal #modal-entry-date').value = data.entry_date || '';
            document.querySelector('#approvedModal #modal-last-name').value = data.last_name || '';
            document.querySelector('#approvedModal #modal-first-name').value = data.first_name || '';
            document.querySelector('#approvedModal #modal-middle-name').value = data.middle_name || '';
            
            // Address
            document.querySelector('#approvedModal #modal-region-name').value = data.region_name || '';
            document.querySelector('#approvedModal #modal-province-name').value = data.province_name || '';
            document.querySelector('#approvedModal #modal-city-name').value = data.city_name || '';
            document.querySelector('#approvedModal #modal-barangay-name').value = data.barangay_name || '';
            document.querySelector('#approvedModal #modal-district').value = data.district || '';
            document.querySelector('#approvedModal #modal-street').value = data.street || '';
            document.querySelector('#approvedModal #modal-email').value = data.email || '';
            document.querySelector('#approvedModal #modal-contact-number').value = data.contact_number || '';
            document.querySelector('#approvedModal #modal-nationality').value = data.nationality || '';
            
            // Personal information
            document.querySelector('#approvedModal #modal-sex').value = data.sex || '';
            document.querySelector('#approvedModal #modal-civil-status').value = data.civil_status || '';
            document.querySelector('#approvedModal #modal-employment-status').value = data.employment_status || '';
            document.querySelector('#approvedModal #modal-monthly-income').value = data.monthly_income || '';
            document.querySelector('#approvedModal #modal-date-hired').value = data.date_hired || '';
            document.querySelector('#approvedModal #modal-company-name').value = data.company_name || '';
            document.querySelector('#approvedModal #modal-birthdate').value = data.birthdate || '';
            document.querySelector('#approvedModal #modal-age').value = data.age || '';
            
            // Birthplace
            document.querySelector('#approvedModal #modal-birthplace-region').value = data.birthplace_regionb_name || '';
            document.querySelector('#approvedModal #modal-birthplace-province').value = data.birthplace_provinceb_name || '';
            document.querySelector('#approvedModal #modal-birthplace-city').value = data.birthplace_cityb_name || '';
            
            // Other information
            document.querySelector('#approvedModal #modal-educational-attainment').value = data.educational_attainment || '';
            document.querySelector('#approvedModal #modal-parent-guardian').value = data.parent_guardian || '';
            document.querySelector('#approvedModal #modal-permanent-address').value = data.permanent_address || '';
            document.querySelector('#approvedModal #modal-course-qualification').value = data.course_or_qualification || '';
            document.querySelector('#approvedModal #modal-applicant-name').value = data.applicant_name || '';
            document.querySelector('#approvedModal #modal-date-accomplished').value = data.date_accomplished || '';
            
            // Classifications
            const classificationsDiv = document.querySelector('#approvedModal #modal-classifications');
            classificationsDiv.innerHTML = '';
            if (data.classifications && data.classifications.length > 0) {
                data.classifications.forEach(classification => {
                    const span = document.createElement('span');
                    span.className = 'inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded mr-2 mb-2';
                    span.textContent = classification.name;
                    classificationsDiv.appendChild(span);
                });
            } else {
                classificationsDiv.textContent = 'None specified';
            }
            
            // Disability type
            document.querySelector('#approvedModal #modal-disability-type').textContent = data.disability_type?.name || 'None';
            
            // Disability causes
            const causesDiv = document.querySelector('#approvedModal #modal-disability-causes');
            causesDiv.innerHTML = '';
            if (data.disability_causes && data.disability_causes.length > 0) {
                data.disability_causes.forEach(cause => {
                    const span = document.createElement('span');
                    span.className = 'inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded mr-2 mb-2';
                    span.textContent = cause.name;
                    causesDiv.appendChild(span);
                });
            } else {
                causesDiv.textContent = 'None';
            }
            
            // Profile picture
            const profilePic = document.querySelector('#approvedModal #modal-profile-picture');
            if (data.id_picture) {
                profilePic.src = data.id_picture;
                profilePic.alt = "Profile Picture";
            } else {
                profilePic.src = "/static/default-profile.png";
                profilePic.alt = "No Profile Picture";
            }
        }

        function closeApprovedModal() {
            const modal = document.getElementById('approvedModal');
            modal.classList.remove('active');
        }

        // Decline modal functions
        function openDeclineModal(applicationId, applicantName) {
            document.getElementById('declineApplicantName').textContent = applicantName;
            document.getElementById('declineApplicationId').value = applicationId;
            document.getElementById('declineModal').classList.add('active');
        }

        function closeDeclineModal() {
            document.getElementById('declineModal').classList.remove('active');
        }

        function updateReasonText() {
            const select = document.getElementById("commonReason");
            const textarea = document.getElementById("declineReason");
            const selected = select.value;
            if (selected && selected !== "Other") {
                textarea.value = selected;
            } else if (selected === "Other") {
                textarea.value = "";
            }
        }

        // PDF download function
        function downloadApplicantProfileAsPDF(profileId, username, programName) {
            fetch(`/api/profile/${profileId}/`)
                .then((response) => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then((data) => {
                    const tempModal = createTempModalForPDF(data, username, programName);
                    const opt = {
                        margin: [10, 10, 10, 10],
                        filename: `${username.replace(/\s+/g, "_")}_${programName.replace(/\s+/g, "_")}_Profile.pdf`,
                        image: { type: "jpeg", quality: 0.98 },
                        html2canvas: {
                            scale: 2,
                            useCORS: true,
                            letterRendering: true,
                        },
                        jsPDF: {
                            unit: "mm",
                            format: "a4",
                            orientation: "portrait",
                        },
                    };
                    return window.html2pdf().set(opt).from(tempModal).save();
                })
                .then(() => {
                    console.log("PDF downloaded successfully");
                })
                .catch((error) => {
                    console.error("Error generating PDF:", error);
                    alert("Error generating PDF. Please try again.");
                });
        }

        function createTempModalForPDF(data, username, programName) {
            const tempDiv = document.createElement("div");
            tempDiv.style.cssText = `
                font-family: Arial, sans-serif;
                padding: 20px;
                background: white;
                color: black;
                max-width: 800px;
                margin: 0 auto;
                line-height: 1.4;
            `;

            tempDiv.innerHTML = `
                <div style="text-align: center; margin-bottom: 30px; border-bottom: 2px solid #1e40af; padding-bottom: 15px;">
                    <h1 style="color: #1e40af; margin: 0; font-size: 24px;">DLL-LMSTC Registration Form</h1>
                    <h2 style="color: #374151; margin: 10px 0; font-size: 18px;">LEARNERS PROFILE FORM</h2>
                    <h3 style="color: #374151; margin: 5px 0; font-size: 16px;">Applicant: ${username}</h3>
                    <h3 style="color: #374151; margin: 5px 0; font-size: 16px;">Program: ${programName}</h3>
                </div>
                <!-- Add more PDF content here -->
            `;

            return tempDiv;
        }

        // Job posting functions
        function openAddJobModal() {
            document.getElementById('addJobModal').classList.remove('hidden');
        }

        function closeAddJobModal() {
            document.getElementById('addJobModal').classList.add('hidden');
        }

        // Skills functionality
        document.addEventListener('DOMContentLoaded', function() {
            const skillButtons = document.querySelectorAll('.skill-btn');
            const skillContainer = document.getElementById('skillContainer');
            
            if (skillButtons.length > 0 && skillContainer) {
                skillButtons.forEach(button => {
                    button.addEventListener('click', function () {
                        const skillName = button.textContent.trim();
                        
                        // Check if skill already exists
                        const existingTags = [...skillContainer.querySelectorAll('.tag')];
                        if (existingTags.some(tag => tag.dataset.skill === skillName)) {
                            return; // Already added, do nothing
                        }
                        
                        // Create tag element
                        const tag = document.createElement('div');
                        tag.className = 'tag flex items-center bg-blue-100 text-blue-800 rounded-full px-3 py-1 text-sm';
                        tag.dataset.skill = skillName;
                        tag.innerHTML = `
                            <span>${skillName}</span>
                            <button type="button" class="ml-2 text-blue-500 hover:text-blue-700 font-bold">&times;</button>
                        `;
                        
                        // Add hidden input for form submission
                        const hiddenInput = document.createElement('input');
                        hiddenInput.type = 'hidden';
                        hiddenInput.name = 'skills[]';
                        hiddenInput.value = skillName;
                        tag.appendChild(hiddenInput);
                        
                        // Add remove functionality
                        tag.querySelector('button').addEventListener('click', () => {
                            skillContainer.removeChild(tag);
                        });
                        
                        skillContainer.appendChild(tag);
                    });
                });
            }
        });

        // Add these JavaScript functions to your existing script section
        function openViewModals(button) {
            // Populate fields from data attributes
            document.getElementById('view-title').value = button.dataset.title || '';
            document.getElementById('view-company').value = button.dataset.company || '';
            document.getElementById('view-address').value = button.dataset.address || '';
            document.getElementById('view-description').value = button.dataset.description || '';
            document.getElementById('view-availability').value = button.dataset.availability || '';
            document.getElementById('view-program').value = button.dataset.program || '';
            document.getElementById('view-email').value = button.dataset.email || '';
            
            // Store job ID for updates
            document.getElementById('viewJobModal').dataset.jobId = button.dataset.jobId;
            
            // Populate skills
            const skillContainer = document.getElementById('view-skills');
            skillContainer.innerHTML = '';
            
            if (button.dataset.skills && button.dataset.skills.trim() !== '') {
                const skills = button.dataset.skills.split(',');
                skills.forEach(skill => {
                    if (skill.trim()) {
                        const tag = document.createElement('div');
                        tag.className = 'bg-blue-100 px-3 py-1 rounded-full';
                        tag.textContent = skill.trim();
                        skillContainer.appendChild(tag);
                    }
                });
            } else {
                const noSkills = document.createElement('div');
                noSkills.className = 'text-gray-500 italic';
                noSkills.textContent = 'No skills specified';
                skillContainer.appendChild(noSkills);
            }
            
            // Reset to view mode
            resetToViewMode();
            
            // Show modal
            document.getElementById('viewJobModal').classList.remove('hidden');
        }

        function closeViewJobModal() {
            document.getElementById('viewJobModal').classList.add('hidden');
            resetToViewMode();
        }

        function toggleEditMode() {
            console.log("Edit mode toggled");
            
            // Enable input fields for editing
            document.getElementById('view-title').disabled = false;
            document.getElementById('view-company').disabled = false;
            document.getElementById('view-address').disabled = false;
            document.getElementById('view-description').disabled = false;
            document.getElementById('view-availability').disabled = false;
            document.getElementById('view-program').disabled = false;
            document.getElementById('view-email').disabled = false;
            
            // Change background color to indicate editing
            const inputs = ['view-title', 'view-company', 'view-address', 'view-description', 'view-availability', 'view-program', 'view-email'];
            inputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                input.classList.remove('bg-gray-100');
                input.classList.add('bg-white');
            });
            
            // Hide Edit button and show Update button
            document.getElementById('edit-button').classList.add('hidden');
            document.getElementById('update-button').classList.remove('hidden');
        }

        function resetToViewMode() {
            // Disable input fields
            const inputs = ['view-title', 'view-company', 'view-address', 'view-description', 'view-availability', 'view-program', 'view-email'];
            inputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                input.disabled = true;
                input.classList.remove('bg-white');
                input.classList.add('bg-gray-100');
            });
            
            // Show Edit button and hide Update button
            document.getElementById('edit-button').classList.remove('hidden');
            document.getElementById('update-button').classList.add('hidden');
        }

        function updateJobDetails() {
            const jobId = document.getElementById('viewJobModal').dataset.jobId;
            
            // Collect updated values
            const updatedData = {
                job_title: document.getElementById('view-title').value,
                company: document.getElementById('view-company').value,
                address: document.getElementById('view-address').value,
                job_description: document.getElementById('view-description').value,
                availability: document.getElementById('view-availability').value,
                program: document.getElementById('view-program').value,
                email_or_link: document.getElementById('view-email').value
            };
            
            // Log updated values (you can replace this with actual AJAX call to your Django backend)
            console.log('Job ID:', jobId);
            console.log('Updated Data:', updatedData);
            
            // Example AJAX call to update job (uncomment and modify according to your Django URLs)
            /*
            fetch(`/update-job/${jobId}/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                },
                body: JSON.stringify(updatedData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Show success notification
                    showNotification('Job updated successfully!', 'success');
                    
                    // Update the table row with new data
                    updateJobTableRow(jobId, updatedData);
                    
                    // Close modal
                    closeViewJobModal();
                } else {
                    showNotification('Error updating job: ' + data.error, 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Error updating job. Please try again.', 'error');
            });
            */
            
            // For now, just show a success message and reset to view mode
            showNotification('Job details updated successfully!', 'success');
            resetToViewMode();
        }

        // Helper function to show notifications
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type} active`;
            notification.innerHTML = `
                <i class="icon fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
                <span>${message}</span>
            `;
            
            const container = document.getElementById('notificationContainer');
            container.appendChild(notification);
            
            // Remove notification after 3 seconds
            setTimeout(() => {
                notification.classList.remove('active');
                setTimeout(() => {
                    if (container.contains(notification)) {
                        container.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Helper function to update table row after successful update
        function updateJobTableRow(jobId, updatedData) {
            // Find the table row and update the job title
            const tableRows = document.querySelectorAll('#activeJobsContent tbody tr');
            tableRows.forEach(row => {
                const viewButton = row.querySelector('button[data-job-id="' + jobId + '"]');
                if (viewButton) {
                    // Update the job title in the table
                    const titleCell = row.querySelector('td:first-child');
                    if (titleCell) {
                        titleCell.textContent = updatedData.job_title;
                    }
                    
                    // Update button data attributes
                    viewButton.dataset.title = updatedData.job_title;
                    viewButton.dataset.company = updatedData.company;
                    viewButton.dataset.address = updatedData.address;
                    viewButton.dataset.description = updatedData.job_description;
                    viewButton.dataset.availability = updatedData.availability;
                    viewButton.dataset.program = updatedData.program;
                    viewButton.dataset.email = updatedData.email_or_link;
                }
            });
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('viewJobModal');
            if (event.target === modal) {
                closeViewJobModal();
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const modal = document.getElementById('viewJobModal');
                if (!modal.classList.contains('hidden')) {
                    closeViewJobModal();
                }
            }
        });

        // Walk-in Modal Functionality - New 3-Step Process
        function openWalkinModal() {
            document.getElementById('walkinModal').classList.add('active');
            showWalkinStep(1);
            // Reset form data
            document.getElementById('walkinFullName').value = '';
            document.getElementById('walkinProgram').value = '';
            document.getElementById('walkinApplicantId').value = '';
            document.getElementById('walkinApplicationId').value = '';
        }

        function closeWalkinModal() {
            document.getElementById('walkinModal').classList.remove('active');
            showWalkinStep(1);
        }

        function showWalkinStep(step) {
            // Hide all steps
            document.getElementById('walkinStep1').style.display = 'none';
            document.getElementById('walkinStep2').style.display = 'none';
            document.getElementById('walkinStep3').style.display = 'none';
            
            // Show the requested step
            document.getElementById('walkinStep' + step).style.display = 'block';
        }

        // Step 1: Create Account
        function createWalkinAccount() {
            const fullName = document.getElementById('walkinFullName').value.trim();
            
            if (!fullName) {
                showNotification('Please enter the applicant\'s full name.', 'error');
                return;
            }

            // Show loading state
            const btn = document.querySelector('#walkinStep1 button');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Creating Account...';
            btn.disabled = true;

            // Send request to create account
            fetch('/create-walkin-account/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                },
                body: JSON.stringify({
                    full_name: fullName
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Store applicant data
                    document.getElementById('walkinApplicantId').value = data.applicant_id;
                    document.getElementById('walkinUsername').textContent = data.username;
                    document.getElementById('walkinPassword').textContent = data.password;
                    
                    // Move to step 2
                    showWalkinStep(2);
                    showNotification('Account created successfully! Now select a program.', 'success');
                } else {
                    showNotification(data.message || 'Failed to create account', 'error');
                }
                
                // Reset button
                btn.innerHTML = originalText;
                btn.disabled = false;
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('An error occurred while creating the account', 'error');
                btn.innerHTML = originalText;
                btn.disabled = false;
            });
        }

        // Step 2: Apply to Program
        function applyWalkinProgram() {
            const applicantId = document.getElementById('walkinApplicantId').value;
            const programId = document.getElementById('walkinProgram').value;
            
            if (!programId) {
                showNotification('Please select a program.', 'error');
                return;
            }

            // Show loading state
            const btn = document.querySelector('#walkinStep2 button[onclick="applyWalkinProgram()"]');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Submitting...';
            btn.disabled = true;

            // Send request to apply to program
            fetch('/apply-walkin-program/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                },
                body: JSON.stringify({
                    applicant_id: applicantId,
                    program_id: programId
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Store application data
                    document.getElementById('walkinApplicationId').value = data.application_id;
                    document.getElementById('walkinQueueNumber').textContent = data.queue_number;
                    
                    // Move to step 3
                    showWalkinStep(3);
                    showNotification('Walk-in application submitted successfully!', 'success');
                    
                    // Refresh the page after a delay to show updated counts
                    setTimeout(() => {
                        location.reload();
                    }, 3000);
                } else {
                    showNotification(data.message || 'Failed to submit application', 'error');
                }
                
                // Reset button
                btn.innerHTML = originalText;
                btn.disabled = false;
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('An error occurred while submitting the application', 'error');
                btn.innerHTML = originalText;
                btn.disabled = false;
            });
        }

        // Age calculation function
        function calculateAge() {
            const birthdate = document.getElementById('birthdate').value;
            if (birthdate) {
                const today = new Date();
                const birth = new Date(birthdate);
                let age = today.getFullYear() - birth.getFullYear();
                const monthDiff = today.getMonth() - birth.getMonth();
                
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                    age--;
                }
                
                document.getElementById('age').value = age;
            }
        }

        // Event listeners for walk-in modal
        document.addEventListener('DOMContentLoaded', function() {
            // New Walk-in button
            const newWalkinBtn = document.getElementById('newWalkinBtn');
            if (newWalkinBtn) {
                newWalkinBtn.addEventListener('click', openWalkinModal);
            }

            // Modal close buttons
            const walkinCloseBtn = document.getElementById('walkinCloseBtn');
            if (walkinCloseBtn) {
                walkinCloseBtn.addEventListener('click', closeWalkinModal);
            }

            // Step navigation buttons
            const walkinNextBtn = document.getElementById('walkinNextBtn');
            if (walkinNextBtn) {
                walkinNextBtn.addEventListener('click', nextWalkinStep);
            }

            const walkinPrevBtn = document.getElementById('walkinPrevBtn');
            if (walkinPrevBtn) {
                walkinPrevBtn.addEventListener('click', prevWalkinStep);
            }

            // Age calculation
            const birthdateInput = document.getElementById('birthdate');
            if (birthdateInput) {
                birthdateInput.addEventListener('change', calculateAge);
            }

            // Close modal when clicking outside
            const walkinModal = document.getElementById('walkinModal');
            if (walkinModal) {
                walkinModal.addEventListener('click', function(event) {
                    if (event.target === walkinModal) {
                        closeWalkinModal();
                    }
                });
            }

            // Address cascade functionality (if needed)
            // You can add region/province/city/barangay dropdown population here
            // similar to the Registration_f1.html implementation
        });

        // Form validation before submission
        function validateWalkinForm() {
            const requiredFields = [
                'first_name', 'last_name', 'sex', 'birthdate', 'contact_no'
            ];

            for (let field of requiredFields) {
                const element = document.getElementById(field);
                if (element && !element.value.trim()) {
                    alert(`Please fill in the ${field.replace('_', ' ')} field.`);
                    element.focus();
                    return false;
                }
            }

            return true;
        }

        // Handle form submission
        document.addEventListener('DOMContentLoaded', function() {
            const walkinForm = document.getElementById('walkinForm');
            if (walkinForm) {
                walkinForm.addEventListener('submit', function(event) {
                    if (!validateWalkinForm()) {
                        event.preventDefault();
                        return false;
                    }
                    // Form will submit normally if validation passes
                });
            }
        });

        // Add Program Modal Functionality
        function openAddProgramModal() {
            document.getElementById('addProgramModal').classList.add('active');
        }

        function closeAddProgramModal() {
            document.getElementById('addProgramModal').classList.remove('active');
            // Reset form
            document.getElementById('addProgramForm').reset();
        }

        // Add Program Modal Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Add Program button
            const addProgramBtn = document.getElementById('addProgramBtn');
            if (addProgramBtn) {
                addProgramBtn.addEventListener('click', openAddProgramModal);
            }

            // Close modal button
            const closeProgramModalBtn = document.getElementById('closeProgramModalBtn');
            if (closeProgramModalBtn) {
                closeProgramModalBtn.addEventListener('click', closeAddProgramModal);
            }

            // Close modal when clicking outside
            const addProgramModal = document.getElementById('addProgramModal');
            if (addProgramModal) {
                addProgramModal.addEventListener('click', function(event) {
                    if (event.target === addProgramModal) {
                        closeAddProgramModal();
                    }
                });
            }

            // Handle form submission with confirmation
            const addProgramForm = document.getElementById('addProgramForm');
            if (addProgramForm) {
                addProgramForm.addEventListener('submit', function(event) {
                    const programName = document.getElementById('programName').value.trim();
                    const programDescription = document.getElementById('programDescription').value.trim();
                    const programSchedule = document.getElementById('programSchedule').value.trim();

                    if (!programName || !programDescription || !programSchedule) {
                        event.preventDefault();
                        alert('Please fill in all required fields (Program Name, Description, and Schedule).');
                        return false;
                    }

                    // Show confirmation dialog
                    if (!confirm(`Are you sure you want to add the program "${programName}"?`)) {
                        event.preventDefault();
                        return false;
                    }

                    // Show loading state
                    const submitBtn = addProgramForm.querySelector('button[type="submit"]');
                    const originalText = submitBtn.innerHTML;
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Adding Program...';
                    submitBtn.disabled = true;

                    // Form will submit normally if validation passes
                    // The loading state will be reset when the page reloads
                });
            }

            // Program Search Functionality
            const programSearchFilter = document.getElementById('programSearchFilter');
            if (programSearchFilter) {
                programSearchFilter.addEventListener('input', function() {
                    filterPrograms();
                });
            }
        });

        // Program Search/Filter Function
        function filterPrograms() {
            const searchTerm = document.getElementById('programSearchFilter').value.toLowerCase().trim();
            const programRows = document.querySelectorAll('#programTableBody tr');
            let visibleCount = 0;

            programRows.forEach(row => {
                // Skip the "no data" row
                if (row.id === 'programNoDataRow') {
                    return;
                }

                const programName = row.querySelector('td:first-child')?.textContent?.toLowerCase() || '';
                const programTrainer = row.querySelector('td:nth-child(3)')?.textContent?.toLowerCase() || '';
                const programSkills = row.querySelector('td:nth-child(4)')?.textContent?.toLowerCase() || '';
                const programSchedule = row.querySelector('td:nth-child(2)')?.textContent?.toLowerCase() || '';

                // Check if search term matches any of the program data
                const isVisible = searchTerm === '' || 
                    programName.includes(searchTerm) ||
                    programTrainer.includes(searchTerm) ||
                    programSkills.includes(searchTerm) ||
                    programSchedule.includes(searchTerm);

                if (isVisible) {
                    row.style.display = '';
                    visibleCount++;
                } else {
                    row.style.display = 'none';
                }
            });

            // Update pagination info
            updateProgramPaginationInfo(visibleCount, searchTerm);

            // Show/hide no results message
            showNoResultsMessage(visibleCount, searchTerm);
        }

        // Update pagination information for filtered results
        function updateProgramPaginationInfo(visibleCount, searchTerm) {
            const paginationInfo = document.getElementById('programPaginationInfo');
            if (paginationInfo) {
                if (searchTerm === '') {
                    // Show original count when no search
                    const totalPrograms = document.querySelectorAll('#programTableBody tr:not(#programNoDataRow)').length;
                    paginationInfo.textContent = totalPrograms > 0 ? 
                        `Showing ${totalPrograms} program${totalPrograms !== 1 ? 's' : ''} total` : 
                        'Showing 0 programs';
                } else {
                    // Show filtered count
                    paginationInfo.textContent = `Showing ${visibleCount} program${visibleCount !== 1 ? 's' : ''} matching "${searchTerm}"`;
                }
            }
        }

        // Show no results message when search yields no results
        function showNoResultsMessage(visibleCount, searchTerm) {
            const noDataRow = document.getElementById('programNoDataRow');
            const hasPrograms = document.querySelectorAll('#programTableBody tr:not(#programNoDataRow)').length > 0;
            
            if (hasPrograms && visibleCount === 0 && searchTerm !== '') {
                // Show "no results found" message
                if (noDataRow) {
                    noDataRow.style.display = '';
                    noDataRow.innerHTML = `
                        <td colspan="5" class="text-center py-8 text-gray-500">
                            <i class="fas fa-search text-4xl mb-2 text-gray-300"></i>
                            <p class="text-lg">No programs found</p>
                            <p class="text-sm">No programs match your search for "${searchTerm}"</p>
                        </td>
                    `;
                }
            } else if (hasPrograms && visibleCount > 0) {
                // Hide no data row when there are visible results
                if (noDataRow) {
                    noDataRow.style.display = 'none';
                }
            } else if (!hasPrograms) {
                // Show original "no programs available" message
                if (noDataRow) {
                    noDataRow.style.display = '';
                    noDataRow.innerHTML = `
                        <td colspan="5" class="text-center py-8 text-gray-500">
                            <i class="fas fa-graduation-cap text-4xl mb-2 text-gray-300"></i>
                            <p class="text-lg">No programs available</p>
                            <p class="text-sm">Click "Add Program" to create your first program</p>
                        </td>
                    `;
                }
            }
        }

        // Program Management Modal Functions
        function openViewProgramModal() {
            document.getElementById('viewProgramModal').classList.add('active');
        }

        function closeViewProgramModal() {
            document.getElementById('viewProgramModal').classList.remove('active');
        }

        function openEditProgramModal() {
            document.getElementById('editProgramModal').classList.add('active');
        }

        function closeEditProgramModal() {
            document.getElementById('editProgramModal').classList.remove('active');
            document.getElementById('editProgramForm').reset();
        }

        function openDeleteProgramModal() {
            document.getElementById('deleteProgramModal').classList.add('active');
        }

        function closeDeleteProgramModal() {
            document.getElementById('deleteProgramModal').classList.remove('active');
        }

        // View Program Function
        function viewProgram(button) {
            const programId = button.getAttribute('data-program-id');
            const programName = button.getAttribute('data-program-name');
            const programDescription = button.getAttribute('data-program-description');
            const programSchedule = button.getAttribute('data-program-schedule');
            const programTrainer = button.getAttribute('data-program-trainer');
            const programSkills = button.getAttribute('data-program-skills');
            const programImage = button.getAttribute('data-program-image');

            // Populate view modal
            document.getElementById('viewProgramName').textContent = programName;
            document.getElementById('viewProgramDescription').textContent = programDescription;
            document.getElementById('viewProgramSchedule').textContent = programSchedule;
            document.getElementById('viewProgramTrainer').textContent = programTrainer;
            document.getElementById('viewProgramSkills').textContent = programSkills;

            // Handle program image
            const imageElement = document.getElementById('viewProgramImage');
            const imagePlaceholder = document.getElementById('viewProgramImagePlaceholder');
            
            if (programImage && programImage.trim() !== '') {
                imageElement.src = programImage;
                imageElement.style.display = 'block';
                imagePlaceholder.style.display = 'none';
            } else {
                imageElement.style.display = 'none';
                imagePlaceholder.style.display = 'block';
            }

            openViewProgramModal();
        }

        // Edit Program Function
        function editProgram(button) {
            const programId = button.getAttribute('data-program-id');
            const programName = button.getAttribute('data-program-name');
            const programDescription = button.getAttribute('data-program-description');
            const programSchedule = button.getAttribute('data-program-schedule');
            const programTrainer = button.getAttribute('data-program-trainer');
            const programSkills = button.getAttribute('data-program-skills');

            // Populate edit modal
            document.getElementById('editProgramId').value = programId;
            document.getElementById('editProgramName').value = programName;
            document.getElementById('editProgramDescription').value = programDescription;
            document.getElementById('editProgramSchedule').value = programSchedule;
            document.getElementById('editProgramTrainer').value = programTrainer;
            document.getElementById('editProgramSkills').value = programSkills;

            // Set form action for editing
            const form = document.getElementById('editProgramForm');
            form.action = `/edit_program/${programId}/`;

            openEditProgramModal();
        }

        // Delete Program Function
        function deleteProgram(button) {
            const programId = button.getAttribute('data-program-id');
            const programName = button.getAttribute('data-program-name');

            // Populate delete modal
            document.getElementById('deleteProgramName').textContent = programName;

            // Set up confirm delete button
            const confirmBtn = document.getElementById('confirmDeleteProgram');
            confirmBtn.onclick = function() {
                // Create and submit delete form
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = `/delete_program/${programId}/`;
                
                // Add CSRF token
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                const csrfInput = document.createElement('input');
                csrfInput.type = 'hidden';
                csrfInput.name = 'csrfmiddlewaretoken';
                csrfInput.value = csrfToken;
                form.appendChild(csrfInput);

                document.body.appendChild(form);
                form.submit();
            };

            openDeleteProgramModal();
        }

        // Event Listeners for Program Management
        document.addEventListener('DOMContentLoaded', function() {
            // View Program buttons
            document.querySelectorAll('.view-program-btn').forEach(button => {
                button.addEventListener('click', function() {
                    viewProgram(this);
                });
            });

            // Edit Program buttons
            document.querySelectorAll('.edit-program-btn').forEach(button => {
                button.addEventListener('click', function() {
                    editProgram(this);
                });
            });

            // Delete Program buttons
            document.querySelectorAll('.delete-program-btn').forEach(button => {
                button.addEventListener('click', function() {
                    deleteProgram(this);
                });
            });

            // Modal close events
            document.getElementById('viewProgramModal').addEventListener('click', function(event) {
                if (event.target === this) {
                    closeViewProgramModal();
                }
            });

            document.getElementById('editProgramModal').addEventListener('click', function(event) {
                if (event.target === this) {
                    closeEditProgramModal();
                }
            });

            document.getElementById('deleteProgramModal').addEventListener('click', function(event) {
                if (event.target === this) {
                    closeDeleteProgramModal();
                }
            });

            // Edit form submission with validation
            const editProgramForm = document.getElementById('editProgramForm');
            if (editProgramForm) {
                editProgramForm.addEventListener('submit', function(event) {
                    const programName = document.getElementById('editProgramName').value.trim();
                    const programDescription = document.getElementById('editProgramDescription').value.trim();
                    const programSchedule = document.getElementById('editProgramSchedule').value.trim();

                    if (!programName || !programDescription || !programSchedule) {
                        event.preventDefault();
                        alert('Please fill in all required fields (Program Name, Description, and Schedule).');
                        return false;
                    }

                    // Show confirmation dialog
                    if (!confirm(`Are you sure you want to update the program "${programName}"?`)) {
                        event.preventDefault();
                        return false;
                    }

                    // Show loading state
                    const submitBtn = editProgramForm.querySelector('button[type="submit"]');
                    const originalText = submitBtn.innerHTML;
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Updating Program...';
                    submitBtn.disabled = true;
                });
            }
        });

        // Walk-in approval functions
        function approveWalkIn(applicationId) {
            if (confirm('Are you sure you want to approve this walk-in application?')) {
                fetch(`/approve-walkin/${applicationId}/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                        'Content-Type': 'application/json',
                    },
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showNotification('Walk-in application approved successfully!', 'success');
                        location.reload();
                    } else {
                        showNotification(data.message || 'Error approving application', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showNotification('Error approving application', 'error');
                });
            }
        }

        function declineWalkIn(applicationId) {
            const reason = prompt('Please provide a reason for declining this application:');
            if (reason !== null && reason.trim() !== '') {
                fetch(`/decline-walkin/${applicationId}/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ reason: reason.trim() })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showNotification('Walk-in application declined', 'info');
                        location.reload();
                    } else {
                        showNotification(data.message || 'Error declining application', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showNotification('Error declining application', 'error');
                });
            }
        }

        // OCR Processing Functions
        function openFileSelectionModal() {
            document.getElementById('fileSelectionModal').classList.remove('hidden');
        }

        function closeFileSelectionModal() {
            document.getElementById('fileSelectionModal').classList.add('hidden');
        }

        function closeTextDisplayModal() {
            document.getElementById('textDisplayModal').classList.add('hidden');
        }

        function processSelectedFile() {
            const fileInput = document.getElementById('ocrFileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                showNotification('Please select a file first', 'error');
                return;
            }

            if (!file.name.endsWith('.xlsx') && !file.name.endsWith('.xls')) {
                showNotification('Please select an Excel file (.xlsx or .xls)', 'error');
                return;
            }

            const formData = new FormData();
            formData.append('file', file);

            document.getElementById('ocrStatus').textContent = 'Processing file...';
            closeFileSelectionModal();

            fetch('/process-excel-ocr/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                },
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('ocrStatus').textContent = 'File processed successfully';
                    displayExtractedText(data.extracted_data, data.columns);
                } else {
                    document.getElementById('ocrStatus').textContent = 'Processing failed';
                    showNotification(data.message || 'Error processing file', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('ocrStatus').textContent = 'Processing failed';
                showNotification('Error processing file', 'error');
            });
        }

        function displayExtractedText(data, columns) {
            const textContent = document.getElementById('extractedTextContent');
            let html = '<div class="space-y-4">';
            
            // Display columns
            html += '<div><h5 class="font-semibold mb-2">Detected Columns:</h5>';
            html += '<div class="flex flex-wrap gap-2 mb-4">';
            columns.forEach(col => {
                html += `<span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm">${col}</span>`;
            });
            html += '</div></div>';
            
            // Display sample data
            html += '<div><h5 class="font-semibold mb-2">Sample Data (First 5 rows):</h5>';
            html += '<div class="overflow-x-auto"><table class="min-w-full border border-gray-300">';
            html += '<thead class="bg-gray-50"><tr>';
            columns.forEach(col => {
                html += `<th class="border border-gray-300 px-2 py-1 text-xs">${col}</th>`;
            });
            html += '</tr></thead><tbody>';
            
            data.slice(0, 5).forEach(row => {
                html += '<tr>';
                columns.forEach(col => {
                    html += `<td class="border border-gray-300 px-2 py-1 text-xs">${row[col] || ''}</td>`;
                });
                html += '</tr>';
            });
            html += '</tbody></table></div></div>';
            html += '</div>';
            
            textContent.innerHTML = html;
            
            // Store data for saving
            window.extractedOCRData = data;
            window.extractedColumns = columns;
            
            document.getElementById('textDisplayModal').classList.remove('hidden');
        }

        function saveExtractedData() {
            if (!window.extractedOCRData || !window.extractedColumns) {
                showNotification('No data to save', 'error');
                return;
            }

            const saveButton = document.querySelector('#textDisplayModal button[onclick="saveExtractedData()"]');
            saveButton.disabled = true;
            saveButton.textContent = 'Saving...';

            fetch('/save-excel-data/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                },
                body: JSON.stringify({
                    data: window.extractedOCRData,
                    columns: window.extractedColumns
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification(`Data saved successfully. ${data.created_count} records created, ${data.updated_count} records updated.`, 'success');
                    closeTextDisplayModal();
                } else {
                    showNotification(data.message || 'Error saving data', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Error saving data', 'error');
            })
            .finally(() => {
                saveButton.disabled = false;
                saveButton.textContent = 'Save Data';
            });
        }

        // Process default 2024.xlsx file
        function processDefault2024File() {
            document.getElementById('ocrStatus').textContent = 'Processing 2024.xlsx...';

            fetch('/process-default-excel/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('ocrStatus').textContent = '2024.xlsx processed successfully';
                    displayExtractedText(data.extracted_data, data.columns);
                } else {
                    document.getElementById('ocrStatus').textContent = 'Processing failed';
                    showNotification(data.message || 'Error processing 2024.xlsx', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('ocrStatus').textContent = 'Processing failed';
                showNotification('Error processing 2024.xlsx', 'error');
            });
        }

        // Bulk Review Modal Functions
        function openBulkReviewModal() {
            document.getElementById('bulkReviewModal').classList.add('active');
            loadBulkReviewData();
        }

        function closeBulkReviewModal() {
            document.getElementById('bulkReviewModal').classList.remove('active');
        }

        // Bulk Download Modal Functions
        let learnerProfilesData = [];
        let filteredData = [];

        function openBulkDownloadModal() {
            document.getElementById('bulkDownloadModal').classList.remove('hidden');
            loadLearnerProfilesData();
        }

        function closeBulkDownloadModal() {
            document.getElementById('bulkDownloadModal').classList.add('hidden');
            clearFilters();
        }

        function loadLearnerProfilesData() {
            // Show loading state
            const tableBody = document.getElementById('learnerProfilesTableBody');
            tableBody.innerHTML = `
                <tr>
                    <td colspan="7" class="px-6 py-4 text-center text-gray-500">
                        <i class="fas fa-spinner fa-spin mr-2"></i>Loading data...
                    </td>
                </tr>
            `;

            // Simulate API call to load learner profiles data
            // In real implementation, this would fetch from your Django backend
            setTimeout(() => {
                // Sample data - replace with actual API call
                learnerProfilesData = [
                    {
                        id: 'LP001',
                        fullName: 'John Doe',
                        programsCompleted: 'Digital Literacy, Computer Basics',
                        yearCompleted: '2024',
                        batch: 'Batch 1',
                        status: 'completed'
                    },
                    {
                        id: 'LP002',
                        fullName: 'Jane Smith',
                        programsCompleted: 'Advanced Computing',
                        yearCompleted: '2023',
                        batch: 'Batch 2',
                        status: 'completed'
                    },
                    {
                        id: 'LP003',
                        fullName: 'Mike Johnson',
                        programsCompleted: 'Web Development',
                        yearCompleted: '2024',
                        batch: 'Batch 1',
                        status: 'in-progress'
                    },
                    {
                        id: 'LP004',
                        fullName: 'Sarah Wilson',
                        programsCompleted: 'Data Analysis',
                        yearCompleted: '2022',
                        batch: 'Batch 3',
                        status: 'completed'
                    },
                    {
                        id: 'LP005',
                        fullName: 'Robert Brown',
                        programsCompleted: 'Mobile Development',
                        yearCompleted: '2024',
                        batch: 'Batch 2',
                        status: 'pending'
                    }
                ];

                filteredData = [...learnerProfilesData];
                populateLearnerProfilesTable();
                updateRecordCounts();
            }, 1000);
        }

        function populateLearnerProfilesTable() {
            const tableBody = document.getElementById('learnerProfilesTableBody');
            
            if (filteredData.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-6 py-4 text-center text-gray-500">
                            No records found matching the current filters.
                        </td>
                    </tr>
                `;
                return;
            }

            tableBody.innerHTML = filteredData.map(profile => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <input type="checkbox" class="profile-checkbox" value="${profile.id}" onchange="updateSelectedCount()">
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                        ${profile.id}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${profile.fullName}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${profile.programsCompleted}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${profile.yearCompleted}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${profile.batch}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getStatusColor(profile.status)}">
                            ${profile.status.charAt(0).toUpperCase() + profile.status.slice(1)}
                        </span>
                    </td>
                </tr>
            `).join('');
        }

        function getStatusColor(status) {
            switch(status) {
                case 'completed':
                    return 'bg-green-100 text-green-800';
                case 'in-progress':
                    return 'bg-yellow-100 text-yellow-800';
                case 'pending':
                    return 'bg-red-100 text-red-800';
                default:
                    return 'bg-gray-100 text-gray-800';
            }
        }

        function applyFilters() {
            const filterId = document.getElementById('filterById').value.toLowerCase();
            const filterProfile = document.getElementById('filterByProfile').value;
            const filterYear = document.getElementById('filterByYear').value;
            const filterBatch = document.getElementById('filterByBatch').value;

            filteredData = learnerProfilesData.filter(profile => {
                const matchesId = !filterId || profile.id.toLowerCase().includes(filterId) || 
                                profile.fullName.toLowerCase().includes(filterId);
                const matchesProfile = !filterProfile || profile.status === filterProfile;
                const matchesYear = !filterYear || profile.yearCompleted === filterYear;
                const matchesBatch = !filterBatch || profile.batch.toLowerCase().includes(filterBatch.replace('batch', ''));

                return matchesId && matchesProfile && matchesYear && matchesBatch;
            });

            populateLearnerProfilesTable();
            updateRecordCounts();
            updateSelectedCount();
        }

        function clearFilters() {
            document.getElementById('filterById').value = '';
            document.getElementById('filterByProfile').value = '';
            document.getElementById('filterByYear').value = '';
            document.getElementById('filterByBatch').value = '';
            document.getElementById('downloadOverall').checked = false;
            document.getElementById('downloadSpecificYear').checked = false;
            
            filteredData = [...learnerProfilesData];
            populateLearnerProfilesTable();
            updateRecordCounts();
            updateSelectedCount();
        }

        function updateRecordCounts() {
            document.getElementById('recordCount').textContent = `${filteredData.length} records found`;
            document.getElementById('totalCount').textContent = filteredData.length;
        }

        function updateSelectedCount() {
            const checkboxes = document.querySelectorAll('.profile-checkbox:checked');
            document.getElementById('selectedCount').textContent = checkboxes.length;
            
            // Update select all checkbox state
            const selectAllCheckbox = document.getElementById('selectAllCheckbox');
            const allCheckboxes = document.querySelectorAll('.profile-checkbox');
            
            if (checkboxes.length === 0) {
                selectAllCheckbox.indeterminate = false;
                selectAllCheckbox.checked = false;
            } else if (checkboxes.length === allCheckboxes.length) {
                selectAllCheckbox.indeterminate = false;
                selectAllCheckbox.checked = true;
            } else {
                selectAllCheckbox.indeterminate = true;
            }
        }

        function toggleSelectAll() {
            const selectAllCheckbox = document.getElementById('selectAllCheckbox');
            const checkboxes = document.querySelectorAll('.profile-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
            
            updateSelectedCount();
        }

        function selectAllRecords() {
            const checkboxes = document.querySelectorAll('.profile-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
            });
            updateSelectedCount();
        }

        function deselectAllRecords() {
            const checkboxes = document.querySelectorAll('.profile-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            updateSelectedCount();
        }

        function downloadSelectedProfiles() {
            const selectedCheckboxes = document.querySelectorAll('.profile-checkbox:checked');
            
            if (selectedCheckboxes.length === 0) {
                showNotificationToast('Warning', 'Please select at least one profile to download.', 'warning');
                return;
            }

            const selectedIds = Array.from(selectedCheckboxes).map(cb => cb.value);
            const downloadOverall = document.getElementById('downloadOverall').checked;
            const downloadSpecificYear = document.getElementById('downloadSpecificYear').checked;
            
            // Show loading state
            const downloadButton = document.querySelector('button[onclick="downloadSelectedProfiles()"]');
            const originalText = downloadButton.innerHTML;
            downloadButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Preparing Download...';
            downloadButton.disabled = true;

            // Simulate download preparation
            setTimeout(() => {
                // In real implementation, this would make an API call to your Django backend
                // to generate and download the ZIP file with selected profiles
                
                const downloadData = {
                    selectedIds: selectedIds,
                    downloadOverall: downloadOverall,
                    downloadSpecificYear: downloadSpecificYear,
                    filters: {
                        id: document.getElementById('filterById').value,
                        profile: document.getElementById('filterByProfile').value,
                        year: document.getElementById('filterByYear').value,
                        batch: document.getElementById('filterByBatch').value
                    }
                };

                console.log('Download data:', downloadData);
                
                // Simulate successful download
                showNotificationToast('Success', `Successfully prepared download for ${selectedIds.length} profiles.`, 'success');
                
                // Reset button
                downloadButton.innerHTML = originalText;
                downloadButton.disabled = false;
                
                // Close modal
                closeBulkDownloadModal();
                
            }, 2000);
        }

        function loadBulkReviewData() {
            fetch('/get_bulk_review_data/')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Update statistics
                        document.getElementById('totalApplicationsCount').textContent = data.statistics.total_applications;
                        document.getElementById('readyForApprovalCount').textContent = data.statistics.ready_for_approval;
                        document.getElementById('pendingReviewCount').textContent = data.statistics.pending_review;

                        // Populate program applications table
                        populateApplicationTable('programApplicationsTable', data.program_applications, 'program');
                        
                        // Populate walk-in applications table
                        populateApplicationTable('walkinApplicationsTable', data.walkin_applications, 'walkin');
                    } else {
                        showNotificationToast('Error', data.error || 'Failed to load review data', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showNotificationToast('Error', 'Failed to load review data', 'error');
                });
        }

        function populateApplicationTable(tableId, applications, type) {
            const tbody = document.getElementById(tableId);
            tbody.innerHTML = '';

            applications.forEach(app => {
                const row = document.createElement('tr');
                const statusClass = app.is_complete ? 'text-green-600' : 'text-orange-600';
                const documentsStatus = getDocumentsStatus(app);
                
                row.innerHTML = `
                    <td class="border border-gray-300 px-4 py-2">
                        <input type="checkbox" class="review-checkbox" data-review-id="${app.dms_review_id}" data-type="${type}">
                    </td>
                    <td class="border border-gray-300 px-4 py-2">${app.applicant_name}</td>
                    <td class="border border-gray-300 px-4 py-2">${app.program_name}</td>
                    <td class="border border-gray-300 px-4 py-2">${app.applied_date}</td>
                    <td class="border border-gray-300 px-4 py-2 ${statusClass}">${app.status}</td>
                    <td class="border border-gray-300 px-4 py-2">${documentsStatus}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function getDocumentsStatus(app) {
            const docs = [];
            if (app.has_id_picture) docs.push('✓ ID Picture');
            else docs.push('✗ ID Picture');
            
            if (app.has_learner_profile) docs.push('✓ Profile');
            else docs.push('✗ Profile');
            
            if (app.has_signature) docs.push('✓ Signature');
            else docs.push('✗ Signature');
            
            return docs.join('<br>');
        }

        function toggleSelectAllProgram() {
            const selectAll = document.getElementById('selectAllProgram');
            const checkboxes = document.querySelectorAll('#programApplicationsTable .review-checkbox');
            checkboxes.forEach(cb => cb.checked = selectAll.checked);
        }

        function toggleSelectAllWalkin() {
            const selectAll = document.getElementById('selectAllWalkin');
            const checkboxes = document.querySelectorAll('#walkinApplicationsTable .review-checkbox');
            checkboxes.forEach(cb => cb.checked = selectAll.checked);
        }

        function processBulkReview() {
            const selectedCheckboxes = document.querySelectorAll('.review-checkbox:checked');
            const selectedReviews = Array.from(selectedCheckboxes).map(cb => cb.dataset.reviewId);

            if (selectedReviews.length === 0) {
                showNotificationToast('Warning', 'Please select at least one application to review', 'warning');
                return;
            }

            fetch('/process_bulk_review/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({
                    selected_reviews: selectedReviews
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotificationToast('Success', data.message, 'success');
                    closeBulkReviewModal();
                    // Refresh the page or update the UI as needed
                    setTimeout(() => location.reload(), 2000);
                } else {
                    showNotificationToast('Error', data.error || 'Failed to process review', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotificationToast('Error', 'Failed to process review', 'error');
            });
        }

        // Bulk Approval Modal Functions
        function openBulkApprovalModal() {
            document.getElementById('bulkApprovalModal').classList.add('active');
            loadBulkApprovalData();
        }

        function closeBulkApprovalModal() {
            document.getElementById('bulkApprovalModal').classList.remove('active');
        }

        function loadBulkApprovalData() {
            fetch('/get_bulk_approval_data/')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Update statistics
                        document.getElementById('approvalReadyCount').textContent = data.statistics.ready_for_approval;
                        document.getElementById('selectedForApprovalCount').textContent = '0';

                        // Populate approval applications table
                        populateApprovalTable('approvalApplicationsTable', data.approval_applications);
                    } else {
                        showNotificationToast('Error', data.error || 'Failed to load approval data', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showNotificationToast('Error', 'Failed to load approval data', 'error');
                });
        }

        function populateApprovalTable(tableId, applications) {
            const tbody = document.getElementById(tableId);
            tbody.innerHTML = '';

            applications.forEach(app => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="border border-gray-300 px-4 py-2">
                        <input type="checkbox" class="approval-checkbox" data-approval-id="${app.id}" onchange="updateSelectedCount()">
                    </td>
                    <td class="border border-gray-300 px-4 py-2">${app.applicant_name}</td>
                    <td class="border border-gray-300 px-4 py-2">${app.program_name}</td>
                    <td class="border border-gray-300 px-4 py-2">${app.application_type}</td>
                    <td class="border border-gray-300 px-4 py-2">${app.review_date}</td>
                    <td class="border border-gray-300 px-4 py-2 text-green-600">${app.status}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function toggleSelectAllApproval() {
            const selectAll = document.getElementById('selectAllApproval');
            const checkboxes = document.querySelectorAll('.approval-checkbox');
            checkboxes.forEach(cb => cb.checked = selectAll.checked);
            updateSelectedCount();
        }

        function updateSelectedCount() {
            const selectedCount = document.querySelectorAll('.approval-checkbox:checked').length;
            document.getElementById('selectedForApprovalCount').textContent = selectedCount;
        }

        function processBulkApproval() {
            const selectedCheckboxes = document.querySelectorAll('.approval-checkbox:checked');
            const selectedApprovals = Array.from(selectedCheckboxes).map(cb => cb.dataset.approvalId);

            if (selectedApprovals.length === 0) {
                showNotificationToast('Warning', 'Please select at least one application to approve', 'warning');
                return;
            }

            if (!confirm(`Are you sure you want to approve ${selectedApprovals.length} application(s)?`)) {
                return;
            }

            fetch('/process_bulk_approval/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({
                    selected_approvals: selectedApprovals
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotificationToast('Success', data.message, 'success');
                    closeBulkApprovalModal();
                    // Refresh the page or update the UI as needed
                    setTimeout(() => location.reload(), 2000);
                } else {
                    showNotificationToast('Error', data.error || 'Failed to process approval', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotificationToast('Error', 'Failed to process approval', 'error');
            });
        }

        // Notification Toast Functions
        function showNotificationToast(title, message, type) {
            const toast = document.getElementById('notificationToast');
            const toastIcon = document.getElementById('toastIcon');
            const toastTitle = document.getElementById('toastTitle');
            const toastMessage = document.getElementById('toastMessage');

            // Set icon based on type
            let iconClass = '';
            let iconColor = '';
            switch(type) {
                case 'success':
                    iconClass = 'fas fa-check-circle';
                    iconColor = 'text-green-500';
                    break;
                case 'error':
                    iconClass = 'fas fa-exclamation-circle';
                    iconColor = 'text-red-500';
                    break;
                case 'warning':
                    iconClass = 'fas fa-exclamation-triangle';
                    iconColor = 'text-yellow-500';
                    break;
                default:
                    iconClass = 'fas fa-info-circle';
                    iconColor = 'text-blue-500';
            }

            toastIcon.innerHTML = `<i class="${iconClass} ${iconColor}"></i>`;
            toastTitle.textContent = title;
            toastMessage.textContent = message;

            toast.classList.remove('hidden');
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                hideNotificationToast();
            }, 5000);
        }

        function hideNotificationToast() {
            document.getElementById('notificationToast').classList.add('hidden');
        }

        // Helper function to get CSRF token
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script>

    <!-- File Selection Modal -->
    <div id="fileSelectionModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">Select Excel File for OCR Processing</h3>
                        <button onclick="closeFileSelectionModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Choose File</label>
                            <input type="file" id="ocrFileInput" accept=".xlsx,.xls" 
                                   class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                        </div>
                        
                        <div class="border-t pt-4">
                            <p class="text-sm text-gray-600 mb-2">Or process the default file:</p>
                            <button onclick="processDefault2024File(); closeFileSelectionModal();" 
                                    class="w-full bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700">
                                <i class="fas fa-file-excel mr-2"></i>Process 2024.xlsx
                            </button>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3 mt-6">
                        <button onclick="closeFileSelectionModal()" 
                                class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                            Cancel
                        </button>
                        <button onclick="processSelectedFile()" 
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            Process File
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Text Display Modal -->
    <div id="textDisplayModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">Extracted Excel Data</h3>
                        <button onclick="closeTextDisplayModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div id="extractedTextContent" class="max-h-96 overflow-y-auto border border-gray-200 p-4 rounded-lg mb-4">
                        <!-- Content will be populated by JavaScript -->
                    </div>
                    
                    <div class="flex justify-end space-x-3">
                        <button onclick="closeTextDisplayModal()" 
                                class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                            Cancel
                        </button>
                        <button onclick="saveExtractedData()" 
                                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                            <i class="fas fa-save mr-2"></i>Save Data
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Review Modal -->
    <div id="bulkReviewModal" class="modal">
        <div class="modal-content" style="max-width: 1200px; width: 95%; max-height: 90vh; overflow-y: auto;">
            <button class="modal-close-btn" onclick="closeBulkReviewModal()">&times;</button>
            <h3 class="text-2xl font-bold text-purple-600 mb-6 text-center">Bulk Review Applications</h3>
            
            <!-- Review Statistics -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                    <div class="text-center">
                        <p class="text-sm text-blue-600 font-medium">Total Applications</p>
                        <p class="text-2xl font-bold text-blue-800" id="totalApplicationsCount">0</p>
                    </div>
                </div>
                <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                    <div class="text-center">
                        <p class="text-sm text-green-600 font-medium">Ready for Approval</p>
                        <p class="text-2xl font-bold text-green-800" id="readyForApprovalCount">0</p>
                    </div>
                </div>
                <div class="bg-orange-50 p-4 rounded-lg border border-orange-200">
                    <div class="text-center">
                        <p class="text-sm text-orange-600 font-medium">Pending Review</p>
                        <p class="text-2xl font-bold text-orange-800" id="pendingReviewCount">0</p>
                    </div>
                </div>
            </div>

            <!-- Program Applications Section -->
            <div class="mb-8">
                <div class="flex items-center justify-between mb-4">
                    <h4 class="text-lg font-semibold text-gray-800">Program Applications</h4>
                    <label class="flex items-center">
                        <input type="checkbox" id="selectAllProgram" class="mr-2" onchange="toggleSelectAllProgram()">
                        <span class="text-sm text-gray-600">Select All</span>
                    </label>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse border border-gray-300">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="border border-gray-300 px-4 py-2 text-left">Select</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">Applicant</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">Program</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">Applied Date</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">Status</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">Documents</th>
                            </tr>
                        </thead>
                        <tbody id="programApplicationsTable">
                            <!-- Content will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Walk-in Applications Section -->
            <div class="mb-8">
                <div class="flex items-center justify-between mb-4">
                    <h4 class="text-lg font-semibold text-gray-800">Walk-in Applications</h4>
                    <label class="flex items-center">
                        <input type="checkbox" id="selectAllWalkin" class="mr-2" onchange="toggleSelectAllWalkin()">
                        <span class="text-sm text-gray-600">Select All</span>
                    </label>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse border border-gray-300">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="border border-gray-300 px-4 py-2 text-left">Select</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">Applicant</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">Program</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">Applied Date</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">Status</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">Documents</th>
                            </tr>
                        </thead>
                        <tbody id="walkinApplicationsTable">
                            <!-- Content will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex justify-end space-x-3 mt-6">
                <button onclick="closeBulkReviewModal()" 
                        class="px-6 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                    Cancel
                </button>
                <button onclick="processBulkReview()" 
                        class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                    <i class="fas fa-search mr-2"></i>Review Selected
                </button>
            </div>
        </div>
    </div>

    <!-- Bulk Approval Modal -->
    <div id="bulkApprovalModal" class="modal">
        <div class="modal-content" style="max-width: 1000px; width: 95%; max-height: 90vh; overflow-y: auto;">
            <button class="modal-close-btn" onclick="closeBulkApprovalModal()">&times;</button>
            <h3 class="text-2xl font-bold text-orange-600 mb-6 text-center">Bulk Approval Applications</h3>
            
            <!-- Approval Statistics -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                    <div class="text-center">
                        <p class="text-sm text-green-600 font-medium">Ready for Approval</p>
                        <p class="text-2xl font-bold text-green-800" id="approvalReadyCount">0</p>
                    </div>
                </div>
                <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                    <div class="text-center">
                        <p class="text-sm text-blue-600 font-medium">Selected for Approval</p>
                        <p class="text-2xl font-bold text-blue-800" id="selectedForApprovalCount">0</p>
                    </div>
                </div>
            </div>

            <!-- Applications Ready for Approval -->
            <div class="mb-8">
                <div class="flex items-center justify-between mb-4">
                    <h4 class="text-lg font-semibold text-gray-800">Applications Ready for Approval</h4>
                    <label class="flex items-center">
                        <input type="checkbox" id="selectAllApproval" class="mr-2" onchange="toggleSelectAllApproval()">
                        <span class="text-sm text-gray-600">Select All</span>
                    </label>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse border border-gray-300">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="border border-gray-300 px-4 py-2 text-left">Select</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">Applicant</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">Program</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">Application Type</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">Review Date</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">Status</th>
                            </tr>
                        </thead>
                        <tbody id="approvalApplicationsTable">
                            <!-- Content will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex justify-end space-x-3 mt-6">
                <button onclick="closeBulkApprovalModal()" 
                        class="px-6 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                    Cancel
                </button>
                <button onclick="processBulkApproval()" 
                        class="px-6 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700">
                    <i class="fas fa-check-double mr-2"></i>Approve Selected
                </button>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="notificationToast" class="fixed top-4 right-4 z-50 hidden">
        <div class="bg-white border border-gray-200 rounded-lg shadow-lg p-4 max-w-sm">
            <div class="flex items-center">
                <div id="toastIcon" class="flex-shrink-0 mr-3">
                    <!-- Icon will be set by JavaScript -->
                </div>
                <div class="flex-1">
                    <p id="toastTitle" class="text-sm font-medium text-gray-900"></p>
                    <p id="toastMessage" class="text-sm text-gray-500"></p>
                </div>
                <button onclick="hideNotificationToast()" class="ml-3 text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Bulk Download Modal -->
    <div id="bulkDownloadModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-6xl shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <!-- Modal Header -->
                <div class="flex justify-between items-center pb-4 border-b">
                    <h3 class="text-2xl font-bold text-gray-900">Bulk Download - Learner Profiles</h3>
                    <button onclick="closeBulkDownloadModal()" class="text-gray-400 hover:text-gray-600 text-2xl font-bold">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <!-- Filters Section -->
                <div class="mt-6 bg-gray-50 p-4 rounded-lg">
                    <h4 class="text-lg font-semibold mb-4 text-gray-800">
                        <i class="fas fa-filter mr-2"></i>Filter Options
                    </h4>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <!-- ID Filter -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Filter by ID</label>
                            <input type="text" id="filterById" placeholder="Enter ID..." 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>

                        <!-- Profile Filter -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Filter by Profile</label>
                            <select id="filterByProfile" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">All Profiles</option>
                                <option value="completed">Completed</option>
                                <option value="in-progress">In Progress</option>
                                <option value="pending">Pending</option>
                            </select>
                        </div>

                        <!-- Year Filter -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Filter by Year</label>
                            <select id="filterByYear" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">All Years</option>
                                <option value="2024">2024</option>
                                <option value="2023">2023</option>
                                <option value="2022">2022</option>
                                <option value="2021">2021</option>
                            </select>
                        </div>

                        <!-- Batch Filter -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Filter by Batch</label>
                            <div class="space-y-2">
                                <select id="filterByBatch" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">All Batches</option>
                                    <option value="batch1">Batch 1</option>
                                    <option value="batch2">Batch 2</option>
                                    <option value="batch3">Batch 3</option>
                                    <option value="batch4">Batch 4</option>
                                </select>
                                <div class="flex items-center space-x-2">
                                    <input type="checkbox" id="downloadOverall" class="rounded">
                                    <label for="downloadOverall" class="text-sm text-gray-600">Download Overall</label>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <input type="checkbox" id="downloadSpecificYear" class="rounded">
                                    <label for="downloadSpecificYear" class="text-sm text-gray-600">Download Specific Year</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Filter Actions -->
                    <div class="mt-4 flex space-x-3">
                        <button onclick="applyFilters()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                            <i class="fas fa-search mr-2"></i>Apply Filters
                        </button>
                        <button onclick="clearFilters()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">
                            <i class="fas fa-times mr-2"></i>Clear Filters
                        </button>
                    </div>
                </div>

                <!-- Results Table -->
                <div class="mt-6">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="text-lg font-semibold text-gray-800">
                            <i class="fas fa-table mr-2"></i>Learner Profiles
                        </h4>
                        <div class="flex items-center space-x-2">
                            <span id="recordCount" class="text-sm text-gray-600">0 records found</span>
                            <button onclick="selectAllRecords()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1 rounded text-sm">
                                Select All
                            </button>
                            <button onclick="deselectAllRecords()" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm">
                                Deselect All
                            </button>
                        </div>
                    </div>

                    <!-- Table Container with Scroll -->
                    <div class="overflow-x-auto max-h-96 border rounded-lg">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50 sticky top-0">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        <input type="checkbox" id="selectAllCheckbox" onchange="toggleSelectAll()">
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        ID
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Full Name
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Programs Completed
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Year Completed
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Batch
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Status
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="learnerProfilesTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Table rows will be populated by JavaScript -->
                                <tr>
                                    <td colspan="7" class="px-6 py-4 text-center text-gray-500">
                                        <i class="fas fa-spinner fa-spin mr-2"></i>Loading data...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="mt-6 flex justify-between items-center pt-4 border-t">
                    <div class="text-sm text-gray-600">
                        <span id="selectedCount">0</span> of <span id="totalCount">0</span> records selected
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="closeBulkDownloadModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg">
                            <i class="fas fa-times mr-2"></i>Cancel
                        </button>
                        <button onclick="downloadSelectedProfiles()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg">
                            <i class="fas fa-download mr-2"></i>Download All Selected
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

                    </div>
                </div>
            </div>
        </div>

        <!-- Document Details Form -->
        <div id="documentDetailsForm" class="hidden">
            <!-- Common Fields -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Document Title</label>
                    <input type="text" name="title" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Version</label>
                    <input type="text" name="version" value="1.0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
            </div>

            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                <textarea name="description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
            </div>

            <!-- Applicant Profile Specific Fields -->
            <div id="applicantProfileFields" class="hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Select Applicant</label>
                        <select name="applicant_id" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">Select an applicant...</option>
                            {% for applicant in applicants %}
                            <option value="{{ applicant.applicant.id }}">{{ applicant.applicant.get_full_name|default:applicant.applicant.username }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>

            <!-- Manual/Policy Specific Fields -->
            <div id="manualPolicyFields" class="hidden">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Program</label>
                        <select name="program_id" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">All Programs</option>
                            {% for program in programs %}
                            <option value="{{ program.id }}">{{ program.program_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Batch</label>
                        <select name="batch" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">All Batches</option>
                            <option value="batch_1">Batch 1</option>
                            <option value="batch_2">Batch 2</option>
                            <option value="batch_3">Batch 3</option>
                            <option value="batch_4">Batch 4</option>
                            <option value="batch_5">Batch 5</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Semester</label>
                        <select name="semester" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">All Semesters</option>
                            <option value="semester_1">Semester 1</option>
                            <option value="semester_2">Semester 2</option>
                            <option value="semester_3">Semester 3</option>
                        </select>
                    </div>
                </div>

                <!-- Category Selection for Manual/Policy -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                    <select name="category_id" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">Select a category...</option>
                        <!-- Categories will be populated via JavaScript based on document type -->
                    </select>
                </div>

                <!-- Policy Specific Fields -->
                <div id="policySpecificFields" class="hidden">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Effective Date</label>
                            <input type="date" name="effective_date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-3">Document Type</label>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="border-2 border-gray-200 rounded-lg p-4 cursor-pointer hover:border-blue-500 transition-colors" onclick="selectDocumentType('applicant_profile')">
                                    <input type="radio" name="document_type" value="applicant_profile" id="type_applicant" class="hidden">
                                    <div class="text-center">
                                        <i class="fas fa-user-circle text-3xl text-blue-500 mb-2"></i>
                                        <h4 class="font-medium text-gray-900">Applicant Profile</h4>
                                        <p class="text-sm text-gray-500">Learner profile documents</p>
                                    </div>
                                </div>
                                <div class="border-2 border-gray-200 rounded-lg p-4 cursor-pointer hover:border-green-500 transition-colors" onclick="selectDocumentType('manual')">
                                    <input type="radio" name="document_type" value="manual" id="type_manual" class="hidden">
                                    <div class="text-center">
                                        <i class="fas fa-book text-3xl text-green-500 mb-2"></i>
                                        <h4 class="font-medium text-gray-900">Manuals</h4>
                                        <p class="text-sm text-gray-500">Training manuals and guides</p>
                                    </div>
                                </div>
                                <div class="border-2 border-gray-200 rounded-lg p-4 cursor-pointer hover:border-purple-500 transition-colors" onclick="selectDocumentType('policy')">
                                    <input type="radio" name="document_type" value="policy" id="type_policy" class="hidden">
                                    <div class="text-center">
                                        <i class="fas fa-file-contract text-3xl text-purple-500 mb-2"></i>
                                        <h4 class="font-medium text-gray-900">Policy</h4>
                                        <p class="text-sm text-gray-500">Policies and procedures</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Document Details Form -->
                        <div id="documentDetailsForm" class="hidden">
                            <!-- Common Fields -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Document Title</label>
                                    <input type="text" name="title" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Version</label>
                                    <input type="text" name="version" value="1.0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                            </div>

                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                                <textarea name="description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                            </div>

                            <!-- Applicant Profile Specific Fields -->
                            <div id="applicantProfileFields" class="hidden">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Select Applicant</label>
                                        <select name="applicant_id" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                            <option value="">Select an applicant...</option>
                                            {% for applicant in applicants %}
                                            <option value="{{ applicant.applicant.id }}">{{ applicant.applicant.get_full_name|default:applicant.applicant.username }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Manual/Policy Specific Fields -->
                            <div id="manualPolicyFields" class="hidden">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Program</label>
                                        <select name="program_id" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                            <option value="">All Programs</option>
                                            {% for program in programs %}
                                            <option value="{{ program.id }}">{{ program.program_name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Batch</label>
                                        <select name="batch" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                            <option value="">All Batches</option>
                                            <option value="batch_1">Batch 1</option>
                                            <option value="batch_2">Batch 2</option>
                                            <option value="batch_3">Batch 3</option>
                                            <option value="batch_4">Batch 4</option>
                                            <option value="batch_5">Batch 5</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Semester</label>
                                        <select name="semester" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                            <option value="">All Semesters</option>
                                            <option value="semester_1">Semester 1</option>
                                            <option value="semester_2">Semester 2</option>
                                            <option value="semester_3">Semester 3</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Category Selection for Manual/Policy -->
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                                    <select name="category_id" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        <option value="">Select a category...</option>
                                        <!-- Categories will be populated via JavaScript based on document type -->
                                    </select>
                                </div>

                                <!-- Policy Specific Fields -->
                                <div id="policySpecificFields" class="hidden">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Effective Date</label>
                                            <input type="date" name="effective_date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Expiry Date</label>
                                            <input type="date" name="expiry_date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- File Upload -->
                            <div class="mb-6">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Upload File</label>
                                <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors">
                                    <input type="file" name="document_file" id="documentFile" class="hidden" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" onchange="handleFileSelect(this)">
                                    <div id="fileUploadArea" onclick="document.getElementById('documentFile').click()" class="cursor-pointer">
                                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                                        <p class="text-gray-500 mb-2">Click to upload or drag and drop</p>
                                        <p class="text-sm text-gray-400">PDF, DOC, DOCX, JPG, PNG (Max 10MB)</p>
                                    </div>
                                    <div id="filePreview" class="hidden mt-4">
                                        <div class="flex items-center justify-center space-x-2">
                                            <i class="fas fa-file text-blue-500"></i>
                                            <span id="fileName" class="text-sm text-gray-700"></span>
                                            <button type="button" onclick="removeFile()" class="text-red-500 hover:text-red-700">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Modal Footer -->
                <div class="mt-6 flex justify-between items-center pt-4 border-t">
                    <div class="text-sm text-gray-600">
                        <i class="fas fa-info-circle mr-1"></i>
                        Select document type to continue
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="closeUploadDocumentModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg">
                            <i class="fas fa-times mr-2"></i>Cancel
                        </button>
                        <button onclick="uploadDocument()" id="uploadBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            <i class="fas fa-upload mr-2"></i>Upload Document
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enrollment Management System JavaScript
        let currentDate = new Date();
        let selectedDate = null;
        let selectedEvent = null;
        let currentCategory = 'enrollment';
        let currentBatch = 1;
        let currentTrimester = 1;
        let events = []; // This will store all events
        let editingEventId = null;

        // Load events from database
        function loadEvents() {
            const params = new URLSearchParams({
                category: currentCategory === 'all' ? 'all' : currentCategory,
                batch: currentBatch === 'all' ? 'all' : currentBatch,
                trimester: currentTrimester === 'all' ? 'all' : currentTrimester
            });
            
            fetch(`/api/events/?${params}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Convert string dates to Date objects
                        events = data.events.map(event => ({
                            ...event,
                            startDate: new Date(event.start_date),
                            endDate: event.end_date ? new Date(event.end_date) : null,
                            startTime: event.start_time,
                            endTime: event.end_time
                        }));
                        
                        generateCalendar();
                        updateEventsTable();
                        document.getElementById('eventCount').textContent = events.length;
                    } else {
                        console.error('Error loading events:', data.error);
                        showNotification('Error loading events', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showNotification('Error loading events', 'error');
                });
        }

        // Refresh events list
        function refreshEventsList() {
            loadEvents();
            showNotification('Events list refreshed', 'success');
        }

        // Initialize enrollment management when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadEvents();
            
            // Add event listener for enrollments navigation
            const enrollmentsLink = document.querySelector('[data-content-type="enrollments"]');
            if (enrollmentsLink) {
                enrollmentsLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    showEnrollmentsContent();
                });
            }

            // Initialize sample events
            initializeSampleEvents();
        });

        function showEnrollmentsContent() {
            // Hide all content sections
            const contentSections = document.querySelectorAll('[id$="Content"]');
            contentSections.forEach(section => section.classList.add('hidden'));
            
            // Show enrollments content
            const enrollmentsContent = document.getElementById('enrollmentsContent');
            if (enrollmentsContent) {
                enrollmentsContent.classList.remove('hidden');
                generateCalendar();
                updateEventsTable();
            }
        }

        function initializeSampleEvents() {
            const today = new Date();
            events = [
                {
                    id: 1,
                    title: 'Batch 1 - 1st Semester Start',
                    category: 'enrollment',
                    batch: 1,
                    trimester: 1,
                    startDate: new Date(today.getFullYear(), today.getMonth(), 15),
                    endDate: new Date(today.getFullYear(), today.getMonth(), 15),
                    startTime: '08:00',
                    endTime: '17:00',
                    description: 'First semester orientation and enrollment for Batch 1',
                    status: 'active'
                },
                {
                    id: 2,
                    title: 'Department Meeting',
                    category: 'departmental',
                    startDate: new Date(today.getFullYear(), today.getMonth(), 20),
                    endDate: new Date(today.getFullYear(), today.getMonth(), 20),
                    startTime: '14:00',
                    endTime: '16:00',
                    description: 'Monthly department meeting',
                    status: 'active'
                }
            ];
        }

        function selectCategory(category) {
            currentCategory = category;
            
            // Update button styles
            const enrollmentBtn = document.getElementById('enrollmentCategoryBtn');
            const departmentalBtn = document.getElementById('departmentalCategoryBtn');
            
            if (category === 'enrollment') {
                enrollmentBtn.className = 'px-4 py-2 rounded-lg bg-blue-600 text-white font-medium transition-colors';
                departmentalBtn.className = 'px-4 py-2 rounded-lg bg-gray-200 text-gray-700 font-medium hover:bg-gray-300 transition-colors';
                document.getElementById('enrollmentControls').style.display = 'block';
            } else {
                enrollmentBtn.className = 'px-4 py-2 rounded-lg bg-gray-200 text-gray-700 font-medium hover:bg-gray-300 transition-colors';
                departmentalBtn.className = 'px-4 py-2 rounded-lg bg-blue-600 text-white font-medium transition-colors';
                document.getElementById('enrollmentControls').style.display = 'none';
            }
            
            updateEventsTable();
            generateCalendar();
        }

        function selectBatch(batch) {
            currentBatch = batch;
            
            // Update button styles
            for (let i = 1; i <= 3; i++) {
                const btn = document.getElementById(`batch${i}Btn`);
                if (i === batch) {
                    btn.className = 'batch-btn px-4 py-2 rounded-lg bg-blue-600 text-white font-medium transition-colors';
                } else {
                    btn.className = 'batch-btn px-4 py-2 rounded-lg bg-gray-200 text-gray-700 font-medium hover:bg-gray-300 transition-colors';
                }
            }
            
            updateEventsTable();
            generateCalendar();
        }

        function selectTrimester(trimester) {
            currentTrimester = trimester;
            
            // Update button styles
            for (let i = 1; i <= 3; i++) {
                const btn = document.getElementById(`trimester${i}Btn`);
                if (i === trimester) {
                    btn.className = 'trimester-btn px-4 py-2 rounded-lg bg-green-600 text-white font-medium transition-colors';
                } else {
                    btn.className = 'trimester-btn px-4 py-2 rounded-lg bg-gray-200 text-gray-700 font-medium hover:bg-gray-300 transition-colors';
                }
            }
            
            updateEventsTable();
            generateCalendar();
        }

        function generateCalendar() {
            const calendarContainer = document.getElementById('enrollmentCalendar');
            if (!calendarContainer) return;

            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            let calendarHTML = `
                <div class="calendar-header">
                    <button class="calendar-nav-btn" onclick="previousMonth()">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <h3 class="text-lg font-semibold">${monthNames[month]} ${year}</h3>
                    <button class="calendar-nav-btn" onclick="nextMonth()">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <div class="calendar-grid">
                    <div class="calendar-day-header">Sun</div>
                    <div class="calendar-day-header">Mon</div>
                    <div class="calendar-day-header">Tue</div>
                    <div class="calendar-day-header">Wed</div>
                    <div class="calendar-day-header">Thu</div>
                    <div class="calendar-day-header">Fri</div>
                    <div class="calendar-day-header">Sat</div>
            `;
            
            const today = new Date();
            const currentDay = startDate;
            
            for (let week = 0; week < 6; week++) {
                for (let day = 0; day < 7; day++) {
                    const dayEvents = getEventsForDate(currentDay);
                    const isToday = currentDay.toDateString() === today.toDateString();
                    const isCurrentMonth = currentDay.getMonth() === month;
                    const isSelected = selectedDate && currentDay.toDateString() === selectedDate.toDateString();
                    
                    let dayClass = 'calendar-day';
                    if (!isCurrentMonth) dayClass += ' other-month';
                    if (isToday) dayClass += ' today';
                    if (isSelected) dayClass += ' selected';
                    
                    calendarHTML += `
                        <div class="${dayClass}" onclick="selectCalendarDate('${currentDay.toISOString()}')">
                            <div class="calendar-day-number">${currentDay.getDate()}</div>
                    `;
                    
                    dayEvents.forEach(event => {
                        calendarHTML += `
                            <div class="calendar-event ${event.category}" onclick="selectEventFromCalendar(${event.id}, event)">
                                ${event.title}
                            </div>
                        `;
                    });
                    
                    calendarHTML += '</div>';
                    currentDay.setDate(currentDay.getDate() + 1);
                }
            }
            
            calendarHTML += '</div>';
            calendarContainer.innerHTML = calendarHTML;
        }

        function getEventsForDate(date) {
            return events.filter(event => {
                const eventDate = new Date(event.startDate);
                return eventDate.toDateString() === date.toDateString() &&
                       (currentCategory === 'all' || event.category === currentCategory) &&
                       (event.category !== 'enrollment' || 
                        (event.batch === currentBatch && event.trimester === currentTrimester));
            });
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            generateCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            generateCalendar();
        }

        function selectCalendarDate(dateString) {
            selectedDate = new Date(dateString);
            generateCalendar();
        }

        function selectEventFromCalendar(eventId, e) {
            e.stopPropagation();
            selectedEvent = events.find(event => event.id === eventId);
            updateSelectedEventInfo();
            highlightEventInTable(eventId);
        }

        function updateSelectedEventInfo() {
            const infoContainer = document.getElementById('selectedEventInfo');
            if (!selectedEvent) {
                infoContainer.innerHTML = '<p class="text-gray-600 text-sm">Select an event from the calendar or table to manage it</p>';
                return;
            }
            
            const startDate = new Date(selectedEvent.startDate).toLocaleDateString();
            const endDate = new Date(selectedEvent.endDate).toLocaleDateString();
            
            infoContainer.innerHTML = `
                <div class="space-y-2">
                    <h5 class="font-semibold text-gray-800">${selectedEvent.title}</h5>
                    <p class="text-sm text-gray-600"><strong>Category:</strong> ${selectedEvent.category}</p>
                    <p class="text-sm text-gray-600"><strong>Date:</strong> ${startDate} - ${endDate}</p>
                    ${selectedEvent.batch ? `<p class="text-sm text-gray-600"><strong>Batch:</strong> ${selectedEvent.batch}</p>` : ''}
                    ${selectedEvent.trimester ? `<p class="text-sm text-gray-600"><strong>Trimester:</strong> ${selectedEvent.trimester}</p>` : ''}
                    <p class="text-sm text-gray-600"><strong>Description:</strong> ${selectedEvent.description || 'No description'}</p>
                </div>
            `;
        }

        function updateEventsTable() {
            const tableBody = document.getElementById('eventsTableBody');
            if (!tableBody) return;
            
            const filteredEvents = events.filter(event => {
                if (currentCategory === 'all') return true;
                if (event.category !== currentCategory) return false;
                if (event.category === 'enrollment') {
                    return event.batch === currentBatch && event.trimester === currentTrimester;
                }
                return true;
            });
            
            if (filteredEvents.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="8" class="px-6 py-8 text-center text-gray-500">
                            <i class="fas fa-calendar-times text-4xl mb-2 text-gray-300"></i>
                            <p class="text-lg">No events found</p>
                            <p class="text-sm">Create a new event to get started</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tableBody.innerHTML = filteredEvents.map(event => {
                const startDate = new Date(event.startDate).toLocaleDateString();
                const endDate = new Date(event.endDate).toLocaleDateString();
                const batchTrimester = event.category === 'enrollment' ? 
                    `Batch ${event.batch} - ${event.trimester}${getOrdinalSuffix(event.trimester)} Sem` : 'N/A';
                
                return `
                    <tr class="hover:bg-gray-50" data-event-id="${event.id}">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <input type="checkbox" class="event-checkbox" value="${event.id}">
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap font-medium text-gray-900">${event.title}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${event.category === 'enrollment' ? 'bg-green-100 text-green-800' : 'bg-purple-100 text-purple-800'}">
                                ${event.category}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${startDate}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${endDate}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${batchTrimester}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${event.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">
                                ${event.status}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button onclick="selectEventFromTable(${event.id})" class="text-blue-600 hover:text-blue-900 mr-2">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button onclick="editEvent(${event.id})" class="text-yellow-600 hover:text-yellow-900 mr-2">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteEvent(${event.id})" class="text-red-600 hover:text-red-900">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function getOrdinalSuffix(num) {
            const suffixes = ['st', 'nd', 'rd'];
            return suffixes[num - 1] || 'th';
        }

        function selectEventFromTable(eventId) {
            selectedEvent = events.find(event => event.id === eventId);
            updateSelectedEventInfo();
            highlightEventInTable(eventId);
        }

        function highlightEventInTable(eventId) {
            // Remove previous highlights
            document.querySelectorAll('tr[data-event-id]').forEach(row => {
                row.classList.remove('bg-blue-50');
            });
            
            // Highlight selected row
            const row = document.querySelector(`tr[data-event-id="${eventId}"]`);
            if (row) {
                row.classList.add('bg-blue-50');
            }
        }

        function showNewEventModal() {
            editingEventId = null;
            document.getElementById('eventModalTitle').textContent = 'Create New Event';
            document.getElementById('eventForm').reset();
            document.getElementById('eventModal').classList.add('active');
            
            // Set default category
            document.getElementById('eventCategory').value = currentCategory;
            toggleEnrollmentFields();
            
            if (currentCategory === 'enrollment') {
                document.getElementById('eventBatch').value = currentBatch;
                document.getElementById('eventTrimester').value = currentTrimester;
            }
        }

        function editEvent(eventId) {
            const event = events.find(e => e.id === eventId);
            if (!event) return;
            
            editingEventId = eventId;
            document.getElementById('eventModalTitle').textContent = 'Edit Event';
            
            // Populate form
            document.getElementById('eventTitle').value = event.title;
            document.getElementById('eventCategory').value = event.category;
            document.getElementById('eventStartDate').value = event.startDate.toISOString().split('T')[0];
            document.getElementById('eventEndDate').value = event.endDate.toISOString().split('T')[0];
            document.getElementById('eventStartTime').value = event.startTime || '';
            document.getElementById('eventEndTime').value = event.endTime || '';
            document.getElementById('eventDescription').value = event.description || '';
            
            if (event.category === 'enrollment') {
                document.getElementById('eventBatch').value = event.batch;
                document.getElementById('eventTrimester').value = event.trimester;
            }
            
            toggleEnrollmentFields();
            document.getElementById('eventModal').classList.add('active');
        }

        function closeEventModal() {
            document.getElementById('eventModal').classList.remove('active');
            editingEventId = null;
        }

        function toggleEnrollmentFields() {
            const category = document.getElementById('eventCategory').value;
            const enrollmentFields = document.getElementById('enrollmentFields');
            
            if (category === 'enrollment') {
                enrollmentFields.classList.remove('hidden');
            } else {
                enrollmentFields.classList.add('hidden');
            }
        }

        // Event form submission
        document.getElementById('eventForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                title: document.getElementById('eventTitle').value,
                category: document.getElementById('eventCategory').value,
                start_date: document.getElementById('eventStartDate').value,
                end_date: document.getElementById('eventEndDate').value,
                start_time: document.getElementById('eventStartTime').value,
                end_time: document.getElementById('eventEndTime').value,
                description: document.getElementById('eventDescription').value,
                status: 'active'
            };
            
            if (formData.category === 'enrollment') {
                formData.batch = document.getElementById('eventBatch').value;
                formData.trimester = document.getElementById('eventTrimester').value;
            }
            
            // Get CSRF token
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
            
            if (editingEventId) {
                // Update existing event
                fetch(`/api/events/update/${editingEventId}/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrfToken
                    },
                    body: JSON.stringify(formData)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showNotification('Event updated successfully!', 'success');
                        closeEventModal();
                        loadEvents();
                    } else {
                        showNotification('Error updating event: ' + data.error, 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showNotification('Error updating event', 'error');
                });
            } else {
                // Create new event
                fetch('/api/events/create/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrfToken
                    },
                    body: JSON.stringify(formData)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showNotification('Event created successfully!', 'success');
                        closeEventModal();
                        loadEvents();
                    } else {
                        showNotification('Error creating event: ' + data.error, 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showNotification('Error creating event', 'error');
                });
            }
        });

        function editSelectedEvent() {
            if (!selectedEvent) {
                showNotification('Please select an event first', 'warning');
                return;
            }
            editEvent(selectedEvent.id);
        }

        function archiveSelectedEvent() {
            if (!selectedEvent) {
                showNotification('Please select an event first', 'warning');
                return;
            }
            
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
            
            fetch(`/api/events/archive/${selectedEvent.id}/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('Event archived successfully!', 'success');
                    selectedEvent = null;
                    updateSelectedEventInfo();
                    loadEvents();
                } else {
                    showNotification('Error archiving event: ' + data.error, 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Error archiving event', 'error');
            });
        }

        function removeSelectedEvent() {
            if (!selectedEvent) {
                showNotification('Please select an event first', 'warning');
                return;
            }
            
            if (confirm('Are you sure you want to delete this event? This action cannot be undone.')) {
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                
                fetch(`/api/events/delete/${selectedEvent.id}/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrfToken
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showNotification('Event deleted successfully!', 'success');
                        selectedEvent = null;
                        updateSelectedEventInfo();
                        loadEvents();
                    } else {
                        showNotification('Error deleting event: ' + data.error, 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showNotification('Error deleting event', 'error');
                });
            }
        }

        function deleteEvent(eventId) {
            if (confirm('Are you sure you want to delete this event? This action cannot be undone.')) {
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                
                fetch(`/api/events/delete/${eventId}/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrfToken
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showNotification('Event deleted successfully!', 'success');
                        if (selectedEvent && selectedEvent.id === eventId) {
                            selectedEvent = null;
                            updateSelectedEventInfo();
                        }
                        loadEvents();
                    } else {
                        showNotification('Error deleting event: ' + data.error, 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showNotification('Error deleting event', 'error');
                });
            }
        }

        function toggleAllEvents() {
            const selectAll = document.getElementById('selectAllEvents');
            const checkboxes = document.querySelectorAll('.event-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
            });
        }

        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-300 transform translate-x-full`;
            
            const bgColor = type === 'success' ? 'bg-green-500' : 
                           type === 'warning' ? 'bg-yellow-500' : 
                           type === 'error' ? 'bg-red-500' : 'bg-blue-500';
            
            notification.className += ` ${bgColor} text-white`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${type === 'success' ? 'check' : type === 'warning' ? 'exclamation-triangle' : type === 'error' ? 'times' : 'info'} mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
    </script>

</body>
</html>