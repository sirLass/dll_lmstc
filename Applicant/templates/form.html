<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TESDA Learner's Profile Form</title>
    {% load static %}
    <script>
        // Define the path to ph.json using Django's static file handling
        const phJsonPath = "{% static 'data/ph.json' %}";
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 2rem 1rem;
        }
        .form-container {
            background-color: #ffffff;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* shadow-xl */
            padding: 2.5rem; /* p-10 */
            max-width: 1000px;
            width: 100%;
            border: 1px solid #e2e8f0; /* border border-gray-200 */
        }
        .form-section-title {
            font-size: 1.25rem; /* text-xl */
            font-weight: 600; /* font-semibold */
            margin-bottom: 1.5rem; /* mb-6 */
            color: #1a202c; /* text-gray-900 */
            border-bottom: 2px solid #e2e8f0; /* border-b-2 border-gray-200 */
            padding-bottom: 0.5rem; /* pb-2 */
        }
        .form-label {
            display: block;
            font-size: 0.875rem; /* text-sm */
            font-weight: 500; /* font-medium */
            color: #4a5568; /* text-gray-700 */
            margin-bottom: 0.5rem; /* mb-2 */
        }
        .form-input, .form-select, .form-textarea {
            display: block;
            width: 100%;
            padding: 0.75rem 1rem; /* px-4 py-3 */
            font-size: 1rem; /* text-base */
            line-height: 1.5;
            color: #4a5568; /* text-gray-700 */
            background-color: #ffffff;
            border: 1px solid #cbd5e0; /* border border-gray-400 */
            border-radius: 0.5rem; /* rounded-lg */
            appearance: none;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            border-color: #6366f1; /* focus:border-indigo-500 */
            outline: 0;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.25); /* focus:ring-indigo-500 */
        }
        .form-radio-checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem; /* gap-4 */
        }
        .form-radio-checkbox-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        .form-radio-checkbox-item input[type="radio"],
        .form-radio-checkbox-item input[type="checkbox"] {
            margin-right: 0.5rem; /* mr-2 */
            width: 1.25rem; /* w-5 */
            height: 1.25rem; /* h-5 */
            border-radius: 0.25rem; /* rounded */
            border: 1px solid #cbd5e0; /* border-gray-400 */
            accent-color: #6366f1; /* For colored checkbox/radio */
        }
        .form-radio-checkbox-item label {
            font-size: 0.875rem; /* text-sm */
            color: #4a5568; /* text-gray-700 */
            font-weight: normal;
            margin-bottom: 0;
        }
        .grid-cols-custom-2 {
            grid-template-columns: 1fr 2fr;
        }
        .upload-box {
            position: relative;
            width: 128px; /* w-32 */
            height: 128px; /* h-32 */
            border: 2px dashed #94a3b8; /* border-gray-400 */
            border-radius: 0.5rem; /* rounded-lg */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: #64748b; /* text-gray-500 */
            font-size: 0.875rem; /* text-sm */
            cursor: pointer;
            overflow: hidden; /* To contain the image */
        }
        .upload-box input[type="file"] {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
            z-index: 10; /* Ensure it's clickable */
        }
        .upload-box img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover; /* Cover the box area */
            z-index: 5; /* Below the input */
        }
        .upload-box .text-content {
            position: relative;
            z-index: 15; /* Above the image */
            pointer-events: none; /* Allow click to pass through to input */
        }

        /* Styles for e-signature upload box */
        .e-signature-upload-box {
            position: relative;
            width: 100%; /* Full width of its grid column */
            height: 100px; /* Fixed height for signature area */
            border: 2px dashed #94a3b8;
            border-radius: 0.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: #64748b;
            font-size: 0.875rem;
            cursor: pointer;
            overflow: hidden;
        }
        .e-signature-upload-box input[type="file"] {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
            z-index: 10;
        }
        .e-signature-upload-box img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain; /* Use 'contain' for signatures to prevent stretching */
            z-index: 5;
        }
        .e-signature-upload-box .text-content {
            position: relative;
            z-index: 15;
            pointer-events: none;
        }

        /* Custom style for the signature lines */
        .signature-line {
            border-bottom: 1px solid #94a3b8; /* A thin line */
            width: 250px; /* Shorter fixed width */
            margin-bottom: 0.25rem; /* Small space below the line */
        }

        /* Hidden class for toggling visibility */
        .hidden-field {
            display: none;
        }
        .hidden-page {
            display: none;
        }

        /* Style for the new checkbox label */
        .checkbox-label-with-text {
            display: flex;
            align-items: center;
            font-size: 0.875rem; /* text-sm */
            font-weight: 500; /* font-medium */
            color: #4a5568; /* text-gray-700 */
            margin-bottom: 0.5rem; /* mb-2 */
        }
        .checkbox-label-with-text input[type="checkbox"] {
            margin-right: 0.5rem; /* mr-2 */
            width: 1.25rem; /* w-5 */
            height: 1.25rem; /* h-5 */
            border-radius: 0.25rem; /* rounded */
            border: 1px solid #cbd5e0; /* border-gray-400 */
            accent-color: #6366f1; /* For colored checkbox */
        }


        @media (min-width: 768px) {
            .grid-cols-md-3 {
                grid-template-columns: repeat(3, minmax(0, 1fr));
            }
            .grid-cols-md-4 {
                grid-template-columns: repeat(4, minmax(0, 1fr));
            }
            .grid-cols-md-2 {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }
    </style>
</head>
<body>
    <div id="message-box" class="hidden fixed top-4 left-1/2 -translate-x-1/2 px-4 py-2 rounded-lg shadow-lg z-50">
        <span id="message-text"></span>
        <button onclick="hideMessageBox()" class="ml-4 text-white font-bold">&times;</button>
    </div>

    <form id="learner-profile-form" method="POST" action="{% url 'walkin_registration' %}" enctype="multipart/form-data">
        {% csrf_token %}
    <div class="form-container">
        <div class="relative mb-8 flex flex-col md:flex-row items-center justify-between">
            <div class="text-center md:text-left md:flex-grow">
                <p class="text-lg font-bold text-gray-800">Technical Education and Skills Development Authority</p>
                <p class="text-md text-gray-600">Pangasiwaan sa Edukasyong Teknikal at Pagpapaunlad ng Kasanayan</p>
                <p class="text-sm text-gray-500 mt-2">MIS 03 – 01 (ver. 2020)</p>
                <h1 class="text-2xl font-extrabold text-gray-900 mt-6 mb-4 uppercase tracking-wide">Learners Profile Form</h1>
            </div>
            <div class="mt-4 md:mt-0 md:ml-8 flex-shrink-0">
                <label for="top-id-picture-upload" class="upload-box">
                    <img id="top-id-preview" src="" alt="ID Picture Preview" class="hidden">
                    <input type="file" name="id_picture" id="top-id-picture-upload" accept="image/*" onchange="previewImage(event, 'top-id-preview')">
                    <div class="text-content">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mx-auto mb-2 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v9" />
                        </svg>
                        Upload ID Picture <br>
                        <span class="text-xs">1x1 taken within <br> the last 6 months</span>
                        <span class="mt-1 text-xs">mm/dd/yy</span>
                    </div>
                </label>
            </div>
        </div>

        <div class="form-page" data-page="1">
            <div class="mb-8">
                <h2 class="form-section-title">1. T2MIS Auto Generated</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="uli-number" class="form-label">1.1. Unique Learner Identifier (ULI) Number:</label>
                        <input type="text" id="uli-number" class="form-input" placeholder="ULI-XXXX-XXXX-XXXX" readonly disabled>
                    </div>
                    <div>
                        <label for="entry-date" class="form-label">1.2. Entry Date:</label>
                        <input type="date" id="entry-date" name="entry_date" class="form-input">
                    </div>
                </div>
            </div>

            <div class="mb-8">
                <h2 class="form-section-title">2. Learner/Manpower Profile</h2>
                <div class="mb-6">
                    <label class="form-label">2.1. Name:</label>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <input type="text" id="last-name" name="last_name" class="form-input" placeholder="Last Name" oninput="this.value = this.value.toUpperCase()">
                            <p class="text-xs text-gray-500 mt-1">Last Name</p>
                        </div>
                        <div>
                            <input type="text" id="first-name" name="first_name" class="form-input" placeholder="First Name" oninput="this.value = this.value.toUpperCase()">
                            <p class="text-xs text-gray-500 mt-1">First Name</p>
                        </div>
                        <div>
                            <input type="text" id="middle-name" name="middle_name" class="form-input" placeholder="Middle Name" oninput="this.value = this.value.toUpperCase()">
                            <p class="text-xs text-gray-500 mt-1">Middle Name</p>
                        </div>
                        <div>
                            <input type="text" id="extension-name" class="form-input" placeholder="Extension Name (Jr., Sr.)" oninput="this.value = this.value.toUpperCase()">
                            <p class="text-xs text-gray-500 mt-1">Extension Name (Jr., Sr.)</p>
                        </div>
                    </div>
                </div>

                <div class="mb-6">
                    <label class="form-label">2.2. Complete Permanent Mailing Address:</label>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div>
                            <label for="region" class="form-label">Region</label>
                            <select id="region" name="region"  class="form-select"></select>
                        </div>
                        <div>
                            <label for="province" class="form-label">Province</label>
                            <select id="province" name="province" class="form-select" disabled></select>
                        </div>
                        <div>
                            <label for="district" class="form-label">District</label>
                            <input type="text" id="district" name="district" class="form-input" placeholder="District" oninput="this.value = this.value.toUpperCase()">
                        </div>
                        <div>
                            <label for="municipality" class="form-label">City/Municipality</label>
                            <select id="municipality" name="city"  class="form-select" disabled></select>
                        </div>
                        <div>
                            <label for="barangay" class="form-label">Barangay</label>
                            <select id="barangay" class="form-select" disabled></select>
                        </div>
                        <div>
                            <label for="house-street" class="form-label">House No., Street, Subdivision/Purok</label>
                            <input type="text" id="house-street"  name='street' class="form-input" placeholder="House No., Street, Subdivision/Purok" oninput="this.value = this.value.toUpperCase()">
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                    <div>
                        <label for="email-facebook" class="form-label">Email Address/Facebook Account:</label>
                        <input type="email" name="email" id="email-facebook" class="form-input" placeholder="your.email@example.com / facebook.com/yourprofile" oninput="this.value = this.value.toUpperCase()">
                    </div>
                    <div>
                        <label for="contact-no" class="form-label">Contact No:</label>
                        <input type="text" name="contact_number"  id="contact-no" class="form-input" placeholder="+63 9XX XXX XXXX" oninput="validateContactNo(this)">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                    <div>
                        <input type="text" name="nationality" id="nationality" class="form-input" placeholder="Nationality" oninput="this.value = this.value.toUpperCase()">
                        <p class="text-xs text-gray-500 mt-1">Nationality</p>
                    </div>
                    <div>
                        <label for="skills" class="form-label">Skills:</label>
                        <input type="text" id="skills" class="form-input" placeholder="e.g., Cooking, Driving" oninput="this.value = this.value.toUpperCase()">
                    </div>
                </div>
            </div>
        </div>

        <div class="form-page hidden-page" data-page="2">
            <div class="mb-8">
                <h2 class="form-section-title">3. Personal Information</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div>
                        <label class="form-label">3.1. Sex</label>
                        <div class="form-radio-checkbox-group">
                            <div class="form-radio-checkbox-item">
                                <input type="radio" id="male" name="sex" value="Male">
                                <label for="male">Male</label>
                            </div>
                            <div class="form-radio-checkbox-item">
                                <input type="radio" id="female" name="sex" value="Female">
                                <label for="female">Female</label>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="form-label">3.2. Civil Status</label>
                        <div class="form-radio-checkbox-group">
                            <div class="form-radio-checkbox-item">
                                <input type="radio" name="civil" value="Single" id="single" name="civil-status" value="Single">
                                <label for="single">Single</label>
                            </div>
                            <div class="form-radio-checkbox-item">
                                <input type="radio" id="married" name="civil" value="Maried" value="Married">
                                <label for="married">Married</label>
                            </div>
                            <div class="form-radio-checkbox-item">
                                <input type="radio"  name="civil" value="Widower" id="widowed" name="civil-status" value="Widowed">
                                <label for="widowed">Widowed</label>
                            </div>
                            <div class="form-radio-checkbox-item">
                                <input type="radio"  name="civil" value="Separated" id="separated" name="civil-status" value="Separated">
                                <label for="separated">Separated</label>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="form-label">3.3. Employment Status (before the training)</label>
                        <div class="form-radio-checkbox-group flex-col">
                            <div class="form-radio-checkbox-item">
                                <input type="radio" id="employed" name="employment-status" value="Employed" onchange="toggleEmploymentFields()">
                                <label for="employed">Employed</label>
                            </div>
                            <div id="employed-fields" class="w-full">
                                <label for="monthly-income" class="form-label ml-6 mt-2">Monthly Income:</label>
                                <input type="text" id="monthly-income" class="form-input ml-6" placeholder="Enter Monthly Income" oninput="this.value = this.value.toUpperCase()">
                                <label for="date-hired" class="form-label ml-6 mt-2">Date Hired:</label>
                                <input type="date" id="date-hired" class="form-input ml-6">
                            </div>
                            <div class="form-radio-checkbox-item mt-2">
                                <input type="radio" id="unemployed" name="employment-status" value="Unemployed" onchange="toggleEmploymentFields()">
                                <label for="unemployed">Unemployed</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mb-6">
                    <label class="form-label">3.4. Birthdate</label>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label for="month-birth" class="form-label">Month of Birth</label>
                            <select id="month-birth" class="form-select" onchange="populateDays(); calculateAge()"></select>
                        </div>
                        <div>
                            <label for="day-birth" class="form-label">Day of Birth</label>
                            <select id="day-birth" class="form-select" onchange="calculateAge()"></select>
                        </div>
                        <div>
                            <label for="year-birth" class="form-label">Year of Birth</label>
                            <select id="year-birth" class="form-select" onchange="populateDays(); calculateAge()"></select>
                        </div>
                        <div>
                            <label for="age" class="form-label">Age</label>
                            <input type="text" id="age" class="form-input" placeholder="Age" readonly>
                        </div>
                    </div>
                </div>

                <div class="mb-6">
                    <label class="form-label">3.5. Birthplace</label>
                    <div class="checkbox-label-with-text mb-2">
                        <input type="checkbox" id="same-as-mailing-birthplace">
                        <label for="same-as-mailing-birthplace">Same as Permanent Address</label>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label for="region-birthplace" class="form-label">Region</label>
                            <select id="region-birthplace" class="form-select"></select>
                        </div>
                        <div>
                            <label for="province-birthplace" class="form-label">Province</labeL>
                            <select id="province-birthplace" class="form-select" disabled></select>
                        </div>
                        <div>
                            <label for="municipality-birthplace" class="form-label">City/Municipality</label>
                            <select id="municipality-birthplace" class="form-select" disabled></select>
                        </div>
                    </div>
                </div>

                <div class="mb-6">
                    <label class="form-label">3.7. Parent/Guardian</label>
                    <div class="checkbox-label-with-text mb-2">
                        <input type="checkbox" id="same-as-mailing-parent-address">
                        <label for="same-as-mailing-parent-address">Same as Permanent Address</label>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <input type="text" id="parent-guardian-name" class="form-input" placeholder="Name" oninput="this.value = this.value.toUpperCase()">
                            <p class="text-xs text-gray-500 mt-1">Name</p>
                        </div>
                        <div>
                            <input type="text" id="parent-guardian-address" class="form-input" placeholder="Complete Permanent Mailing Address" oninput="this.value = this.value.toUpperCase()">
                            <p class="text-xs text-gray-500 mt-1">Complete Permanent Mailing Address</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="form-page hidden-page" data-page="3">
            <div class="mb-8">
                <h2 class="form-section-title">4. Learner/Trainee/Student (Clients) Classification:</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2">
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="4ps-beneficiary" name="client-classification" value="4Ps Beneficiary">
                        <label for="4ps-beneficiary">4Ps Beneficiary</label>
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="agrarian-reform" name="client-classification" value="Agrarian Reform Beneficiary">
                        <label for="agrarian-reform">Agrarian Reform Beneficiary</label>
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="balik-probinsya" name="client-classification" value="Balik Probinsya">
                        <label for="balik-probinsya">Balik Probinsya</label>
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="displaced-workers" name="client-classification" value="Displaced Workers">
                        <label for="displaced-workers">Displaced Workers</label>
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="drug-dependents" name="client-classification" value="Drug Dependents Surrenderees/Surrenderers">
                        <label for="drug-dependents">Drug Dependents Surrenderees/Surrenderers</label>
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="afp-pnp-kia" name="client-classification" value="Family Members of AFP and PNP Killed-in-Action">
                        <label for="afp-pnp-kia">Family Members of AFP and PNP Killed-in-Action</label>
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="afp-pnp-wia" name="client-classification" value="Family Members of AFP and PNP Wounded in-Action">
                        <label for="afp-pnp-wia">Family Members of AFP and PNP Wounded in-Action</label>
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="farmers-fishermen" name="client-classification" value="Farmers and Fishermen">
                        <label for="farmers-fishermen">Farmers and Fishermen</label>
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="indigenous-people" name="client-classification" value="Indigenous People & Cultural Communities">
                        <label for="indigenous-people">Indigenous People & Cultural Communities</label>
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="industry-workers" name="client-classification" value="Industry Workers">
                        <label for="industry-workers">Industry Workers</label>
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="inmates-detainees" name="client-classification" value="Inmates and Detainees">
                        <label for="inmates-detainees">Inmates and Detainees</label>
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="milf-beneficiary" name="client-classification" value="MILF Beneficiary">
                        <label for="milf-beneficiary">MILF Beneficiary</label>
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="out-of-school-youth" name="client-classification" value="Out-of-School-Youth">
                        <label for="out-of-school-youth">Out-of-School-Youth</label>
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="ofw-dependents" name="client-classification" value="Overseas Filipino Workers (OFW) Dependents">
                        <label for="ofw-dependents">Overseas Filipino Workers (OFW) Dependents</label>
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="rcef-resp" name="client-classification" value="RCEF-RESP">
                        <label for="rcef-resp">RCEF-RESP</label>
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="rebel-returnees" name="client-classification" value="Rebel Returnees/Decommissioned Combatants">
                        <label for="rebel-returnees">Rebel Returnees/Decommissioned Combatants</label>
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="returning-ofw" name="client-classification" value="Returning/Repatriated Overseas Filipino Workers (OFW)">
                        <label for="returning-ofw">Returning/Repatriated Overseas Filipino Workers (OFW)</label>
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="student" name="client-classification" value="Student">
                        <label for="student">Student</label>
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="tesda-alumni" name="client-classification" value="TESDA Alumni">
                        <label for="tesda-alumni">TESDA Alumni</label>
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="tvet-trainers" name="client-classification" value="TVET Trainers">
                        <label for="tvet-trainers">TVET Trainers</label>
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="uniformed-personnel" name="client-classification" value="Uniformed Personnel">
                        <label for="uniformed-personnel">Uniformed Personnel</label>
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="natural-disasters" name="client-classification" value="Victim of Natural Disasters and Calamities">
                        <label for="natural-disasters">Victim of Natural Disasters and Calamities</label>
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="wounded-afp-pnp" name="client-classification" value="Wounded-in-Action AFP & PNP Personnel">
                        <label for="wounded-afp-pnp">Wounded-in-Action AFP & PNP Personnel</label>
                    </div>
                    <div class="form-radio-checkbox-item flex-grow">
                        <input type="checkbox" id="others-classification" name="client-classification" value="Others">
                        <label for="others-classification">Others:</label>
                        <input type="text" id="others-classification-specify" class="form-input ml-2 flex-grow" placeholder="(Please Specify)" oninput="this.value = this.value.toUpperCase()">
                    </div>
                </div>
            </div>

            <div class="mb-8">
                <h2 class="form-section-title">5. Type of Disability (for Persons with Disability Only): <span class="text-sm font-normal text-gray-500">To be filled up by the LMSTC personnel</span></h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2">
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="mental-intellectual" name="disability-type" value="Mental/Intellectual">
                        <label for="mental-intellectual">Mental/Intellectual</label>
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="visual-disability" name="disability-type" value="Visual Disability">
                        <label for="visual-disability">Visual Disability</label>
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="orthopedic-disability" name="disability-type" value="Orthopedic (Musculoskeletal) Disability">
                        <label for="orthopedic-disability">Orthopedic (Musculoskeletal) Disability</label>
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="hearing-disability" name="disability-type" value="Hearing Disability">
                        <label for="hearing-disability">Hearing Disability</label>
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="speech-impairment" name="disability-type" value="Speech Impairment">
                        <label for="speech-impairment">Speech Impairment</label>
                    </div>
                    <div class="form-radio-checkbox-item flex-grow">
                        <input type="checkbox" id="multiple-disabilities" name="disability-type" value="Multiple Disabilities">
                        <label for="multiple-disabilities">Multiple Disabilities, specify</label>
                        <input type="text" id="multiple-disabilities-specify" class="form-input ml-2 flex-grow" oninput="this.value = this.value.toUpperCase()">
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="psycho-social-disability" name="disability-type" value="Psycho-social Disability">
                        <label for="psycho-social-disability">Psycho-social Disability</label>
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="chronic-illness-disability" name="disability-type" value="Disability Due to Chronic Illness">
                        <label for="chronic-illness-disability">Disability Due to Chronic Illness</label>
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="learning-disability" name="disability-type" value="Learning Disability">
                        <label for="learning-disability">Learning Disability</label>
                    </div>
                </div>
            </div>

            <div class="mb-8">
                <h2 class="form-section-title">6. Causes of Disability (for Persons with Disability Only): <span class="text-sm font-normal text-gray-500">To be filled up by the LMSTC personnel</span></h2>
                <div class="form-radio-checkbox-group">
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="congenital-inborn" name="disability-cause" value="Congenital/Inborn">
                        <label for="congenital-inborn">Congenital/Inborn</label>
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="illness" name="disability-cause" value="Illness">
                        <label for="illness">Illness</label>
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="checkbox" id="injury" name="disability-cause" value="Injury">
                        <label for="injury">Injury</label>
                    </div>
                </div>
            </div>
        </div>

        <div class="form-page hidden-page" data-page="4">
            <div class="mb-8">
                <label for="course-qualification" class="form-label text-lg font-semibold">7. Name of Course/Qualification</label>
                <input type="text" id="course-qualification" class="form-input" placeholder="e.g., Computer Programming NC IV" oninput="this.value = this.value.toUpperCase()">
            </div>

            <div class="mb-8">
                <label for="scholarship-package" class="form-label text-lg font-semibold">8. If Scholar, What Type of Scholarship Package (TWSP, PESFA, STEP, others)?</label>
                <input type="text" id="scholarship-package" class="form-input" placeholder="e.g., TWSP" oninput="this.value = this.value.toUpperCase()">
            </div>

            <div class="mb-8">
                <h2 class="form-section-title">9. Privacy Disclaimer</h2>
                <p class="text-gray-700 mb-4">I hereby allow TESDA to use/post my contact details, name, email, cellphone/landline nos. and other information I provided which may be used for processing of my scholarship application, for employment opportunities and for the survey of TESDA programs.</p>
                <div class="form-radio-checkbox-group">
                    <div class="form-radio-checkbox-item">
                        <input type="radio" id="agree-privacy" name="privacy-disclaimer" value="Agree">
                        <label for="agree-privacy">Agree</label>
                    </div>
                    <div class="form-radio-checkbox-item">
                        <input type="radio" id="disagree-privacy" name="privacy-disclaimer" value="Disagree">
                        <label for="disagree-privacy">Disagree</label>
                    </div>
                </div>
            </div>

            <div class="mb-8">
                <h2 class="form-section-title">10. Applicant’s Signature</h2>
                <p class="text-gray-700 mb-4">This is to certify that the information stated above is true and correct.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-end">
                    <div>
                        <label for="applicant-printed-name" class="form-label">Applicant’s Printed Name:</label>
                        <input type="text" id="applicant-printed-name" class="form-input" placeholder="Enter Printed Name" oninput="this.value = this.value.toUpperCase()">
                    </div>
                    <div>
                        <label for="date-accomplished" class="form-label">Date Accomplished:</label>
                        <input type="date" id="date-accomplished" class="form-input">
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-10">
                <div class="md:col-span-2">
                    <p class="text-gray-700 mb-4 text-left">Noted by:</p>
                    <div class="signature-line"></div>
                    <p class="text-xs text-gray-500 mt-1 uppercase text-left">Registrar/School Administrator</p>
                    <p class="text-xs text-gray-500 uppercase text-left">(Signature Over Printed Name)</p>
                    <div class="signature-line mt-6"></div>
                    <p class="text-xs text-gray-500 mt-1 uppercase text-left">Date Received</p>
                </div>
                <div class="flex flex-col items-center justify-center space-y-6">
                    <div class="flex flex-row gap-4">
                        <label for="voter-id-yellow-card-upload" class="upload-box">
                            <img id="voter-id-yellow-card-preview" src="" alt="Voter's ID or Yellow Card Preview" class="hidden">
                            <input type="file" id="voter-id-yellow-card-upload" accept="image/*" onchange="previewImage(event, 'voter-id-yellow-card-preview')">
                            <div class="text-content">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mx-auto mb-2 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v9" />
                                </svg>
                                Upload Voter's ID <br>
                                or Yellow Card
                            </div>
                        </label>
                        <label for="bottom-id-picture-upload" class="upload-box">
                            <img id="bottom-id-preview" src="" alt="ID Picture Preview" class="hidden">
                            <input type="file" id="bottom-id-picture-upload" accept="image/*" onchange="previewImage(event, 'bottom-id-preview')">
                            <div class="text-content">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mx-auto mb-2 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v9" />
                                </svg>
                                Upload ID Picture <br>
                                mm/dd/yy <br>
                                <span class="text-xs">1x1 picture taken within the last 6 months</span>
                            </div>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <div class="flex justify-between mt-8">
            <button id="prev-button" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50" style="display: none;">Previous</button>
            <button id="next-button" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">Next</button>
            <button id="submit-button" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50" style="display: none;">Submit</button>
        </div>

    </div>
    </form>

    <script>
        let phDataGlobal = null; // Global variable to store the fetched ph.json data
        let currentPage = 1;
        const totalPages = 4; // Define the total number of pages

        /**
         * Displays a message box to the user.
         * @param {string} message The message to display.
         * @param {string} type The type of message ('info' for blue, 'error' for red).
         */
        function showMessageBox(message, type = 'info') {
            const msgBox = document.getElementById('message-box');
            const msgText = document.getElementById('message-text');
            msgText.textContent = message;
            msgBox.className = `fixed top-4 left-1/2 -translate-x-1/2 px-4 py-2 rounded-lg shadow-lg z-50`;
            if (type === 'error') {
                msgBox.classList.add('bg-red-500', 'text-white');
            } else {
                msgBox.classList.add('bg-blue-500', 'text-white');
            }
            msgBox.classList.remove('hidden');
            setTimeout(hideMessageBox, 3000); // Auto-hide after 3 seconds
        }

        /**
         * Hides the message box.
         */
        function hideMessageBox() {
            document.getElementById('message-box').classList.add('hidden');
        }

        /**
         * Fetches the ph.json file once and stores it.
         * This function expects ph.json to be served from a web server.
         * If the file cannot be fetched (e.g., due to local file restrictions or 'blob:' URL origin),
         * the address dropdowns will not populate.
         * To resolve this, ensure your HTML file and 'ph.json' are served from a web server
         * (e.g., using Python's 'http.server', Node.js 'serve', or similar).
         * @returns {Promise<Object>} A promise that resolves with the fetched data.
         */
        async function loadPhData() {
            if (!phDataGlobal) {
                try {
                    // Attempt to fetch ph.json from the same directory as this HTML file.
                    // This will only work if the HTML and JSON files are served from a web server.
                    // If opened directly from the file system (e.g., file:///), this fetch will fail.
                    const response = await fetch(phJsonPath);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    phDataGlobal = await response.json();
                    console.log("ph.json loaded successfully from external file.");
                } catch (error) {
                    console.error("Error fetching ph.json from external file. Address dropdowns will not function without a web server:", error);
                    showMessageBox("Failed to load address data. Please ensure 'ph.json' is accessible via a web server.", 'error');
                    // phDataGlobal remains null if fetch failed, as per your explicit request.
                    // This means the dropdowns will remain empty if the file cannot be loaded.
                }
            }
            return phDataGlobal;
        }

        /**
         * Retrieves specific data from the loaded phDataGlobal object.
         * @param {string} type The type of data to retrieve (e.g., "regions", "provinces").
         * @param {string} [regionCode] Optional region code for provinces.
         * @param {string} [provinceName] Optional province name for municipalities.
         * @param {string} [municipalityName] Optional municipality name for barangays.
         * @returns {Array|Object} The requested data, or an empty array/object if not found.
         */
        function getData(type, regionCode = null, provinceName = null, municipalityName = null) {
            if (!phDataGlobal) {
                console.warn("Address data not loaded. Cannot retrieve address data.");
                return [];
            }

            switch (type) {
                case "regions":
                    // For regions, we return the top-level object keys and their region_name
                    return Object.keys(phDataGlobal).map(code => ({
                        id: code,
                        name: phDataGlobal[code].region_name
                    }));
                case "provinces":
                    if (regionCode && phDataGlobal[regionCode] && phDataGlobal[regionCode].province_list) {
                        return Object.keys(phDataGlobal[regionCode].province_list).map(name => ({
                            id: name, // Use name as ID for provinces
                            name: name
                        }));
                    }
                    return [];
                case "municipalities":
                    if (regionCode && provinceName &&
                        phDataGlobal[regionCode] &&
                        phDataGlobal[regionCode].province_list &&
                        phDataGlobal[regionCode].province_list[provinceName] &&
                        phDataGlobal[regionCode].province_list[provinceName].municipality_list) {
                        return Object.keys(phDataGlobal[regionCode].province_list[provinceName].municipality_list).map(name => ({
                            id: name, // Use name as ID for municipalities
                            name: name
                        }));
                    }
                    return [];
                case "barangays":
                    if (regionCode && provinceName && municipalityName &&
                        phDataGlobal[regionCode] &&
                        phDataGlobal[regionCode].province_list &&
                        phDataGlobal[regionCode].province_list[provinceName] &&
                        phDataGlobal[regionCode].province_list[provinceName].municipality_list &&
                        phDataGlobal[regionCode].province_list[provinceName].municipality_list[municipalityName] &&
                        phDataGlobal[regionCode].province_list[provinceName].municipality_list[municipalityName].barangay_list) {
                        return phDataGlobal[regionCode].province_list[provinceName].municipality_list[municipalityName].barangay_list.map(name => ({
                            id: name, // Use name as ID for barangays
                            name: name
                        }));
                    }
                    return [];
                default:
                    return [];
            }
        }

        /**
         * Previews the selected image in the corresponding image tag.
         * @param {Event} event The change event from the file input.
         * @param {string} previewId The ID of the <img> element to display the preview.
         */
        function previewImage(event, previewId) {
            const reader = new FileReader();
            reader.onload = function() {
                const output = document.getElementById(previewId);
                output.src = reader.result;
                output.classList.remove('hidden'); // Show the image

                // Find the parent label and then its direct child with class 'text-content'
                const parentLabel = output.closest('label.upload-box');
                const textContent = parentLabel ? parentLabel.querySelector('.text-content') : null;

                if (textContent) {
                    textContent.classList.add('hidden'); // Hide the text content
                }
            };
            if (event.target.files[0]) {
                reader.readAsDataURL(event.target.files[0]);
            } else {
                // If no file is selected, clear the preview and show text content
                const output = document.getElementById(previewId);
                output.src = "";
                output.classList.add('hidden');

                const parentLabel = output.closest('label.upload-box');
                const textContent = parentLabel ? parentLabel.querySelector('.text-content') : null;

                if (textContent) {
                    textContent.classList.remove('hidden'); // Show the text content
                }
            }
        }

        /**
         * Populates a dropdown with options from an array.
         * @param {HTMLElement} selectElement The <select> element to populate.
         * @param {Array<Object>|Array<string>|Array<number>} optionsArray An array of objects (with name/id) or strings/numbers for the options.
         * @param {string} defaultText The default text for the first disabled option.
         */
        function populateDropdown(selectElement, optionsArray, defaultText) {
            selectElement.innerHTML = ''; // Clear existing options
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = defaultText;
            defaultOption.disabled = true;
            defaultOption.selected = true;
            selectElement.appendChild(defaultOption);

            optionsArray.forEach(item => {
                const option = document.createElement('option');
                if (typeof item === 'object' && item !== null && 'name' in item && 'id' in item) {
                    option.value = item.id;
                    option.textContent = item.name;
                } else {
                    option.value = item;
                    option.textContent = item;
                }
                selectElement.appendChild(option);
            });
        }

        /**
         * Resets a select element to its default state.
         * @param {HTMLElement} select The select element to reset.
         * @param {string} label The placeholder text for the select.
         */
        function resetSelect(select, label) {
            select.innerHTML = `<option value="">Select ${label}</option>`;
            select.disabled = true;
        }

        /**
         * Clears the selected value and resets a select element.
         * @param {HTMLElement} select The select element to clear.
         * @param {string} label The placeholder text for the select.
         */
        function clearSelect(select, label) {
            select.value = '';
            resetSelect(select, label);
        }

        // Get references to the select elements for mailing address
        const regionSelect = document.getElementById('region');
        const provinceSelect = document.getElementById('province');
        const municipalitySelect = document.getElementById('municipality');
        const barangaySelect = document.getElementById('barangay');

        // Get references to the select elements for birthplace
        const birthplaceRegionSelect = document.getElementById('region-birthplace');
        const birthplaceProvinceSelect = document.getElementById('province-birthplace');
        const birthplaceMunicipalitySelect = document.getElementById('municipality-birthplace');

        /**
         * Populates the Region dropdown for mailing address.
         */
        async function populateMailingRegions() {
            regionSelect.disabled = true;
            populateDropdown(regionSelect, [], 'Loading Regions...');
            try {
                // Ensure data is loaded before attempting to get regions
                await loadPhData();
                const regions = getData('regions');
                populateDropdown(regionSelect, regions, 'Select Region');
            } catch (error) {
                console.error("Error populating mailing regions:", error);
                populateDropdown(regionSelect, [], 'Error loading regions');
            } finally {
                regionSelect.disabled = false;
                resetSelect(provinceSelect, "Province");
                resetSelect(municipalitySelect, "Municipality");
                resetSelect(barangaySelect, "Barangay");
            }
        }

        /**
         * Populates the Province dropdown for mailing address based on the selected Region.
         */
        regionSelect.addEventListener('change', async () => {
            const regionCode = regionSelect.value;
            resetSelect(provinceSelect, "Province");
            resetSelect(municipalitySelect, "Municipality");
            resetSelect(barangaySelect, "Barangay");

            if (!regionCode) return;

            provinceSelect.disabled = true;
            populateDropdown(provinceSelect, [], 'Loading Provinces...');
            try {
                const provinces = getData('provinces', regionCode);
                populateDropdown(provinceSelect, provinces, 'Select Province');
            } catch (error) {
                console.error("Error populating mailing provinces:", error);
                populateDropdown(provinceSelect, [], 'Error loading provinces');
            } finally {
                provinceSelect.disabled = false;
            }
        });

        /**
         * Populates the City/Municipality dropdown for mailing address based on the selected Province.
         */
        provinceSelect.addEventListener('change', async () => {
            const regionCode = regionSelect.value;
            const provinceName = provinceSelect.value;
            resetSelect(municipalitySelect, "Municipality");
            resetSelect(barangaySelect, "Barangay");

            if (!provinceName) return;

            municipalitySelect.disabled = true;
            populateDropdown(municipalitySelect, [], 'Loading Cities/Municipalities...');
            try {
                const municipalities = getData('municipalities', regionCode, provinceName);
                populateDropdown(municipalitySelect, municipalities, 'Select City/Municipality');
            } catch (error) {
                console.error("Error populating mailing municipalities:", error);
                populateDropdown(municipalitySelect, [], 'Error loading Cities/Municipalities');
            } finally {
                municipalitySelect.disabled = false;
            }
        });

        /**
         * Populates the Barangay dropdown for mailing address based on the selected City/Municipality.
         */
        municipalitySelect.addEventListener('change', async () => {
            const regionCode = regionSelect.value;
            const provinceName = provinceSelect.value;
            const municipalityName = municipalitySelect.value;
            resetSelect(barangaySelect, "Barangay");

            if (!municipalityName) return;

            barangaySelect.disabled = true;
            populateDropdown(barangaySelect, [], 'Loading Barangays...');
            try {
                const barangays = getData('barangays', regionCode, provinceName, municipalityName);
                populateDropdown(barangaySelect, barangays, 'Select Barangay');
            } catch (error) {
                console.error("Error populating mailing barangays:", error);
                populateDropdown(barangaySelect, [], 'Error loading Barangays');
            } finally {
                barangaySelect.disabled = false;
            }
        });

        // --- Birthplace Address Logic (similar to mailing address) ---

        /**
         * Populates the Birthplace Region dropdown.
         */
        async function populateBirthplaceRegions() {
            birthplaceRegionSelect.disabled = true;
            populateDropdown(birthplaceRegionSelect, [], 'Loading Regions...');
            try {
                // Ensure data is loaded before attempting to get regions
                await loadPhData();
                const regions = getData('regions');
                populateDropdown(birthplaceRegionSelect, regions, 'Select Region');
            } catch (error) {
                console.error("Error populating birthplace regions:", error);
                populateDropdown(birthplaceRegionSelect, [], 'Error loading regions');
            } finally {
                birthplaceRegionSelect.disabled = false;
                resetSelect(birthplaceProvinceSelect, "Province");
                resetSelect(birthplaceMunicipalitySelect, "City/Municipality");
            }
        }

        /**
         * Populates the Birthplace Province dropdown based on the selected Birthplace Region.
         */
        birthplaceRegionSelect.addEventListener('change', async () => {
            const regionCode = birthplaceRegionSelect.value;
            resetSelect(birthplaceProvinceSelect, "Province");
            resetSelect(birthplaceMunicipalitySelect, "City/Municipality");

            if (!regionCode) return;

            birthplaceProvinceSelect.disabled = true;
            populateDropdown(birthplaceProvinceSelect, [], 'Loading Provinces...');
            try {
                const provinces = getData('provinces', regionCode);
                populateDropdown(birthplaceProvinceSelect, provinces, 'Select Province');
            } catch (error) {
                console.error("Error populating birthplace provinces:", error);
                populateDropdown(birthplaceProvinceSelect, [], 'Error loading provinces');
            } finally {
                birthplaceProvinceSelect.disabled = false;
            }
        });

        /**
         * Populates the Birthplace City/Municipality dropdown based on the selected Birthplace Province.
         */
        birthplaceProvinceSelect.addEventListener('change', async () => {
            const regionCode = birthplaceRegionSelect.value;
            const provinceName = birthplaceProvinceSelect.value;
            resetSelect(birthplaceMunicipalitySelect, "City/Municipality");

            if (!provinceName) return;

            birthplaceMunicipalitySelect.disabled = true;
            populateDropdown(birthplaceMunicipalitySelect, [], 'Loading Cities/Municipalities...');
            try {
                const municipalities = getData('municipalities', regionCode, provinceName);
                populateDropdown(birthplaceMunicipalitySelect, municipalities, 'Select City/Municipality');
            } catch (error) {
                console.error("Error populating birthplace municipalities:", error);
                populateDropdown(birthplaceMunicipalitySelect, [], 'Error loading Cities/Municipalities');
            } finally {
                birthplaceMunicipalitySelect.disabled = false;
            }
        });

        // --- New Autofill Functions ---

        /**
         * Autofills or clears the birthplace fields based on checkbox state.
         */
        async function toggleBirthplaceFromMailing() {
            const checkbox = document.getElementById('same-as-mailing-birthplace');
            if (checkbox.checked) {
                if (!phDataGlobal) {
                    showMessageBox("Address data not loaded. Please ensure ph.json is accessible.", 'error');
                    checkbox.checked = false; // Uncheck if data not available
                    return;
                }

                const mailingRegionCode = regionSelect.value;
                const mailingProvinceName = provinceSelect.value;
                const mailingMunicipalityName = municipalitySelect.value;

                if (!mailingRegionCode || !mailingProvinceName || !mailingMunicipalityName) {
                    showMessageBox("Please fill in the Complete Permanent Mailing Address (Region, Province, City/Municipality) first.", 'info');
                    checkbox.checked = false;
                    return;
                }

                // 1. Populate Region dropdown for birthplace
                const regions = getData('regions');
                populateDropdown(birthplaceRegionSelect, regions, 'Select Region');
                birthplaceRegionSelect.value = mailingRegionCode;
                birthplaceRegionSelect.disabled = false; // Enable after populating

                // 2. Populate Province dropdown for birthplace based on selected region
                const provinces = getData('provinces', mailingRegionCode);
                populateDropdown(birthplaceProvinceSelect, provinces, 'Select Province');
                // Check if the mailing province exists in the newly populated birthplace province options
                if (provinces.some(p => p.id === mailingProvinceName)) {
                    birthplaceProvinceSelect.value = mailingProvinceName;
                    birthplaceProvinceSelect.disabled = false; // Enable after populating
                } else {
                    showMessageBox("Mailing Province not found in birthplace options. Please select manually.", 'error');
                    checkbox.checked = false; // Uncheck if not fully filled
                    clearSelect(birthplaceProvinceSelect, "Province"); // Clear subsequent fields
                    clearSelect(birthplaceMunicipalitySelect, "City/Municipality");
                    return;
                }

                // 3. Populate Municipality dropdown for birthplace based on selected province
                const municipalities = getData('municipalities', mailingRegionCode, mailingProvinceName);
                populateDropdown(birthplaceMunicipalitySelect, municipalities, 'Select City/Municipality');
                // Check if the mailing municipality exists in the newly populated birthplace municipality options
                if (municipalities.some(m => m.id === mailingMunicipalityName)) {
                    birthplaceMunicipalitySelect.value = mailingMunicipalityName;
                    birthplaceMunicipalitySelect.disabled = false; // Enable after populating
                    showMessageBox("Birthplace autofilled successfully.", 'info');
                } else {
                    showMessageBox("Mailing City/Municipality not found in birthplace options. Please select manually.", 'error');
                    checkbox.checked = false; // Uncheck if not fully filled
                    clearSelect(birthplaceMunicipalitySelect, "City/Municipality"); // Clear subsequent fields
                    return;
                }

            } else {
                // If unchecked, clear the birthplace fields
                clearSelect(birthplaceRegionSelect, "Region");
                clearSelect(birthplaceProvinceSelect, "Province");
                clearSelect(birthplaceMunicipalitySelect, "City/Municipality");
                showMessageBox("Birthplace fields cleared.", 'info');
            }
        }

        /**
         * Autofills or clears the Parent/Guardian Address field based on checkbox state.
         */
        function toggleParentAddressFromMailing() {
            const checkbox = document.getElementById('same-as-mailing-parent-address');
            const parentGuardianAddressInput = document.getElementById('parent-guardian-address');

            if (checkbox.checked) {
                const houseStreetAddress = document.getElementById('house-street').value;
                const barangayText = barangaySelect.options[barangaySelect.selectedIndex]?.textContent || '';
                const municipalityText = municipalitySelect.options[municipalitySelect.selectedIndex]?.textContent || '';
                const provinceText = provinceSelect.options[provinceSelect.selectedIndex]?.textContent || '';

                const addressParts = [houseStreetAddress, barangayText, municipalityText, provinceText].filter(part => part.trim() !== '');
                
                if (addressParts.length === 0) {
                    showMessageBox("Please fill in the Complete Permanent Mailing Address first.", 'info');
                    checkbox.checked = false; // Uncheck if source is empty
                    return;
                }

                parentGuardianAddressInput.value = addressParts.join(', ').toUpperCase(); // Ensure copied text is also uppercase
                showMessageBox("Parent/Guardian Address autofilled.", 'info');
            } else {
                parentGuardianAddressInput.value = '';
                showMessageBox("Parent/Guardian Address cleared.", 'info');
            }
        }

        /**
         * Toggles the visibility of monthly income and date hired fields based on employment status.
         */
        function toggleEmploymentFields() {
            const employedRadio = document.getElementById('employed');
            const employedFieldsDiv = document.getElementById('employed-fields');

            if (employedRadio.checked) {
                employedFieldsDiv.classList.remove('hidden-field');
            } else {
                employedFieldsDiv.classList.add('hidden-field');
            }
        }

        /**
         * Validates the contact number input to allow only digits and limit length to 11.
         * @param {HTMLInputElement} inputElement The input field to validate.
         */
        function validateContactNo(inputElement) {
            let value = inputElement.value;
            // Remove any non-digit characters
            value = value.replace(/\D/g, '');
            // Limit to 11 digits
            if (value.length > 11) {
                value = value.substring(0, 11);
            }
            inputElement.value = value;
        }

        // Function to get today's date in YYYY-MM-DD format
        function getTodayDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0'); // Months are 0-indexed
            const day = String(today.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        /**
         * Populates the month dropdown.
         */
        function populateMonths() {
            const monthSelect = document.getElementById('month-birth');
            const months = [
                "January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"
            ];
            populateDropdown(monthSelect, months, 'Select Month');
        }

        /**
         * Populates the year dropdown (last 100 years from current).
         */
        function populateYears() {
            const yearSelect = document.getElementById('year-birth');
            const currentYear = new Date().getFullYear();
            const years = [];
            for (let i = currentYear; i >= currentYear - 100; i--) {
                years.push(i);
            }
            populateDropdown(yearSelect, years, 'Select Year');
        }

        /**
         * Populates the day dropdown based on selected month and year.
         */
        function populateDays() {
            const daySelect = document.getElementById('day-birth');
            const monthSelect = document.getElementById('month-birth');
            const yearSelect = document.getElementById('year-birth');

            const selectedMonthIndex = monthSelect.selectedIndex > 0 ? monthSelect.selectedIndex - 1 : -1; // 0-indexed
            const selectedYear = parseInt(yearSelect.value);

            if (selectedMonthIndex === -1 || isNaN(selectedYear)) {
                populateDropdown(daySelect, [], 'Select Day');
                return;
            }

            const daysInMonth = new Date(selectedYear, selectedMonthIndex + 1, 0).getDate();
            const days = Array.from({ length: daysInMonth }, (_, i) => i + 1);
            populateDropdown(daySelect, days, 'Select Day');
        }

        /**
         * Calculates age based on selected birthdate and updates the age field.
         */
        function calculateAge() {
            const monthSelect = document.getElementById('month-birth');
            const daySelect = document.getElementById('day-birth');
            const yearSelect = document.getElementById('year-birth');
            const ageInput = document.getElementById('age');

            const selectedMonthIndex = monthSelect.selectedIndex > 0 ? monthSelect.selectedIndex - 1 : -1;
            const selectedDay = parseInt(daySelect.value);
            const selectedYear = parseInt(yearSelect.value);

            if (selectedMonthIndex === -1 || isNaN(selectedDay) || isNaN(selectedYear)) {
                ageInput.value = '';
                return;
            }

            const birthDate = new Date(selectedYear, selectedMonthIndex, selectedDay);
            const today = new Date();
            let age = today.getFullYear() - birthDate.getFullYear();
            const m = today.getMonth() - birthDate.getMonth();

            if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            ageInput.value = age >= 0 ? age : ''; // Ensure age is not negative
        }

        /**
         * Shows the specified page and updates button visibility.
         * @param {number} pageNum The page number to show.
         */
        function showPage(pageNum) {
            const pages = document.querySelectorAll('.form-page');
            pages.forEach(page => {
                if (parseInt(page.dataset.page) === pageNum) {
                    page.classList.remove('hidden-page');
                } else {
                    page.classList.add('hidden-page');
                }
            });

            const prevButton = document.getElementById('prev-button');
            const nextButton = document.getElementById('next-button');
            const submitButton = document.getElementById('submit-button');

            // Show/hide Previous button
            if (pageNum === 1) {
                prevButton.style.display = 'none';
            } else {
                prevButton.style.display = 'block';
            }

            // Show/hide Next and Submit buttons
            if (pageNum === totalPages) {
                nextButton.style.display = 'none';
                submitButton.style.display = 'block';
            } else {
                nextButton.style.display = 'block';
                submitButton.style.display = 'none';
            }
            currentPage = pageNum;
        }

        /**
         * Navigates to the next page.
         */
        function nextPage() {
            if (currentPage < totalPages) {
                showPage(currentPage + 1);
            }
        }

        /**
         * Navigates to the previous page.
         */
        function prevPage() {
            if (currentPage > 1) {
                showPage(currentPage - 1);
            }
        }

        // Initialize dropdowns and set default dates on page load
        document.addEventListener('DOMContentLoaded', (event) => {
            const today = getTodayDate();
            const entryDateInput = document.getElementById('entry-date');
            const dateAccomplishedInput = document.getElementById('date-accomplished');

            if (entryDateInput) {
                entryDateInput.value = today;
            }
            if (dateAccomplishedInput) {
                dateAccomplishedInput.value = today;
            }

            populateMailingRegions(); // Initial population of mailing address regions
            toggleEmploymentFields(); // Set initial visibility of employment fields

            // Populate birthdate dropdowns
            populateMonths();
            populateYears();
            populateDays(); // Populate days initially (will be empty until month/year selected)

            // Add event listeners for birthdate changes
            document.getElementById('month-birth').addEventListener('change', () => {
                populateDays();
                calculateAge();
            });
            document.getElementById('year-birth').addEventListener('change', () => {
                populateDays();
                calculateAge();
            });
            document.getElementById('day-birth').addEventListener('change', calculateAge);

            // Populate birthplace dropdowns
            populateBirthplaceRegions();

            // Add event listeners for the new "Same as Permanent Address" checkboxes
            document.getElementById('same-as-mailing-birthplace').addEventListener('change', toggleBirthplaceFromMailing);
            document.getElementById('same-as-mailing-parent-address').addEventListener('change', toggleParentAddressFromMailing);

            // Set up navigation button event listeners
            document.getElementById('next-button').addEventListener('click', nextPage);
            document.getElementById('prev-button').addEventListener('click', prevPage);
            document.getElementById('submit-button').addEventListener('click', (e) => {
                e.preventDefault(); // Prevent default form submission
                
                // Check if this is a walk-in registration
                const urlParams = new URLSearchParams(window.location.search);
                const isWalkin = urlParams.get('walkin') === 'true';
                
                if (isWalkin) {
                    // Add hidden fields for walk-in data
                    const form = document.getElementById('learner-profile-form');
                    
                    // Add walk-in specific data from URL parameters
                    const hiddenFields = [
                        { name: 'first_name', value: urlParams.get('first_name') || '' },
                        { name: 'last_name', value: urlParams.get('last_name') || '' },
                        { name: 'middle_name', value: urlParams.get('middle_name') || '' },
                        { name: 'selected_program', value: urlParams.get('program') || '' }
                    ];
                    
                    hiddenFields.forEach(field => {
                        const input = document.createElement('input');
                        input.type = 'hidden';
                        input.name = field.name;
                        input.value = field.value;
                        form.appendChild(input);
                    });
                    
                    // Submit the form
                    form.submit();
                } else {
                    // For regular registration, just show success message
                    showMessageBox("Form submitted successfully!", 'info');
                }
            });

            // Check for walk-in data from localStorage
            checkForWalkinData();

            // Show the first page on load
            showPage(1);
        });

        // Function to check and populate walk-in data
        function checkForWalkinData() {
            // Check URL parameters first
            const urlParams = new URLSearchParams(window.location.search);
            const isWalkin = urlParams.get('walkin') === 'true';
            
            if (isWalkin) {
                // Get data from URL parameters
                const firstName = urlParams.get('first_name') || '';
                const lastName = urlParams.get('last_name') || '';
                const middleName = urlParams.get('middle_name') || '';
                const program = urlParams.get('program') || '';
                
                // Populate name fields
                document.getElementById('first-name').value = firstName;
                document.getElementById('last-name').value = lastName;
                document.getElementById('middle-name').value = middleName;
                
                // Show a message indicating this is a walk-in registration
                showMessageBox('Walk-in registration data loaded. Please complete the form.', 'info');
                
                // Add a visual indicator that this is a walk-in registration
                const header = document.querySelector('h1');
                if (header) {
                    header.innerHTML += ' <span style="color: #3B82F6; font-size: 0.8em;">(Walk-in Registration)</span>';
                }
                
                return;
            }
            
            // Fallback to localStorage method
            const walkinData = localStorage.getItem('walkinData');
            if (walkinData) {
                try {
                    const data = JSON.parse(walkinData);
                    if (data.isWalkin) {
                        // Populate name fields
                        document.getElementById('first-name').value = data.firstName || '';
                        document.getElementById('last-name').value = data.lastName || '';
                        document.getElementById('middle-name').value = data.middleName || '';
                        
                        // Clear the localStorage after use
                        localStorage.removeItem('walkinData');
                        
                        // Show a message indicating this is a walk-in registration
                        showMessageBox('Walk-in registration data loaded. Please complete the form.', 'info');
                    }
                } catch (error) {
                    console.error('Error parsing walk-in data:', error);
                }
            }
        }
    </script>
</body>
</html>
