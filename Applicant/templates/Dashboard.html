{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        /* Define color variables for consistency with trainer dashboard */
        :root {
            --text-dark: #333333;
            --text-medium: #666666;
            --background-light: #F0F2F5;
            --card-background: #FFFFFF;
            --green-icon: #28A745;
            --red-icon: #DC3545;
            --purple-icon: #6F42C1;
            --sidebar-logo-color: #2a6dbd;
            --sidebar-active-hover-color: rgba(255, 255, 255, 0.2);
            --dark-blue-card-bg: #2C5EBD;
            --dark-blue-card-text: #FFFFFF;
            --table-header-blue: #4A89DC;
            --status-active-bg: #E6F7D9;
            --status-active-text: #52C41A;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            background-color: var(--background-light);
        }

        /* Sidebar styling to match trainer dashboard */
        .sidebar {
            width: 250px;
            background: linear-gradient(180deg, #4a90e2 0%, #2a6dbd 100%);
            color: white;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            padding: 20px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            border-top-right-radius: 15px;
            border-bottom-right-radius: 15px;
            z-index: 1000;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
        }

        .sidebar-header .logo {
            width: 40px;
            height: 40px;
            background-color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 10px;
            overflow: hidden;
        }

        .sidebar-header .logo img {
            width: 30px;
            height: 30px;
            object-fit: cover;
        }

        .sidebar-nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar-nav li {
            margin-bottom: 10px;
        }

        .sidebar-nav a {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: background-color 0.3s ease;
            cursor: pointer;
        }

        .sidebar-nav a:hover, .sidebar-nav a.active {
            background-color: var(--sidebar-active-hover-color);
        }

        .sidebar-nav a i {
            margin-right: 10px;
            font-size: 1.1rem;
        }

        /* Notification badge on sidebar link */
        .sidebar-nav a {
            position: relative;
        }

        .sidebar-nav .nav-notification-badge {
            position: absolute;
            top: 8px;
            right: 15px;
            width: 10px;
            height: 10px;
            background-color: #dc3545;
            border-radius: 50%;
            border: 2px solid white;
            animation: pulse-badge 2s infinite;
        }

        @keyframes pulse-badge {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7);
            }
            50% {
                transform: scale(1.1);
                box-shadow: 0 0 0 4px rgba(220, 53, 69, 0);
            }
        }

        /* Dropdown styling */
        .dropdown-item {
            position: relative;
        }

        .dropdown-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 15px;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: background-color 0.3s ease;
            cursor: pointer;
        }

        .dropdown-toggle:hover {
            background-color: var(--sidebar-active-hover-color);
        }

        .dropdown-arrow {
            transition: transform 0.3s ease;
            font-size: 0.8rem;
        }

        .dropdown-arrow.rotated {
            transform: rotate(180deg);
        }

        .dropdown-menu {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            margin-top: 5px;
            padding: 5px 0;
            transition: max-height 0.3s ease-out;
        }

        .dropdown-menu.active {
            max-height: 200px;
        }

        .dropdown-menu.hidden {
            max-height: 0;
            opacity: 0;
        }

        .dropdown-link {
            display: flex;
            align-items: center;
            padding: 8px 25px;
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            font-size: 0.9rem;
            transition: background-color 0.3s ease;
        }

        .dropdown-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .dropdown-link i {
            margin-right: 8px;
            font-size: 0.9rem;
        }

        /* Main content area */
        .main-content {
            margin-left: 250px;
            padding: 20px;
            flex-grow: 1;
        }

        /* Header styling */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background-color: var(--card-background);
            border-bottom: 1px solid #e0e0e0;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info .icon {
            color: var(--text-medium);
            cursor: pointer;
            font-size: 1.4rem;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.3s ease;
            position: relative;
        }

        .user-info .icon:hover {
            background-color: rgba(74, 137, 220, 0.1);
            color: var(--sidebar-logo-color);
            transform: scale(1.1);
        }

        .notification-bell {
            position: relative;
            display: inline-block;
        }

        .notification-bell .fas.fa-bell {
            font-size: 1.5rem;
            color: var(--sidebar-logo-color);
            transition: all 0.3s ease;
        }

        .notification-bell:hover .fas.fa-bell {
            color: #f59e0b;
            animation: bell-ring 0.5s ease-in-out;
        }

        @keyframes bell-ring {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(15deg); }
            75% { transform: rotate(-15deg); }
        }

        .user-info .avatar {
            width: 40px;
            height: 40px;
            background-color: var(--sidebar-logo-color);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: 500;
            overflow: hidden;
        }

        .user-info .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-info .welcome-text {
            text-align: right;
        }

        .user-info .welcome-text .greeting {
            font-size: 1rem;
            color: var(--sidebar-logo-color);
            margin: 0;
        }

        .user-info .welcome-text .username {
            font-size: 1.2rem;
            font-weight: 600;
            color: #f59e0b;
            margin: 0;
        }

        /* Content sections */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        /* Card styling */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background-color: var(--card-background);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
            transition: transform 0.2s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-title {
            font-size: 0.9rem;
            color: var(--text-medium);
            margin-bottom: 5px;
        }

        .card-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-dark);
        }

        .card-subtitle {
            font-size: 0.8rem;
            color: var(--text-medium);
            margin-top: 5px;
        }

        /* Dark blue cards */
        .dark-blue-card {
            background-color: var(--dark-blue-card-bg);
            color: var(--dark-blue-card-text);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
            min-height: 250px;
            transition: transform 0.2s ease;
        }

        .dark-blue-card:hover {
            transform: translateY(-5px);
        }

        .dark-blue-card h3 {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
        }

        /* Table styling */
        .list-container {
            background-color: var(--card-background);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.9rem;
        }

        .data-table th,
        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
            text-align: left;
        }

        .data-table th {
            background-color: var(--table-header-blue);
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.8rem;
        }

        .data-table td {
            color: var(--text-dark);
        }

        .data-table tr:hover {
            background-color: #f5f5f5;
        }

        /* Status badges */
        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-badge.pending {
            background-color: #FFF3CD;
            color: #856404;
        }

        .status-badge.accepted {
            background-color: #D1ECF1;
            color: #0C5460;
        }

        .status-badge.approved {
            background-color: #D4EDDA;
            color: #155724;
        }

        .status-badge.declined {
            background-color: #F8D7DA;
            color: #721C24;
        }

        /* Notification styling */
        .notification-container {
            position: relative;
        }

        .notification-box {
            position: absolute;
            right: 0;
            top: 40px;
            width: 300px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            border: 1px solid #e0e0e0;
            max-height: 400px;
            overflow-y: auto;
        }

        .notification-box .header-notif {
            padding: 12px 16px;
            border-bottom: 1px solid #e0e0e0;
            font-weight: 600;
            color: var(--sidebar-logo-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-item {
            padding: 12px 16px;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s ease;
        }

        .notification-item:hover {
            background-color: #f5f5f5;
        }

        /* Modal styling */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal-content {
            background-color: var(--card-background);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        /* Plus button styling */
        .add-button {
            background-color: var(--table-header-blue);
            color: white;
            padding: 12px 20px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
            border: none;
            cursor: pointer;
            font-size: 1.1rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .add-button:hover {
            background-color: #3a7bd5;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        /* Profile form styling */
        .profile-container {
            background-color: var(--card-background);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
            max-height: 80vh;
            overflow-y: auto;
        }

        .profile-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .profile-photo {
            width: 120px;
            height: 120px;
            background-color: #f0f0f0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 2px solid #e0e0e0;
        }

        .profile-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-section h2 {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--table-header-blue);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e0e0e0;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-medium);
            margin-bottom: 5px;
        }

        .form-group input,
        .form-group select {
            padding: 10px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.9rem;
            background-color: #f8f9fa;
            color: var(--text-dark);
        }

        /* Job matching styling */
        .job-card {
            background-color: var(--card-background);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .job-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .job-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 10px;
        }

        .job-detail {
            font-size: 0.9rem;
            color: var(--text-medium);
            margin-bottom: 8px;
        }

        .job-detail strong {
            color: var(--text-dark);
        }

        .apply-button {
            background-color: var(--table-header-blue);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            display: inline-block;
            margin-top: 10px;
            transition: background-color 0.2s ease;
        }

        .apply-button:hover {
            background-color: #3a7bd5;
            color: white;
        }

        /* Progress bars */
        .progress-container {
            margin-bottom: 20px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: #60A5FA;
            border-radius: 6px;
            transition: width 0.3s ease;
        }

        /* Mobile Hamburger Menu */
        .mobile-menu-toggle {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 2000;
            background: linear-gradient(135deg, #4a90e2, #2a6dbd);
            border: none;
            border-radius: 8px;
            padding: 10px 12px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .mobile-menu-toggle i {
            color: white;
            font-size: 1.5rem;
        }

        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1500;
        }

        /* Responsive design for Mobile */
        @media (max-width: 768px) {
            /* Show mobile menu toggle */
            .mobile-menu-toggle {
                display: block;
            }

            /* Hide sidebar by default on mobile */
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                width: 250px;
                z-index: 1600;
                overflow-y: auto;
                overflow-x: hidden;
            }

            /* Show sidebar when active */
            .sidebar.mobile-active {
                transform: translateX(0);
            }

            /* Enable scrolling for sidebar navigation on mobile */
            .sidebar-nav {
                max-height: calc(100vh - 200px);
                overflow-y: auto;
                overflow-x: hidden;
            }

            .sidebar-overlay.active {
                display: block;
            }

            /* Main content takes full width on mobile */
            .main-content {
                margin-left: 0;
                padding: 70px 15px 15px 15px;
            }

            /* Mobile Header Adjustments */
            .header {
                padding: 10px 15px;
                margin-bottom: 15px;
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .header h1 {
                font-size: 1.3rem;
                margin-bottom: 5px;
            }

            .user-info {
                width: 100%;
                justify-content: space-between;
            }

            .user-info .welcome-text {
                display: none;
            }

            .user-info .avatar {
                width: 35px;
                height: 35px;
            }

            /* Mobile Card Layout */
            .dashboard-cards {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .card {
                padding: 15px;
            }

            .card-title {
                font-size: 0.85rem;
            }

            .card-value {
                font-size: 1.5rem;
            }

            /* Mobile Table - Make scrollable */
            .list-container {
                padding: 15px;
                overflow-x: auto;
            }

            .data-table {
                font-size: 0.8rem;
                min-width: 600px;
            }

            .data-table th,
            .data-table td {
                padding: 8px 10px;
            }

            /* Mobile Form Adjustments */
            .form-grid {
                grid-template-columns: 1fr;
            }

            /* Dark blue cards mobile */
            .dark-blue-card {
                padding: 15px;
                min-height: auto;
            }

            .dark-blue-card h3 {
                font-size: 1rem;
            }

            /* Mobile notification improvements */
            .notification-bell .fas.fa-bell {
                font-size: 1.3rem;
            }

            /* Mobile notification box positioning - align to right with proper viewport constraints */
            .notification-box {
                position: fixed;
                right: 10px;
                left: auto;
                top: 60px;
                width: calc(100vw - 20px);
                max-width: 320px;
                max-height: 70vh;
            }

            /* Improve touch targets for mobile */
            .sidebar-nav a {
                padding: 14px 15px;
                font-size: 0.95rem;
            }

            .sidebar-nav a i {
                font-size: 1.2rem;
            }
        }

        /* Tablet View (768px - 1024px) */
        @media (min-width: 769px) and (max-width: 1024px) {
            .sidebar {
                width: 200px;
            }

            .main-content {
                margin-left: 200px;
            }

            .dashboard-cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .hidden {
            display: none !important;
        }

        /* Alpine.js cloak - hide elements until Alpine.js loads */
        [x-cloak] {
            display: none !important;
        }

        /* Marked field styles - for fields that need correction */
        .field-needs-correction {
            position: relative;
        }

        .field-needs-correction input,
        .field-needs-correction select,
        .field-needs-correction textarea {
            border: 2px solid #dc3545 !important;
            background-color: #fff5f5 !important;
            animation: pulse-red 2s ease-in-out infinite;
        }

        .field-needs-correction label {
            color: #dc3545 !important;
            font-weight: 600 !important;
        }

        .field-needs-correction::after {
            content: '‚ö†Ô∏è Needs Correction';
            position: absolute;
            top: -8px;
            right: 0;
            background-color: #dc3545;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            z-index: 10;
        }

        @keyframes pulse-red {
            0%, 100% {
                border-color: #dc3545;
                box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.4);
            }
            50% {
                border-color: #ff6b6b;
                box-shadow: 0 0 0 4px rgba(220, 53, 69, 0.2);
            }
        }

        /* Correction alert banner */
        .correction-alert {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .correction-alert h3 {
            margin: 0 0 10px 0;
            font-size: 1.3rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .correction-alert p {
            margin: 5px 0;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .correction-alert .admin-notes {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            border-left: 4px solid rgba(255, 255, 255, 0.5);
        }

        /* Animation for notifications */
        @keyframes notification-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        #notification-badge {
            animation: notification-pulse 2s infinite;
        }

        /* Success modal styling */
        .success-modal .modal-content {
            border: 2px solid #28a745;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(40, 167, 69, 0.3);
        }

        .success-modal .modal-header {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border-bottom: none;
            border-radius: 10px 10px 0 0;
        }

        .progress-item {
            transition: all 0.3s ease;
        }

        .progress-item.completed {
            background-color: #d4edda;
            border-color: #28a745;
        }

        .progress-item.pending {
            background-color: #f8f9fa;
            border-color: #dee2e6;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Watermark and print protection styles */
        .certificate-watermark {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: repeating-linear-gradient(
                45deg,
                rgba(74, 137, 220, 0.1) 0px,
                rgba(74, 137, 220, 0.1) 10px,
                transparent 10px,
                transparent 20px
            );
            pointer-events: none;
            z-index: 10;
        }

        .certificate-watermark::before {
            content: 'DLL-LMSTC OFFICIAL CERTIFICATE';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 3rem;
            font-weight: bold;
            color: rgba(74, 137, 220, 0.1);
            white-space: nowrap;
            z-index: 11;
        }

        /* Disable print and download for certificate */
        @media print {
            .certificate-container {
                display: none !important;
            }
        }

        .no-select {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* Sliding news animation */
        @keyframes marquee {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        .animate-marquee {
            animation: marquee 30s linear infinite;
            color: #1e40af;
            font-weight: 500;
        }

        /* Tab Navigation Styles */
        .tab-navigation {
            border-bottom: 2px solid #e5e7eb;
        }

        .tab-button {
            background: none;
            border: none;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 500;
            color: #6b7280;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
        }

        .tab-button:hover {
            color: #374151;
            background-color: #f9fafb;
        }

        .tab-button.active {
            color: #2563eb;
            border-bottom-color: #2563eb;
            background-color: #eff6ff;
        }

        .tab-button i {
            margin-right: 8px;
        }

        /* Tab Content Styles */
        .tab-content {
            position: relative;
        }

        .tab-panel {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .tab-panel.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Profile Field Styles */
        .profile-field {
            margin-bottom: 16px;
        }

        .profile-field label {
            display: block;
            margin-bottom: 4px;
            font-weight: 500;
            color: #6b7280;
        }

        .profile-field p {
            margin: 0;
            padding: 8px 0;
            color: #374151;
            word-wrap: break-word;
        }

        /* Responsive adjustments for tabs */
        @media (max-width: 768px) {
            .tab-button {
                padding: 10px 16px;
                font-size: 13px;
            }
            
            .tab-button i {
                margin-right: 6px;
            }
        }
    </style>
</head>

<body {% if show_modal %}data-show-modal="true"{% endif %}>
    <!-- Django Messages Notification -->
    {% if messages %}
    {% for message in messages %}
    <div id="django-message-{{ forloop.counter }}" class="fixed top-4 left-1/2 transform -translate-x-1/2 z-[9999] px-6 py-4 rounded-xl shadow-2xl text-white flex items-center space-x-3 transition-all duration-300 {% if message.tags == 'success' %}bg-gradient-to-r from-green-500 to-green-600{% elif message.tags == 'error' %}bg-gradient-to-r from-red-500 to-red-600{% elif message.tags == 'warning' %}bg-gradient-to-r from-yellow-500 to-orange-500{% else %}bg-gradient-to-r from-blue-500 to-blue-600{% endif %}" style="max-width: 500px;">
        <div class="flex items-center space-x-3">
            {% if message.tags == 'success' %}
                <i class="fas fa-check-circle text-xl"></i>
            {% elif message.tags == 'error' %}
                <i class="fas fa-exclamation-triangle text-xl"></i>
            {% elif message.tags == 'warning' %}
                <i class="fas fa-exclamation-circle text-xl"></i>
            {% else %}
                <i class="fas fa-info-circle text-xl"></i>
            {% endif %}
            <span class="font-medium">{{ message }}</span>
        </div>
        <button onclick="this.parentElement.remove()" class="ml-4 text-white hover:opacity-70 transition-opacity">
            <i class="fas fa-times"></i>
        </button>
    </div>
    <script>
        setTimeout(function() {
            const msg = document.getElementById('django-message-{{ forloop.counter }}');
            if (msg) {
                msg.style.opacity = '0';
                msg.style.transform = 'translate(-50%, -20px)';
                setTimeout(() => msg.remove(), 300);
            }
        }, 5000);
    </script>
    {% endfor %}
    {% endif %}
    
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" id="mobile-menu-btn">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <div class="sidebar" id="sidebar">
        <div>
            <div class="sidebar-header">
                <div class="logo">
                    <img src="{% static 'Images/icon.png' %}" alt="Logo">
                </div>
                <h2>DLL - LMSTC</h2>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="#" data-section="overview" class="active"><i class="fas fa-tachometer-alt"></i> <span>Dashboard</span></a></li>
                    <li>
                        <a href="#" data-section="profile">
                            <i class="fas fa-user"></i> 
                            <span>Profile</span>
                            {% if marked_fields %}
                            <span class="nav-notification-badge" title="Action required: Incorrect information needs correction"></span>
                            {% endif %}
                        </a>
                    </li>
                    <li><a href="#" data-section="schedule"><i class="fas fa-calendar-alt"></i> <span>Class Schedule</span></a></li>
                    <li><a href="#" data-section="grades"><i class="fas fa-chart-line"></i> <span>Competencies</span></a></li>
                    <li>
                        <a href="#" data-section="jobs" {% if not is_passer %}class="opacity-50 cursor-not-allowed" onclick="event.preventDefault(); alert('Job Recommendations are only available after completing a program.');"{% endif %}>
                            <i class="fas fa-briefcase"></i> 
                            <span>Job Recommendations{% if not is_passer %} <i class="fas fa-lock ml-2"></i>{% endif %}</span>
                        </a>
                    </li>
                    <li><a href="#" data-section="ticket"><i class="fas fa-ticket-alt"></i> <span>Ticket</span></a></li>
                    <li><a href="#" data-section="document-management"><i class="fas fa-folder-open"></i> <span>Document Management</span></a></li>
                    <li><a href="#" data-section="certification"><i class="fas fa-certificate"></i> <span>Certification</span></a></li>
                </ul>
            </nav>
        </div>
        <div>
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="{% url 'Homepage_user' %}"><i class="fas fa-home"></i> <span>Homepage</span></a></li>
                    <li><a href="{% url 'logout_view' %}"><i class="fas fa-sign-out-alt"></i> <span>Sign Out</span></a></li>
                </ul>
            </nav>
        </div>
    </div>

    <div class="main-content">
        <div class="header">
            <h1>User Process Dashboard</h1>
            <div class="user-info">
                <div class="notification-container">
                    <div class="notification-bell">
                        <i class="fas fa-bell icon" id="bell-btn"></i>
                        <span id="notification-badge" class="{% if unread_notifications_count == 0 %}hidden{% endif %} absolute bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold" style="position: absolute; top: -2px; right: -2px; width: 22px; height: 22px; font-size: 0.75rem; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
                            {{ unread_notifications_count|default:0 }}
                        </span>
                    </div>
                    
                    <div id="notification-box" class="notification-box hidden">
                        <div class="header-notif">
                            <span>Notifications</span>
                            <button id="mark-all-read" class="text-sm text-gray-500 hover:text-blue-600">Mark all read</button>
                        </div>
                        <div id="notifications-list" class="max-h-64 overflow-y-auto">
                            <div class="p-4 text-center text-gray-500">Loading notifications...</div>
                        </div>
                    </div>
                </div>
                <div class="welcome-text">
                    <p class="greeting">Welcome!</p>
                    <p class="username">{{ username }}</p>
                </div>
                <div class="avatar">
                    {% if user_profile_picture %}
                        <img src="{{ user_profile_picture }}" alt="User Avatar" class="object-cover" onerror="this.src='{% static 'Images/user.png' %}'" />
                    {% else %}
                        <img src="{% static 'Images/user.png' %}" alt="User Avatar" />
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Overview Section -->
        <div id="overview-section" class="content-section active">
            <h2 class="text-2xl font-semibold text-gray-800 mb-5">Overview</h2>
            
            <!-- Sliding News Section -->
            {% if is_passer %}
            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 mb-6 border border-blue-200 overflow-hidden">
                <div class="flex items-center mb-2">
                    <i class="fas fa-newspaper text-blue-600 mr-2"></i>
                    <h3 class="text-lg font-semibold text-gray-800">Latest Job Updates</h3>
                </div>
                <div class="relative overflow-hidden">
                    <div class="sliding-news whitespace-nowrap">
                        <span class="inline-block animate-marquee">
                            üî• New Software Developer position at TechCorp - ‚Ç±45,000/month | 
                            üíº Automotive Technician needed at AutoFix - ‚Ç±30,000/month | 
                            üé® Web Designer opportunity at Creative Studio - ‚Ç±35,000/month | 
                            üçΩÔ∏è Restaurant Manager position available - ‚Ç±40,000/month | 
                            üèóÔ∏è Construction Worker roles open - ‚Ç±25,000/month | 
                            üíª Database Administrator at DataTech - ‚Ç±50,000/month
                        </span>
                    </div>
                </div>
            </div>
            {% else %}
            <!-- Locked Latest Job Updates for Non-Passers -->
            <div class="bg-gradient-to-r from-gray-100 to-gray-200 rounded-lg p-4 mb-6 border border-gray-300">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-lock text-gray-400 mr-2"></i>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-600">Latest Job Updates</h3>
                            <p class="text-sm text-gray-500">Available after program completion</p>
                        </div>
                    </div>
                    <i class="fas fa-briefcase text-gray-300 text-2xl"></i>
                </div>
            </div>
            {% endif %}
            
            <!-- Add Program Button -->
            <div x-data="{ showModal: false, confirmModal: null, limitModal: false }" class="relative mb-6">
                <div class="flex justify-end">
                    <button 
                        @click="{% if has_reached_limit %}limitModal = true{% else %}showModal = true{% endif %}"
                        class="add-button"
                    >
                        <i class="fas fa-plus"></i>
                        New Application
                    </button>
                </div>

                <!-- Limit Modal -->
                <div x-show="limitModal" class="modal-overlay" x-transition>
                    <div class="modal-content">
                        <div class="text-center">
                            <div class="mx-auto w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4">
                                <i class="fas fa-exclamation-triangle text-red-600 text-2xl"></i>
                            </div>
                            <h2 class="text-xl font-bold mb-4 text-gray-800">Maximum Program Limit Reached</h2>
                            <p class="text-gray-600 mb-6">
                                You have reached the maximum limit of 2 program applications. You currently have <strong>{{ total_programs }}</strong> program(s) in your account.
                            </p>
                            <button @click="limitModal = false" class="add-button">
                                Okay!
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Program Selection Modal -->
                <div x-show="showModal" class="modal-overlay" x-transition x-cloak>
                    <div class="modal-content">
                        <h2 class="text-xl font-bold mb-4 text-gray-800">New Application</h2>
                        <div class="space-y-3">
                            {% for prog in Programss %}
                            <div>
                                <a href="javascript:void(0);"
                                   @click="confirmModal = {{ prog.id }}; showModal = false"
                                   class="block p-3 border rounded-lg hover:bg-blue-50 text-blue-700 font-semibold">
                                    {{ prog.program_name }}
                                </a>
                            </div>
                            {% endfor %}
                        </div>
                        <div class="mt-6 text-right">
                            <button @click="showModal = false" class="px-4 py-2 bg-gray-300 text-gray-800 rounded-lg">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Confirmation Modals -->
                {% for prog in Programss %}
                <div x-show="confirmModal === {{ prog.id }}" class="modal-overlay" x-transition x-cloak style="display: none;">
                    <div class="modal-content">
                        <div class="text-center">
                            <h2 class="text-2xl font-bold text-gray-800 mb-4">Confirm Program Enrollment</h2>
                            <p class="text-gray-700 text-lg mb-8">
                                You are about to enroll in the program: <strong>{{ prog.program_name }}</strong>.<br>
                                Would you like to proceed?
                            </p>
                            <div class="flex justify-center gap-4">
                                <form method="POST" action="{% url 'apply_program' prog.id %}">
                                    {% csrf_token %}
                                    <button type="submit" class="add-button">
                                        Yes, Proceed
                                    </button>
                                </form>
                                <button @click="confirmModal = null" class="px-6 py-3 bg-gray-300 text-gray-800 rounded-lg">
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Dashboard Cards -->
            <div class="dashboard-cards">
                <div class="card">
                    <div class="card-title">Program Progress</div>
                    <div class="card-value">{{ overall_percentage|default:0 }}%</div>
                </div>
                <div class="card">
                    <div class="card-title">Current Semester</div>
                    <div class="card-value">{% if current_semester == "1" or current_semester == 1 %}1st{% elif current_semester == "2" or current_semester == 2 %}2nd{% elif current_semester == "3" or current_semester == 3 %}3rd{% else %}{{ current_semester }}th{% endif %}</div>
                    <div class="card-subtitle">Last Active: <span style="color: #28a745; font-weight: 600;">Today</span></div>
                </div>
            </div>


            <!-- My Applications Section -->
            <div class="list-container">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-800">My Applications</h3>
                    <div class="flex gap-2">
                        <select class="px-3 py-1 border border-gray-300 rounded-lg text-sm" id="statusFilter">
                            <option value="all">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="accepted">Accepted</option>
                            <option value="approved">Approved</option>
                            <option value="declined">Declined</option>
                        </select>
                    </div>
                </div>

                <!-- Applications Grid -->
                <div class="grid gap-4">
                    {% for app in applications %}
                    <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow duration-200">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex-1">
                                <h4 class="text-lg font-semibold text-gray-800 mb-2">{{ app.program.program_name }}</h4>
                                <div class="flex items-center gap-4 text-sm text-gray-600 mb-3">
                                    <span><i class="fas fa-calendar-alt mr-1"></i>{{ app.program.program_sched|default:"Schedule TBD" }}</span>
                                    {% if app.program.program_trainor %}
                                    <span><i class="fas fa-user-tie mr-1"></i>{{ app.program.program_trainor }}</span>
                                    {% endif %}
                                    <span><i class="fas fa-layer-group mr-1"></i>Batch {{ current_batch|default:"TBD" }}</span>
                                    <span><i class="fas fa-graduation-cap mr-1"></i>{% if current_semester == "1" or current_semester == 1 %}1st{% elif current_semester == "2" or current_semester == 2 %}2nd{% elif current_semester == "3" or current_semester == 3 %}3rd{% else %}{{ current_semester }}th{% endif %} Semester</span>
                                    <span><i class="fas fa-calendar mr-1"></i>Year {{ app.applied_at.year }}</span>
                                </div>
                                {% if app.program.program_skill %}
                                <div class="flex flex-wrap gap-1 mb-3">
                                    <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-full">{{ app.program.program_skill }}</span>
                                </div>
                                {% endif %}
                            </div>
                            <div class="text-right">
                                {% if app.status == "Pending" %}
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800">
                                        <i class="fas fa-clock mr-1"></i>Pending
                                    </span>
                                {% elif app.status == "Accepted" %}
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                                        <i class="fas fa-check-circle mr-1"></i>Accepted
                                    </span>
                                {% elif app.status == "Declined" %}
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800">
                                        <i class="fas fa-times-circle mr-1"></i>Declined
                                    </span>
                                {% else %}
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-800">
                                        {{ app.status|title }}
                                    </span>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center pt-4 border-t border-gray-100">
                            <div class="text-sm text-gray-500">
                                <i class="fas fa-calendar mr-1"></i>Applied: {{ app.applied_at|date:"M j, Y" }}
                            </div>
                            <div class="flex gap-2">
                                {% if app.status == "Declined" and app.decline_reason %}
                                <button class="px-3 py-1 text-sm text-red-600 hover:bg-red-50 rounded-lg transition-colors" 
                                        onclick="showDeclineReason('{{ app.decline_reason|escapejs }}')">
                                    <i class="fas fa-info-circle mr-1"></i>View Reason
                                </button>
                                {% endif %}
                                <button class="px-3 py-1 text-sm text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">
                                    <i class="fas fa-eye mr-1"></i>View Details
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    
                    {% for approg in approveprog %}
                    <div class="bg-white border border-green-200 rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow duration-200 border-l-4 border-l-green-500">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex-1">
                                <h4 class="text-lg font-semibold text-gray-800 mb-2">{{ approg.program.program_name }}</h4>
                                <div class="flex items-center gap-4 text-sm text-gray-600 mb-3">
                                    <span><i class="fas fa-calendar-alt mr-1"></i>{{ approg.program.program_sched|default:"Schedule TBD" }}</span>
                                    {% if approg.program.program_trainor %}
                                    <span><i class="fas fa-user-tie mr-1"></i>{{ approg.program.program_trainor }}</span>
                                    {% endif %}
                                    <span><i class="fas fa-layer-group mr-1"></i>Batch {{ approg.batch_number|default:"N/A" }}</span>
                                    <span><i class="fas fa-graduation-cap mr-1"></i>{% if current_semester == "1" or current_semester == 1 %}1st{% elif current_semester == "2" or current_semester == 2 %}2nd{% elif current_semester == "3" or current_semester == 3 %}3rd{% else %}{{ current_semester }}th{% endif %} Semester</span>
                                    <span><i class="fas fa-calendar mr-1"></i>Year {{ approg.enrollment_year|default:"N/A" }}</span>
                                </div>
                                {% if approg.program.program_skill %}
                                <div class="flex flex-wrap gap-1 mb-3">
                                    <span class="px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full">{{ approg.program.program_skill }}</span>
                                </div>
                                {% endif %}
                                
                                <!-- Progress Bar -->
                                <div class="mb-3">
                                    <div class="flex justify-between text-sm text-gray-600 mb-1">
                                        <span>Progress</span>
                                        <span>{{ approg.progress|default:0 }}%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-green-500 h-2 rounded-full transition-all duration-300" 
                                             style="width: {{ approg.progress|default:0 }}%"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">
                                    <i class="fas fa-check-double mr-1"></i>Approved
                                </span>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center pt-4 border-t border-gray-100">
                            <div class="text-sm text-gray-500">
                                <i class="fas fa-calendar-check mr-1"></i>Approved: {{ approg.approved_at|date:"M j, Y" }}
                            </div>
                            <div class="flex gap-2">
                                {% if approg.progress >= 100 %}
                                <button class="px-3 py-1 text-sm text-green-600 hover:bg-green-50 rounded-lg transition-colors">
                                    <i class="fas fa-certificate mr-1"></i>View Certificate
                                </button>
                                {% endif %}
                                <button class="px-3 py-1 text-sm text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">
                                    <i class="fas fa-chart-line mr-1"></i>View Progress
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    
                    {% if applications|length == 0 and approveprog|length == 0 %}
                    <div class="text-center py-12">
                        <div class="mx-auto w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-4">
                            <i class="fas fa-file-alt text-gray-400 text-3xl"></i>
                        </div>
                        <h4 class="text-lg font-medium text-gray-900 mb-2">No Applications Yet</h4>
                        <p class="text-gray-500 mb-4">You haven't applied for any programs yet. Start your learning journey today!</p>
                        <button class="add-button" onclick="document.querySelector('[data-section=overview] .add-button').click()">
                            <i class="fas fa-plus mr-2"></i>Apply for Program
                        </button>
                    </div>
                    {% endif %}
                </div>
            </div>

        </div>

        <!-- Include Edit Marked Fields Modal -->
        {% include 'edit_fields_modal.html' %}

        <!-- Profile Section -->
        <div id="profile-section" class="content-section">
            <h2 class="text-2xl font-semibold text-gray-800 mb-5">Profile</h2>
            
            {% if marked_fields %}
            <!-- Correction Alert Banner -->
            <div class="correction-alert">
                <h3>
                    <i class="fas fa-exclamation-triangle"></i>
                    Action Required: Please Correct Your Information
                </h3>
                <p><strong>Your application requires corrections.</strong> The admin has identified the following issues with your profile:</p>
                <ul style="list-style: disc; margin-left: 20px; margin-top: 10px;">
                    <li><strong>Reason:</strong> Incorrect spelling or inappropriate information</li>
                    <li><strong>Fields marked:</strong> Please review the highlighted fields below</li>
                </ul>
                {% if review_notes %}
                <div class="admin-notes">
                    <strong><i class="fas fa-comment-dots"></i> Admin Notes:</strong>
                    <p style="margin-top: 5px;">{{ review_notes }}</p>
                </div>
                {% endif %}
                <p style="margin-top: 15px; font-size: 0.9rem;">
                    <i class="fas fa-info-circle"></i> <strong>What to do:</strong> Click the "Edit Incorrect Fields" button below to update your information.
                </p>
                <div style="margin-top: 20px; display: flex; gap: 15px;">
                    <button onclick="openEditFieldsModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition-all duration-200 shadow-lg hover:shadow-xl">
                        <i class="fas fa-edit"></i> Edit Incorrect Fields
                    </button>
                    <button onclick="resubmitForReview()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold transition-all duration-200 shadow-lg hover:shadow-xl">
                        <i class="fas fa-check-circle"></i> Resubmit for Review
                    </button>
                </div>
            </div>
            {% endif %}
            
            <div class="profile-container">
                <div class="profile-header">
                    <div>
                        <h1 class="text-2xl font-bold text-blue-700">DLL-LMSTC Registration Form</h1>
                        <p class="text-lg font-semibold text-gray-700">LEARNERS PROFILE FORM</p>
                    </div>
                    <div class="profile-photo">
                        <img src="{{profile.id_picture.url}}" alt="Profile Photo">
                    </div>
                </div>

                <div class="form-section">
                    <h2>1. TWMS Auto Generated</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>1.1 Unique Learner Identifier (ULI) Number:</label>
                            <input type="text" value="None" disabled>
                        </div>
                        <div class="form-group">
                            <label>1.2 Entry Date:</label>
                            <input type="text" value="{{profile.entry_date}}" disabled>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>2. Learner/Manpower Profile</h2>
                    <div class="form-grid">
                        <div class="form-group {% if marked_fields.last_name %}field-needs-correction{% endif %}">
                            <label>2.1 Last Name</label>
                            <input type="text" value="{{ profile.last_name}}" disabled>
                        </div>
                        <div class="form-group {% if marked_fields.first_name %}field-needs-correction{% endif %}">
                            <label>First Name</label>
                            <input type="text" value="{{profile.first_name}}" disabled>
                        </div>
                        <div class="form-group {% if marked_fields.middle_name %}field-needs-correction{% endif %}">
                            <label>Middle Name</label>
                            <input type="text" value="{{profile.middle_name}}" disabled>
                        </div>
                        <div class="form-group {% if marked_fields.region %}field-needs-correction{% endif %}">
                            <label>Region</label>
                            <input type="text" value="{{profile.region}}" disabled>
                        </div>
                        <div class="form-group {% if marked_fields.province %}field-needs-correction{% endif %}">
                            <label>Province</label>
                            <input type="text" value="{{profile.province}}" disabled>
                        </div>
                        <div class="form-group {% if marked_fields.city %}field-needs-correction{% endif %}">
                            <label>City</label>
                            <input type="text" value="{{profile.city}}" disabled>
                        </div>
                        <div class="form-group {% if marked_fields.barangay %}field-needs-correction{% endif %}">
                            <label>Barangay</label>
                            <input type="text" value="{{profile.barangay_name}}" disabled>
                        </div>
                        <div class="form-group {% if marked_fields.district %}field-needs-correction{% endif %}">
                            <label>District</label>
                            <input type="text" value="{{profile.district}}" disabled>
                        </div>
                        <div class="form-group {% if marked_fields.street %}field-needs-correction{% endif %}">
                            <label>Street</label>
                            <input type="text" value="{{profile.street}}" disabled>
                        </div>
                        <div class="form-group {% if marked_fields.email %}field-needs-correction{% endif %}">
                            <label>Email</label>
                            <input type="text" value="{{profile.email}}" disabled>
                        </div>
                        <div class="form-group {% if marked_fields.contact_number %}field-needs-correction{% endif %}">
                            <label>Contact Number</label>
                            <input type="text" value="{{profile.contact_number}}" disabled>
                        </div>
                        <div class="form-group {% if marked_fields.nationality %}field-needs-correction{% endif %}">
                            <label>Nationality</label>
                            <input type="text" value="{{profile.nationality}}" disabled>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>3. Personal Information</h2>
                    <div class="form-grid">
                        <div class="form-group {% if marked_fields.sex %}field-needs-correction{% endif %}">
                            <label>3.1 Sex</label>
                            <input type="text" value="{{profile.sex}}" disabled>
                        </div>
                        <div class="form-group {% if marked_fields.civil_status %}field-needs-correction{% endif %}">
                            <label>3.2 Civil Status</label>
                            <input type="text" value="{{profile.civil_status}}" disabled>
                        </div>
                        <div class="form-group {% if marked_fields.employment_status %}field-needs-correction{% endif %}">
                            <label>3.3 Employment Status</label>
                            <input type="text" value="{{profile.employment_status}}" disabled>
                        </div>
                        <div class="form-group {% if marked_fields.monthly_income %}field-needs-correction{% endif %}">
                            <label>Monthly Income</label>
                            <input type="text" value="{{profile.monthly_income}}" disabled>
                        </div>
                        <div class="form-group {% if marked_fields.date_hired %}field-needs-correction{% endif %}">
                            <label>Date Hired</label>
                            <input type="text" value="{{profile.date_hired}}" disabled>
                        </div>
                        <div class="form-group {% if marked_fields.company_name %}field-needs-correction{% endif %}">
                            <label>Company Name</label>
                            <input type="text" value="{{profile.company_name}}" disabled>
                        </div>
                        <div class="form-group {% if marked_fields.birthdate %}field-needs-correction{% endif %}">
                            <label>3.4 Birthdate</label>
                            <input type="text" value="{{profile.birthdate}}" disabled>
                        </div>
                        <div class="form-group">
                            <label>Age</label>
                            <input type="text" value="{{profile.age}}" disabled>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>3.5 Birthplace</h2>
                    <div class="form-grid">
                        <div class="form-group {% if marked_fields.birthplace_region %}field-needs-correction{% endif %}">
                            <label>Birthplace Region</label>
                            <input type="text" value="{{profile.birthplace_regionb_name}}" disabled>
                        </div>
                        <div class="form-group {% if marked_fields.birthplace_province %}field-needs-correction{% endif %}">
                            <label>Birthplace Province</label>
                            <input type="text" value="{{profile.birthplace_provinceb_name}}" disabled>
                        </div>
                        <div class="form-group {% if marked_fields.birthplace_city %}field-needs-correction{% endif %}">
                            <label>Birthplace City/Municipality</label>
                            <input type="text" value="{{profile.birthplace_cityb_name}}" disabled>
                        </div>
                    </div>
                </div>

                <!-- Continue with other sections... -->
                <div class="form-section">
                    <h2>4. Learner/Trainee/Student (Clients) Classification</h2>
                    <div class="form-grid">
                        {% for classification in profile.classifications.all %}
                        <div class="form-group">
                            <label>Classification</label>
                            <input type="text" value="{{ classification.name }}" disabled>
                        </div>
                        {% endfor %}
                        {% if profile.other_classification %}
                        <div class="form-group">
                            <label>Other Classification</label>
                            <input type="text" value="{{ profile.other_classification }}" disabled>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <div class="form-section">
                    <h2>5. Type of Disability (for Persons with Disability Only)</h2>
                    <div class="form-grid">
                        {% for disability in profile.disability_types.all %}
                        <div class="form-group">
                            <label>Disability Type</label>
                            <input type="text" value="{{ disability.name }}" disabled>
                        </div>
                        {% empty %}
                        <div class="form-group">
                            <label>Disability Type</label>
                            <input type="text" value="None" disabled>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="form-section">
                    <h2>6. Causes of Disability (for Persons with Disability Only)</h2>
                    <div class="form-grid">
                        {% for cause in profile.disability_causes.all %}
                        <div class="form-group">
                            <label>Disability Cause</label>
                            <input type="text" value="{{ cause.name }}" disabled>
                        </div>
                        {% empty %}
                        <div class="form-group">
                            <label>Disability Cause</label>
                            <input type="text" value="None" disabled>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="form-section">
                    <h2>7. Course and Scholarship</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Name of Course/Qualification</label>
                            <input type="text" value="{{profile.course_or_qualification}}" disabled>
                        </div>
                        <div class="form-group">
                            <label>Scholarship Package</label>
                            <input type="text" value="{{profile.scholarship_package}}" disabled>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>8. Educational Attainment</h2>
                    <div class="form-grid">
                        <div class="form-group {% if marked_fields.educational_attainment %}field-needs-correction{% endif %}">
                            <label>Educational Attainment</label>
                            <input type="text" value="{{profile.educational_attainment}}" disabled>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>9. Privacy Disclaimer</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Agreed to Privacy Disclaimer</label>
                            <input type="text" value="{% if profile.agree_to_privacy %}Yes{% else %}No{% endif %}" disabled>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>10. Applicant's Signature</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Applicant's Name</label>
                            <input type="text" value="{{profile.applicant_name}}" disabled>
                        </div>
                        <div class="form-group">
                            <label>Date Accomplished</label>
                            <input type="text" value="{{profile.date_accomplished}}" disabled>
                        </div>
                    </div>
                    {% if profile.applicant_signature %}
                    <div class="form-group mt-4">
                        <label>Signature:</label>
                        <div>
                            <img src="{{ profile.applicant_signature.url }}" alt="Applicant Signature" style="max-width: 300px; max-height: 100px;">
                        </div>
                    </div>
                    {% endif %}
                </div>

                <!-- Edit button at the lower right side -->
                <div class="flex justify-end mt-6">
                    <button class="add-button" id="editProfileBtn">
                        <i class="fas fa-edit"></i>
                        Edit Profile
                    </button>
                </div>
            </div>
        </div>

        <!-- Edit Profile Modal -->
        <div id="editProfileModal" class="modal-overlay hidden">
            <div class="modal-content" style="max-width: 800px; max-height: 90vh;">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-gray-800">Edit Profile</h2>
                    <button id="closeModalBtn" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="editProfileForm" method="POST" action="{% url 'update_profile' %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="profile-container" style="max-height: 70vh; overflow-y: auto;">
                        <div class="form-section">
                            <h2>1. TWMS Auto Generated</h2>
                            <fieldset class="form-group">
                                <legend>1.1 Unique Learner Identifier (ULI) Number:</legend>
                                <input type="text" name="uli_number" value="{{ profile.uli_number|default:'None' }}" disabled>
                            </fieldset>
                            <fieldset class="form-group">
                                <legend>1.2 Entry Date:</legend>
                                <input type="date" name="entry_date" value="{{ profile.entry_date|date:'Y-m-d' }}">
                            </fieldset>
                        </div>

                        <div class="form-section">
                            <h2>2. Learner/Manpower Profile</h2>
                            <div class="form-grid">
                                <fieldset class="form-group">
                                    <legend>2.1 Last Name</legend>
                                    <input type="text" name="last_name" value="{{ profile.last_name }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>First Name</legend>
                                    <input type="text" name="first_name" value="{{ profile.first_name }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Middle Name</legend>
                                    <input type="text" name="middle_name" value="{{ profile.middle_name }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Region</legend>
                                    <input type="text" name="region_name" value="{{ profile.region }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Province</legend>
                                    <input type="text" name="province_name" value="{{ profile.province }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>City</legend>
                                    <input type="text" name="city_name" value="{{ profile.city }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Barangay</legend>
                                    <input type="text" name="barangay_name" value="{{ profile.barangay_name }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>District</legend>
                                    <input type="text" name="district" value="{{ profile.district }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Street</legend>
                                    <input type="text" name="street" value="{{ profile.street }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Email</legend>
                                    <input type="email" name="email" value="{{ profile.email }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Contact Number</legend>
                                    <input type="text" name="contact_number" value="{{ profile.contact_number }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Nationality</legend>
                                    <input type="text" name="nationality" value="{{ profile.nationality }}">
                                </fieldset>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2>3. Personal Information</h2>
                            <div class="form-grid">
                                <fieldset class="form-group">
                                    <legend>3.1 Sex</legend>
                                    <select name="sex">
                                        <option value="Male" {% if profile.sex == "Male" %}selected{% endif %}>Male</option>
                                        <option value="Female" {% if profile.sex == "Female" %}selected{% endif %}>Female</option>
                                    </select>
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>3.2 Civil Status</legend>
                                    <select name="civil_status">
                                        <option value="Single" {% if profile.civil_status == "Single" %}selected{% endif %}>Single</option>
                                        <option value="Married" {% if profile.civil_status == "Married" %}selected{% endif %}>Married</option>
                                        <option value="Widower" {% if profile.civil_status == "Widower" %}selected{% endif %}>Widower</option>
                                        <option value="Separated" {% if profile.civil_status == "Separated" %}selected{% endif %}>Separated</option>
                                    </select>
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>3.3 Employment Status</legend>
                                    <select name="employment_status">
                                        <option value="Employed" {% if profile.employment_status == "Employed" %}selected{% endif %}>Employed</option>
                                        <option value="Unemployed" {% if profile.employment_status == "Unemployed" %}selected{% endif %}>Unemployed</option>
                                    </select>
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Monthly Income</legend>
                                    <input type="text" name="monthly_income" value="{{ profile.monthly_income }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Date Hired</legend>
                                    <input type="date" name="date_hired" value="{{ profile.date_hired|date:'Y-m-d' }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Company Name</legend>
                                    <input type="text" name="company_name" value="{{ profile.company_name }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>3.4 Birthdate</legend>
                                    <input type="date" name="birthdate" value="{{ profile.birthdate|date:'Y-m-d' }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Age</legend>
                                    <input type="number" name="age" value="{{ profile.age }}">
                                </fieldset>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2>3.5 Birthplace</h2>
                            <div class="form-grid">
                                <fieldset class="form-group">
                                    <legend>Birthplace Region</legend>
                                    <input type="text" name="birthplace-region-name" value="{{ profile.birthplace_regionb_name }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Birthplace Province</legend>
                                    <input type="text" name="birthplace-province-name" value="{{ profile.birthplace_provinceb_name }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Birthplace City/Municipality</legend>
                                    <input type="text" name="birthplace-city-name" value="{{ profile.birthplace_cityb_name }}">
                                </fieldset>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2>4. Learner/Trainee/Student (Clients) Classification</h2>
                            <div class="form-grid">
                                <fieldset class="form-group">
                                    <legend>Classifications</legend>
                                    <select name="classifications" multiple>
                                        {% for classification in all_classifications %}
                                        <option value="{{ classification.id }}" {% if classification in profile.classifications.all %}selected{% endif %}>
                                            {{ classification.name }}
                                        </option>
                                        {% endfor %}
                                    </select>
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Other Classification</legend>
                                    <input type="text" name="other_classification" value="{{ profile.other_classification }}">
                                </fieldset>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2>5. Type of Disability (for Persons with Disability Only)</h2>
                            <div class="form-grid">
                                <fieldset class="form-group">
                                    <legend>Disability Types</legend>
                                    <select name="disability_types" multiple>
                                        {% for disability in all_disability_types %}
                                        <option value="{{ disability.id }}" {% if disability in profile.disability_types.all %}selected{% endif %}>
                                            {{ disability.name }}
                                        </option>
                                        {% endfor %}
                                    </select>
                                </fieldset>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2>6. Causes of Disability (for Persons with Disability Only)</h2>
                            <div class="form-grid">
                                <fieldset class="form-group">
                                    <legend>Disability Causes</legend>
                                    <select name="disability_causes" multiple>
                                        {% for cause in all_disability_causes %}
                                        <option value="{{ cause.id }}" {% if cause in profile.disability_causes.all %}selected{% endif %}>
                                            {{ cause.name }}
                                        </option>
                                        {% endfor %}
                                    </select>
                                </fieldset>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2>7. Course and Scholarship</h2>
                            <div class="form-grid">
                                <fieldset class="form-group">
                                    <legend>Name of Course/Qualification</legend>
                                    <input type="text" name="course_or_qualification" value="{{ profile.course_or_qualification }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Scholarship Package</legend>
                                    <input type="text" name="scholarship_package" value="{{ profile.scholarship_package }}">
                                </fieldset>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2>8. Educational Attainment</h2>
                            <div class="form-grid">
                                <fieldset class="form-group">
                                    <legend>Educational Attainment</legend>
                                    <input type="text" name="educational_attainment" value="{{ profile.educational_attainment }}">
                                </fieldset>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2>9. Privacy Disclaimer</h2>
                            <div class="form-grid">
                                <fieldset class="form-group">
                                    <legend>
                                        <input type="checkbox" name="agree_to_privacy" {% if profile.agree_to_privacy %}checked{% endif %}>
                                        I agree to the privacy disclaimer
                                    </legend>
                                </fieldset>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2>10. Applicant's Signature</h2>
                            <div class="form-grid">
                                <fieldset class="form-group">
                                    <legend>Applicant's Name</legend>
                                    <input type="text" name="applicant_name" value="{{ profile.applicant_name }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Date Accomplished</legend>
                                    <input type="date" name="date_accomplished" value="{{ profile.date_accomplished|date:'Y-m-d' }}">
                                </fieldset>
                            </div>
                            <fieldset class="form-group mt-4">
                                <legend>Signature:</legend>
                                <input type="file" name="applicant_signature">
                                {% if profile.applicant_signature %}
                                <div class="mt-2">
                                    <img src="{{ profile.applicant_signature.url }}" alt="Current Signature" style="max-width: 300px; max-height: 100px;">
                                </div>
                                {% endif %}
                            </fieldset>
                        </div>
                    </div>
                    <div class="flex justify-end mt-6">
                        <button type="button" id="cancelEditBtn" class="px-4 py-2 bg-gray-300 text-gray-800 rounded-lg mr-2">Cancel</button>
                        <button type="submit" class="add-button">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Include Edit Marked Fields Modal -->
        {% include 'edit_fields_modal.html' %}

        <!-- Schedule Section -->
        <div id="schedule-section" class="content-section">
            <h2 class="text-2xl font-semibold text-gray-800 mb-5">Training Schedule</h2>
            <div class="list-container">
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Time</th>
                                <th>Topic</th>
                                <th>Trainer</th>
                                <th>Location</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for training in trainings %}
                            <tr>
                                <td>{{ training.start_date }}</td>
                                <td>
                                    {{ training.task_time|default:"" }} - {{ training.end_time|default:"" }}
                                </td>
                                <td>{{ training.program_name }}</td>
                                <td>{{ training.trainer.get_full_name|default:training.trainer.username }}</td>
                                <td>{{ training.room_lab }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="text-center text-gray-500">No training sessions found.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Score & Grades Section -->
        <div id="grades-section" class="content-section">
            <h2 class="text-2xl font-semibold text-gray-800 mb-5">Competencies</h2>
            
            <!-- Competencies Summary Cards -->
            <div class="dashboard-cards mb-6">
                <div class="card">
                    <div class="card-title">Basic Competencies</div>
                    <div class="card-value" style="color: #28a745;" id="basic-percentage">{{ basic_percentage|default:0 }}%</div>
                    <div class="card-subtitle">Foundation Skills</div>
                </div>
                <div class="card">
                    <div class="card-title">Common Competencies</div>
                    <div class="card-value" style="color: #4A89DC;" id="common-percentage">{{ common_percentage|default:0 }}%</div>
                    <div class="card-subtitle">Core Skills</div>
                </div>
                <div class="card">
                    <div class="card-title">Core Competencies</div>
                    <div class="card-value" style="color: #f59e0b;" id="core-percentage">{{ core_percentage|default:0 }}%</div>
                    <div class="card-subtitle">Specialized Skills</div>
                </div>
                <div class="card">
                    <div class="card-title">Overall Progress</div>
                    <div class="card-value" style="color: #6F42C1;" id="overall-percentage">{{ overall_percentage|default:0 }}%</div>
                    <div class="card-subtitle">Total Completion</div>
                </div>
            </div>

            <!-- Competencies Details -->
            <div class="list-container">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold text-gray-800">Program Competencies</h3>
                    <div class="flex gap-2">
                        <select class="px-3 py-1 border border-gray-300 rounded-lg text-sm" id="competency-filter">
                            <option value="all">All Competencies</option>
                            <option value="basic">Basic Competencies</option>
                            <option value="common">Common Competencies</option>
                            <option value="core">Core Competencies</option>
                        </select>
                        <button class="add-button text-sm px-4 py-2" onclick="exportCompetencies()">
                            <i class="fas fa-download mr-1"></i>Export Report
                        </button>
                    </div>
                </div>
                
                <!-- Basic Competencies -->
                <div class="mb-6">
                    <h4 class="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                        <i class="fas fa-layer-group text-green-600 mr-2"></i>
                        Basic Competencies
                    </h4>
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <div id="basic-competencies-list" class="space-y-2">
                            <!-- Basic competencies will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Common Competencies -->
                <div class="mb-6">
                    <h4 class="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                        <i class="fas fa-cogs text-blue-600 mr-2"></i>
                        Common Competencies
                    </h4>
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <div id="common-competencies-list" class="space-y-2">
                            <!-- Common competencies will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Core Competencies -->
                <div class="mb-6">
                    <h4 class="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                        <i class="fas fa-star text-yellow-600 mr-2"></i>
                        Core Competencies
                    </h4>
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <div id="core-competencies-list" class="space-y-2">
                            <!-- Core competencies will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Career Opportunities & Progress Visualization -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
                <!-- Career Opportunities -->
                <div class="list-container">
                    <h4 class="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                        <i class="fas fa-briefcase text-purple-600 mr-2"></i>
                        Career Opportunities
                    </h4>
                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                        <div class="mb-4">
                            <p class="text-sm text-purple-800 font-medium mb-2">
                                <i class="fas fa-info-circle mr-1"></i>
                                Skills you will gain after completion of this program:
                            </p>
                            <div id="career-skills-list" class="space-y-2">
                                <!-- Career skills will be populated here -->
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-white rounded-lg border border-purple-200">
                            <p class="text-sm text-gray-700">
                                <strong>Note:</strong> Upon successful completion of this program, you will be equipped with industry-relevant skills and competencies that will open doors to various career opportunities in your chosen field.
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Progress Visualization -->
                <div class="list-container">
                    <h4 class="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                        <i class="fas fa-chart-pie text-indigo-600 mr-2"></i>
                        Progress Visualization
                    </h4>
                    <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-4">
                        <!-- Circular Progress Chart -->
                        <div class="flex justify-center items-center mb-4">
                            <div class="relative w-32 h-32">
                                <svg class="w-32 h-32 transform -rotate-90" viewBox="0 0 120 120">
                                    <!-- Background circle -->
                                    <circle cx="60" cy="60" r="50" stroke="#e5e7eb" stroke-width="8" fill="none"/>
                                    <!-- Progress circle -->
                                    <circle cx="60" cy="60" r="50" stroke="#4f46e5" stroke-width="8" fill="none" 
                                            stroke-dasharray="314" stroke-dashoffset="314" 
                                            id="progress-circle" class="transition-all duration-1000 ease-in-out"/>
                                </svg>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-indigo-600" id="progress-percentage">{{ overall_percentage|default:0 }}%</div>
                                        <div class="text-xs text-gray-600">Complete</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Progress Details -->
                        <div class="space-y-2">
                            <div class="flex justify-between items-center text-sm">
                                <span class="text-gray-600">Basic Competencies</span>
                                <span class="font-semibold text-green-600" id="basic-detail-percentage">{{ basic_percentage|default:0 }}%</span>
                            </div>
                            <div class="flex justify-between items-center text-sm">
                                <span class="text-gray-600">Common Competencies</span>
                                <span class="font-semibold text-blue-600" id="common-detail-percentage">{{ common_percentage|default:0 }}%</span>
                            </div>
                            <div class="flex justify-between items-center text-sm">
                                <span class="text-gray-600">Core Competencies</span>
                                <span class="font-semibold text-yellow-600" id="core-detail-percentage">{{ core_percentage|default:0 }}%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Job Recommendations Section -->
        <div id="jobs-section" class="content-section">
            {% if not is_passer %}
            <!-- Locked Content for Non-Passers -->
            <div class="flex flex-col items-center justify-center py-20">
                <div class="bg-white rounded-lg shadow-xl p-12 max-w-2xl text-center">
                    <div class="mb-6">
                        <i class="fas fa-lock text-6xl text-gray-400 mb-4"></i>
                    </div>
                    <h2 class="text-3xl font-bold text-gray-800 mb-4">Job Recommendations Locked</h2>
                    <p class="text-lg text-gray-600 mb-6">
                        This feature is only available to applicants who have successfully completed a program.
                    </p>
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6">
                        <p class="text-sm text-blue-800">
                            <i class="fas fa-info-circle mr-2"></i>
                            <strong>How to unlock:</strong> Complete your enrolled program and achieve passing status to access personalized job recommendations.
                        </p>
                    </div>
                    <p class="text-sm text-gray-500">
                        Keep up the good work in your training program!
                    </p>
                </div>
            </div>
            {% else %}
            <!-- Unlocked Content for Passers -->
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold text-gray-800">Job Recommendations</h2>
                <button id="refresh-jobs-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors">
                    <i class="fas fa-sync-alt" id="refresh-icon"></i>
                    Refresh PESO Jobs
                </button>
            </div>

            <!-- Statistics Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-white rounded-lg shadow p-4 border-l-4 border-blue-500">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-sm text-gray-600">Total Job Posts</p>
                            <p class="text-2xl font-bold text-gray-800" id="total-jobs-count">0</p>
                        </div>
                        <div class="bg-blue-100 p-3 rounded-full">
                            <i class="fas fa-briefcase text-blue-600"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow p-4 border-l-4 border-green-500">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-sm text-gray-600">Skill Matches</p>
                            <p class="text-2xl font-bold text-gray-800" id="skill-matches-count">0</p>
                        </div>
                        <div class="bg-green-100 p-3 rounded-full">
                            <i class="fas fa-check-circle text-green-600"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow p-4 border-l-4 border-yellow-500">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-sm text-gray-600">New This Week</p>
                            <p class="text-2xl font-bold text-gray-800" id="new-jobs-count">0</p>
                        </div>
                        <div class="bg-yellow-100 p-3 rounded-full">
                            <i class="fas fa-star text-yellow-600"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow p-4 border-l-4 border-purple-500">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-sm text-gray-600">Applications Sent</p>
                            <p class="text-2xl font-bold text-gray-800" id="applications-sent-count">0</p>
                        </div>
                        <div class="bg-purple-100 p-3 rounded-full">
                            <i class="fas fa-paper-plane text-purple-600"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filter and Search -->
            <div class="bg-white rounded-lg shadow p-4 mb-6">
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="flex-1">
                        <input type="text" id="job-search" placeholder="Search jobs by title, company, or skills..." 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div class="flex gap-2">
                        <select id="location-filter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="">All Locations</option>
                            <option value="lucena">Lucena City</option>
                            <option value="quezon">Quezon Province</option>
                            <option value="calabarzon">CALABARZON</option>
                        </select>
                        <button id="clear-filters" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600">
                            Clear
                        </button>
                    </div>
                </div>
            </div>

            <!-- Job Posts Container -->
            <div class="list-container">
                <div id="loading-indicator" class="hidden text-center py-8">
                    <div class="inline-flex items-center">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mr-3"></div>
                        <span class="text-gray-600">Loading PESO job posts...</span>
                    </div>
                </div>

                <div id="jobs-container" class="space-y-4 max-h-[600px] overflow-y-auto">
                    <!-- Job posts will be dynamically loaded here -->
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-briefcase text-4xl mb-4 text-gray-300"></i>
                        <p class="text-lg mb-2">No job posts loaded yet</p>
                        <p class="text-sm">Click "Refresh PESO Jobs" to load the latest opportunities</p>
                    </div>
                </div>

                <!-- Pagination -->
                <div id="pagination" class="hidden flex justify-center items-center mt-6 space-x-2">
                    <button id="prev-page" class="px-3 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 disabled:opacity-50">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <span id="page-info" class="px-4 py-2 text-gray-600">Page 1 of 1</span>
                    <button id="next-page" class="px-3 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 disabled:opacity-50">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Certification Section -->
        <div id="certification-section" class="content-section">
            <h2 class="text-2xl font-semibold text-gray-800 mb-5">Certification</h2>
            <div class="flex justify-center items-center min-h-screen">
                <div class="certificate-container w-full max-w-5xl rounded-xl shadow-2xl overflow-hidden relative p-2" style="background: linear-gradient(90deg, #1e40af 0%, #fbbf24 50%, #1e40af 100%);">
                    <!-- Overlay Buttons (Disabled) -->
                    <div class="absolute top-4 right-4 z-20 flex gap-2">
                        <button class="bg-gray-400 text-white px-3 py-2 rounded-lg shadow-lg cursor-not-allowed opacity-50 flex items-center gap-2 text-sm" disabled title="Download disabled for security">
                            <i class="fas fa-download"></i>
                            Download
                        </button>
                        <button class="bg-gray-400 text-white px-3 py-2 rounded-lg shadow-lg cursor-not-allowed opacity-50 flex items-center gap-2 text-sm" disabled title="Print disabled for security">
                            <i class="fas fa-print"></i>
                            Print
                        </button>
                    </div>
                    <div id="certificate-content" class="relative bg-white px-20 py-16 min-h-[600px] rounded-lg no-select">
                        <!-- Watermark overlay - Only show if user has NOT passed -->
                        {% if not is_passer %}
                        <div class="certificate-watermark"></div>
                        {% endif %}
                <!-- Decorative background elements -->
                <i class="fas fa-graduation-cap absolute left-0 top-1/2 transform -translate-y-1/2 text-yellow-400 opacity-10 text-9xl select-none pointer-events-none"></i>
                <i class="fas fa-star absolute right-0 top-1/2 transform -translate-y-1/2 text-yellow-400 opacity-10 text-9xl select-none pointer-events-none"></i>
                
                <!-- Certificate Header -->
                <div class="text-center mb-10 relative z-10">
                    <div class="mx-auto mb-5 w-24 h-24 rounded-full bg-blue-900 flex items-center justify-center">
                        <img src="{% static 'Images/icon.png' %}" alt="Logo" class="w-20 h-20 object-contain rounded-full" />
                    </div>
                    <h1 class="font-serif text-3xl md:text-4xl font-bold text-blue-900 leading-tight">Lucena Manpower Skill Training Center</h1>
                    <p class="uppercase tracking-wider text-base text-slate-500 font-semibold mt-1">Dalubhasaan ng Lungsod ng Lucena</p>
                </div>
                
                <!-- Certificate Title -->
                <h2 class="text-center font-serif text-4xl font-semibold text-yellow-400 my-8 drop-shadow">Certificate of Completion</h2>
                
                <!-- Certificate Text -->
                <div class="text-center text-lg text-slate-700 my-6">
                    <p>This is to certify that</p>
                </div>
                
                <!-- Recipient Name -->
                <div class="font-serif text-3xl font-bold text-blue-900 text-center my-6 py-4 border-b-4 border-yellow-400 w-full">{{ profile.first_name }} {{ profile.middle_name }} {{ profile.last_name }}</div>
                
                <!-- Course Details -->
                <div class="text-center text-base italic text-slate-500 my-6">
                    <p>has successfully completed the requirements for</p>
                    <p class="font-semibold text-lg text-blue-800">
                        {% if program_info %}
                            {{ program_info.program_name }}
                        {% else %}
                            {{ profile.course_or_qualification|default:'[Program Name]' }}
                        {% endif %}
                    </p>
                    <p>and has demonstrated proficiency in the required skills and competencies.</p>
                    <p class="mt-4">We sincerely thank you for your dedication and commitment in completing this program. We hope you continue to pursue more skills and achieve greater success in your future endeavors.</p>
                </div>
                
                <!-- Certificate Footer -->
                <div class="flex flex-row justify-between items-end mt-16 pt-8 border-t-2 border-slate-200">
                    <div class="flex-1 text-center">
                        <p class="text-sm text-slate-500 font-medium mb-2">
                            {% if trainer_name %}
                                {{ trainer_name }}
                                <br><span class="text-xs">{{ program_info.program_name|default:"Training Program" }}</span>
                            {% else %}
                                Trainer Name
                                <br><span class="text-xs">Training Program</span>
                            {% endif %}
                        </p>
                        <div class="mx-auto w-52 h-0.5 bg-blue-900"></div>
                    </div>
                    <div class="flex-1 text-center">
                        <p class="text-sm text-slate-500 mb-1">Date Issued:</p>
                        <p class="text-base text-blue-900 font-semibold">{{ profile.date_accomplished|date:'F j, Y'|default:'[Date]' }}</p>
                    </div>
                    <div class="flex-1 text-center">
                        <div class="mx-auto w-52 h-0.5 bg-blue-900 mb-2"></div>
                        <p class="text-sm text-slate-500 font-medium">Training Coordinator</p>
                    </div>
                </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Document Management Section -->
        <div id="document-management-section" class="content-section">
            <h2 class="text-2xl font-semibold text-gray-800 mb-5">Document Management</h2>
            
            <!-- Tab Navigation -->
            <div class="tab-navigation mb-6">
                <div class="flex border-b border-gray-200">
                    <button class="tab-button active" data-tab="id-photo">
                        <i class="fas fa-id-card mr-2"></i>
                        My ID Photo
                    </button>
                    <button class="tab-button" data-tab="my-profile">
                        <i class="fas fa-user mr-2"></i>
                        My Profile
                    </button>
                </div>
            </div>

            <!-- Tab Content -->
            <div class="tab-content">
                <!-- My ID Photo Tab -->
                <div id="id-photo-tab" class="tab-panel active">
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-semibold text-gray-800">My ID Photo</h3>
                            <button id="change-id-photo" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200 flex items-center">
                                <i class="fas fa-camera mr-2"></i>
                                Change ID Photo
                            </button>
                        </div>
                        <div class="text-center">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">My ID Photo</h3>
                            
                            {% if profile.id_picture %}
                                <div class="inline-block border-4 border-gray-200 rounded-lg p-4 bg-gray-50">
                                    <img src="{{ profile.id_picture.url }}" 
                                         alt="ID Photo" 
                                         id="id-photo-thumbnail"
                                         class="w-48 h-60 object-cover rounded-lg shadow-md cursor-pointer"
                                         style="max-width: 200px; max-height: 250px;">
                                </div>
                                <div class="mt-4">
                                    <p class="text-sm text-gray-600 mb-2">Uploaded ID Photo</p>
                                    <div class="flex justify-center gap-2">
                                        <button id="view-full-size-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm">
                                            <i class="fas fa-eye mr-1"></i>
                                            View Full Size
                                        </button>
                                    </div>
                                </div>
                            {% else %}
                                <div class="text-center py-12">
                                    <i class="fas fa-image text-6xl text-gray-300 mb-4"></i>
                                    <h4 class="text-lg font-semibold text-gray-600 mb-2">No ID Photo Uploaded</h4>
                                    <p class="text-gray-500 mb-4">You haven't uploaded an ID photo yet.</p>
                                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 max-w-md mx-auto">
                                        <p class="text-yellow-800 text-sm">
                                            <i class="fas fa-info-circle mr-2"></i>
                                            Contact your administrator to upload your ID photo.
                                        </p>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- My Profile Tab -->
                <div id="my-profile-tab" class="tab-panel">
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-semibold text-gray-800">My Profile Information</h3>
                            <div class="flex gap-3">
                                <button id="download-profile-pdf" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200 flex items-center">
                                    <i class="fas fa-download mr-2"></i>
                                    Download PDF
                                </button>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- Personal Information -->
                            <div class="space-y-4">
                                <h4 class="text-md font-semibold text-gray-700 border-b border-gray-200 pb-2">
                                    <i class="fas fa-user mr-2"></i>Personal Information
                                </h4>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Full Name</label>
                                    <p class="text-gray-800 font-medium">{{ profile.last_name }}, {{ profile.first_name }} {{ profile.middle_name|default:"" }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Email</label>
                                    <p class="text-gray-800">{{ profile.email }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Contact Number</label>
                                    <p class="text-gray-800">{{ profile.contact_number|default:"Not provided" }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Sex</label>
                                    <p class="text-gray-800">{{ profile.sex|default:"Not specified" }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Civil Status</label>
                                    <p class="text-gray-800">{{ profile.civil_status|default:"Not specified" }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Birthdate</label>
                                    <p class="text-gray-800">{{ profile.birthdate|default:"Not provided" }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Age</label>
                                    <p class="text-gray-800">{{ profile.age|default:"Not provided" }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Nationality</label>
                                    <p class="text-gray-800">{{ profile.nationality|default:"Not specified" }}</p>
                                </div>
                            </div>

                            <!-- Address Information -->
                            <div class="space-y-4">
                                <h4 class="text-md font-semibold text-gray-700 border-b border-gray-200 pb-2">
                                    <i class="fas fa-map-marker-alt mr-2"></i>Address Information
                                </h4>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Region</label>
                                    <p class="text-gray-800">{{ profile.region_name|default:profile.region }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Province</label>
                                    <p class="text-gray-800">{{ profile.province_name|default:profile.province }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">City</label>
                                    <p class="text-gray-800">{{ profile.city_name|default:profile.city }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Barangay</label>
                                    <p class="text-gray-800">{{ profile.barangay_name|default:profile.barangay }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Street</label>
                                    <p class="text-gray-800">{{ profile.street|default:"Not provided" }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">District</label>
                                    <p class="text-gray-800">{{ profile.district|default:"Not applicable" }}</p>
                                </div>
                            </div>

                            <!-- Employment Information -->
                            <div class="space-y-4">
                                <h4 class="text-md font-semibold text-gray-700 border-b border-gray-200 pb-2">
                                    <i class="fas fa-briefcase mr-2"></i>Employment Information
                                </h4>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Employment Status</label>
                                    <p class="text-gray-800">{{ profile.employment_status|default:"Not specified" }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Monthly Income</label>
                                    <p class="text-gray-800">{{ profile.monthly_income|default:"Not specified" }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Company Name</label>
                                    <p class="text-gray-800">{{ profile.company_name|default:"Not specified" }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Date Hired</label>
                                    <p class="text-gray-800">{{ profile.date_hired|default:"Not specified" }}</p>
                                </div>
                            </div>

                            <!-- Educational Information -->
                            <div class="space-y-4">
                                <h4 class="text-md font-semibold text-gray-700 border-b border-gray-200 pb-2">
                                    <i class="fas fa-graduation-cap mr-2"></i>Educational Information
                                </h4>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Educational Attainment</label>
                                    <p class="text-gray-800">{{ profile.educational_attainment|default:"Not specified" }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Course/Qualification</label>
                                    <p class="text-gray-800">{{ profile.course_or_qualification|default:"Not specified" }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Scholarship Package</label>
                                    <p class="text-gray-800">{{ profile.scholarship_package|default:"Not specified" }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Parent/Guardian</label>
                                    <p class="text-gray-800">{{ profile.parent_guardian|default:"Not specified" }}</p>
                                </div>
                            </div>
                        </div>

                        <!-- Additional Information -->
                        <div class="mt-8 pt-6 border-t border-gray-200">
                            <h4 class="text-md font-semibold text-gray-700 mb-4">
                                <i class="fas fa-info-circle mr-2"></i>Additional Information
                            </h4>
                            
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div class="space-y-4">
                                    <div class="profile-field">
                                        <label class="text-sm font-medium text-gray-600">Birthplace</label>
                                        <p class="text-gray-800">
                                            {% if profile.birthplace_regionb_name %}
                                                {{ profile.birthplace_regionb_name }}, {{ profile.birthplace_provinceb_name }}, {{ profile.birthplace_cityb_name }}
                                            {% else %}
                                                Not specified
                                            {% endif %}
                                        </p>
                                    </div>
                                    
                                    <div class="profile-field">
                                        <label class="text-sm font-medium text-gray-600">Permanent Address</label>
                                        <p class="text-gray-800">{{ profile.permanent_address|default:"Not specified" }}</p>
                                    </div>
                                </div>
                                
                                <div class="space-y-4">
                                    <div class="profile-field">
                                        <label class="text-sm font-medium text-gray-600">Entry Date</label>
                                        <p class="text-gray-800">{{ profile.entry_date|default:"Not specified" }}</p>
                                    </div>
                                    
                                    <div class="profile-field">
                                        <label class="text-sm font-medium text-gray-600">Date Accomplished</label>
                                        <p class="text-gray-800">{{ profile.date_accomplished|default:"Not specified" }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ticket Section -->
        <div id="ticket-section" class="content-section">
            <h2 class="text-2xl font-semibold text-gray-800 mb-5">Support Tickets</h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Create New Ticket -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-lg shadow">
                        <div class="p-6 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Submit a Support Ticket</h3>
                            <form id="ticketForm">
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Ticket Category</label>
                                    <select id="ticketCategory" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        <option value="">Select a category...</option>
                                        <option value="academic">Academic/Training Issues</option>
                                        <option value="technical">Technical Issues</option>
                                        <option value="administrative">Administrative Issues</option>
                                        <option value="facility">Facility/Equipment Issues</option>
                                        <option value="assessment">Assessment/Certification Issues</option>
                                        <option value="general">General Complaints/Feedback</option>
                                    </select>
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Priority Level</label>
                                    <select id="ticketPriority" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        <option value="low">Low - General inquiry</option>
                                        <option value="medium" selected>Medium - Standard issue</option>
                                        <option value="high">High - Urgent matter</option>
                                        <option value="critical">Critical - Emergency</option>
                                    </select>
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Send to</label>
                                    <select id="ticketRecipient" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        <option value="admin">Admin Support</option>
                                        <option value="trainer">My Trainer</option>
                                        <option value="both">Both Admin & Trainer</option>
                                    </select>
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Subject</label>
                                    <input type="text" id="ticketSubject" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Brief description of your issue">
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                                    <textarea id="ticketDescription" rows="5" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Please provide detailed information about your issue or complaint..."></textarea>
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Attachment (Optional)</label>
                                    <input type="file" id="ticketAttachment" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" accept=".jpg,.jpeg,.png,.pdf,.doc,.docx">
                                    <p class="text-xs text-gray-500 mt-1">Supported formats: JPG, PNG, PDF, DOC, DOCX (Max 5MB)</p>
                                </div>
                                
                                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium">
                                    <i class="fas fa-paper-plane mr-2"></i>Submit Ticket
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                
                <!-- My Tickets -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-lg shadow">
                        <div class="p-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">My Tickets</h3>
                            <p class="text-sm text-gray-600 mt-1">Track your submitted tickets</p>
                        </div>
                        <div class="max-h-96 overflow-y-auto">
                            {% if user_tickets %}
                                {% for ticket in user_tickets %}
                                <div class="p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer" onclick="window.location.href='{% url 'view_ticket' ticket.id %}'">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <div class="flex items-center mb-2">
                                                {% if ticket.status == 'open' %}
                                                <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full mr-2">OPEN</span>
                                                {% elif ticket.status == 'in_progress' %}
                                                <span class="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-full mr-2">IN PROGRESS</span>
                                                {% elif ticket.status == 'resolved' %}
                                                <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full mr-2">RESOLVED</span>
                                                {% else %}
                                                <span class="bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded-full mr-2">CLOSED</span>
                                                {% endif %}
                                                
                                                {% if ticket.priority == 'high' %}
                                                <span class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full">HIGH</span>
                                                {% elif ticket.priority == 'medium' %}
                                                <span class="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-full">MEDIUM</span>
                                                {% else %}
                                                <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">LOW</span>
                                                {% endif %}
                                            </div>
                                            <div class="flex items-center mb-1">
                                                <span class="text-xs text-gray-500 mr-2">#{{ ticket.ticket_id }}</span>
                                                <h4 class="font-medium text-gray-800 text-sm">{{ ticket.subject }}</h4>
                                            </div>
                                            <p class="text-xs text-gray-600 mt-1">{{ ticket.description|truncatewords:10 }}</p>
                                            <div class="flex items-center text-xs text-gray-500 mt-2">
                                                <i class="fas fa-clock mr-1"></i>
                                                <span>{{ ticket.created_at|timesince }} ago</span>
                                                <span class="mx-2">‚Ä¢</span>
                                                <i class="fas fa-user mr-1"></i>
                                                <span>{{ ticket.get_recipient_display }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            {% else %}
                                <div class="p-8 text-center">
                                    <i class="fas fa-ticket-alt text-4xl text-gray-300 mb-3"></i>
                                    <p class="text-gray-500">No tickets submitted yet</p>
                                    <p class="text-xs text-gray-400 mt-1">Submit a ticket to get support</p>
                                </div>
                            {% endif %}
                        </div>
                        
                        <!-- Ticket Categories Help -->
                        <div class="p-4 bg-gray-50">
                            <h4 class="text-sm font-semibold text-gray-800 mb-2">Common Issues:</h4>
                            <ul class="text-xs text-gray-600 space-y-1">
                                <li>‚Ä¢ Schedule conflicts or class changes</li>
                                <li>‚Ä¢ Equipment or facility problems</li>
                                <li>‚Ä¢ Assessment or certification issues</li>
                                <li>‚Ä¢ Technical platform problems</li>
                                <li>‚Ä¢ Administrative concerns</li>
                                <li>‚Ä¢ General feedback or complaints</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Certification Section -->
        <div id="certification-section" class="content-section">
            <h2 class="text-2xl font-semibold text-gray-800 mb-5">Certification</h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Available Certifications -->
                <div class="bg-white rounded-lg shadow">
                    <div class="p-6 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-800">Available Certifications</h3>
                        <p class="text-sm text-gray-600 mt-1">Certifications you can apply for based on your completed programs</p>
                    </div>
                    <div class="p-6">
                        <!-- Certification Item -->
                        <div class="border border-gray-200 rounded-lg p-4 mb-4">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <h4 class="font-semibold text-gray-800">Automotive Servicing NC II</h4>
                                    <p class="text-sm text-gray-600 mt-1">National Certificate Level II in Automotive Servicing</p>
                                    <div class="flex items-center mt-2">
                                        <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full mr-2">Eligible</span>
                                        <span class="text-xs text-gray-500">Program Completed: 95%</span>
                                    </div>
                                </div>
                                <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm ml-4">
                                    Apply
                                </button>
                            </div>
                        </div>

                        <!-- Another Certification -->
                        <div class="border border-gray-200 rounded-lg p-4 mb-4">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <h4 class="font-semibold text-gray-800">Welding NC I</h4>
                                    <p class="text-sm text-gray-600 mt-1">National Certificate Level I in Welding</p>
                                    <div class="flex items-center mt-2">
                                        <span class="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-full mr-2">In Progress</span>
                                        <span class="text-xs text-gray-500">Program Completed: 65%</span>
                                    </div>
                                </div>
                                <button class="bg-gray-400 text-white px-4 py-2 rounded-lg text-sm ml-4 cursor-not-allowed" disabled>
                                    Not Ready
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- My Certificates -->
                <div class="bg-white rounded-lg shadow">
                    <div class="p-6 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-800">My Certificates</h3>
                        <p class="text-sm text-gray-600 mt-1">Your earned certificates and their status</p>
                    </div>
                    <div class="p-6">
                        <!-- Certificate Item -->
                        <div class="border border-gray-200 rounded-lg p-4 mb-4">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <h4 class="font-semibold text-gray-800">Computer Systems Servicing NC II</h4>
                                    <p class="text-sm text-gray-600 mt-1">Issued: March 15, 2024</p>
                                    <p class="text-sm text-gray-600">Certificate No: CSS-2024-001234</p>
                                    <div class="flex items-center mt-2">
                                        <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Valid</span>
                                    </div>
                                </div>
                                <div class="flex flex-col space-y-2 ml-4">
                                    <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm">
                                        <i class="fas fa-download mr-2"></i>Download
                                    </button>
                                    <button class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm">
                                        <i class="fas fa-eye mr-2"></i>View
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- No certificates message -->
                        <div class="text-center py-8 text-gray-500">
                            <i class="fas fa-certificate text-4xl mb-4"></i>
                            <p>Complete your programs to earn certificates</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Admin Approval Notice Modal -->
    <div id="adminApprovalModal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; display: none; z-index: 2000; background-color: rgba(0, 0, 0, 0.5);">
        <div class="modal-content" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); max-width: 500px; text-align: center;">
            <div class="text-center">
                <!-- Close button -->
                <div class="flex justify-end mb-2">
                    <button id="closeAdminApprovalModal" class="text-gray-500 hover:text-gray-700" style="background: none; border: none; font-size: 1.5rem;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4">
                    <i class="fas fa-hourglass-half text-blue-600 text-2xl"></i>
                </div>
                <h2 class="text-xl font-bold mb-4 text-gray-800">Application Under Review</h2>
                <p class="text-gray-600 mb-6">
                    Your application is currently being reviewed by an administrator.
                    Please wait patiently while we process your request.
                    You will be notified once your application has been approved.
                </p>
                <!-- Navigation buttons -->
                <div class="flex justify-center gap-4 mt-6">
                    <button id="dismissAdminModal" class="add-button">
                        <i class="fas fa-check"></i>
                        Got it!
                    </button>
                    <a href="{% url 'Homepage_user' %}" class="add-button">
                        <i class="fas fa-home"></i>
                        Homepage
                    </a>
                </div>
                <div class="mt-4">
                    <p class="text-sm text-gray-500">
                        This notice will disappear automatically once your application is approved.
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Application Success Modal -->
    <div id="applicationModal" class="modal fade success-modal" tabindex="-1" aria-labelledby="applicationModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content fade-in">
                <div class="modal-header">
                    <h5 class="modal-title" id="applicationModalLabel">
                        <i class="fas fa-check-circle me-2"></i>üéâ Congratulations!
                    </h5>
                </div>
                <div class="modal-body p-4">
                    <div class="text-center mb-4">
                        <div class="success-icon mb-3">
                            <i class="fas fa-trophy text-warning" style="font-size: 3rem;"></i>
                        </div>
                        <h4 class="text-success mb-2">
                            <strong>Successful application for {{ applied_program_name }}!</strong>
                        </h4>
                        <p class="text-muted">Check your account regularly for future updates.</p>
                    </div>
                    
                    <div class="application-progress">
                        <h6 class="mb-3 text-dark">Application Progress:</h6>
                        <div class="list-group">
                            <div class="list-group-item progress-item completed d-flex align-items-center">
                                <i class="fas fa-check-circle text-success me-3"></i>
                                <span><strong>Online Application Submission</strong></span>
                            </div>
                            <div class="list-group-item progress-item pending d-flex align-items-center">
                                <i class="far fa-circle text-muted me-3"></i>
                                <span>Online Application Processing</span>
                            </div>
                            <div class="list-group-item progress-item pending d-flex align-items-center">
                                <i class="far fa-circle text-muted me-3"></i>
                                <span>Review of Application</span>
                            </div>
                            <div class="list-group-item progress-item pending d-flex align-items-center">
                                <i class="far fa-circle text-muted me-3"></i>
                                <span>Orientation Attendance Confirmation</span>
                            </div>
                            <div class="list-group-item progress-item pending d-flex align-items-center">
                                <i class="far fa-circle text-muted me-3"></i>
                                <span>Application Approval</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-warning mt-4" role="alert">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Important Note:</strong> Failure to attend the orientation will result in your application being denied.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success btn-lg px-4" onclick="closeApplicationModal()">
                        <i class="fas fa-check me-2"></i>Got it, Thanks!
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Application Approved Congratulatory Modal -->
    <div id="applicationApprovedModal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; display: none; z-index: 2000; background-color: rgba(0, 0, 0, 0.5);">
        <div class="modal-content" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); max-width: 500px; text-align: center;">
            <div class="text-center">
                <div class="mx-auto w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4">
                    <i class="fas fa-check-circle text-green-600 text-2xl"></i>
                </div>
                <h2 class="text-xl font-bold mb-4 text-gray-800">Congratulations!</h2>
                <p class="text-gray-600 mb-6">
                    Your application has been approved!
                    You can now proceed with the next steps of the program.
                </p>
                <div class="mt-4">
                    <button id="closeApprovedModalBtn" class="add-button">
                        <i class="fas fa-times"></i>
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Initialize Chart
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize section switching first (most important for navigation)
            initializeSectionSwitching();
            // Initialize notifications
            initializeNotifications();
            
            // Initialize charts with error handling
            try {
                const chartElement = document.getElementById('completionChart');
                if (chartElement) {
                    const ctx = chartElement.getContext('2d');
                    // Get the approved count and total programs from the template context
                    const approvedCount = parseInt("{{ approved_count|default:0 }}");
                    const totalPrograms = parseInt("{{ total_programs|default:0 }}");
                    const remainingCount = totalPrograms > approvedCount ? totalPrograms - approvedCount : 0;
                    
                    new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Complete', 'Remaining'],
                            datasets: [{
                                data: [approvedCount, remainingCount],
                                backgroundColor: ['#60A5FA', '#F87171'],
                                borderColor: '#1E3A8A',
                                borderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            cutout: '50%',
                            plugins: {
                                legend: {
                                    display: true,
                                    position: 'bottom',
                                    labels: {
                                        color: 'white'
                                    }
                                }
                            }
                        }
                    });
                }
                
                // Initialize Grade Chart
                initializeGradeChart();
            } catch (error) {
                console.log('Chart initialization failed:', error);
                // Navigation will still work even if charts fail
            }
        });

        // Section switching functionality
        function initializeSectionSwitching() {
            const sidebarLinks = document.querySelectorAll('.sidebar-nav a[data-section]');
            const contentSections = document.querySelectorAll('.content-section');

            function showSection(sectionId) {
                contentSections.forEach(section => {
                    section.classList.remove('active');
                });
                document.getElementById(sectionId + '-section').classList.add('active');

                sidebarLinks.forEach(link => {
                    link.classList.remove('active');
                });
                document.querySelector(`.sidebar-nav a[data-section="${sectionId}"]`).classList.add('active');
            }

            sidebarLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const sectionId = this.dataset.section;
                    showSection(sectionId);
                });
            });
        }

        // Notification functionality
        function initializeNotifications() {
            const bellBtn = document.getElementById('bell-btn');
            const notificationBox = document.getElementById('notification-box');
            const notificationBadge = document.getElementById('notification-badge');
            const notificationsList = document.getElementById('notifications-list');
            const markAllReadBtn = document.getElementById('mark-all-read');

            // Toggle notification box
            bellBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                notificationBox.classList.toggle('hidden');
                if (!notificationBox.classList.contains('hidden')) {
                    loadNotifications();
                }
            });

            // Close notification box when clicking outside
            document.addEventListener('click', function(e) {
                if (!notificationBox.contains(e.target) && !bellBtn.contains(e.target)) {
                    notificationBox.classList.add('hidden');
                }
            });

            // Load notifications
            function loadNotifications() {
                fetch('/get-notifications/')
                    .then(response => response.json())
                    .then(data => {
                        updateNotificationBadge(data.unread_count);
                        renderNotifications(data.notifications);
                    })
                    .catch(error => {
                        console.error('Error loading notifications:', error);
                        notificationsList.innerHTML = '<div class="p-4 text-center text-red-500">Error loading notifications</div>';
                    });
            }

            // Update notification badge
            function updateNotificationBadge(count) {
                if (count > 0) {
                    notificationBadge.textContent = count > 99 ? '99+' : count;
                    notificationBadge.classList.remove('hidden');
                } else {
                    notificationBadge.classList.add('hidden');
                }
            }

            // Render notifications
            function renderNotifications(notifications) {
                if (notifications.length === 0) {
                    notificationsList.innerHTML = '<div class="p-4 text-center text-gray-500">No notifications</div>';
                    return;
                }

                const notificationsHTML = notifications.map(notification => `
                    <div class="notification-item ${notification.is_read ? 'opacity-60' : ''}"
                         data-notification-id="${notification.id}">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <h4 class="font-semibold text-sm ${notification.is_read ? 'text-gray-600' : 'text-blue-600'}">${notification.title}</h4>
                                <p class="text-xs text-gray-600 mt-1">${notification.message}</p>
                                <p class="text-xs text-gray-400 mt-1">${notification.created_at}</p>
                            </div>
                            ${!notification.is_read ? '<div class="w-2 h-2 bg-blue-500 rounded-full ml-2 mt-1"></div>' : ''}
                        </div>
                    </div>
                `).join('');

                notificationsList.innerHTML = notificationsHTML;

                // Add click handlers for individual notifications
                document.querySelectorAll('.notification-item').forEach(item => {
                    item.addEventListener('click', function() {
                        const notificationId = this.dataset.notificationId;
                        markNotificationAsRead(notificationId);
                    });
                });
            }

            // Mark notification as read
            function markNotificationAsRead(notificationId) {
                fetch(`/mark-notification-read/${notificationId}/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken'),
                        'Content-Type': 'application/json',
                    },
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        loadNotifications(); // Reload to update the display
                    }
                })
                .catch(error => console.error('Error marking notification as read:', error));
            }

            // Mark all notifications as read
            if (markAllReadBtn) {
                markAllReadBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const csrfToken = getCookie('csrftoken');
                    if (!csrfToken) {
                        console.error('CSRF token not found');
                        showNotification('Authentication error. Please refresh the page and try again.', 'error');
                        return;
                    }
                    
                    // Show loading state
                    markAllReadBtn.textContent = 'Marking...';
                    markAllReadBtn.disabled = true;
                    
                    // Use the absolute URL for the endpoint
                    fetch('/mark-all-notifications-read/', {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': csrfToken,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({})
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data.success) {
                            showNotification('All notifications marked as read!', 'success');
                            loadNotifications();
                            updateNotificationBadge(0);
                        } else {
                            throw new Error(data.error || 'Unknown error');
                        }
                    })
                    .catch(error => {
                        console.error('Error marking all notifications as read:', error);
                        showNotification('Failed to mark notifications as read. Please try again.', 'error');
                    })
                    .finally(() => {
                        // Reset button state
                        markAllReadBtn.textContent = 'Mark all read';
                        markAllReadBtn.disabled = false;
                    });
                });
            }

            // Load notifications on page load
            loadNotifications();

            // Auto-refresh notifications every 30 seconds
            setInterval(loadNotifications, 30000);
        }

        // Get CSRF token
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    // Check if this cookie string begins with the name we want
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            // Trim any whitespace that might have been introduced
            return cookieValue ? cookieValue.trim() : null;
        }


        // Application modal functions
        function closeApplicationModal() {
            const modal = document.getElementById('applicationModal');
            const bootstrapModal = bootstrap.Modal.getInstance(modal);
            if (bootstrapModal) {
                bootstrapModal.hide();
            }

            // Clear the session flag via AJAX
            fetch('{% url "clear_modal_session" %}', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/json',
                },
            });
        }

        // Show modal if session flag is set
        document.addEventListener('DOMContentLoaded', function() {
            // Check if show_modal is true (passed from Django view)
            const body = document.querySelector('body');
            const showModal = body && body.dataset.showModal === 'true';
            if (showModal) {
                const modal = new bootstrap.Modal(document.getElementById('applicationModal'), {
                    backdrop: 'static',
                    keyboard: false
                });
                modal.show();
            }
            
            // Show admin approval modal for users with pending applications
            // Only show once per session and only on the overview section
            const hasPendingApplications = Array.from(document.querySelectorAll('.inline-flex')).some(badge => 
                badge.textContent.toLowerCase().includes('pending')
            );
            
            const overviewSection = document.getElementById('overview-section');
            const isOverviewActive = overviewSection && overviewSection.classList.contains('active');
            
            // Check if modal has been shown in this session
            const modalShownThisSession = sessionStorage.getItem('adminApprovalModalShown');
            
            if (hasPendingApplications && isOverviewActive && !modalShownThisSession) {
                // Show the admin approval modal
                const adminModal = document.getElementById('adminApprovalModal');
                if (adminModal) {
                    adminModal.style.display = 'block';
                    // Mark as shown for this session
                    sessionStorage.setItem('adminApprovalModalShown', 'true');
                }
            }
        });

        // Edit Profile Modal Functionality
        document.addEventListener('DOMContentLoaded', function() {
            const editProfileBtn = document.getElementById('editProfileBtn');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const cancelEditBtn = document.getElementById('cancelEditBtn');
            const editProfileModal = document.getElementById('editProfileModal');
            const editProfileForm = document.getElementById('editProfileForm');

            // Open modal
            editProfileBtn.addEventListener('click', function() {
                editProfileModal.classList.remove('hidden');
            });

            // Close modal
            closeModalBtn.addEventListener('click', function() {
                editProfileModal.classList.add('hidden');
            });

            cancelEditBtn.addEventListener('click', function() {
                editProfileModal.classList.add('hidden');
            });

            // Close modal when clicking outside
            editProfileModal.addEventListener('click', function(e) {
                if (e.target === editProfileModal) {
                    editProfileModal.classList.add('hidden');
                }
            });

            // Form submission
            editProfileForm.addEventListener('submit', function(e) {
                // Add any validation here if needed
                // For now, we'll let the form submit normally
            });
        });

        // Application Approved Modal Functionality
        document.addEventListener('DOMContentLoaded', function() {
            const closeApprovedModalBtn = document.getElementById('closeApprovedModalBtn');
            const applicationApprovedModal = document.getElementById('applicationApprovedModal');

            // Close modal
            if (closeApprovedModalBtn) {
                closeApprovedModalBtn.addEventListener('click', function() {
                    applicationApprovedModal.style.display = 'none';
                });
            }

            // Close modal when clicking outside
            if (applicationApprovedModal) {
                applicationApprovedModal.addEventListener('click', function(e) {
                    if (e.target === applicationApprovedModal) {
                        applicationApprovedModal.style.display = 'none';
                    }
                });
            }
        });

        // Admin Approval Modal Functionality
        document.addEventListener('DOMContentLoaded', function() {
            const closeAdminApprovalModal = document.getElementById('closeAdminApprovalModal');
            const dismissAdminModal = document.getElementById('dismissAdminModal');
            const adminApprovalModal = document.getElementById('adminApprovalModal');

            // Close modal function - keeps sessionStorage so it won't show again this session
            function closeAdminModal() {
                if (adminApprovalModal) {
                    adminApprovalModal.style.display = 'none';
                }
            }

            // Close modal via X button
            if (closeAdminApprovalModal) {
                closeAdminApprovalModal.addEventListener('click', closeAdminModal);
            }

            // Close modal via "Got it!" button
            if (dismissAdminModal) {
                dismissAdminModal.addEventListener('click', closeAdminModal);
            }

            // Don't allow clicking outside to close this modal - it's important
            // User must click X or "Got it!" button to dismiss
        });

        // Status filter functionality for My Applications
        document.getElementById('statusFilter').addEventListener('change', function() {
            const selectedStatus = this.value.toLowerCase();
            const applicationCards = document.querySelectorAll('#overview-section .grid.gap-4 > div');
            
            applicationCards.forEach(card => {
                const statusBadge = card.querySelector('.inline-flex');
                if (!statusBadge) return;
                
                const cardStatus = statusBadge.textContent.toLowerCase().trim();
                
                if (selectedStatus === 'all' || cardStatus.includes(selectedStatus)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });

        // Show decline reason modal
        function showDeclineReason(reason) {
            alert('Decline Reason:\n\n' + reason);
        }

        // Job Recommendations Functionality
        document.addEventListener('DOMContentLoaded', function() {
            let currentPage = 1;
            let totalPages = 1;
            let jobsData = [];
            let filteredJobs = [];

            // DOM Elements
            const refreshBtn = document.getElementById('refresh-jobs-btn');
            const refreshIcon = document.getElementById('refresh-icon');
            const loadingIndicator = document.getElementById('loading-indicator');
            const jobsContainer = document.getElementById('jobs-container');
            const searchInput = document.getElementById('job-search');
            const locationFilter = document.getElementById('location-filter');
            const skillFilter = document.getElementById('skill-filter');
            const clearFiltersBtn = document.getElementById('clear-filters');
            const viewAllJobsBtn = document.getElementById('view-all-jobs');
            const pagination = document.getElementById('pagination');
            const prevPageBtn = document.getElementById('prev-page');
            const nextPageBtn = document.getElementById('next-page');
            const pageInfo = document.getElementById('page-info');

            // Statistics counters
            const totalJobsCount = document.getElementById('total-jobs-count');
            const skillMatchesCount = document.getElementById('skill-matches-count');
            const newJobsCount = document.getElementById('new-jobs-count');
            const applicationsSentCount = document.getElementById('applications-sent-count');

            // Mock PESO job data (in real implementation, this would come from web scraping)
            const mockPesoJobs = [
                {
                    id: 1,
                    title: "Software Developer",
                    company: "TechCorp Philippines",
                    location: "Lucena City",
                    description: "Develop and maintain web applications using modern technologies",
                    skills: ["JavaScript", "Python", "React", "Django"],
                    salary: "‚Ç±35,000 - ‚Ç±50,000",
                    type: "Full-time",
                    posted: "2024-01-15",
                    isNew: true,
                    matchScore: 95
                },
                {
                    id: 2,
                    title: "Automotive Technician",
                    company: "AutoFix Services",
                    location: "Quezon Province",
                    description: "Diagnose and repair automotive systems and components",
                    skills: ["Automotive Repair", "Diagnostics", "Engine Maintenance"],
                    salary: "‚Ç±25,000 - ‚Ç±35,000",
                    type: "Full-time",
                    posted: "2024-01-14",
                    isNew: true,
                    matchScore: 88
                },
                {
                    id: 3,
                    title: "Web Designer",
                    company: "Creative Studio Inc",
                    location: "Lucena City",
                    description: "Create visually appealing and user-friendly website designs",
                    skills: ["HTML", "CSS", "Adobe Photoshop", "UI/UX Design"],
                    salary: "‚Ç±28,000 - ‚Ç±40,000",
                    type: "Full-time",
                    posted: "2024-01-13",
                    isNew: false,
                    matchScore: 82
                },
                {
                    id: 4,
                    title: "Food Service Manager",
                    company: "Restaurant Chain",
                    location: "CALABARZON",
                    description: "Oversee daily restaurant operations and staff management",
                    skills: ["Food Service", "Management", "Customer Service"],
                    salary: "‚Ç±30,000 - ‚Ç±45,000",
                    type: "Full-time",
                    posted: "2024-01-12",
                    isNew: false,
                    matchScore: 75
                },
                {
                    id: 5,
                    title: "Construction Worker",
                    company: "BuildRight Construction",
                    location: "Quezon Province",
                    description: "Perform various construction tasks and site maintenance",
                    skills: ["Construction", "Safety Protocols", "Equipment Operation"],
                    salary: "‚Ç±20,000 - ‚Ç±28,000",
                    type: "Full-time",
                    posted: "2024-01-11",
                    isNew: false,
                    matchScore: 70
                }
            ];

            // Initialize
            function init() {
                updateStatistics();
                bindEvents();
                // Auto-refresh every 5 minutes
                setInterval(() => {
                    if (jobsData.length > 0) {
                        refreshJobs();
                    }
                }, 300000);
            }

            // Bind event listeners
            function bindEvents() {
                refreshBtn.addEventListener('click', refreshJobs);
                searchInput.addEventListener('input', debounce(filterJobs, 300));
                locationFilter.addEventListener('change', filterJobs);
                skillFilter.addEventListener('change', filterJobs);
                clearFiltersBtn.addEventListener('click', clearFilters);
                viewAllJobsBtn.addEventListener('click', () => showSection('jobs'));
                prevPageBtn.addEventListener('click', () => changePage(currentPage - 1));
                nextPageBtn.addEventListener('click', () => changePage(currentPage + 1));
            }

            // Refresh jobs from PhilJobNet with Skill Matching
            function refreshJobs() {
                showLoading(true);
                refreshIcon.classList.add('animate-spin');
                
                // Fetch skill-matched jobs from PhilJobNet
                fetch('/api/matched-jobs/?limit=50&min_threshold=10')
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Check if no matches found
                            if (data.no_match || data.matched_count === 0) {
                                jobsData = [];
                                filteredJobs = [];
                                renderNoMatchMessage();
                                updateStatistics();
                                showNotification('No job skills match your program competencies.', 'info');
                            } else {
                                // Transform matched job data
                                jobsData = data.jobs.map(job => ({
                                    id: job.id,
                                    title: job.title,
                                    company: job.company,
                                    location: job.location,
                                    description: job.description,
                                    requirements: job.requirements,
                                    salary: job.salary,
                                    employment_type: job.employment_type,
                                    posted_date: job.posted_date,
                                    deadline: job.deadline,
                                    skills: job.skills || [],
                                    vacancy_count: job.vacancy_count || 1,
                                    url: job.url,
                                    source: job.source || 'PhilJobNet',
                                    matchScore: job.match_percentage || 0,
                                    match_percentage: job.match_percentage || 0,
                                    isNew: isJobNew(job.posted_date)
                                }));
                                
                                filteredJobs = [...jobsData];
                                currentPage = 1;
                                updateStatistics();
                                renderJobs();
                                showNotification(`Found ${data.matched_count} matching jobs out of ${data.total_count} available!`, 'success');
                            }
                        } else {
                            // Handle error from API
                            console.warn('Failed to fetch matched jobs:', data.error);
                            jobsData = [];
                            filteredJobs = [];
                            renderNoMatchMessage();
                            updateStatistics();
                            showNotification(data.message || 'Failed to load job recommendations.', 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching matched jobs:', error);
                        jobsData = [];
                        filteredJobs = [];
                        renderNoMatchMessage();
                        updateStatistics();
                        showNotification('Network error. Unable to load jobs.', 'error');
                    })
                    .finally(() => {
                        showLoading(false);
                        refreshIcon.classList.remove('animate-spin');
                    });
            }

            // Show/hide loading indicator
            function showLoading(show) {
                if (show) {
                    loadingIndicator.classList.remove('hidden');
                    jobsContainer.innerHTML = '';
                } else {
                    loadingIndicator.classList.add('hidden');
                }
            }

            // Render no match message
            function renderNoMatchMessage() {
                jobsContainer.innerHTML = `
                    <div class="text-center py-12">
                        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-6 rounded-lg max-w-2xl mx-auto">
                            <div class="flex items-center mb-4">
                                <i class="fas fa-exclamation-triangle text-4xl text-yellow-500 mr-4"></i>
                                <div class="text-left">
                                    <h3 class="text-xl font-semibold text-gray-800 mb-2">No Job Skill Match Found</h3>
                                    <p class="text-gray-600">
                                        We couldn't find any PESO job posts that match your program competencies at this time.
                                    </p>
                                </div>
                            </div>
                            <div class="mt-4 text-left">
                                <p class="text-sm text-gray-700 mb-2">
                                    <strong>What you can do:</strong>
                                </p>
                                <ul class="list-disc list-inside text-sm text-gray-600 space-y-1">
                                    <li>Try refreshing later for new job postings</li>
                                    <li>Complete additional training programs to expand your skills</li>
                                    <li>Check back regularly as new opportunities are posted daily</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
                pagination.classList.add('hidden');
            }

            // Check if job is new (posted within last 7 days)
            function isJobNew(postedDate) {
                if (!postedDate) return false;
                const posted = new Date(postedDate);
                const now = new Date();
                const daysDiff = Math.floor((now - posted) / (1000 * 60 * 60 * 24));
                return daysDiff <= 7;
            }

            // Filter jobs based on search and filters
            function filterJobs() {
                const searchTerm = searchInput.value.toLowerCase();
                const locationValue = locationFilter.value;
                const skillValue = skillFilter.value;

                filteredJobs = jobsData.filter(job => {
                    const matchesSearch = !searchTerm || 
                        job.title.toLowerCase().includes(searchTerm) ||
                        job.company.toLowerCase().includes(searchTerm) ||
                        job.skills.some(skill => skill.toLowerCase().includes(searchTerm));
                    
                    const matchesLocation = !locationValue || 
                        job.location.toLowerCase().includes(locationValue);
                    

                    return matchesSearch && matchesLocation;
                });

                currentPage = 1;
                renderJobs();
                updatePagination();
            }

            // Clear all filters
            function clearFilters() {
                searchInput.value = '';
                locationFilter.value = '';
                filterJobs();
                filteredJobs = [...jobsData];
                currentPage = 1;
                renderJobs();
                updatePagination();
            }

            // Render jobs
            function renderJobs() {
                const jobsPerPage = 5;
                const startIndex = (currentPage - 1) * jobsPerPage;
                const endIndex = startIndex + jobsPerPage;
                const jobsToShow = filteredJobs.slice(startIndex, endIndex);

                if (jobsToShow.length === 0) {
                    jobsContainer.innerHTML = `
                        <div class="text-center text-gray-500 py-8">
                            <i class="fas fa-search text-4xl mb-4 text-gray-300"></i>
                            <p class="text-lg mb-2">No jobs found</p>
                            <p class="text-sm">Try adjusting your search criteria</p>
                        </div>
                    `;
                    pagination.classList.add('hidden');
                    return;
                }

                jobsContainer.innerHTML = jobsToShow.map(job => {
                    const matchScore = Math.round(job.match_percentage || job.matchScore || 0);
                    const matchColor = matchScore >= 70 ? 'bg-green-100 text-green-800' : 
                                       matchScore >= 50 ? 'bg-blue-100 text-blue-800' : 
                                       'bg-yellow-100 text-yellow-800';
                    const jobSalary = job.salary || 'Competitive';
                    const jobType = job.employment_type || job.type || 'Full-time';
                    const jobPosted = job.posted_date || job.posted || new Date().toISOString();
                    
                    return `
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow duration-200 job-card-item" data-job-id="${job.id}">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex-1">
                                <div class="flex items-center mb-2 flex-wrap gap-2">
                                    <h3 class="text-lg font-semibold text-gray-800">${job.title}</h3>
                                    ${job.isNew ? '<span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full font-medium"><i class="fas fa-star mr-1"></i>New</span>' : ''}
                                    <span class="${matchColor} text-xs px-3 py-1 rounded-full font-semibold">
                                        <i class="fas fa-chart-line mr-1"></i>${matchScore}% Match
                                    </span>
                                </div>
                                <p class="text-gray-600 mb-2">
                                    <i class="fas fa-building mr-2 text-blue-500"></i>${job.company}
                                </p>
                                <p class="text-gray-600 mb-2">
                                    <i class="fas fa-map-marker-alt mr-2 text-red-500"></i>${job.location}
                                </p>
                                <p class="text-gray-700 mb-3 text-sm">${job.description}</p>
                                ${job.skills && job.skills.length > 0 ? `
                                    <div class="flex flex-wrap gap-2 mb-3">
                                        ${job.skills.slice(0, 5).map(skill => `<span class="bg-indigo-50 text-indigo-700 text-xs px-2 py-1 rounded border border-indigo-200">${skill}</span>`).join('')}
                                        ${job.skills.length > 5 ? `<span class="text-xs text-gray-500 py-1">+${job.skills.length - 5} more</span>` : ''}
                                    </div>
                                ` : ''}
                            </div>
                            <div class="text-right ml-4 flex-shrink-0">
                                <p class="text-lg font-semibold text-green-600 mb-2">${jobSalary}</p>
                                <p class="text-sm text-gray-500 mb-3">${jobType}</p>
                                ${job.url ? `
                                    <a href="${job.url}" target="_blank" class="inline-block bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                                        <i class="fas fa-external-link-alt mr-1"></i>View Details
                                    </a>
                                ` : `
                                    <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm transition-colors apply-job-btn" data-job-id="${job.id}">
                                        Apply Now
                                    </button>
                                `}
                            </div>
                        </div>
                        <div class="flex justify-between items-center pt-3 border-t border-gray-100">
                            <span class="text-sm text-gray-500">
                                <i class="fas fa-calendar mr-1"></i>Posted: ${formatDate(jobPosted)}
                            </span>
                            ${job.vacancy_count > 1 ? `
                                <span class="text-sm text-green-600 font-medium">
                                    <i class="fas fa-users mr-1"></i>${job.vacancy_count.toLocaleString()} openings
                                </span>
                            ` : ''}
                        </div>
                    </div>
                `}).join('');

                // Bind job action events
                bindJobActions();
                updatePagination();
            }

            // Bind job-specific actions
            function bindJobActions() {
                document.querySelectorAll('.apply-job-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const jobId = e.target.dataset.jobId;
                        applyToJob(jobId);
                    });
                });

                document.querySelectorAll('.save-job-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const jobId = e.target.dataset.jobId;
                        saveJob(jobId);
                    });
                });

                document.querySelectorAll('.share-job-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const jobId = e.target.dataset.jobId;
                        shareJob(jobId);
                    });
                });
            }

            // Apply to job
            function applyToJob(jobId) {
                const job = jobsData.find(j => j.id == jobId);
                if (job) {
                    // In real implementation, this would redirect to application form
                    showNotification(`Application submitted for ${job.title}!`, 'success');
                    updateApplicationsCount();
                }
            }

            // Save job
            function saveJob(jobId) {
                showNotification('Job saved to your favorites!', 'info');
            }

            // Share job
            function shareJob(jobId) {
                const job = jobsData.find(j => j.id == jobId);
                if (job && navigator.share) {
                    navigator.share({
                        title: job.title,
                        text: `Check out this job opportunity: ${job.title} at ${job.company}`,
                        url: window.location.href
                    });
                } else {
                    // Fallback: copy to clipboard
                    navigator.clipboard.writeText(window.location.href);
                    showNotification('Job link copied to clipboard!', 'info');
                }
            }

            // Update statistics
            function updateStatistics() {
                totalJobsCount.textContent = jobsData.length;
                // Skill matches are jobs with 70% or higher match percentage
                const highMatches = jobsData.filter(job => {
                    const matchScore = job.match_percentage || job.matchScore || 0;
                    return matchScore >= 70;
                }).length;
                skillMatchesCount.textContent = highMatches;
                newJobsCount.textContent = jobsData.filter(job => job.isNew).length;
                // Applications sent would come from backend in real implementation
                applicationsSentCount.textContent = Math.floor(Math.random() * 5);
            }

            // Update applications count
            function updateApplicationsCount() {
                const current = parseInt(applicationsSentCount.textContent);
                applicationsSentCount.textContent = current + 1;
            }

            // Update pagination
            function updatePagination() {
                const jobsPerPage = 5;
                totalPages = Math.ceil(filteredJobs.length / jobsPerPage);
                
                if (totalPages <= 1) {
                    pagination.classList.add('hidden');
                    return;
                }

                pagination.classList.remove('hidden');
                pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
                prevPageBtn.disabled = currentPage === 1;
                nextPageBtn.disabled = currentPage === totalPages;
            }

            // Change page
            function changePage(page) {
                if (page >= 1 && page <= totalPages) {
                    currentPage = page;
                    renderJobs();
                }
            }

            // Utility functions
            function formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric' 
                });
            }

            function debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }

            function showNotification(message, type = 'info') {
                // Create notification element
                const notification = document.createElement('div');
                notification.className = `fixed top-4 right-4 z-50 px-4 py-3 rounded-lg shadow-lg text-white transition-all duration-300 transform translate-x-full`;
                
                switch(type) {
                    case 'success':
                        notification.classList.add('bg-green-500');
                        break;
                    case 'error':
                        notification.classList.add('bg-red-500');
                        break;
                    case 'info':
                    default:
                        notification.classList.add('bg-blue-500');
                        break;
                }

                notification.innerHTML = `
                    <div class="flex items-center">
                        <span>${message}</span>
                        <button class="ml-3 text-white hover:text-gray-200" onclick="this.parentElement.parentElement.remove()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;

                document.body.appendChild(notification);

                // Animate in
                setTimeout(() => {
                    notification.classList.remove('translate-x-full');
                }, 100);

                // Auto remove after 5 seconds
                setTimeout(() => {
                    notification.classList.add('translate-x-full');
                    setTimeout(() => notification.remove(), 300);
                }, 5000);
            }

            // Initialize the job recommendations system
            init();
        });

        // Document Management Functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Tab functionality for Document Management
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabPanels = document.querySelectorAll('.tab-panel');

            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    // Remove active class from all buttons and panels
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabPanels.forEach(panel => panel.classList.remove('active'));
                    
                    // Add active class to clicked button
                    this.classList.add('active');
                    
                    // Show corresponding panel
                    const targetPanel = document.getElementById(targetTab + '-tab');
                    if (targetPanel) {
                        targetPanel.classList.add('active');
                    }
                });
            });

            // Change ID Photo button functionality
            const changeIdPhotoBtn = document.getElementById('change-id-photo');
            if (changeIdPhotoBtn) {
                changeIdPhotoBtn.addEventListener('click', function() {
                    // Create file input dynamically
                    const fileInput = document.createElement('input');
                    fileInput.type = 'file';
                    fileInput.accept = 'image/*';
                    fileInput.style.display = 'none';
                    
                    fileInput.addEventListener('change', function(e) {
                        if (e.target.files && e.target.files[0]) {
                            const file = e.target.files[0];
                            const formData = new FormData();
                            formData.append('id_picture', file);
                            formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');
                            
                            // Show loading indicator
                            changeIdPhotoBtn.disabled = true;
                            changeIdPhotoBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Uploading...';
                            
                            // Send to server
                            fetch('{% url "update_id_photo" %}', {
                                method: 'POST',
                                body: formData,
                                headers: {
                                    'X-Requested-With': 'XMLHttpRequest'
                                }
                            })
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    alert('ID Photo updated successfully!');
                                    location.reload();
                                } else {
                                    alert('Error updating ID Photo: ' + (data.error || 'Unknown error'));
                                    changeIdPhotoBtn.disabled = false;
                                    changeIdPhotoBtn.innerHTML = '<i class="fas fa-camera mr-2"></i>Change ID Photo';
                                }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                alert('Error uploading photo. Please try again.');
                                changeIdPhotoBtn.disabled = false;
                                changeIdPhotoBtn.innerHTML = '<i class="fas fa-camera mr-2"></i>Change ID Photo';
                            });
                        }
                    });
                    
                    document.body.appendChild(fileInput);
                    fileInput.click();
                    document.body.removeChild(fileInput);
                });
            }

            // View Full Size functionality
            const viewFullSizeBtn = document.getElementById('view-full-size-btn');
            const idPhotoThumbnail = document.getElementById('id-photo-thumbnail');
            
            function showFullSizeModal() {
                const photoUrl = idPhotoThumbnail ? idPhotoThumbnail.src : '';
                if (!photoUrl) return;
                
                // Create modal
                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                modal.style.zIndex = '9999';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width: 90%; max-height: 90vh; overflow: auto;">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold">ID Photo - Full Size</h3>
                            <button id="close-modal" class="text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times text-2xl"></i>
                            </button>
                        </div>
                        <div class="text-center">
                            <img src="${photoUrl}" alt="ID Photo Full Size" class="max-w-full max-h-[80vh] rounded-lg shadow-lg">
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Close modal handlers
                const closeBtn = modal.querySelector('#close-modal');
                closeBtn.addEventListener('click', () => {
                    document.body.removeChild(modal);
                });
                
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        document.body.removeChild(modal);
                    }
                });
            }
            
            if (viewFullSizeBtn) {
                viewFullSizeBtn.addEventListener('click', showFullSizeModal);
            }
            
            // Also allow clicking on thumbnail to view full size
            if (idPhotoThumbnail) {
                idPhotoThumbnail.addEventListener('click', showFullSizeModal);
            }

            // Download Profile PDF button functionality
            const downloadPdfBtn = document.getElementById('download-profile-pdf');
            if (downloadPdfBtn) {
                downloadPdfBtn.addEventListener('click', function() {
                    // Show loading state
                    const originalHTML = this.innerHTML;
                    this.disabled = true;
                    this.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating PDF...';
                    
                    // Redirect to download URL
                    window.location.href = '{% url "download_profile_pdf" %}';
                    
                    // Reset button after a short delay (since download doesn't navigate away)
                    setTimeout(() => {
                        this.disabled = false;
                        this.innerHTML = originalHTML;
                    }, 2000);
                });
            }
        });

        // Mobile Menu Toggle Functionality
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const sidebar = document.getElementById('sidebar');
            const sidebarOverlay = document.getElementById('sidebar-overlay');

            // Toggle mobile menu
            function toggleMobileMenu() {
                sidebar.classList.toggle('mobile-active');
                sidebarOverlay.classList.toggle('active');
            }

            // Open mobile menu
            if (mobileMenuBtn) {
                mobileMenuBtn.addEventListener('click', toggleMobileMenu);
            }

            // Close mobile menu when clicking overlay
            if (sidebarOverlay) {
                sidebarOverlay.addEventListener('click', toggleMobileMenu);
            }

            // Close mobile menu when clicking a navigation link
            const sidebarLinks = document.querySelectorAll('.sidebar-nav a');
            sidebarLinks.forEach(link => {
                link.addEventListener('click', function() {
                    // Only close on mobile (when overlay is visible)
                    if (window.innerWidth <= 768) {
                        toggleMobileMenu();
                    }
                });
            });

            // Handle window resize
            window.addEventListener('resize', function() {
                if (window.innerWidth > 768) {
                    // Remove mobile classes when switching to desktop view
                    sidebar.classList.remove('mobile-active');
                    sidebarOverlay.classList.remove('active');
                }
            });
        });

        // Ticket Form Submission
        document.addEventListener('DOMContentLoaded', function() {
            const ticketForm = document.getElementById('ticketForm');
            
            if (ticketForm) {
                ticketForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    // Get form values
                    const category = document.getElementById('ticketCategory').value;
                    const priority = document.getElementById('ticketPriority').value;
                    const recipient = document.getElementById('ticketRecipient').value;
                    const subject = document.getElementById('ticketSubject').value.trim();
                    const description = document.getElementById('ticketDescription').value.trim();
                    const attachmentInput = document.getElementById('ticketAttachment');
                    
                    // Validation
                    if (!category) {
                        showNotificationMessage('Please select a ticket category', 'error');
                        return;
                    }
                    
                    if (!subject) {
                        showNotificationMessage('Please enter a subject', 'error');
                        return;
                    }
                    
                    if (!description) {
                        showNotificationMessage('Please provide a description', 'error');
                        return;
                    }
                    
                    // Prepare form data
                    const formData = {
                        category: category,
                        priority: priority,
                        recipient: recipient,
                        subject: subject,
                        description: description
                    };
                    
                    try {
                        // Get CSRF token
                        const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]')?.value || getCookie('csrftoken');
                        
                        // Submit ticket
                        const response = await fetch('/create-ticket/', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': csrftoken
                            },
                            body: JSON.stringify(formData)
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            showNotificationMessage('Ticket submitted successfully! Ticket ID: ' + data.ticket_id, 'success');
                            
                            // Reset form
                            ticketForm.reset();
                            
                            // Reload page to show new ticket in the list
                            setTimeout(() => {
                                window.location.reload();
                            }, 2000);
                        } else {
                            showNotificationMessage(data.message || 'Failed to submit ticket', 'error');
                        }
                    } catch (error) {
                        console.error('Error submitting ticket:', error);
                        showNotificationMessage('An error occurred while submitting the ticket', 'error');
                    }
                });
            }
        });
        
        // Helper function to get CSRF token from cookies
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        
        // Edit Fields Modal Functions
        function openEditFieldsModal() {
            const modal = document.getElementById('editFieldsModal');
            if (modal) {
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
            }
        }

        function closeEditFieldsModal() {
            const modal = document.getElementById('editFieldsModal');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        }

        // Resubmit for Review Function
        function resubmitForReview() {
            if (confirm('Are you sure you want to resubmit your corrected information for admin review?')) {
                // Get CSRF token from the page
                const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                
                fetch('{% url "resubmit_for_review" %}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrftoken
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        showNotificationMessage(data.message, 'success');
                        setTimeout(() => {
                            window.location.reload();
                        }, 2000);
                    } else {
                        showNotificationMessage(data.message || 'Error resubmitting for review', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showNotificationMessage('An error occurred. Please try again: ' + error.message, 'error');
                });
            }
        }

        // Helper function to show notification messages
        function showNotificationMessage(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 left-1/2 transform -translate-x-1/2 z-[9999] px-6 py-4 rounded-xl shadow-2xl text-white flex items-center space-x-3 transition-all duration-300 ${
                type === 'success' ? 'bg-gradient-to-r from-green-500 to-green-600' :
                type === 'error' ? 'bg-gradient-to-r from-red-500 to-red-600' :
                type === 'warning' ? 'bg-gradient-to-r from-yellow-500 to-orange-500' :
                'bg-gradient-to-r from-blue-500 to-blue-600'
            }`;
            notification.style.maxWidth = '500px';
            
            notification.innerHTML = `
                <div class="flex items-center space-x-3">
                    <i class="fas ${
                        type === 'success' ? 'fa-check-circle' :
                        type === 'error' ? 'fa-exclamation-triangle' :
                        type === 'warning' ? 'fa-exclamation-circle' :
                        'fa-info-circle'
                    } text-xl"></i>
                    <span class="font-medium">${message}</span>
                </div>
                <button onclick="this.parentElement.remove()" class="ml-4 text-white hover:opacity-70 transition-opacity">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translate(-50%, -20px)';
                    setTimeout(() => notification.remove(), 300);
                }
            }, 5000);
        }
    </script>
</body>
</html>