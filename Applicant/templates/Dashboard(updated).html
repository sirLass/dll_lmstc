{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        /* Define color variables for consistency with trainer dashboard */
        :root {
            --text-dark: #333333;
            --text-medium: #666666;
            --background-light: #F0F2F5;
            --card-background: #FFFFFF;
            --green-icon: #28A745;
            --red-icon: #DC3545;
            --purple-icon: #6F42C1;
            --sidebar-logo-color: #2a6dbd;
            --sidebar-active-hover-color: rgba(255, 255, 255, 0.2);
            --dark-blue-card-bg: #2C5EBD;
            --dark-blue-card-text: #FFFFFF;
            --table-header-blue: #4A89DC;
            --status-active-bg: #E6F7D9;
            --status-active-text: #52C41A;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            background-color: var(--background-light);
        }

        /* Sidebar styling to match trainer dashboard */
        .sidebar {
            width: 250px;
            background: linear-gradient(180deg, #4a90e2 0%, #2a6dbd 100%);
            color: white;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            padding: 20px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            border-top-right-radius: 15px;
            border-bottom-right-radius: 15px;
            z-index: 1000;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
        }

        .sidebar-header .logo {
            width: 40px;
            height: 40px;
            background-color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 10px;
            overflow: hidden;
        }

        .sidebar-header .logo img {
            width: 30px;
            height: 30px;
            object-fit: cover;
        }

        .sidebar-nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar-nav li {
            margin-bottom: 10px;
        }

        .sidebar-nav a {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: background-color 0.3s ease;
            cursor: pointer;
        }

        .sidebar-nav a:hover, .sidebar-nav a.active {
            background-color: var(--sidebar-active-hover-color);
        }

        .sidebar-nav a i {
            margin-right: 10px;
            font-size: 1.1rem;
        }

        /* Dropdown styling */
        .dropdown-item {
            position: relative;
        }

        .dropdown-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 15px;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: background-color 0.3s ease;
            cursor: pointer;
        }

        .dropdown-toggle:hover {
            background-color: var(--sidebar-active-hover-color);
        }

        .dropdown-arrow {
            transition: transform 0.3s ease;
            font-size: 0.8rem;
        }

        .dropdown-arrow.rotated {
            transform: rotate(180deg);
        }

        .dropdown-menu {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            margin-top: 5px;
            padding: 5px 0;
            transition: max-height 0.3s ease-out;
        }

        .dropdown-menu.active {
            max-height: 200px;
        }

        .dropdown-menu.hidden {
            max-height: 0;
            opacity: 0;
        }

        .dropdown-link {
            display: flex;
            align-items: center;
            padding: 8px 25px;
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            font-size: 0.9rem;
            transition: background-color 0.3s ease;
        }

        .dropdown-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .dropdown-link i {
            margin-right: 8px;
            font-size: 0.9rem;
        }

        /* Main content area */
        .main-content {
            margin-left: 250px;
            padding: 20px;
            flex-grow: 1;
        }

        /* Header styling */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background-color: var(--card-background);
            border-bottom: 1px solid #e0e0e0;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info .icon {
            color: var(--text-medium);
            cursor: pointer;
            font-size: 1.4rem;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.3s ease;
            position: relative;
        }

        .user-info .icon:hover {
            background-color: rgba(74, 137, 220, 0.1);
            color: var(--sidebar-logo-color);
            transform: scale(1.1);
        }

        .notification-bell {
            position: relative;
            display: inline-block;
        }

        .notification-bell .fas.fa-bell {
            font-size: 1.5rem;
            color: var(--sidebar-logo-color);
            transition: all 0.3s ease;
        }

        .notification-bell:hover .fas.fa-bell {
            color: #f59e0b;
            animation: bell-ring 0.5s ease-in-out;
        }

        @keyframes bell-ring {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(15deg); }
            75% { transform: rotate(-15deg); }
        }

        .user-info .avatar {
            width: 40px;
            height: 40px;
            background-color: var(--sidebar-logo-color);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: 500;
            overflow: hidden;
        }

        .user-info .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-info .welcome-text {
            text-align: right;
        }

        .user-info .welcome-text .greeting {
            font-size: 1rem;
            color: var(--sidebar-logo-color);
            margin: 0;
        }

        .user-info .welcome-text .username {
            font-size: 1.2rem;
            font-weight: 600;
            color: #f59e0b;
            margin: 0;
        }

        /* Content sections */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        /* Card styling */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background-color: var(--card-background);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
            transition: transform 0.2s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-title {
            font-size: 0.9rem;
            color: var(--text-medium);
            margin-bottom: 5px;
        }

        .card-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-dark);
        }

        .card-subtitle {
            font-size: 0.8rem;
            color: var(--text-medium);
            margin-top: 5px;
        }

        /* Dark blue cards */
        .dark-blue-card {
            background-color: var(--dark-blue-card-bg);
            color: var(--dark-blue-card-text);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
            min-height: 250px;
            transition: transform 0.2s ease;
        }

        .dark-blue-card:hover {
            transform: translateY(-5px);
        }

        .dark-blue-card h3 {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
        }

        /* Table styling */
        .list-container {
            background-color: var(--card-background);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.9rem;
        }

        .data-table th,
        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
            text-align: left;
        }

        .data-table th {
            background-color: var(--table-header-blue);
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.8rem;
        }

        .data-table td {
            color: var(--text-dark);
        }

        .data-table tr:hover {
            background-color: #f5f5f5;
        }

        /* Status badges */
        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-badge.pending {
            background-color: #FFF3CD;
            color: #856404;
        }

        .status-badge.accepted {
            background-color: #D1ECF1;
            color: #0C5460;
        }

        .status-badge.approved {
            background-color: #D4EDDA;
            color: #155724;
        }

        .status-badge.declined {
            background-color: #F8D7DA;
            color: #721C24;
        }

        /* Notification styling */
        .notification-container {
            position: relative;
        }

        .notification-box {
            position: absolute;
            right: 0;
            top: 40px;
            width: 300px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            border: 1px solid #e0e0e0;
            max-height: 400px;
            overflow-y: auto;
        }

        .notification-box .header-notif {
            padding: 12px 16px;
            border-bottom: 1px solid #e0e0e0;
            font-weight: 600;
            color: var(--sidebar-logo-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-item {
            padding: 12px 16px;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s ease;
        }

        .notification-item:hover {
            background-color: #f5f5f5;
        }

        /* Modal styling */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal-content {
            background-color: var(--card-background);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        /* Plus button styling */
        .add-button {
            background-color: var(--table-header-blue);
            color: white;
            padding: 12px 20px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
            border: none;
            cursor: pointer;
            font-size: 1.1rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .add-button:hover {
            background-color: #3a7bd5;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        /* Profile form styling */
        .profile-container {
            background-color: var(--card-background);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
            max-height: 80vh;
            overflow-y: auto;
        }

        .profile-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .profile-photo {
            width: 120px;
            height: 120px;
            background-color: #f0f0f0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 2px solid #e0e0e0;
        }

        .profile-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-section h2 {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--table-header-blue);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e0e0e0;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-medium);
            margin-bottom: 5px;
        }

        .form-group input,
        .form-group select {
            padding: 10px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.9rem;
            background-color: #f8f9fa;
            color: var(--text-dark);
        }

        /* Job matching styling */
        .job-card {
            background-color: var(--card-background);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .job-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .job-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 10px;
        }

        .job-detail {
            font-size: 0.9rem;
            color: var(--text-medium);
            margin-bottom: 8px;
        }

        .job-detail strong {
            color: var(--text-dark);
        }

        .apply-button {
            background-color: var(--table-header-blue);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            display: inline-block;
            margin-top: 10px;
            transition: background-color 0.2s ease;
        }

        .apply-button:hover {
            background-color: #3a7bd5;
            color: white;
        }

        /* Progress bars */
        .progress-container {
            margin-bottom: 20px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: #60A5FA;
            border-radius: 6px;
            transition: width 0.3s ease;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .sidebar {
                width: 80px;
                padding: 15px 10px;
            }

            .sidebar-header h2,
            .sidebar-nav span,
            .user-info .welcome-text {
                display: none;
            }

            .sidebar-nav a {
                justify-content: center;
                padding: 10px 0;
            }

            .sidebar-nav a i {
                margin-right: 0;
            }

            .main-content {
                margin-left: 80px;
                padding: 15px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .dashboard-cards {
                grid-template-columns: 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        .hidden {
            display: none !important;
        }

        /* Animation for notifications */
        @keyframes notification-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        #notification-badge {
            animation: notification-pulse 2s infinite;
        }

        /* Success modal styling */
        .success-modal .modal-content {
            border: 2px solid #28a745;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(40, 167, 69, 0.3);
        }

        .success-modal .modal-header {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border-bottom: none;
            border-radius: 10px 10px 0 0;
        }

        .progress-item {
            transition: all 0.3s ease;
        }

        .progress-item.completed {
            background-color: #d4edda;
            border-color: #28a745;
        }

        .progress-item.pending {
            background-color: #f8f9fa;
            border-color: #dee2e6;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Watermark and print protection styles */
        .certificate-watermark {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: repeating-linear-gradient(
                45deg,
                rgba(74, 137, 220, 0.1) 0px,
                rgba(74, 137, 220, 0.1) 10px,
                transparent 10px,
                transparent 20px
            );
            pointer-events: none;
            z-index: 10;
        }

        .certificate-watermark::before {
            content: 'DLL-LMSTC OFFICIAL CERTIFICATE';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 3rem;
            font-weight: bold;
            color: rgba(74, 137, 220, 0.1);
            white-space: nowrap;
            z-index: 11;
        }

        /* Disable print and download for certificate */
        @media print {
            .certificate-container {
                display: none !important;
            }
        }

        .no-select {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* Sliding news animation */
        @keyframes marquee {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        .animate-marquee {
            animation: marquee 30s linear infinite;
            color: #1e40af;
            font-weight: 500;
        }

        /* Locked section styles */
        .disabled-link {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .disabled-link a {
            color: #9ca3af !important;
            pointer-events: none;
        }

        .locked-section-overlay {
            position: relative;
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            border-radius: 12px;
            padding: 60px 20px;
            text-align: center;
            margin-bottom: 20px;
        }

        .locked-content {
            position: relative;
            z-index: 2;
        }

        /* Certification watermark overlay */
        .certification-watermark-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            border-radius: 12px;
        }

        .watermark-content {
            text-align: center;
            padding: 40px;
        }

        #certification-section {
            position: relative;
        }

        /* Tab Navigation Styles */
        .tab-navigation {
            margin-bottom: 1.5rem;
        }

        .tab-navigation .flex {
            border-bottom: 2px solid #e5e7eb;
        }

        .tab-button {
            background: none;
            border: none;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 500;
            color: #6b7280;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
        }

        .tab-button:hover {
            color: #374151;
            background-color: #f9fafb;
        }

        .tab-button.active {
            color: #2563eb;
            border-bottom-color: #2563eb;
            background-color: #eff6ff;
        }

        .tab-button i {
            margin-right: 8px;
        }

        /* Tab Content Styles */
        .tab-content {
            position: relative;
        }

        .tab-panel {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .tab-panel.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Profile Field Styles */
        .profile-field {
            margin-bottom: 16px;
        }

        .profile-field label {
            display: block;
            margin-bottom: 4px;
            font-weight: 500;
            color: #6b7280;
        }

        .profile-field p {
            margin: 0;
            padding: 8px 0;
            color: #374151;
            word-wrap: break-word;
        }

        /* Responsive adjustments for tabs */
        @media (max-width: 768px) {
            .tab-button {
                padding: 10px 16px;
                font-size: 13px;
            }
            
            .tab-button i {
                margin-right: 6px;
            }
        }
    </style>
</head>

<body {% if show_modal %}data-show-modal="true"{% endif %}>
    <div class="sidebar">
        <div>
            <div class="sidebar-header">
                <div class="logo">
                    <img src="{% static 'Images/icon.png' %}" alt="Logo">
                </div>
                <h2>DLL - LMSTC</h2>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="#" data-section="overview" class="active"><i class="fas fa-tachometer-alt"></i> <span>Dashboard</span></a></li>
                    <li><a href="#" data-section="profile"><i class="fas fa-user"></i> <span>Profile</span></a></li>
                    <li><a href="#" data-section="schedule"><i class="fas fa-calendar-alt"></i> <span>Class Schedule</span></a></li>
                    <li><a href="#" data-section="grades"><i class="fas fa-chart-line"></i> <span>Competencies</span></a></li>
                    {% if is_passer %}
                        <li><a href="#" data-section="jobs"><i class="fas fa-briefcase"></i> <span>Job Recommendations</span></a></li>
                    {% else %}
                        <li class="disabled-link"><a href="#" onclick="showLockedMessage()"><i class="fas fa-briefcase"></i> <span>Job Recommendations</span> <i class="fas fa-lock ml-2"></i></a></li>
                    {% endif %}
                    <li><a href="#" data-section="ticket"><i class="fas fa-ticket-alt"></i> <span>Ticket</span></a></li>
                    <li><a href="#" data-section="document-management"><i class="fas fa-folder-open"></i> <span>Document Management</span></a></li>
                    <li><a href="#" data-section="certification"><i class="fas fa-certificate"></i> <span>Certification</span></a></li>
                </ul>
            </nav>
        </div>
        <div>
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="{% url 'Homepage_user' %}"><i class="fas fa-home"></i> <span>Homepage</span></a></li>
                    <li><a href="{% url 'logout_view' %}"><i class="fas fa-sign-out-alt"></i> <span>Sign Out</span></a></li>
                </ul>
            </nav>
        </div>
    </div>

    <div class="main-content">
        <div class="header">
            <h1>User Process Dashboard</h1>
            <div class="user-info">
                <div class="notification-container">
                    <div class="notification-bell">
                        <i class="fas fa-bell icon" id="bell-btn"></i>
                        <span id="notification-badge" class="{% if unread_notifications_count == 0 %}hidden{% endif %} absolute bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold" style="position: absolute; top: -2px; right: -2px; width: 22px; height: 22px; font-size: 0.75rem; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
                            {{ unread_notifications_count|default:0 }}
                        </span>
                    </div>
                    
                    <div id="notification-box" class="notification-box hidden">
                        <div class="header-notif">
                            <span>Notifications</span>
                            <button id="mark-all-read" class="text-sm text-gray-500 hover:text-blue-600">Mark all read</button>
                        </div>
                        <div id="notifications-list" class="max-h-64 overflow-y-auto">
                            <div class="p-4 text-center text-gray-500">Loading notifications...</div>
                        </div>
                    </div>
                </div>
                <div class="welcome-text">
                    <p class="greeting">Welcome!</p>
                    <p class="username">{{ username }}</p>
                </div>
                <div class="avatar">
                    <img src="{% static 'Images/user.png' %}" alt="User Avatar" />
                </div>
            </div>
        </div>

        <!-- Overview Section -->
        <div id="overview-section" class="content-section active">
            <h2 class="text-2xl font-semibold text-gray-800 mb-5">Overview</h2>
            
            <!-- Sliding News Section -->
            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 mb-6 border border-blue-200 overflow-hidden">
                <div class="flex items-center mb-2">
                    <i class="fas fa-newspaper text-blue-600 mr-2"></i>
                    <h3 class="text-lg font-semibold text-gray-800">Latest Job Updates</h3>
                </div>
                <div class="relative overflow-hidden">
                    <div class="sliding-news whitespace-nowrap">
                        <span class="inline-block animate-marquee">
                            üî• New Software Developer position at TechCorp - ‚Ç±45,000/month | 
                            üíº Automotive Technician needed at AutoFix - ‚Ç±30,000/month | 
                            üé® Web Designer opportunity at Creative Studio - ‚Ç±35,000/month | 
                            üçΩÔ∏è Restaurant Manager position available - ‚Ç±40,000/month | 
                            üèóÔ∏è Construction Worker roles open - ‚Ç±25,000/month | 
                            üíª Database Administrator at DataTech - ‚Ç±50,000/month
                        </span>
                    </div>
                </div>
            </div>
            
            <!-- Add Program Button -->
            <div x-data="{ showModal: false, confirmModal: null, limitModal: false }" class="relative mb-6">
                <div class="flex justify-end">
                    <button 
                        @click="{% if has_reached_limit %}limitModal = true{% else %}showModal = true{% endif %}"
                        class="add-button"
                    >
                        <i class="fas fa-plus"></i>
                        New Application
                    </button>
                </div>

                <!-- Limit Modal -->
                <div x-show="limitModal" class="modal-overlay" x-transition>
                    <div class="modal-content">
                        <div class="text-center">
                            <div class="mx-auto w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4">
                                <i class="fas fa-exclamation-triangle text-red-600 text-2xl"></i>
                            </div>
                            <h2 class="text-xl font-bold mb-4 text-gray-800">Maximum Program Limit Reached</h2>
                            <p class="text-gray-600 mb-6">
                                You have reached the maximum limit of 2 program applications. You currently have <strong>{{ total_programs }}</strong> program(s) in your account.
                            </p>
                            <button @click="limitModal = false" class="add-button">
                                Okay!
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Program Selection Modal -->
                <div x-show="showModal" class="modal-overlay" x-transition x-cloak>
                    <div class="modal-content">
                        <h2 class="text-xl font-bold mb-4 text-gray-800">New Application</h2>
                        <div class="space-y-3">
                            {% for prog in Programss %}
                            <div>
                                <a href="javascript:void(0);"
                                   @click="confirmModal = {{ prog.id }}; showModal = false"
                                   class="block p-3 border rounded-lg hover:bg-blue-50 text-blue-700 font-semibold">
                                    {{ prog.program_name }}
                                </a>
                            </div>
                            {% endfor %}
                        </div>
                        <div class="mt-6 text-right">
                            <button @click="showModal = false" class="px-4 py-2 bg-gray-300 text-gray-800 rounded-lg">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Confirmation Modals -->
                {% for prog in Programss %}
                <div x-show="confirmModal === {{ prog.id }}" class="modal-overlay" x-transition x-cloak style="display: none;">
                    <div class="modal-content">
                        <div class="text-center">
                            <h2 class="text-2xl font-bold text-gray-800 mb-4">Confirm Program Enrollment</h2>
                            <p class="text-gray-700 text-lg mb-8">
                                You are about to enroll in the program: <strong>{{ prog.program_name }}</strong>.<br>
                                Would you like to proceed?
                            </p>
                            <div class="flex justify-center gap-4">
                                <form method="POST" action="{% url 'apply_program' prog.id %}">
                                    {% csrf_token %}
                                    <button type="submit" class="add-button">
                                        Yes, Proceed
                                    </button>
                                </form>
                                <button @click="confirmModal = null" class="px-6 py-3 bg-gray-300 text-gray-800 rounded-lg">
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Dashboard Cards -->
            <div class="dashboard-cards">
                <div class="card">
                    <div class="card-title">Program Progress</div>
                    <div class="card-value">55%</div>
                    <div class="card-subtitle">5 of 10 Subjects Completed</div>
                </div>
                <div class="card">
                    <div class="card-title">Time Estimated</div>
                    <div class="card-value">3 Months</div>
                    <div class="card-subtitle">Last Active: <span style="color: #28a745; font-weight: 600;">Today</span></div>
                </div>
            </div>

            <!-- Job Recommendations Notifications -->
            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 mb-6 border border-blue-200">
                <div class="flex items-start justify-between mb-4">
                    <div class="flex items-center">
                        <div class="bg-blue-100 p-2 rounded-full mr-3">
                            <i class="fas fa-briefcase text-blue-600"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800">Job Recommendations</h3>
                            <p class="text-sm text-gray-600">New opportunities matching your skills</p>
                        </div>
                    </div>
                    <button id="view-all-jobs" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                        View All ‚Üí
                    </button>
                </div>

                <div id="job-notifications-container">
                    <!-- Job notifications will be populated here -->
                    <div class="space-y-3" id="job-notifications-list">
                        <div class="bg-white rounded-lg p-4 border-l-4 border-green-500 shadow-sm">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center mb-2">
                                        <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full mr-2">New</span>
                                        <span class="text-sm text-gray-500">2 hours ago</span>
                                    </div>
                                    <h4 class="font-medium text-gray-800 mb-1">3 new job posts match your IT skills</h4>
                                    <p class="text-sm text-gray-600">Software Developer, Web Designer, and Database Administrator positions available</p>
                                </div>
                                <button class="text-blue-600 hover:text-blue-800 text-sm">
                                    <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>

                        <div class="bg-white rounded-lg p-4 border-l-4 border-yellow-500 shadow-sm">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center mb-2">
                                        <span class="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-full mr-2">Updated</span>
                                        <span class="text-sm text-gray-500">1 day ago</span>
                                    </div>
                                    <h4 class="font-medium text-gray-800 mb-1">Job requirements updated for Automotive Technician</h4>
                                    <p class="text-sm text-gray-600">Now accepting candidates with your automotive training background</p>
                                </div>
                                <button class="text-blue-600 hover:text-blue-800 text-sm">
                                    <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>

                        <div class="text-center py-4">
                            <button id="load-more-notifications" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                                Load more notifications
                            </button>
                        </div>
                    </div>

                    <!-- Empty state -->
                    <div id="no-job-notifications" class="hidden text-center py-8">
                        <i class="fas fa-bell-slash text-gray-300 text-3xl mb-3"></i>
                        <p class="text-gray-500 mb-2">No new job recommendations</p>
                        <p class="text-sm text-gray-400">We'll notify you when new jobs match your skills</p>
                    </div>
                </div>
            </div>

            <!-- My Applications Section -->
            <div class="list-container">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-800">My Applications</h3>
                    <div class="flex gap-2">
                        <select class="px-3 py-1 border border-gray-300 rounded-lg text-sm" id="statusFilter">
                            <option value="all">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="accepted">Accepted</option>
                            <option value="approved">Approved</option>
                            <option value="declined">Declined</option>
                        </select>
                    </div>
                </div>

                <!-- Applications Grid -->
                <div class="grid gap-4">
                    {% for app in applications %}
                    <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow duration-200">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex-1">
                                <h4 class="text-lg font-semibold text-gray-800 mb-2">{{ app.program.program_name }}</h4>
                                <div class="flex items-center gap-4 text-sm text-gray-600 mb-3">
                                    <span><i class="fas fa-calendar-alt mr-1"></i>{{ app.program.program_sched|default:"Schedule TBD" }}</span>
                                    {% if app.program.program_trainor %}
                                    <span><i class="fas fa-user-tie mr-1"></i>{{ app.program.program_trainor }}</span>
                                    {% endif %}
                                    <span><i class="fas fa-layer-group mr-1"></i>Batch 1</span>
                                    <span><i class="fas fa-graduation-cap mr-1"></i>2nd Semester</span>
                                </div>
                                {% if app.program.program_skill %}
                                <div class="flex flex-wrap gap-1 mb-3">
                                    <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-full">{{ app.program.program_skill }}</span>
                                </div>
                                {% endif %}
                            </div>
                            <div class="text-right">
                                {% if app.status == "Pending" %}
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800">
                                        <i class="fas fa-clock mr-1"></i>Pending
                                    </span>
                                {% elif app.status == "Accepted" %}
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                                        <i class="fas fa-check-circle mr-1"></i>Accepted
                                    </span>
                                {% elif app.status == "Declined" %}
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800">
                                        <i class="fas fa-times-circle mr-1"></i>Declined
                                    </span>
                                {% else %}
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-800">
                                        {{ app.status|title }}
                                    </span>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center pt-4 border-t border-gray-100">
                            <div class="text-sm text-gray-500">
                                <i class="fas fa-calendar mr-1"></i>Applied: {{ app.applied_at|date:"M j, Y" }}
                            </div>
                            <div class="flex gap-2">
                                {% if app.status == "Declined" and app.decline_reason %}
                                <button class="px-3 py-1 text-sm text-red-600 hover:bg-red-50 rounded-lg transition-colors" 
                                        onclick="showDeclineReason('{{ app.decline_reason|escapejs }}')">
                                    <i class="fas fa-info-circle mr-1"></i>View Reason
                                </button>
                                {% endif %}
                                <button class="px-3 py-1 text-sm text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">
                                    <i class="fas fa-eye mr-1"></i>View Details
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    
                    {% for approg in approveprog %}
                    <div class="bg-white border border-green-200 rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow duration-200 border-l-4 border-l-green-500">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex-1">
                                <h4 class="text-lg font-semibold text-gray-800 mb-2">{{ approg.program.program_name }}</h4>
                                <div class="flex items-center gap-4 text-sm text-gray-600 mb-3">
                                    <span><i class="fas fa-calendar-alt mr-1"></i>{{ approg.program.program_sched|default:"Schedule TBD" }}</span>
                                    {% if approg.program.program_trainor %}
                                    <span><i class="fas fa-user-tie mr-1"></i>{{ approg.program.program_trainor }}</span>
                                    {% endif %}
                                    <span><i class="fas fa-layer-group mr-1"></i>Batch 1</span>
                                    <span><i class="fas fa-graduation-cap mr-1"></i>2nd Semester</span>
                                </div>
                                {% if approg.program.program_skill %}
                                <div class="flex flex-wrap gap-1 mb-3">
                                    <span class="px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full">{{ approg.program.program_skill }}</span>
                                </div>
                                {% endif %}
                                
                                <!-- Progress Bar -->
                                <div class="mb-3">
                                    <div class="flex justify-between text-sm text-gray-600 mb-1">
                                        <span>Progress</span>
                                        <span>{{ approg.progress|default:0 }}%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-green-500 h-2 rounded-full transition-all duration-300" 
                                             style="width: {{ approg.progress|default:0 }}%"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">
                                    <i class="fas fa-check-double mr-1"></i>Approved
                                </span>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center pt-4 border-t border-gray-100">
                            <div class="text-sm text-gray-500">
                                <i class="fas fa-calendar-check mr-1"></i>Approved: {{ approg.approved_at|date:"M j, Y" }}
                            </div>
                            <div class="flex gap-2">
                                {% if approg.progress >= 100 %}
                                <button class="px-3 py-1 text-sm text-green-600 hover:bg-green-50 rounded-lg transition-colors">
                                    <i class="fas fa-certificate mr-1"></i>View Certificate
                                </button>
                                {% endif %}
                                <button class="px-3 py-1 text-sm text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">
                                    <i class="fas fa-chart-line mr-1"></i>View Progress
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    
                    {% if applications|length == 0 and approveprog|length == 0 %}
                    <div class="text-center py-12">
                        <div class="mx-auto w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-4">
                            <i class="fas fa-file-alt text-gray-400 text-3xl"></i>
                        </div>
                        <h4 class="text-lg font-medium text-gray-900 mb-2">No Applications Yet</h4>
                        <p class="text-gray-500 mb-4">You haven't applied for any programs yet. Start your learning journey today!</p>
                        <button class="add-button" onclick="document.querySelector('[data-section=overview] .add-button').click()">
                            <i class="fas fa-plus mr-2"></i>Apply for Program
                        </button>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Progress Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
                <div class="dark-blue-card">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">Program Progress Tracker</h3>
                        <span class="bg-blue-500 text-white text-xs px-2 py-1 rounded-full">55% Complete</span>
                    </div>
                    <div style="position: relative; height: 200px; display: flex; justify-content: center; align-items: center;">
                        <canvas id="completionChart" width="200" height="200"></canvas>
                    </div>
                    <div class="mt-4 grid grid-cols-2 gap-4">
                        <div class="bg-blue-100 bg-opacity-20 rounded-lg p-3 text-center">
                            <p class="text-sm opacity-80">Completed</p>
                            <p class="text-xl font-bold">{{ approved_count|default:0 }}</p>
                        </div>
                        <div class="bg-blue-100 bg-opacity-20 rounded-lg p-3 text-center">
                            <p class="text-sm opacity-80">Total Programs</p>
                            <p class="text-xl font-bold">{{ total_programs|default:0 }}</p>
                        </div>
                    </div>
                </div>

                <div class="dark-blue-card">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">Ongoing Program Progress</h3>
                        <span class="bg-green-500 text-white text-xs px-2 py-1 rounded-full">On Track</span>
                    </div>
                    <div class="space-y-5">
                        <div class="progress-container">
                            <div class="flex justify-between mb-1">
                                <span class="text-sm font-medium">Activities</span>
                                <span class="text-sm font-medium">40%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill bg-blue-400" style="width: 40%;"></div>
                            </div>
                        </div>
                        <div class="progress-container">
                            <div class="flex justify-between mb-1">
                                <span class="text-sm font-medium">Performance</span>
                                <span class="text-sm font-medium">50%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill bg-green-400" style="width: 50%;"></div>
                            </div>
                        </div>
                        <div class="progress-container">
                            <div class="flex justify-between mb-1">
                                <span class="text-sm font-medium">Examination</span>
                                <span class="text-sm font-medium">50%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill bg-yellow-400" style="width: 50%;"></div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 pt-3 border-t border-blue-400 border-opacity-30">
                        <p class="text-sm opacity-80">Next milestone: Complete Module 4 by June 7</p>
                    </div>
                </div>
            </div>

            <!-- Reminders -->
            <div class="dark-blue-card mt-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold">Reminders for Current Activities</h3>
                    <span class="bg-red-500 text-white text-xs px-2 py-1 rounded-full">4 Active</span>
                </div>
                <div class="space-y-3">
                    <div class="flex items-start p-3 bg-blue-500 bg-opacity-20 rounded-lg">
                        <div class="flex-shrink-0 mt-1">
                            <i class="fas fa-file-alt text-blue-300"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm font-medium">Submit progress report</p>
                            <p class="text-xs opacity-80">Due: June 3</p>
                        </div>
                        <div class="ml-auto">
                            <span class="bg-red-500 text-white text-xs px-2 py-1 rounded-full">Urgent</span>
                        </div>
                    </div>
                    <div class="flex items-start p-3 bg-blue-500 bg-opacity-20 rounded-lg">
                        <div class="flex-shrink-0 mt-1">
                            <i class="fas fa-calendar-alt text-blue-300"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm font-medium">Attend online session</p>
                            <p class="text-xs opacity-80">June 5 at 10:00 AM</p>
                        </div>
                        <div class="ml-auto">
                            <span class="bg-yellow-500 text-white text-xs px-2 py-1 rounded-full">Soon</span>
                        </div>
                    </div>
                    <div class="flex items-start p-3 bg-blue-500 bg-opacity-20 rounded-lg">
                        <div class="flex-shrink-0 mt-1">
                            <i class="fas fa-book text-blue-300"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm font-medium">Complete Module 4</p>
                            <p class="text-xs opacity-80">Due: June 7</p>
                        </div>
                        <div class="ml-auto">
                            <span class="bg-green-500 text-white text-xs px-2 py-1 rounded-full">Upcoming</span>
                        </div>
                    </div>
                    <div class="flex items-start p-3 bg-blue-500 bg-opacity-20 rounded-lg">
                        <div class="flex-shrink-0 mt-1">
                            <i class="fas fa-comment text-blue-300"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm font-medium">Check feedback from instructor</p>
                            <p class="text-xs opacity-80">Ongoing</p>
                        </div>
                        <div class="ml-auto">
                            <span class="bg-purple-500 text-white text-xs px-2 py-1 rounded-full">Regular</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Section -->
        <div id="profile-section" class="content-section">
            <h2 class="text-2xl font-semibold text-gray-800 mb-5">Profile</h2>
            <div class="profile-container">
                <div class="profile-header">
                    <div>
                        <h1 class="text-2xl font-bold text-blue-700">DLL-LMSTC Registration Form</h1>
                        <p class="text-lg font-semibold text-gray-700">LEARNERS PROFILE FORM</p>
                    </div>
                    <div class="profile-photo">
                        <img src="{{profile.id_picture.url}}" alt="Profile Photo">
                    </div>
                </div>

                <div class="form-section">
                    <h2>1. TWMS Auto Generated</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>1.1 Unique Learner Identifier (ULI) Number:</label>
                            <input type="text" value="None" disabled>
                        </div>
                        <div class="form-group">
                            <label>1.2 Entry Date:</label>
                            <input type="text" value="{{profile.entry_date}}" disabled>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>2. Learner/Manpower Profile</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>2.1 Last Name</label>
                            <input type="text" value="{{ profile.last_name}}" disabled>
                        </div>
                        <div class="form-group">
                            <label>First Name</label>
                            <input type="text" value="{{profile.first_name}}" disabled>
                        </div>
                        <div class="form-group">
                            <label>Middle Name</label>
                            <input type="text" value="{{profile.middle_name}}" disabled>
                        </div>
                        <div class="form-group">
                            <label>Region</label>
                            <input type="text" value="{{profile.region}}" disabled>
                        </div>
                        <div class="form-group">
                            <label>Province</label>
                            <input type="text" value="{{profile.province}}" disabled>
                        </div>
                        <div class="form-group">
                            <label>City</label>
                            <input type="text" value="{{profile.city}}" disabled>
                        </div>
                        <div class="form-group">
                            <label>Barangay</label>
                            <input type="text" value="{{profile.barangay_name}}" disabled>
                        </div>
                        <div class="form-group">
                            <label>District</label>
                            <input type="text" value="{{profile.district}}" disabled>
                        </div>
                        <div class="form-group">
                            <label>Street</label>
                            <input type="text" value="{{profile.street}}" disabled>
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="text" value="{{profile.email}}" disabled>
                        </div>
                        <div class="form-group">
                            <label>Contact Number</label>
                            <input type="text" value="{{profile.contact_number}}" disabled>
                        </div>
                        <div class="form-group">
                            <label>Nationality</label>
                            <input type="text" value="{{profile.nationality}}" disabled>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>3. Personal Information</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>3.1 Sex</label>
                            <input type="text" value="{{profile.sex}}" disabled>
                        </div>
                        <div class="form-group">
                            <label>3.2 Civil Status</label>
                            <input type="text" value="{{profile.civil_status}}" disabled>
                        </div>
                        <div class="form-group">
                            <label>3.3 Employment Status</label>
                            <input type="text" value="{{profile.employment_status}}" disabled>
                        </div>
                        <div class="form-group">
                            <label>Monthly Income</label>
                            <input type="text" value="{{profile.monthly_income}}" disabled>
                        </div>
                        <div class="form-group">
                            <label>Date Hired</label>
                            <input type="text" value="{{profile.date_hired}}" disabled>
                        </div>
                        <div class="form-group">
                            <label>Company Name</label>
                            <input type="text" value="{{profile.company_name}}" disabled>
                        </div>
                        <div class="form-group">
                            <label>3.4 Birthdate</label>
                            <input type="text" value="{{profile.birthdate}}" disabled>
                        </div>
                        <div class="form-group">
                            <label>Age</label>
                            <input type="text" value="{{profile.age}}" disabled>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>3.5 Birthplace</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Birthplace Region</label>
                            <input type="text" value="{{profile.birthplace_regionb_name}}" disabled>
                        </div>
                        <div class="form-group">
                            <label>Birthplace Province</label>
                            <input type="text" value="{{profile.birthplace_provinceb_name}}" disabled>
                        </div>
                        <div class="form-group">
                            <label>Birthplace City/Municipality</label>
                            <input type="text" value="{{profile.birthplace_cityb_name}}" disabled>
                        </div>
                    </div>
                </div>

                <!-- Continue with other sections... -->
                <div class="form-section">
                    <h2>4. Learner/Trainee/Student (Clients) Classification</h2>
                    <div class="form-grid">
                        {% for classification in profile.classifications.all %}
                        <div class="form-group">
                            <label>Classification</label>
                            <input type="text" value="{{ classification.name }}" disabled>
                        </div>
                        {% endfor %}
                        {% if profile.other_classification %}
                        <div class="form-group">
                            <label>Other Classification</label>
                            <input type="text" value="{{ profile.other_classification }}" disabled>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <div class="form-section">
                    <h2>5. Type of Disability (for Persons with Disability Only)</h2>
                    <div class="form-grid">
                        {% for disability in profile.disability_types.all %}
                        <div class="form-group">
                            <label>Disability Type</label>
                            <input type="text" value="{{ disability.name }}" disabled>
                        </div>
                        {% empty %}
                        <div class="form-group">
                            <label>Disability Type</label>
                            <input type="text" value="None" disabled>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="form-section">
                    <h2>6. Causes of Disability (for Persons with Disability Only)</h2>
                    <div class="form-grid">
                        {% for cause in profile.disability_causes.all %}
                        <div class="form-group">
                            <label>Disability Cause</label>
                            <input type="text" value="{{ cause.name }}" disabled>
                        </div>
                        {% empty %}
                        <div class="form-group">
                            <label>Disability Cause</label>
                            <input type="text" value="None" disabled>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="form-section">
                    <h2>7. Course and Scholarship</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Name of Course/Qualification</label>
                            <input type="text" value="{{profile.course_or_qualification}}" disabled>
                        </div>
                        <div class="form-group">
                            <label>Scholarship Package</label>
                            <input type="text" value="{{profile.scholarship_package}}" disabled>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>8. Educational Attainment</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Educational Attainment</label>
                            <input type="text" value="{{profile.educational_attainment}}" disabled>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>9. Privacy Disclaimer</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Agreed to Privacy Disclaimer</label>
                            <input type="text" value="{% if profile.agree_to_privacy %}Yes{% else %}No{% endif %}" disabled>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>10. Applicant's Signature</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Applicant's Name</label>
                            <input type="text" value="{{profile.applicant_name}}" disabled>
                        </div>
                        <div class="form-group">
                            <label>Date Accomplished</label>
                            <input type="text" value="{{profile.date_accomplished}}" disabled>
                        </div>
                    </div>
                    {% if profile.applicant_signature %}
                    <div class="form-group mt-4">
                        <label>Signature:</label>
                        <div>
                            <img src="{{ profile.applicant_signature.url }}" alt="Applicant Signature" style="max-width: 300px; max-height: 100px;">
                        </div>
                    </div>
                    {% endif %}
                </div>

                <!-- Edit button at the lower right side -->
                <div class="flex justify-end mt-6">
                    <button class="add-button" id="editProfileBtn">
                        <i class="fas fa-edit"></i>
                        Edit Profile
                    </button>
                </div>
            </div>
        </div>

        <!-- Edit Profile Modal -->
        <div id="editProfileModal" class="modal-overlay hidden">
            <div class="modal-content" style="max-width: 800px; max-height: 90vh;">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-gray-800">Edit Profile</h2>
                    <button id="closeModalBtn" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="editProfileForm" method="POST" action="{% url 'update_profile' %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="profile-container" style="max-height: 70vh; overflow-y: auto;">
                        <div class="form-section">
                            <h2>1. TWMS Auto Generated</h2>
                            <fieldset class="form-group">
                                <legend>1.1 Unique Learner Identifier (ULI) Number:</legend>
                                <input type="text" name="uli_number" value="{{ profile.uli_number|default:'None' }}" disabled>
                            </fieldset>
                            <fieldset class="form-group">
                                <legend>1.2 Entry Date:</legend>
                                <input type="date" name="entry_date" value="{{ profile.entry_date|date:'Y-m-d' }}">
                            </fieldset>
                        </div>

                        <div class="form-section">
                            <h2>2. Learner/Manpower Profile</h2>
                            <div class="form-grid">
                                <fieldset class="form-group">
                                    <legend>2.1 Last Name</legend>
                                    <input type="text" name="last_name" value="{{ profile.last_name }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>First Name</legend>
                                    <input type="text" name="first_name" value="{{ profile.first_name }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Middle Name</legend>
                                    <input type="text" name="middle_name" value="{{ profile.middle_name }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Region</legend>
                                    <input type="text" name="region_name" value="{{ profile.region }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Province</legend>
                                    <input type="text" name="province_name" value="{{ profile.province }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>City</legend>
                                    <input type="text" name="city_name" value="{{ profile.city }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Barangay</legend>
                                    <input type="text" name="barangay_name" value="{{ profile.barangay_name }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>District</legend>
                                    <input type="text" name="district" value="{{ profile.district }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Street</legend>
                                    <input type="text" name="street" value="{{ profile.street }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Email</legend>
                                    <input type="email" name="email" value="{{ profile.email }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Contact Number</legend>
                                    <input type="text" name="contact_number" value="{{ profile.contact_number }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Nationality</legend>
                                    <input type="text" name="nationality" value="{{ profile.nationality }}">
                                </fieldset>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2>3. Personal Information</h2>
                            <div class="form-grid">
                                <fieldset class="form-group">
                                    <legend>3.1 Sex</legend>
                                    <select name="sex">
                                        <option value="Male" {% if profile.sex == "Male" %}selected{% endif %}>Male</option>
                                        <option value="Female" {% if profile.sex == "Female" %}selected{% endif %}>Female</option>
                                    </select>
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>3.2 Civil Status</legend>
                                    <select name="civil_status">
                                        <option value="Single" {% if profile.civil_status == "Single" %}selected{% endif %}>Single</option>
                                        <option value="Married" {% if profile.civil_status == "Married" %}selected{% endif %}>Married</option>
                                        <option value="Widower" {% if profile.civil_status == "Widower" %}selected{% endif %}>Widower</option>
                                        <option value="Separated" {% if profile.civil_status == "Separated" %}selected{% endif %}>Separated</option>
                                    </select>
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>3.3 Employment Status</legend>
                                    <select name="employment_status">
                                        <option value="Employed" {% if profile.employment_status == "Employed" %}selected{% endif %}>Employed</option>
                                        <option value="Unemployed" {% if profile.employment_status == "Unemployed" %}selected{% endif %}>Unemployed</option>
                                    </select>
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Monthly Income</legend>
                                    <input type="text" name="monthly_income" value="{{ profile.monthly_income }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Date Hired</legend>
                                    <input type="date" name="date_hired" value="{{ profile.date_hired|date:'Y-m-d' }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Company Name</legend>
                                    <input type="text" name="company_name" value="{{ profile.company_name }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>3.4 Birthdate</legend>
                                    <input type="date" name="birthdate" value="{{ profile.birthdate|date:'Y-m-d' }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Age</legend>
                                    <input type="number" name="age" value="{{ profile.age }}">
                                </fieldset>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2>3.5 Birthplace</h2>
                            <div class="form-grid">
                                <fieldset class="form-group">
                                    <legend>Birthplace Region</legend>
                                    <input type="text" name="birthplace-region-name" value="{{ profile.birthplace_regionb_name }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Birthplace Province</legend>
                                    <input type="text" name="birthplace-province-name" value="{{ profile.birthplace_provinceb_name }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Birthplace City/Municipality</legend>
                                    <input type="text" name="birthplace-city-name" value="{{ profile.birthplace_cityb_name }}">
                                </fieldset>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2>4. Learner/Trainee/Student (Clients) Classification</h2>
                            <div class="form-grid">
                                <fieldset class="form-group">
                                    <legend>Classifications</legend>
                                    <select name="classifications" multiple>
                                        {% for classification in all_classifications %}
                                        <option value="{{ classification.id }}" {% if classification in profile.classifications.all %}selected{% endif %}>
                                            {{ classification.name }}
                                        </option>
                                        {% endfor %}
                                    </select>
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Other Classification</legend>
                                    <input type="text" name="other_classification" value="{{ profile.other_classification }}">
                                </fieldset>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2>5. Type of Disability (for Persons with Disability Only)</h2>
                            <div class="form-grid">
                                <fieldset class="form-group">
                                    <legend>Disability Types</legend>
                                    <select name="disability_types" multiple>
                                        {% for disability in all_disability_types %}
                                        <option value="{{ disability.id }}" {% if disability in profile.disability_types.all %}selected{% endif %}>
                                            {{ disability.name }}
                                        </option>
                                        {% endfor %}
                                    </select>
                                </fieldset>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2>6. Causes of Disability (for Persons with Disability Only)</h2>
                            <div class="form-grid">
                                <fieldset class="form-group">
                                    <legend>Disability Causes</legend>
                                    <select name="disability_causes" multiple>
                                        {% for cause in all_disability_causes %}
                                        <option value="{{ cause.id }}" {% if cause in profile.disability_causes.all %}selected{% endif %}>
                                            {{ cause.name }}
                                        </option>
                                        {% endfor %}
                                    </select>
                                </fieldset>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2>7. Course and Scholarship</h2>
                            <div class="form-grid">
                                <fieldset class="form-group">
                                    <legend>Name of Course/Qualification</legend>
                                    <input type="text" name="course_or_qualification" value="{{ profile.course_or_qualification }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Scholarship Package</legend>
                                    <input type="text" name="scholarship_package" value="{{ profile.scholarship_package }}">
                                </fieldset>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2>8. Educational Attainment</h2>
                            <div class="form-grid">
                                <fieldset class="form-group">
                                    <legend>Educational Attainment</legend>
                                    <input type="text" name="educational_attainment" value="{{ profile.educational_attainment }}">
                                </fieldset>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2>9. Privacy Disclaimer</h2>
                            <div class="form-grid">
                                <fieldset class="form-group">
                                    <legend>
                                        <input type="checkbox" name="agree_to_privacy" {% if profile.agree_to_privacy %}checked{% endif %}>
                                        I agree to the privacy disclaimer
                                    </legend>
                                </fieldset>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2>10. Applicant's Signature</h2>
                            <div class="form-grid">
                                <fieldset class="form-group">
                                    <legend>Applicant's Name</legend>
                                    <input type="text" name="applicant_name" value="{{ profile.applicant_name }}">
                                </fieldset>
                                <fieldset class="form-group">
                                    <legend>Date Accomplished</legend>
                                    <input type="date" name="date_accomplished" value="{{ profile.date_accomplished|date:'Y-m-d' }}">
                                </fieldset>
                            </div>
                            <fieldset class="form-group mt-4">
                                <legend>Signature:</legend>
                                <input type="file" name="applicant_signature">
                                {% if profile.applicant_signature %}
                                <div class="mt-2">
                                    <img src="{{ profile.applicant_signature.url }}" alt="Current Signature" style="max-width: 300px; max-height: 100px;">
                                </div>
                                {% endif %}
                            </fieldset>
                        </div>
                    </div>
                    <div class="flex justify-end mt-6">
                        <button type="button" id="cancelEditBtn" class="px-4 py-2 bg-gray-300 text-gray-800 rounded-lg mr-2">Cancel</button>
                        <button type="submit" class="add-button">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Schedule Section -->
        <div id="schedule-section" class="content-section">
            <h2 class="text-2xl font-semibold text-gray-800 mb-5">Training Schedule</h2>
            <div class="list-container">
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Time</th>
                                <th>Topic</th>
                                <th>Trainer</th>
                                <th>Location</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for training in trainings %}
                            <tr>
                                <td>{{ training.start_date }}</td>
                                <td>
                                    {{ training.task_time|default:"" }} - {{ training.end_time|default:"" }}
                                </td>
                                <td>{{ training.program_name }}</td>
                                <td>{{ training.trainer.get_full_name|default:training.trainer.username }}</td>
                                <td>{{ training.room_lab }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="text-center text-gray-500">No training sessions found.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Competencies Section -->
        <div id="grades-section" class="content-section">
            <h2 class="text-2xl font-semibold text-gray-800 mb-5">Competencies</h2>
            
            <!-- Competencies Summary Cards -->
            <div class="dashboard-cards mb-6">
                <div class="card">
                    <div class="card-title">Basic Competencies</div>
                    <div class="card-value" style="color: #28a745;" id="basic-percentage">0%</div>
                    <div class="card-subtitle">Foundation Skills</div>
                </div>
                <div class="card">
                    <div class="card-title">Common Competencies</div>
                    <div class="card-value" style="color: #4A89DC;" id="common-percentage">0%</div>
                    <div class="card-subtitle">Core Skills</div>
                </div>
                <div class="card">
                    <div class="card-title">Core Competencies</div>
                    <div class="card-value" style="color: #f59e0b;" id="core-percentage">0%</div>
                    <div class="card-subtitle">Specialized Skills</div>
                </div>
                <div class="card">
                    <div class="card-title">Overall Progress</div>
                    <div class="card-value" style="color: #6F42C1;" id="overall-percentage">0%</div>
                    <div class="card-subtitle">Total Completion</div>
                </div>
            </div>

            <!-- Competencies Progress Overview -->
            <div class="list-container mb-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">Competencies Progress Overview</h3>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="dark-blue-card">
                        <h3>Competencies Progress Chart</h3>
                        <div class="mt-4">
                            <canvas id="competenciesChart" width="400" height="200"></canvas>
                        </div>
                    </div>
                    <div class="dark-blue-card">
                        <h3>Competencies Breakdown</h3>
                        <div class="space-y-4 mt-4">
                            <div class="progress-container">
                                <div class="progress-label">
                                    <span>Basic Competencies</span>
                                    <span id="basic-percentage-text">0%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="basic-progress-fill" style="width: 0%;"></div>
                                </div>
                            </div>
                            <div class="progress-container">
                                <div class="progress-label">
                                    <span>Common Competencies</span>
                                    <span id="common-percentage-text">0%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="common-progress-fill" style="width: 0%;"></div>
                                </div>
                            </div>
                            <div class="progress-container">
                                <div class="progress-label">
                                    <span>Core Competencies</span>
                                    <span id="core-percentage-text">0%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="core-progress-fill" style="width: 0%;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Competencies Details -->
            <div class="list-container">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold text-gray-800">Program Competencies</h3>
                    <div class="flex gap-2">
                        <select class="px-3 py-1 border border-gray-300 rounded-lg text-sm" id="competency-filter">
                            <option value="all">All Competencies</option>
                            <option value="basic">Basic Competencies</option>
                            <option value="common">Common Competencies</option>
                            <option value="core">Core Competencies</option>
                        </select>
                        <button class="add-button text-sm px-4 py-2" onclick="exportCompetencies()">
                            <i class="fas fa-download mr-1"></i>Export Report
                        </button>
                    </div>
                </div>
                
                <!-- Basic Competencies -->
                <div class="mb-6">
                    <h4 class="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                        <i class="fas fa-layer-group text-green-600 mr-2"></i>
                        Basic Competencies
                    </h4>
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <div id="basic-competencies-list" class="space-y-2">
                            <!-- Basic competencies will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Common Competencies -->
                <div class="mb-6">
                    <h4 class="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                        <i class="fas fa-cogs text-blue-600 mr-2"></i>
                        Common Competencies
                    </h4>
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <div id="common-competencies-list" class="space-y-2">
                            <!-- Common competencies will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Core Competencies -->
                <div class="mb-6">
                    <h4 class="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                        <i class="fas fa-star text-yellow-600 mr-2"></i>
                        Core Competencies
                    </h4>
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <div id="core-competencies-list" class="space-y-2">
                            <!-- Core competencies will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Career Opportunities & Progress Visualization -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
                <!-- Career Opportunities -->
                <div class="list-container">
                    <h4 class="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                        <i class="fas fa-briefcase text-purple-600 mr-2"></i>
                        Career Opportunities
                    </h4>
                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                        <div class="mb-4">
                            <p class="text-sm text-purple-800 font-medium mb-2">
                                <i class="fas fa-info-circle mr-1"></i>
                                Skills you will gain after completion of this program:
                            </p>
                            <div id="career-skills-list" class="space-y-2">
                                <!-- Career skills will be populated here -->
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-white rounded-lg border border-purple-200">
                            <p class="text-sm text-gray-700">
                                <strong>Note:</strong> Upon successful completion of this program, you will be equipped with industry-relevant skills and competencies that will open doors to various career opportunities in your chosen field.
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Progress Visualization -->
                <div class="list-container">
                    <h4 class="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                        <i class="fas fa-chart-pie text-indigo-600 mr-2"></i>
                        Progress Visualization
                    </h4>
                    <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-4">
                        <!-- Circular Progress Chart -->
                        <div class="flex justify-center items-center mb-4">
                            <div class="relative w-32 h-32">
                                <svg class="w-32 h-32 transform -rotate-90" viewBox="0 0 120 120">
                                    <!-- Background circle -->
                                    <circle cx="60" cy="60" r="50" stroke="#e5e7eb" stroke-width="8" fill="none"/>
                                    <!-- Progress circle -->
                                    <circle cx="60" cy="60" r="50" stroke="#4f46e5" stroke-width="8" fill="none" 
                                            stroke-dasharray="314" stroke-dashoffset="314" 
                                            id="progress-circle" class="transition-all duration-1000 ease-in-out"/>
                                </svg>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-indigo-600" id="progress-percentage">0%</div>
                                        <div class="text-xs text-gray-600">Complete</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Progress Details -->
                        <div class="space-y-2">
                            <div class="flex justify-between items-center text-sm">
                                <span class="text-gray-600">Basic Competencies</span>
                                <span class="font-semibold text-green-600" id="basic-detail-percentage">0%</span>
                            </div>
                            <div class="flex justify-between items-center text-sm">
                                <span class="text-gray-600">Common Competencies</span>
                                <span class="font-semibold text-blue-600" id="common-detail-percentage">0%</span>
                            </div>
                            <div class="flex justify-between items-center text-sm">
                                <span class="text-gray-600">Core Competencies</span>
                                <span class="font-semibold text-yellow-600" id="core-detail-percentage">0%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Job Recommendations Section -->
        <div id="jobs-section" class="content-section">
            {% if is_passer %}
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-gray-800">Job Recommendations</h2>
                    <button id="refresh-jobs-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors">
                        <i class="fas fa-sync-alt" id="refresh-icon"></i>
                        Refresh PESO Jobs
                    </button>
                </div>
            {% else %}
                <div class="locked-section-overlay">
                    <div class="locked-content">
                        <div class="text-center">
                            <i class="fas fa-lock text-6xl text-gray-400 mb-4"></i>
                            <h2 class="text-2xl font-semibold text-gray-600 mb-2">Job Recommendations Locked</h2>
                            <p class="text-gray-500 mb-4">Complete a program to unlock job recommendations</p>
                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                                <p class="text-yellow-800 text-sm">
                                    <i class="fas fa-info-circle mr-2"></i>
                                    You need to pass a program to access job recommendations and career opportunities.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}

            <!-- Statistics Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-white rounded-lg shadow p-4 border-l-4 border-blue-500">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-sm text-gray-600">Total Job Posts</p>
                            <p class="text-2xl font-bold text-gray-800" id="total-jobs-count">0</p>
                        </div>
                        <div class="bg-blue-100 p-3 rounded-full">
                            <i class="fas fa-briefcase text-blue-600"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow p-4 border-l-4 border-green-500">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-sm text-gray-600">Skill Matches</p>
                            <p class="text-2xl font-bold text-gray-800" id="skill-matches-count">0</p>
                        </div>
                        <div class="bg-green-100 p-3 rounded-full">
                            <i class="fas fa-check-circle text-green-600"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow p-4 border-l-4 border-yellow-500">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-sm text-gray-600">New This Week</p>
                            <p class="text-2xl font-bold text-gray-800" id="new-jobs-count">0</p>
                        </div>
                        <div class="bg-yellow-100 p-3 rounded-full">
                            <i class="fas fa-star text-yellow-600"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow p-4 border-l-4 border-purple-500">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-sm text-gray-600">Applications Sent</p>
                            <p class="text-2xl font-bold text-gray-800" id="applications-sent-count">0</p>
                        </div>
                        <div class="bg-purple-100 p-3 rounded-full">
                            <i class="fas fa-paper-plane text-purple-600"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filter and Search -->
            <div class="bg-white rounded-lg shadow p-4 mb-6">
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="flex-1">
                        <input type="text" id="job-search" placeholder="Search jobs by title, company, or skills..." 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div class="flex gap-2">
                        <select id="location-filter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="">All Locations</option>
                            <option value="lucena">Lucena City</option>
                            <option value="quezon">Quezon Province</option>
                            <option value="calabarzon">CALABARZON</option>
                        </select>
                        <button id="clear-filters" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600">
                            Clear
                        </button>
                    </div>
                </div>
            </div>

            <!-- Job Posts Container -->
            <div class="list-container">
                <div id="loading-indicator" class="hidden text-center py-8">
                    <div class="inline-flex items-center">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mr-3"></div>
                        <span class="text-gray-600">Loading PESO job posts...</span>
                    </div>
                </div>

                <div id="jobs-container" class="space-y-4 max-h-[600px] overflow-y-auto">
                    <!-- Job posts will be dynamically loaded here -->
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-briefcase text-4xl mb-4 text-gray-300"></i>
                        <p class="text-lg mb-2">No job posts loaded yet</p>
                        <p class="text-sm">Click "Refresh PESO Jobs" to load the latest opportunities</p>
                    </div>
                </div>

                <!-- Pagination -->
                <div id="pagination" class="hidden flex justify-center items-center mt-6 space-x-2">
                    <button id="prev-page" class="px-3 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 disabled:opacity-50">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <span id="page-info" class="px-4 py-2 text-gray-600">Page 1 of 1</span>
                    <button id="next-page" class="px-3 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 disabled:opacity-50">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Certification Section -->
        <div id="certification-section" class="content-section">
            <h2 class="text-2xl font-semibold text-gray-800 mb-5">Certification</h2>
            <div class="flex justify-center items-center min-h-screen">
                <div class="certificate-container w-full max-w-5xl rounded-xl shadow-2xl overflow-hidden relative p-2" style="background: linear-gradient(90deg, #1e40af 0%, #fbbf24 50%, #1e40af 100%);">
                    <!-- Overlay Buttons (Disabled) -->
                    <div class="absolute top-4 right-4 z-20 flex gap-2">
                        <button class="bg-gray-400 text-white px-3 py-2 rounded-lg shadow-lg cursor-not-allowed opacity-50 flex items-center gap-2 text-sm" disabled title="Download disabled for security">
                            <i class="fas fa-download"></i>
                            Download
                        </button>
                        <button class="bg-gray-400 text-white px-3 py-2 rounded-lg shadow-lg cursor-not-allowed opacity-50 flex items-center gap-2 text-sm" disabled title="Print disabled for security">
                            <i class="fas fa-print"></i>
                            Print
                        </button>
                    </div>
                    <div id="certificate-content" class="relative bg-white px-20 py-16 min-h-[600px] rounded-lg no-select">
                        <!-- Watermark overlay -->
                        <div class="certificate-watermark"></div>
                <!-- Decorative background elements -->
                <i class="fas fa-graduation-cap absolute left-0 top-1/2 transform -translate-y-1/2 text-yellow-400 opacity-10 text-9xl select-none pointer-events-none"></i>
                <i class="fas fa-star absolute right-0 top-1/2 transform -translate-y-1/2 text-yellow-400 opacity-10 text-9xl select-none pointer-events-none"></i>
                
                <!-- Certificate Header -->
                <div class="text-center mb-10 relative z-10">
                    <div class="mx-auto mb-5 w-24 h-24 rounded-full bg-blue-900 flex items-center justify-center">
                        <img src="{% static 'Images/icon.png' %}" alt="Logo" class="w-20 h-20 object-contain rounded-full" />
                    </div>
                    <h1 class="font-serif text-3xl md:text-4xl font-bold text-blue-900 leading-tight">Lucena Manpower Skill Training Center</h1>
                    <p class="uppercase tracking-wider text-base text-slate-500 font-semibold mt-1">Dalubhasaan ng Lungsod ng Lucena</p>
                </div>
                
                <!-- Certificate Title -->
                <h2 class="text-center font-serif text-4xl font-semibold text-yellow-400 my-8 drop-shadow">Certificate of Completion</h2>
                
                <!-- Certificate Text -->
                <div class="text-center text-lg text-slate-700 my-6">
                    <p>This is to certify that</p>
                </div>
                
                <!-- Recipient Name -->
                <div class="font-serif text-3xl font-bold text-blue-900 text-center my-6 py-4 border-b-4 border-yellow-400 w-full">{{ profile.first_name }} {{ profile.middle_name }} {{ profile.last_name }}</div>
                
                <!-- Course Details -->
                <div class="text-center text-base italic text-slate-500 my-6">
                    <p>has successfully completed the requirements for</p>
                    <p class="font-semibold text-lg text-blue-800">
                        {% if program_info %}
                            {{ program_info.program_name }}
                        {% else %}
                            {{ profile.course_or_qualification|default:'[Program Name]' }}
                        {% endif %}
                    </p>
                    <p>and has demonstrated proficiency in the required skills and competencies.</p>
                    <p class="mt-4">We sincerely thank you for your dedication and commitment in completing this program. We hope you continue to pursue more skills and achieve greater success in your future endeavors.</p>
                </div>
                
                <!-- Certificate Footer -->
                <div class="flex flex-row justify-between items-end mt-16 pt-8 border-t-2 border-slate-200">
                    <div class="flex-1 text-center">
                        <p class="text-sm text-slate-500 font-medium mb-2">
                            {% if trainer_name %}
                                {{ trainer_name }}
                                <br><span class="text-xs">{{ program_info.program_name|default:"Training Program" }}</span>
                            {% else %}
                                Trainer Name
                                <br><span class="text-xs">Training Program</span>
                            {% endif %}
                        </p>
                        <div class="mx-auto w-52 h-0.5 bg-blue-900"></div>
                    </div>
                    <div class="flex-1 text-center">
                        <p class="text-sm text-slate-500 mb-1">Date Issued:</p>
                        <p class="text-base text-blue-900 font-semibold">{{ profile.date_accomplished|date:'F j, Y'|default:'[Date]' }}</p>
                    </div>
                    <div class="flex-1 text-center">
                        <div class="mx-auto w-52 h-0.5 bg-blue-900 mb-2"></div>
                        <p class="text-sm text-slate-500 font-medium">Training Coordinator</p>
                    </div>
                </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- Ticket Section -->
        <div id="ticket-section" class="content-section">
            <h2 class="text-2xl font-semibold text-gray-800 mb-5">Support Tickets</h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Create New Ticket -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-lg shadow">
                        <div class="p-6 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Submit a Support Ticket</h3>
                            <form id="ticketForm">
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Ticket Category</label>
                                    <select id="ticketCategory" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        <option value="">Select a category...</option>
                                        <option value="academic">Academic/Training Issues</option>
                                        <option value="technical">Technical Issues</option>
                                        <option value="administrative">Administrative Issues</option>
                                        <option value="facility">Facility/Equipment Issues</option>
                                        <option value="assessment">Assessment/Certification Issues</option>
                                        <option value="general">General Complaints/Feedback</option>
                                    </select>
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Priority Level</label>
                                    <select id="ticketPriority" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        <option value="low">Low - General inquiry</option>
                                        <option value="medium" selected>Medium - Standard issue</option>
                                        <option value="high">High - Urgent matter</option>
                                        <option value="critical">Critical - Emergency</option>
                                    </select>
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Send to</label>
                                    <select id="ticketRecipient" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        <option value="admin">Admin Support</option>
                                        <option value="trainer">My Trainer</option>
                                        <option value="both">Both Admin & Trainer</option>
                                    </select>
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Subject</label>
                                    <input type="text" id="ticketSubject" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Brief description of your issue">
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                                    <textarea id="ticketDescription" rows="5" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Please provide detailed information about your issue or complaint..."></textarea>
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Attachment (Optional)</label>
                                    <input type="file" id="ticketAttachment" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" accept=".jpg,.jpeg,.png,.pdf,.doc,.docx">
                                    <p class="text-xs text-gray-500 mt-1">Supported formats: JPG, PNG, PDF, DOC, DOCX (Max 5MB)</p>
                                </div>
                                
                                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium">
                                    <i class="fas fa-paper-plane mr-2"></i>Submit Ticket
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                
                <!-- My Tickets -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-lg shadow">
                        <div class="p-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">My Tickets</h3>
                            <p class="text-sm text-gray-600 mt-1">Track your submitted tickets</p>
                        </div>
                        <div class="max-h-96 overflow-y-auto">
                            <!-- Sample Ticket 1 -->
                            <div class="p-4 border-b border-gray-100 hover:bg-gray-50">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <div class="flex items-center mb-2">
                                            <span class="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-full mr-2">OPEN</span>
                                            <span class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full">HIGH</span>
                                        </div>
                                        <h4 class="font-medium text-gray-800 text-sm">Equipment Malfunction</h4>
                                        <p class="text-xs text-gray-600 mt-1">Welding machine not working properly...</p>
                                        <div class="flex items-center text-xs text-gray-500 mt-2">
                                            <i class="fas fa-clock mr-1"></i>
                                            <span>2 hours ago</span>
                                            <span class="mx-2">‚Ä¢</span>
                                            <i class="fas fa-user mr-1"></i>
                                            <span>Admin Support</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Sample Ticket 2 -->
                            <div class="p-4 border-b border-gray-100 hover:bg-gray-50">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <div class="flex items-center mb-2">
                                            <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full mr-2">IN PROGRESS</span>
                                            <span class="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-full">MEDIUM</span>
                                        </div>
                                        <h4 class="font-medium text-gray-800 text-sm">Schedule Conflict</h4>
                                        <p class="text-xs text-gray-600 mt-1">Unable to attend class due to work...</p>
                                        <div class="flex items-center text-xs text-gray-500 mt-2">
                                            <i class="fas fa-clock mr-1"></i>
                                            <span>1 day ago</span>
                                            <span class="mx-2">‚Ä¢</span>
                                            <i class="fas fa-user mr-1"></i>
                                            <span>My Trainer</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Sample Ticket 3 -->
                            <div class="p-4 border-b border-gray-100 hover:bg-gray-50">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <div class="flex items-center mb-2">
                                            <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full mr-2">RESOLVED</span>
                                            <span class="bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded-full">LOW</span>
                                        </div>
                                        <h4 class="font-medium text-gray-800 text-sm">Login Issues</h4>
                                        <p class="text-xs text-gray-600 mt-1">Cannot access my account...</p>
                                        <div class="flex items-center text-xs text-gray-500 mt-2">
                                            <i class="fas fa-clock mr-1"></i>
                                            <span>3 days ago</span>
                                            <span class="mx-2">‚Ä¢</span>
                                            <i class="fas fa-user mr-1"></i>
                                            <span>Admin Support</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Ticket Categories Help -->
                        <div class="p-4 bg-gray-50">
                            <h4 class="text-sm font-semibold text-gray-800 mb-2">Common Issues:</h4>
                            <ul class="text-xs text-gray-600 space-y-1">
                                <li>‚Ä¢ Schedule conflicts or class changes</li>
                                <li>‚Ä¢ Equipment or facility problems</li>
                                <li>‚Ä¢ Assessment or certification issues</li>
                                <li>‚Ä¢ Technical platform problems</li>
                                <li>‚Ä¢ Administrative concerns</li>
                                <li>‚Ä¢ General feedback or complaints</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Document Management Section -->
        <div id="document-management-section" class="content-section">
            <h2 class="text-2xl font-semibold text-gray-800 mb-5">Document Management</h2>
            
            <!-- Tab Navigation -->
            <div class="tab-navigation mb-6">
                <div class="flex border-b border-gray-200">
                    <button class="tab-button active" data-tab="id-photo">
                        <i class="fas fa-id-card mr-2"></i>
                        My ID Photo
                    </button>
                    <button class="tab-button" data-tab="my-profile">
                        <i class="fas fa-user mr-2"></i>
                        My Profile
                    </button>
                </div>
            </div>

            <!-- Tab Content -->
            <div class="tab-content">
                <!-- My ID Photo Tab -->
                <div id="id-photo-tab" class="tab-panel active">
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-semibold text-gray-800">My ID Photo</h3>
                            <button id="change-id-photo" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200 flex items-center">
                                <i class="fas fa-camera mr-2"></i>
                                Change ID Photo
                            </button>
                        </div>
                        <div class="text-center">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">My ID Photo</h3>
                            
                            {% if profile.id_picture %}
                                <div class="inline-block border-4 border-gray-200 rounded-lg p-4 bg-gray-50">
                                    <img src="{{ profile.id_picture.url }}" 
                                         alt="ID Photo" 
                                         class="w-48 h-60 object-cover rounded-lg shadow-md"
                                         style="max-width: 200px; max-height: 250px;">
                                </div>
                                <div class="mt-4">
                                    <p class="text-sm text-gray-600 mb-2">Uploaded ID Photo</p>
                                    <div class="flex justify-center gap-2">
                                        <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm">
                                            <i class="fas fa-download mr-1"></i>
                                            Download
                                        </button>
                                        <button class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm">
                                            <i class="fas fa-eye mr-1"></i>
                                            View Full Size
                                        </button>
                                    </div>
                                </div>
                            {% else %}
                                <div class="text-center py-12">
                                    <i class="fas fa-image text-6xl text-gray-300 mb-4"></i>
                                    <h4 class="text-lg font-semibold text-gray-600 mb-2">No ID Photo Uploaded</h4>
                                    <p class="text-gray-500 mb-4">You haven't uploaded an ID photo yet.</p>
                                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 max-w-md mx-auto">
                                        <p class="text-yellow-800 text-sm">
                                            <i class="fas fa-info-circle mr-2"></i>
                                            Contact your administrator to upload your ID photo.
                                        </p>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- My Profile Tab -->
                <div id="my-profile-tab" class="tab-panel">
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-semibold text-gray-800">My Profile Information</h3>
                            <div class="flex gap-3">
                                <button id="download-profile-pdf" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200 flex items-center">
                                    <i class="fas fa-download mr-2"></i>
                                    Download PDF
                                </button>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- Personal Information -->
                            <div class="space-y-4">
                                <h4 class="text-md font-semibold text-gray-700 border-b border-gray-200 pb-2">
                                    <i class="fas fa-user mr-2"></i>Personal Information
                                </h4>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Full Name</label>
                                    <p class="text-gray-800 font-medium">{{ profile.last_name }}, {{ profile.first_name }} {{ profile.middle_name|default:"" }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Email</label>
                                    <p class="text-gray-800">{{ profile.email }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Contact Number</label>
                                    <p class="text-gray-800">{{ profile.contact_number|default:"Not provided" }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Sex</label>
                                    <p class="text-gray-800">{{ profile.sex|default:"Not specified" }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Civil Status</label>
                                    <p class="text-gray-800">{{ profile.civil_status|default:"Not specified" }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Birthdate</label>
                                    <p class="text-gray-800">{{ profile.birthdate|default:"Not provided" }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Age</label>
                                    <p class="text-gray-800">{{ profile.age|default:"Not provided" }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Nationality</label>
                                    <p class="text-gray-800">{{ profile.nationality|default:"Not specified" }}</p>
                                </div>
                            </div>

                            <!-- Address Information -->
                            <div class="space-y-4">
                                <h4 class="text-md font-semibold text-gray-700 border-b border-gray-200 pb-2">
                                    <i class="fas fa-map-marker-alt mr-2"></i>Address Information
                                </h4>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Region</label>
                                    <p class="text-gray-800">{{ profile.region_name|default:profile.region }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Province</label>
                                    <p class="text-gray-800">{{ profile.province_name|default:profile.province }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">City</label>
                                    <p class="text-gray-800">{{ profile.city_name|default:profile.city }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Barangay</label>
                                    <p class="text-gray-800">{{ profile.barangay_name|default:profile.barangay }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Street</label>
                                    <p class="text-gray-800">{{ profile.street|default:"Not provided" }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">District</label>
                                    <p class="text-gray-800">{{ profile.district|default:"Not applicable" }}</p>
                                </div>
                            </div>

                            <!-- Employment Information -->
                            <div class="space-y-4">
                                <h4 class="text-md font-semibold text-gray-700 border-b border-gray-200 pb-2">
                                    <i class="fas fa-briefcase mr-2"></i>Employment Information
                                </h4>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Employment Status</label>
                                    <p class="text-gray-800">{{ profile.employment_status|default:"Not specified" }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Monthly Income</label>
                                    <p class="text-gray-800">{{ profile.monthly_income|default:"Not specified" }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Company Name</label>
                                    <p class="text-gray-800">{{ profile.company_name|default:"Not specified" }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Date Hired</label>
                                    <p class="text-gray-800">{{ profile.date_hired|default:"Not specified" }}</p>
                                </div>
                            </div>

                            <!-- Educational Information -->
                            <div class="space-y-4">
                                <h4 class="text-md font-semibold text-gray-700 border-b border-gray-200 pb-2">
                                    <i class="fas fa-graduation-cap mr-2"></i>Educational Information
                                </h4>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Educational Attainment</label>
                                    <p class="text-gray-800">{{ profile.educational_attainment|default:"Not specified" }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Course/Qualification</label>
                                    <p class="text-gray-800">{{ profile.course_or_qualification|default:"Not specified" }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Scholarship Package</label>
                                    <p class="text-gray-800">{{ profile.scholarship_package|default:"Not specified" }}</p>
                                </div>
                                
                                <div class="profile-field">
                                    <label class="text-sm font-medium text-gray-600">Parent/Guardian</label>
                                    <p class="text-gray-800">{{ profile.parent_guardian|default:"Not specified" }}</p>
                                </div>
                            </div>
                        </div>

                        <!-- Additional Information -->
                        <div class="mt-8 pt-6 border-t border-gray-200">
                            <h4 class="text-md font-semibold text-gray-700 mb-4">
                                <i class="fas fa-info-circle mr-2"></i>Additional Information
                            </h4>
                            
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div class="space-y-4">
                                    <div class="profile-field">
                                        <label class="text-sm font-medium text-gray-600">Birthplace</label>
                                        <p class="text-gray-800">
                                            {% if profile.birthplace_regionb_name %}
                                                {{ profile.birthplace_regionb_name }}, {{ profile.birthplace_provinceb_name }}, {{ profile.birthplace_cityb_name }}
                                            {% else %}
                                                Not specified
                                            {% endif %}
                                        </p>
                                    </div>
                                    
                                    <div class="profile-field">
                                        <label class="text-sm font-medium text-gray-600">Permanent Address</label>
                                        <p class="text-gray-800">{{ profile.permanent_address|default:"Not specified" }}</p>
                                    </div>
                                </div>
                                
                                <div class="space-y-4">
                                    <div class="profile-field">
                                        <label class="text-sm font-medium text-gray-600">Entry Date</label>
                                        <p class="text-gray-800">{{ profile.entry_date|default:"Not specified" }}</p>
                                    </div>
                                    
                                    <div class="profile-field">
                                        <label class="text-sm font-medium text-gray-600">Date Accomplished</label>
                                        <p class="text-gray-800">{{ profile.date_accomplished|default:"Not specified" }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Certification Section -->
        <div id="certification-section" class="content-section">
            <h2 class="text-2xl font-semibold text-gray-800 mb-5">Certification</h2>
            
            {% if not is_passer %}
            <!-- Watermark overlay for non-passers -->
            <div class="certification-watermark-overlay">
                <div class="watermark-content">
                    <i class="fas fa-lock text-6xl text-gray-300 mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-400 mb-2">Complete a Program to Access Certifications</h3>
                    <p class="text-gray-400">You need to pass a program to unlock certification features</p>
                </div>
            </div>
            {% endif %}
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 {% if not is_passer %}opacity-50{% endif %}">
                <!-- Available Certifications -->
                <div class="bg-white rounded-lg shadow">
                    <div class="p-6 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-800">Available Certifications</h3>
                        <p class="text-sm text-gray-600 mt-1">Certifications you can apply for based on your completed programs</p>
                    </div>
                    <div class="p-6">
                        <!-- Certification Item -->
                        <div class="border border-gray-200 rounded-lg p-4 mb-4">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <h4 class="font-semibold text-gray-800">Automotive Servicing NC II</h4>
                                    <p class="text-sm text-gray-600 mt-1">National Certificate Level II in Automotive Servicing</p>
                                    <div class="flex items-center mt-2">
                                        <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full mr-2">Eligible</span>
                                        <span class="text-xs text-gray-500">Program Completed: 95%</span>
                                    </div>
                                </div>
                                <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm ml-4">
                                    Apply
                                </button>
                            </div>
                        </div>

                        <!-- Another Certification -->
                        <div class="border border-gray-200 rounded-lg p-4 mb-4">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <h4 class="font-semibold text-gray-800">Welding NC I</h4>
                                    <p class="text-sm text-gray-600 mt-1">National Certificate Level I in Welding</p>
                                    <div class="flex items-center mt-2">
                                        <span class="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-full mr-2">In Progress</span>
                                        <span class="text-xs text-gray-500">Program Completed: 65%</span>
                                    </div>
                                </div>
                                <button class="bg-gray-400 text-white px-4 py-2 rounded-lg text-sm ml-4 cursor-not-allowed" disabled>
                                    Not Ready
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- My Certificates -->
                <div class="bg-white rounded-lg shadow">
                    <div class="p-6 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-800">My Certificates</h3>
                        <p class="text-sm text-gray-600 mt-1">Your earned certificates and their status</p>
                    </div>
                    <div class="p-6">
                        <!-- Certificate Item -->
                        <div class="border border-gray-200 rounded-lg p-4 mb-4">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <h4 class="font-semibold text-gray-800">Computer Systems Servicing NC II</h4>
                                    <p class="text-sm text-gray-600 mt-1">Issued: March 15, 2024</p>
                                    <p class="text-sm text-gray-600">Certificate No: CSS-2024-001234</p>
                                    <div class="flex items-center mt-2">
                                        <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Valid</span>
                                    </div>
                                </div>
                                <div class="flex flex-col space-y-2 ml-4">
                                    <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm">
                                        <i class="fas fa-download mr-2"></i>Download
                                    </button>
                                    <button class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm">
                                        <i class="fas fa-eye mr-2"></i>View
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- No certificates message -->
                        <div class="text-center py-8 text-gray-500">
                            <i class="fas fa-certificate text-4xl mb-4"></i>
                            <p>Complete your programs to earn certificates</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Admin Approval Notice Modal -->
    <div id="adminApprovalModal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; display: none; z-index: 2000; background-color: rgba(0, 0, 0, 0.5);">
        <div class="modal-content" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); max-width: 500px; text-align: center;">
            <div class="text-center">
                <!-- Close button -->
                <div class="flex justify-end mb-2">
                    <button id="closeAdminApprovalModal" class="text-gray-500 hover:text-gray-700" style="background: none; border: none; font-size: 1.5rem;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4">
                    <i class="fas fa-hourglass-half text-blue-600 text-2xl"></i>
                </div>
                <h2 class="text-xl font-bold mb-4 text-gray-800">Application Under Review</h2>
                <p class="text-gray-600 mb-6">
                    Your application is currently being reviewed by an administrator.
                    Please wait patiently while we process your request.
                    You will be notified once your application has been approved.
                </p>
                <!-- Navigation buttons -->
                <div class="flex justify-center gap-4 mt-6">
                    <button id="dismissAdminModal" class="add-button">
                        <i class="fas fa-check"></i>
                        Got it!
                    </button>
                    <a href="{% url 'Homepage_user' %}" class="add-button">
                        <i class="fas fa-home"></i>
                        Homepage
                    </a>
                    <a href="{% url 'logout_view' %}" class="add-button" style="background-color: #dc3545;">
                        <i class="fas fa-sign-out-alt"></i>
                        Logout
                    </a>
                </div>
                <div class="mt-4">
                    <p class="text-sm text-gray-500">
                        This notice will disappear automatically once your application is approved.
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Application Success Modal -->
    <div id="applicationModal" class="modal fade success-modal" tabindex="-1" aria-labelledby="applicationModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content fade-in">
                <div class="modal-header">
                    <h5 class="modal-title" id="applicationModalLabel">
                        <i class="fas fa-check-circle me-2"></i>üéâ Congratulations!
                    </h5>
                </div>
                <div class="modal-body p-4">
                    <div class="text-center mb-4">
                        <div class="success-icon mb-3">
                            <i class="fas fa-trophy text-warning" style="font-size: 3rem;"></i>
                        </div>
                        <h4 class="text-success mb-2">
                            <strong>Successful application for {{ applied_program_name }}!</strong>
                        </h4>
                        <p class="text-muted">Check your account regularly for future updates.</p>
                    </div>
                    
                    <div class="application-progress">
                        <h6 class="mb-3 text-dark">Application Progress:</h6>
                        <div class="list-group">
                            <div class="list-group-item progress-item completed d-flex align-items-center">
                                <i class="fas fa-check-circle text-success me-3"></i>
                                <span><strong>Online Application Submission</strong></span>
                            </div>
                            <div class="list-group-item progress-item pending d-flex align-items-center">
                                <i class="far fa-circle text-muted me-3"></i>
                                <span>Online Application Processing</span>
                            </div>
                            <div class="list-group-item progress-item pending d-flex align-items-center">
                                <i class="far fa-circle text-muted me-3"></i>
                                <span>Review of Application</span>
                            </div>
                            <div class="list-group-item progress-item pending d-flex align-items-center">
                                <i class="far fa-circle text-muted me-3"></i>
                                <span>Orientation Attendance Confirmation</span>
                            </div>
                            <div class="list-group-item progress-item pending d-flex align-items-center">
                                <i class="far fa-circle text-muted me-3"></i>
                                <span>Application Approval</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-warning mt-4" role="alert">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Important Note:</strong> Failure to attend the orientation will result in your application being denied.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success btn-lg px-4" onclick="closeApplicationModal()">
                        <i class="fas fa-check me-2"></i>Got it, Thanks!
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Application Approved Congratulatory Modal -->
    <div id="applicationApprovedModal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; display: none; z-index: 2000; background-color: rgba(0, 0, 0, 0.5);">
        <div class="modal-content" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); max-width: 500px; text-align: center;">
            <div class="text-center">
                <div class="mx-auto w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4">
                    <i class="fas fa-check-circle text-green-600 text-2xl"></i>
                </div>
                <h2 class="text-xl font-bold mb-4 text-gray-800">Congratulations!</h2>
                <p class="text-gray-600 mb-6">
                    Your application has been approved!
                    You can now proceed with the next steps of the program.
                </p>
                <div class="mt-4">
                    <button id="closeApprovedModalBtn" class="add-button">
                        <i class="fas fa-times"></i>
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Initialize Chart
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing navigation...');
            // Initialize section switching first (most important for navigation)
            initializeSectionSwitching();
            // Initialize notifications
            initializeNotifications();
            
            // Initialize charts with error handling
            try {
                const chartElement = document.getElementById('completionChart');
                if (chartElement) {
                    const ctx = chartElement.getContext('2d');
                    // Get the approved count and total programs from the template context
                    const approvedCount = parseInt("{{ approved_count|default:0 }}");
                    const totalPrograms = parseInt("{{ total_programs|default:0 }}");
                    const remainingCount = totalPrograms > approvedCount ? totalPrograms - approvedCount : 0;
                    
                    new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Complete', 'Remaining'],
                            datasets: [{
                                data: [approvedCount, remainingCount],
                                backgroundColor: ['#60A5FA', '#F87171'],
                                borderColor: '#1E3A8A',
                                borderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            cutout: '50%',
                            plugins: {
                                legend: {
                                    display: true,
                                    position: 'bottom',
                                    labels: {
                                        color: 'white'
                                    }
                                }
                            }
                        }
                    });
                }
                
                // Initialize Grade Chart
                initializeGradeChart();
                
                // Initialize Competencies Chart
                initializeCompetenciesChart();
                
                // Initialize Competencies Data
                initializeCompetenciesData();
            } catch (error) {
                console.log('Chart initialization failed:', error);
                // Navigation will still work even if charts fail
            }
        });

        // Global section switching functionality
        let sidebarLinks, contentSections;
        
        function showSection(sectionId) {
            console.log('Switching to section:', sectionId);
            
            // Hide all content sections
            if (contentSections) {
                contentSections.forEach(section => {
                    section.classList.remove('active');
                });
            }
            
            // Show the target section
            const targetSection = document.getElementById(sectionId + '-section');
            if (targetSection) {
                targetSection.classList.add('active');
                console.log('Successfully switched to section:', sectionId);
            } else {
                console.error('Section not found:', sectionId + '-section');
                console.log('Available sections:', document.querySelectorAll('.content-section'));
                return;
            }

            // Update active sidebar link
            if (sidebarLinks) {
                sidebarLinks.forEach(link => {
                    link.classList.remove('active');
                });
                const activeLink = document.querySelector(`.sidebar-nav a[data-section="${sectionId}"]`);
                if (activeLink) {
                    activeLink.classList.add('active');
                } else {
                    console.error('Sidebar link not found for section:', sectionId);
                }
            }
        }

        function initializeSectionSwitching() {
            sidebarLinks = document.querySelectorAll('.sidebar-nav a[data-section]');
            contentSections = document.querySelectorAll('.content-section');

            console.log('Navigation initialized. Found', sidebarLinks.length, 'sidebar links and', contentSections.length, 'content sections');
            console.log('Sidebar links:', sidebarLinks);
            console.log('Content sections:', contentSections);

            sidebarLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const sectionId = this.dataset.section;
                    console.log('Navigation link clicked:', sectionId, this);
                    showSection(sectionId);
                });
            });
            
            // Show the overview section by default
            console.log('Setting overview section as default...');
            showSection('overview');
            
            // Make showSection function globally accessible for testing
            window.testNavigation = function(sectionId) {
                console.log('Testing navigation to:', sectionId);
                showSection(sectionId);
            };
        }

        // Notification functionality
        function initializeNotifications() {
            const bellBtn = document.getElementById('bell-btn');
            const notificationBox = document.getElementById('notification-box');
            const notificationBadge = document.getElementById('notification-badge');
            const notificationsList = document.getElementById('notifications-list');
            const markAllReadBtn = document.getElementById('mark-all-read');

            // Toggle notification box
            bellBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                notificationBox.classList.toggle('hidden');
                if (!notificationBox.classList.contains('hidden')) {
                    loadNotifications();
                }
            });

            // Mark all read functionality
            if (markAllReadBtn) {
                markAllReadBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    markAllNotificationsAsRead();
                });
            }

            // Close notification box when clicking outside
            document.addEventListener('click', function(e) {
                if (!notificationBox.contains(e.target) && !bellBtn.contains(e.target)) {
                    notificationBox.classList.add('hidden');
                }
            });

            // Load notifications
            function loadNotifications() {
                fetch('/get-notifications/')
                    .then(response => response.json())
                    .then(data => {
                        updateNotificationBadge(data.unread_count);
                        renderNotifications(data.notifications);
                    })
                    .catch(error => {
                        console.error('Error loading notifications:', error);
                        notificationsList.innerHTML = '<div class="p-4 text-center text-red-500">Error loading notifications</div>';
                    });
            }

            // Update notification badge
            function updateNotificationBadge(count) {
                if (count > 0) {
                    notificationBadge.textContent = count > 99 ? '99+' : count;
                    notificationBadge.classList.remove('hidden');
                } else {
                    notificationBadge.classList.add('hidden');
                }
            }

            // Render notifications
            function renderNotifications(notifications) {
                if (notifications.length === 0) {
                    notificationsList.innerHTML = '<div class="p-4 text-center text-gray-500">No notifications</div>';
                    return;
                }

                const notificationsHTML = notifications.map(notification => {
                    // Extract program name from message for program_completion notifications
                    let programName = '';
                    if (notification.notification_type === 'program_completion') {
                        const match = notification.message.match(/completed the (.+?) program/);
                        if (match) {
                            programName = match[1];
                        }
                    }
                    
                    return `
                    <div class="notification-item ${notification.is_read ? 'opacity-60' : ''}"
                         data-notification-id="${notification.id}"
                         data-notification-type="${notification.notification_type}"
                         ${notification.notification_type === 'program_completion' ? `data-program-name="${programName}"` : ''}>
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                ${notification.notification_type === 'program_completion' ? '<i class="fas fa-trophy text-yellow-500 mr-2"></i>' : ''}
                                <h4 class="font-semibold text-sm ${notification.is_read ? 'text-gray-600' : 'text-blue-600'}">${notification.title}</h4>
                                <p class="text-xs text-gray-600 mt-1">${notification.message}</p>
                                <p class="text-xs text-gray-400 mt-1">${notification.created_at}</p>
                            </div>
                            ${!notification.is_read ? '<div class="w-2 h-2 bg-blue-500 rounded-full ml-2 mt-1"></div>' : ''}
                        </div>
                    </div>
                    `;
                }).join('');

                notificationsList.innerHTML = notificationsHTML;

                // Add click handlers for individual notifications
                document.querySelectorAll('.notification-item').forEach(item => {
                    item.addEventListener('click', function() {
                        const notificationId = this.dataset.notificationId;
                        markNotificationAsRead(notificationId);
                    });
                });
            }

            // Mark notification as read
            function markNotificationAsRead(notificationId) {
                fetch(`/mark-notification-read/${notificationId}/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}',
                        'Content-Type': 'application/json',
                    },
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        loadNotifications(); // Reload to update the display
                    }
                })
                .catch(error => console.error('Error marking notification as read:', error));
            }

            // Mark all notifications as read
            function markAllNotificationsAsRead() {
                fetch('/mark-all-notifications-read/', {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}',
                        'Content-Type': 'application/json',
                    },
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        loadNotifications(); // Reload to update the display
                        updateNotificationBadge(0); // Clear the badge
                    }
                })
                .catch(error => console.error('Error marking all notifications as read:', error));
            }

            // Mark all notifications as read
            if (markAllReadBtn) {
                markAllReadBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Show loading state
                    markAllReadBtn.textContent = 'Marking...';
                    markAllReadBtn.disabled = true;
                    
                    // Use the absolute URL for the endpoint
                    fetch('/mark-all-notifications-read/', {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': '{{ csrf_token }}',
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({})
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data.success) {
                            showNotification('All notifications marked as read!', 'success');
                            loadNotifications();
                            updateNotificationBadge(0);
                        } else {
                            throw new Error(data.error || 'Unknown error');
                        }
                    })
                    .catch(error => {
                        console.error('Error marking all notifications as read:', error);
                        showNotification('Failed to mark notifications as read. Please try again.', 'error');
                    })
                    .finally(() => {
                        // Reset button state
                        markAllReadBtn.textContent = 'Mark all read';
                        markAllReadBtn.disabled = false;
                    });
                });
            }

            // Load notifications on page load
            loadNotifications();

            // Auto-refresh notifications every 30 seconds
            setInterval(loadNotifications, 30000);
        }

        // Get CSRF token
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }


        // Application modal functions
        function closeApplicationModal() {
            const modal = document.getElementById('applicationModal');
            const bootstrapModal = bootstrap.Modal.getInstance(modal);
            if (bootstrapModal) {
                bootstrapModal.hide();
            }

            // Clear the session flag via AJAX
            fetch('{% url "clear_modal_session" %}', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/json',
                },
            });
        }

        // Show modal if session flag is set
        document.addEventListener('DOMContentLoaded', function() {
            // Check if show_modal is true (passed from Django view)
            const body = document.querySelector('body');
            const showModal = body && body.dataset.showModal === 'true';
            if (showModal) {
                const modal = new bootstrap.Modal(document.getElementById('applicationModal'), {
                    backdrop: 'static',
                    keyboard: false
                });
                modal.show();
            }
            
            // Show admin approval modal for users with pending applications
            const pendingApplications = document.querySelectorAll('.inline-flex:contains("Pending"), .status-badge.pending');
            const hasPendingApplications = Array.from(document.querySelectorAll('.inline-flex')).some(badge => 
                badge.textContent.toLowerCase().includes('pending')
            );
            
            if (hasPendingApplications) {
                // Show the admin approval modal
                document.getElementById('adminApprovalModal').style.display = 'block';
            }
        });

        // Edit Profile Modal Functionality
        document.addEventListener('DOMContentLoaded', function() {
            const editProfileBtn = document.getElementById('editProfileBtn');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const cancelEditBtn = document.getElementById('cancelEditBtn');
            const editProfileModal = document.getElementById('editProfileModal');
            const editProfileForm = document.getElementById('editProfileForm');

            // Open modal
            editProfileBtn.addEventListener('click', function() {
                editProfileModal.classList.remove('hidden');
            });

            // Close modal
            closeModalBtn.addEventListener('click', function() {
                editProfileModal.classList.add('hidden');
            });

            cancelEditBtn.addEventListener('click', function() {
                editProfileModal.classList.add('hidden');
            });

            // Close modal when clicking outside
            editProfileModal.addEventListener('click', function(e) {
                if (e.target === editProfileModal) {
                    editProfileModal.classList.add('hidden');
                }
            });

            // Form submission
            editProfileForm.addEventListener('submit', function(e) {
                // Add any validation here if needed
                // For now, we'll let the form submit normally
            });
        });

        // Application Approved Modal Functionality
        document.addEventListener('DOMContentLoaded', function() {
            const closeApprovedModalBtn = document.getElementById('closeApprovedModalBtn');
            const applicationApprovedModal = document.getElementById('applicationApprovedModal');

            // Close modal
            if (closeApprovedModalBtn) {
                closeApprovedModalBtn.addEventListener('click', function() {
                    applicationApprovedModal.style.display = 'none';
                });
            }

            // Close modal when clicking outside
            if (applicationApprovedModal) {
                applicationApprovedModal.addEventListener('click', function(e) {
                    if (e.target === applicationApprovedModal) {
                        applicationApprovedModal.style.display = 'none';
                    }
                });
            }
        });

        // Admin Approval Modal Functionality
        document.addEventListener('DOMContentLoaded', function() {
            const closeAdminApprovalModal = document.getElementById('closeAdminApprovalModal');
            const dismissAdminModal = document.getElementById('dismissAdminModal');
            const adminApprovalModal = document.getElementById('adminApprovalModal');

            // Close modal functions
            function closeAdminModal() {
                adminApprovalModal.style.display = 'none';
            }

            // Close modal via X button
            if (closeAdminApprovalModal) {
                closeAdminApprovalModal.addEventListener('click', closeAdminModal);
            }

            // Close modal via "Got it!" button
            if (dismissAdminModal) {
                dismissAdminModal.addEventListener('click', closeAdminModal);
            }

            // Close modal when clicking outside
            if (adminApprovalModal) {
                adminApprovalModal.addEventListener('click', function(e) {
                    if (e.target === adminApprovalModal) {
                        closeAdminModal();
                    }
                });
            }
        });

        // Status filter functionality for My Applications
        document.getElementById('statusFilter').addEventListener('change', function() {
            const selectedStatus = this.value.toLowerCase();
            const applicationCards = document.querySelectorAll('#overview-section .grid.gap-4 > div');
            
            applicationCards.forEach(card => {
                const statusBadge = card.querySelector('.inline-flex');
                if (!statusBadge) return;
                
                const cardStatus = statusBadge.textContent.toLowerCase().trim();
                
                if (selectedStatus === 'all' || cardStatus.includes(selectedStatus)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });

        // Show decline reason modal
        function showDeclineReason(reason) {
            alert('Decline Reason:\n\n' + reason);
        }

        // Show locked message for Job Recommendations
        function showLockedMessage() {
            // Create modal overlay
            const modalOverlay = document.createElement('div');
            modalOverlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;

            // Create modal content
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white;
                border-radius: 12px;
                padding: 40px;
                max-width: 500px;
                text-align: center;
                box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            `;

            modalContent.innerHTML = `
                <div class="mx-auto w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mb-4">
                    <i class="fas fa-lock text-yellow-600 text-2xl"></i>
                </div>
                <h2 class="text-xl font-bold mb-4 text-gray-800">Job Recommendations Locked</h2>
                <p class="text-gray-600 mb-6">
                    You need to complete and pass a program to unlock job recommendations and career opportunities.
                </p>
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                    <p class="text-blue-800 text-sm">
                        <i class="fas fa-info-circle mr-2"></i>
                        Complete your training program to access personalized job recommendations based on your skills.
                    </p>
                </div>
                <button onclick="this.closest('.modal-overlay').remove()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium">
                    <i class="fas fa-check mr-2"></i>
                    Got it!
                </button>
            `;

            modalOverlay.appendChild(modalContent);
            document.body.appendChild(modalOverlay);

            // Close modal when clicking outside
            modalOverlay.addEventListener('click', function(e) {
                if (e.target === modalOverlay) {
                    modalOverlay.remove();
                }
            });
        }

        // Job Recommendations Functionality
        document.addEventListener('DOMContentLoaded', function() {
            let currentPage = 1;
            let totalPages = 1;
            let jobsData = [];
            let filteredJobs = [];

            // DOM Elements
            const refreshBtn = document.getElementById('refresh-jobs-btn');
            const refreshIcon = document.getElementById('refresh-icon');
            const loadingIndicator = document.getElementById('loading-indicator');
            const jobsContainer = document.getElementById('jobs-container');
            const searchInput = document.getElementById('job-search');
            const locationFilter = document.getElementById('location-filter');
            const skillFilter = document.getElementById('skill-filter');
            const clearFiltersBtn = document.getElementById('clear-filters');
            const viewAllJobsBtn = document.getElementById('view-all-jobs');
            const pagination = document.getElementById('pagination');
            const prevPageBtn = document.getElementById('prev-page');
            const nextPageBtn = document.getElementById('next-page');
            const pageInfo = document.getElementById('page-info');

            // Statistics counters
            const totalJobsCount = document.getElementById('total-jobs-count');
            const skillMatchesCount = document.getElementById('skill-matches-count');
            const newJobsCount = document.getElementById('new-jobs-count');
            const applicationsSentCount = document.getElementById('applications-sent-count');

            // Mock PESO job data (in real implementation, this would come from web scraping)
            const mockPesoJobs = [
                {
                    id: 1,
                    title: "Software Developer",
                    company: "TechCorp Philippines",
                    location: "Lucena City",
                    description: "Develop and maintain web applications using modern technologies",
                    skills: ["JavaScript", "Python", "React", "Django"],
                    salary: "‚Ç±35,000 - ‚Ç±50,000",
                    type: "Full-time",
                    posted: "2024-01-15",
                    isNew: true,
                    matchScore: 95
                },
                {
                    id: 2,
                    title: "Automotive Technician",
                    company: "AutoFix Services",
                    location: "Quezon Province",
                    description: "Diagnose and repair automotive systems and components",
                    skills: ["Automotive Repair", "Diagnostics", "Engine Maintenance"],
                    salary: "‚Ç±25,000 - ‚Ç±35,000",
                    type: "Full-time",
                    posted: "2024-01-14",
                    isNew: true,
                    matchScore: 88
                },
                {
                    id: 3,
                    title: "Web Designer",
                    company: "Creative Studio Inc",
                    location: "Lucena City",
                    description: "Create visually appealing and user-friendly website designs",
                    skills: ["HTML", "CSS", "Adobe Photoshop", "UI/UX Design"],
                    salary: "‚Ç±28,000 - ‚Ç±40,000",
                    type: "Full-time",
                    posted: "2024-01-13",
                    isNew: false,
                    matchScore: 82
                },
                {
                    id: 4,
                    title: "Food Service Manager",
                    company: "Restaurant Chain",
                    location: "CALABARZON",
                    description: "Oversee daily restaurant operations and staff management",
                    skills: ["Food Service", "Management", "Customer Service"],
                    salary: "‚Ç±30,000 - ‚Ç±45,000",
                    type: "Full-time",
                    posted: "2024-01-12",
                    isNew: false,
                    matchScore: 75
                },
                {
                    id: 5,
                    title: "Construction Worker",
                    company: "BuildRight Construction",
                    location: "Quezon Province",
                    description: "Perform various construction tasks and site maintenance",
                    skills: ["Construction", "Safety Protocols", "Equipment Operation"],
                    salary: "‚Ç±20,000 - ‚Ç±28,000",
                    type: "Full-time",
                    posted: "2024-01-11",
                    isNew: false,
                    matchScore: 70
                }
            ];

            // Initialize
            function init() {
                updateStatistics();
                bindEvents();
                // Auto-refresh every 5 minutes
                setInterval(() => {
                    if (jobsData.length > 0) {
                        refreshJobs();
                    }
                }, 300000);
            }

            // Bind event listeners
            function bindEvents() {
                refreshBtn.addEventListener('click', refreshJobs);
                searchInput.addEventListener('input', debounce(filterJobs, 300));
                locationFilter.addEventListener('change', filterJobs);
                skillFilter.addEventListener('change', filterJobs);
                clearFiltersBtn.addEventListener('click', clearFilters);
                viewAllJobsBtn.addEventListener('click', () => showSection('jobs'));
                prevPageBtn.addEventListener('click', () => changePage(currentPage - 1));
                nextPageBtn.addEventListener('click', () => changePage(currentPage + 1));
            }

            // Refresh jobs from PhilJobNet (real web scraping)
            function refreshJobs() {
                showLoading(true);
                refreshIcon.classList.add('animate-spin');
                
                // Fetch real job data from PhilJobNet
                fetch('/api/philjobnet-jobs/?limit=50')
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Transform PhilJobNet data to match our format
                            jobsData = data.jobs.map(job => ({
                                id: job.id,
                                title: job.title,
                                company: job.company,
                                location: job.location,
                                description: job.description,
                                requirements: job.requirements,
                                salary: job.salary,
                                employment_type: job.employment_type,
                                posted_date: job.posted_date,
                                deadline: job.deadline,
                                skills: job.skills || [],
                                vacancy_count: job.vacancy_count || 1,
                                url: job.url,
                                source: job.source || 'PhilJobNet'
                            }));
                            
                            filteredJobs = [...jobsData];
                            currentPage = 1;
                            updateStatistics();
                            renderJobs();
                            showNotification(`Successfully loaded ${jobsData.length} jobs from PhilJobNet!`, 'success');
                        } else {
                            // Fallback to mock data if scraping fails
                            console.warn('Failed to fetch PhilJobNet jobs, using fallback data:', data.error);
                            jobsData = [...mockPesoJobs];
                            filteredJobs = [...jobsData];
                            currentPage = 1;
                            updateStatistics();
                            renderJobs();
                            showNotification('Using cached job data. PhilJobNet temporarily unavailable.', 'warning');
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching PhilJobNet jobs:', error);
                        // Fallback to mock data on error
                        jobsData = [...mockPesoJobs];
                        filteredJobs = [...jobsData];
                        currentPage = 1;
                        updateStatistics();
                        renderJobs();
                        showNotification('Network error. Using cached job data.', 'error');
                    })
                    .finally(() => {
                        showLoading(false);
                        refreshIcon.classList.remove('animate-spin');
                    });
            }

            // Show/hide loading indicator
            function showLoading(show) {
                if (show) {
                    loadingIndicator.classList.remove('hidden');
                    jobsContainer.innerHTML = '';
                } else {
                    loadingIndicator.classList.add('hidden');
                }
            }

            // Filter jobs based on search and filters
            function filterJobs() {
                const searchTerm = searchInput.value.toLowerCase();
                const locationValue = locationFilter.value;
                const skillValue = skillFilter.value;

                filteredJobs = jobsData.filter(job => {
                    const matchesSearch = !searchTerm || 
                        job.title.toLowerCase().includes(searchTerm) ||
                        job.company.toLowerCase().includes(searchTerm) ||
                        job.skills.some(skill => skill.toLowerCase().includes(searchTerm));
                    
                    const matchesLocation = !locationValue || 
                        job.location.toLowerCase().includes(locationValue);
                    

                    return matchesSearch && matchesLocation;
                });

                currentPage = 1;
                renderJobs();
                updatePagination();
            }

            // Clear all filters
            function clearFilters() {
                searchInput.value = '';
                locationFilter.value = '';
                filterJobs();
                filteredJobs = [...jobsData];
                currentPage = 1;
                renderJobs();
                updatePagination();
            }

            // Render jobs
            function renderJobs() {
                const jobsPerPage = 5;
                const startIndex = (currentPage - 1) * jobsPerPage;
                const endIndex = startIndex + jobsPerPage;
                const jobsToShow = filteredJobs.slice(startIndex, endIndex);

                if (jobsToShow.length === 0) {
                    jobsContainer.innerHTML = `
                        <div class="text-center text-gray-500 py-8">
                            <i class="fas fa-search text-4xl mb-4 text-gray-300"></i>
                            <p class="text-lg mb-2">No jobs found</p>
                            <p class="text-sm">Try adjusting your search criteria</p>
                        </div>
                    `;
                    pagination.classList.add('hidden');
                    return;
                }

                jobsContainer.innerHTML = jobsToShow.map(job => `
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow duration-200 job-card-item" data-job-id="${job.id}">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex-1">
                                <div class="flex items-center mb-2">
                                    <h3 class="text-lg font-semibold text-gray-800 mr-3">${job.title}</h3>
                                    ${job.isNew ? '<span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">New</span>' : ''}
                                    <span class="ml-2 bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">${job.matchScore}% Match</span>
                                </div>
                                <p class="text-gray-600 mb-2">
                                    <i class="fas fa-building mr-2"></i>${job.company}
                                </p>
                                <p class="text-gray-600 mb-2">
                                    <i class="fas fa-map-marker-alt mr-2"></i>${job.location}
                                </p>
                                <p class="text-gray-600 mb-3">${job.description}</p>
                                <div class="flex flex-wrap gap-2 mb-3">
                                    ${job.skills.map(skill => `<span class="bg-gray-100 text-gray-700 text-xs px-2 py-1 rounded">${skill}</span>`).join('')}
                                </div>
                            </div>
                            <div class="text-right ml-4">
                                <p class="text-lg font-semibold text-green-600 mb-2">${job.salary}</p>
                                <p class="text-sm text-gray-500 mb-3">${job.type}</p>
                                <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm transition-colors apply-job-btn" data-job-id="${job.id}">
                                    Apply Now
                                </button>
                            </div>
                        </div>
                        <div class="flex justify-between items-center pt-3 border-t border-gray-100">
                            <span class="text-sm text-gray-500">
                                <i class="fas fa-calendar mr-1"></i>Posted: ${formatDate(job.posted)}
                            </span>
                            <div class="flex gap-2">
                                <button class="text-blue-600 hover:text-blue-800 text-sm save-job-btn" data-job-id="${job.id}">
                                    <i class="fas fa-bookmark mr-1"></i>Save
                                </button>
                                <button class="text-gray-600 hover:text-gray-800 text-sm share-job-btn" data-job-id="${job.id}">
                                    <i class="fas fa-share mr-1"></i>Share
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');

                // Bind job action events
                bindJobActions();
                updatePagination();
            }

            // Bind job-specific actions
            function bindJobActions() {
                document.querySelectorAll('.apply-job-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const jobId = e.target.dataset.jobId;
                        applyToJob(jobId);
                    });
                });

                document.querySelectorAll('.save-job-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const jobId = e.target.dataset.jobId;
                        saveJob(jobId);
                    });
                });

                document.querySelectorAll('.share-job-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const jobId = e.target.dataset.jobId;
                        shareJob(jobId);
                    });
                });
            }

            // Apply to job
            function applyToJob(jobId) {
                const job = jobsData.find(j => j.id == jobId);
                if (job) {
                    // In real implementation, this would redirect to application form
                    showNotification(`Application submitted for ${job.title}!`, 'success');
                    updateApplicationsCount();
                }
            }

            // Save job
            function saveJob(jobId) {
                showNotification('Job saved to your favorites!', 'info');
            }

            // Share job
            function shareJob(jobId) {
                const job = jobsData.find(j => j.id == jobId);
                if (job && navigator.share) {
                    navigator.share({
                        title: job.title,
                        text: `Check out this job opportunity: ${job.title} at ${job.company}`,
                        url: window.location.href
                    });
                } else {
                    // Fallback: copy to clipboard
                    navigator.clipboard.writeText(window.location.href);
                    showNotification('Job link copied to clipboard!', 'info');
                }
            }

            // Update statistics
            function updateStatistics() {
                totalJobsCount.textContent = jobsData.length;
                skillMatchesCount.textContent = jobsData.filter(job => job.matchScore >= 80).length;
                newJobsCount.textContent = jobsData.filter(job => job.isNew).length;
                // Applications sent would come from backend in real implementation
                applicationsSentCount.textContent = Math.floor(Math.random() * 5);
            }

            // Update applications count
            function updateApplicationsCount() {
                const current = parseInt(applicationsSentCount.textContent);
                applicationsSentCount.textContent = current + 1;
            }

            // Update pagination
            function updatePagination() {
                const jobsPerPage = 5;
                totalPages = Math.ceil(filteredJobs.length / jobsPerPage);
                
                if (totalPages <= 1) {
                    pagination.classList.add('hidden');
                    return;
                }

                pagination.classList.remove('hidden');
                pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
                prevPageBtn.disabled = currentPage === 1;
                nextPageBtn.disabled = currentPage === totalPages;
            }

            // Change page
            function changePage(page) {
                if (page >= 1 && page <= totalPages) {
                    currentPage = page;
                    renderJobs();
                }
            }

            // Utility functions
            function formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric' 
                });
            }

            function debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }

            function showNotification(message, type = 'info') {
                // Create notification element
                const notification = document.createElement('div');
                notification.className = `fixed top-4 right-4 z-50 px-4 py-3 rounded-lg shadow-lg text-white transition-all duration-300 transform translate-x-full`;
                
                switch(type) {
                    case 'success':
                        notification.classList.add('bg-green-500');
                        break;
                    case 'error':
                        notification.classList.add('bg-red-500');
                        break;
                    case 'info':
                    default:
                        notification.classList.add('bg-blue-500');
                        break;
                }

                notification.innerHTML = `
                    <div class="flex items-center">
                        <span>${message}</span>
                        <button class="ml-3 text-white hover:text-gray-200" onclick="this.parentElement.parentElement.remove()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;

                document.body.appendChild(notification);

                // Animate in
                setTimeout(() => {
                    notification.classList.remove('translate-x-full');
                }, 100);

                // Auto remove after 5 seconds
                setTimeout(() => {
                    notification.classList.add('translate-x-full');
                    setTimeout(() => notification.remove(), 300);
                }, 5000);
            }

            // Initialize the job recommendations system
            init();
        });

        // Competencies Functions
        function initializeCompetenciesChart() {
            const competenciesChartElement = document.getElementById('competenciesChart');
            if (competenciesChartElement) {
                const ctx = competenciesChartElement.getContext('2d');
                window.competenciesChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Basic Competencies', 'Common Competencies', 'Core Competencies'],
                        datasets: [{
                            data: [0, 0, 0], // Will be updated with actual data
                            backgroundColor: ['#28a745', '#4A89DC', '#f59e0b'],
                            borderColor: '#ffffff',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        cutout: '50%',
                        plugins: {
                            legend: {
                                display: true,
                                position: 'bottom',
                                labels: {
                                    color: 'white'
                                }
                            }
                        }
                    }
                });
            }
        }

        // Initialize Competencies Data
        function initializeCompetenciesData() {
            // Get competencies data from the template context
            const competenciesData = {
                basic: {{ program_competencies.basic|default:"[]"|safe }},
                common: {{ program_competencies.common|default:"[]"|safe }},
                core: {{ program_competencies.core|default:"[]"|safe }},
                percentages: {
                    basic: {{ basic_percentage|default:0 }},
                    common: {{ common_percentage|default:0 }},
                    core: {{ core_percentage|default:0 }},
                    overall: {{ overall_percentage|default:0 }}
                }
            };

            // Update the UI with competencies data
            updateCompetenciesUI(competenciesData);
        }

        // Update Competencies UI
        function updateCompetenciesUI(data) {
            // Update percentage cards
            document.getElementById('basic-percentage').textContent = data.percentages.basic + '%';
            document.getElementById('common-percentage').textContent = data.percentages.common + '%';
            document.getElementById('core-percentage').textContent = data.percentages.core + '%';
            document.getElementById('overall-percentage').textContent = data.percentages.overall + '%';

            // Update progress bars
            document.getElementById('basic-progress-fill').style.width = data.percentages.basic + '%';
            document.getElementById('common-progress-fill').style.width = data.percentages.common + '%';
            document.getElementById('core-progress-fill').style.width = data.percentages.core + '%';

            // Update progress bar text
            document.getElementById('basic-percentage-text').textContent = data.percentages.basic + '%';
            document.getElementById('common-percentage-text').textContent = data.percentages.common + '%';
            document.getElementById('core-percentage-text').textContent = data.percentages.core + '%';

            // Update progress details
            document.getElementById('basic-detail-percentage').textContent = data.percentages.basic + '%';
            document.getElementById('common-detail-percentage').textContent = data.percentages.common + '%';
            document.getElementById('core-detail-percentage').textContent = data.percentages.core + '%';

            // Update circular progress
            updateCircularProgress(data.percentages.overall);

            // Update competencies lists
            updateCompetenciesList('basic', data.basic);
            updateCompetenciesList('common', data.common);
            updateCompetenciesList('core', data.core);

            // Update career skills
            updateCareerSkills(data);

            // Update competencies chart
            updateCompetenciesChart(data.percentages);
        }

        // Update Circular Progress
        function updateCircularProgress(percentage) {
            const progressCircle = document.getElementById('progress-circle');
            const progressPercentage = document.getElementById('progress-percentage');
            
            if (progressCircle && progressPercentage) {
                const circumference = 2 * Math.PI * 50; // radius = 50
                const offset = circumference - (percentage / 100) * circumference;
                
                progressCircle.style.strokeDashoffset = offset;
                progressPercentage.textContent = percentage + '%';
            }
        }

        // Update Competencies List
        function updateCompetenciesList(type, competencies) {
            const listElement = document.getElementById(type + '-competencies-list');
            if (listElement && competencies) {
                listElement.innerHTML = '';
                competencies.forEach((competency, index) => {
                    const competencyElement = document.createElement('div');
                    competencyElement.className = 'flex items-center justify-between p-2 bg-white rounded border';
                    competencyElement.innerHTML = `
                        <span class="text-sm text-gray-700">${competency}</span>
                        <div class="flex items-center">
                            <input type="checkbox" class="competency-checkbox mr-2" data-type="${type}" data-index="${index}" 
                                   ${competency.completed ? 'checked' : ''}>
                            <span class="text-xs text-gray-500">${competency.completed ? 'Completed' : 'Pending'}</span>
                        </div>
                    `;
                    listElement.appendChild(competencyElement);
                });
            }
        }

        // Update Career Skills
        function updateCareerSkills(data) {
            const careerSkillsList = document.getElementById('career-skills-list');
            if (careerSkillsList) {
                // Combine all competencies for career skills
                const allSkills = [...(data.basic || []), ...(data.common || []), ...(data.core || [])];
                careerSkillsList.innerHTML = '';
                
                allSkills.forEach(skill => {
                    const skillElement = document.createElement('div');
                    skillElement.className = 'flex items-center p-2 bg-white rounded border mb-2';
                    skillElement.innerHTML = `
                        <i class="fas fa-check-circle text-green-600 mr-2"></i>
                        <span class="text-sm text-gray-700">${skill}</span>
                    `;
                    careerSkillsList.appendChild(skillElement);
                });
            }
        }

        // Update Competencies Chart
        function updateCompetenciesChart(percentages) {
            const competenciesChartElement = document.getElementById('competenciesChart');
            if (competenciesChartElement && window.competenciesChart) {
                window.competenciesChart.data.datasets[0].data = [
                    percentages.basic,
                    percentages.common,
                    percentages.core
                ];
                window.competenciesChart.update();
            }
        }

        // Export Competencies Function
        function exportCompetencies() {
            // Create a simple CSV export
            const competenciesData = {
                basic: {{ program_competencies.basic|default:"[]"|safe }},
                common: {{ program_competencies.common|default:"[]"|safe }},
                core: {{ program_competencies.core|default:"[]"|safe }}
            };

            let csvContent = "Competency Type,Competency,Status\n";
            
            // Add basic competencies
            competenciesData.basic.forEach(comp => {
                csvContent += `Basic,${comp},${comp.completed ? 'Completed' : 'Pending'}\n`;
            });
            
            // Add common competencies
            competenciesData.common.forEach(comp => {
                csvContent += `Common,${comp},${comp.completed ? 'Completed' : 'Pending'}\n`;
            });
            
            // Add core competencies
            competenciesData.core.forEach(comp => {
                csvContent += `Core,${comp},${comp.completed ? 'Completed' : 'Pending'}\n`;
            });

            // Download CSV
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'competencies_report.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        }

            // Dropdown functionality (matching admin template)
            const dropdownToggles = document.querySelectorAll('.dropdown-toggle');
            
            dropdownToggles.forEach(toggle => {
                toggle.addEventListener('click', () => {
                    const dropdownMenu = toggle.nextElementSibling;
                    const dropdownChevron = toggle.querySelector('.fa-chevron-down');
                    if (dropdownMenu && dropdownChevron) {
                        dropdownMenu.classList.toggle('active');
                        dropdownChevron.classList.toggle('rotate-180');
                    }
                });
            });

            // Note: Navigation is handled by the main initializeSectionSwitching() function
            // No need for duplicate event listeners here

            // Tab functionality for Document Management
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabPanels = document.querySelectorAll('.tab-panel');

            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    // Remove active class from all buttons and panels
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabPanels.forEach(panel => panel.classList.remove('active'));
                    
                    // Add active class to clicked button
                    this.classList.add('active');
                    
                    // Show corresponding panel
                    const targetPanel = document.getElementById(targetTab + '-tab');
                    if (targetPanel) {
                        targetPanel.classList.add('active');
                    }
                });
            });

            // PDF Download functionality
            const downloadPdfBtn = document.getElementById('download-profile-pdf');
            if (downloadPdfBtn) {
                downloadPdfBtn.addEventListener('click', function() {
                    // Create a new window with the profile data formatted for PDF
                    const profileData = {
                        personalInfo: {
                            fullName: '{{ profile.last_name }}, {{ profile.first_name }} {{ profile.middle_name|default:"" }}',
                            email: '{{ profile.email }}',
                            contactNumber: '{{ profile.contact_number|default:"Not provided" }}',
                            sex: '{{ profile.sex|default:"Not specified" }}',
                            civilStatus: '{{ profile.civil_status|default:"Not specified" }}',
                            birthdate: '{{ profile.birthdate|default:"Not provided" }}',
                            age: '{{ profile.age|default:"Not provided" }}',
                            nationality: '{{ profile.nationality|default:"Not specified" }}'
                        },
                        addressInfo: {
                            region: '{{ profile.region_name|default:profile.region }}',
                            province: '{{ profile.province_name|default:profile.province }}',
                            city: '{{ profile.city_name|default:profile.city }}',
                            barangay: '{{ profile.barangay_name|default:profile.barangay }}',
                            street: '{{ profile.street|default:"Not provided" }}',
                            district: '{{ profile.district|default:"Not applicable" }}'
                        },
                        employmentInfo: {
                            employmentStatus: '{{ profile.employment_status|default:"Not specified" }}',
                            monthlyIncome: '{{ profile.monthly_income|default:"Not specified" }}',
                            companyName: '{{ profile.company_name|default:"Not specified" }}',
                            dateHired: '{{ profile.date_hired|default:"Not specified" }}'
                        },
                        educationalInfo: {
                            educationalAttainment: '{{ profile.educational_attainment|default:"Not specified" }}',
                            courseOrQualification: '{{ profile.course_or_qualification|default:"Not specified" }}',
                            scholarshipPackage: '{{ profile.scholarship_package|default:"Not specified" }}'
                        }
                    };

                    // Generate PDF content
                    const pdfContent = generateProfilePDF(profileData);
                    
                    // Open new window with PDF content
                    const printWindow = window.open('', '_blank');
                    printWindow.document.write(pdfContent);
                    printWindow.document.close();
                    printWindow.print();
                });
            }

            // Change ID Photo functionality
            const changeIdPhotoBtn = document.getElementById('change-id-photo');
            if (changeIdPhotoBtn) {
                changeIdPhotoBtn.addEventListener('click', function() {
                    // Create file input
                    const fileInput = document.createElement('input');
                    fileInput.type = 'file';
                    fileInput.accept = 'image/*';
                    fileInput.style.display = 'none';
                    
                    fileInput.addEventListener('change', function(e) {
                        const file = e.target.files[0];
                        if (file) {
                            // Validate file type
                            if (!file.type.startsWith('image/')) {
                                alert('Please select an image file.');
                                return;
                            }
                            
                            // Validate file size (max 5MB)
                            if (file.size > 5 * 1024 * 1024) {
                                alert('File size must be less than 5MB.');
                                return;
                            }
                            
                            // Show preview
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                const previewImg = document.querySelector('#id-photo-tab img');
                                if (previewImg) {
                                    previewImg.src = e.target.result;
                                }
                                
                                // Here you would typically upload the file to the server
                                // For now, we'll just show a success message
                                alert('ID Photo updated successfully! (Note: This is a preview only. File upload functionality needs to be implemented on the server side.)');
                            };
                            reader.readAsDataURL(file);
                        }
                    });
                    
                    // Trigger file input
                    document.body.appendChild(fileInput);
                    fileInput.click();
                    document.body.removeChild(fileInput);
                });
            }
        });

        // ===== PROGRAM COMPLETION NOTIFICATION MODAL =====
        function showProgramCompletionModal(programName) {
            // Create modal overlay
            const modalOverlay = document.createElement('div');
            modalOverlay.id = 'program-completion-modal';
            modalOverlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: rgba(0, 0, 0, 0.6);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 3000;
                animation: fadeIn 0.3s ease;
            `;

            // Create modal content
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white;
                border-radius: 16px;
                padding: 0;
                max-width: 550px;
                width: 90%;
                text-align: center;
                box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
                animation: slideUp 0.3s ease;
                position: relative;
                overflow: hidden;
            `;

            modalContent.innerHTML = `
                <style>
                    @keyframes fadeIn {
                        from { opacity: 0; }
                        to { opacity: 1; }
                    }
                    @keyframes slideUp {
                        from { transform: translateY(50px); opacity: 0; }
                        to { transform: translateY(0); opacity: 1; }
                    }
                    @keyframes confetti {
                        0% { transform: translateY(0) rotate(0deg); opacity: 1; }
                        100% { transform: translateY(1000px) rotate(720deg); opacity: 0; }
                    }
                    .confetti {
                        position: absolute;
                        width: 10px;
                        height: 10px;
                        background: #f59e0b;
                        animation: confetti 3s ease-out forwards;
                    }
                </style>
                
                <!-- Confetti elements -->
                ${Array.from({length: 30}, (_, i) => `
                    <div class="confetti" style="
                        left: ${Math.random() * 100}%; 
                        top: -10px;
                        background: ${['#f59e0b', '#3b82f6', '#10b981', '#ef4444', '#8b5cf6'][i % 5]};
                        animation-delay: ${Math.random() * 0.5}s;
                    "></div>
                `).join('')}
                
                <!-- Modal Header with Gradient -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 40px 20px;">
                    <div style="
                        background: white;
                        width: 100px;
                        height: 100px;
                        border-radius: 50%;
                        margin: 0 auto 20px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        box-shadow: 0 10px 25px rgba(0,0,0,0.2);
                        animation: pulse 2s infinite;
                    ">
                        <i class="fas fa-trophy" style="font-size: 3rem; color: #f59e0b;"></i>
                    </div>
                    <h2 style="color: white; font-size: 2rem; font-weight: bold; margin: 0;">
                        üéâ Congratulations! üéâ
                    </h2>
                </div>
                
                <!-- Modal Body -->
                <div style="padding: 40px 30px;">
                    <h3 style="font-size: 1.5rem; font-weight: 600; color: #1f2937; margin-bottom: 20px;">
                        You've Completed Your Program!
                    </h3>
                    <p style="font-size: 1.1rem; color: #4b5563; margin-bottom: 30px;">
                        You have successfully completed the <br>
                        <strong style="color: #667eea; font-size: 1.3rem;">${programName}</strong> program!
                    </p>
                    
                    <!-- Success Features -->
                    <div style="background: #f3f4f6; border-radius: 12px; padding: 20px; margin-bottom: 30px;">
                        <div style="display: flex; align-items: center; justify-content: center; gap: 30px; flex-wrap: wrap;">
                            <div style="text-align: center;">
                                <div style="background: #dbeafe; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 10px;">
                                    <i class="fas fa-briefcase" style="color: #3b82f6; font-size: 1.3rem;"></i>
                                </div>
                                <p style="font-size: 0.85rem; color: #6b7280; margin: 0;">Job Recommendations</p>
                                <p style="font-size: 0.75rem; color: #10b981; margin: 0; font-weight: 600;">‚úì Unlocked</p>
                            </div>
                            <div style="text-align: center;">
                                <div style="background: #dcfce7; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 10px;">
                                    <i class="fas fa-certificate" style="color: #10b981; font-size: 1.3rem;"></i>
                                </div>
                                <p style="font-size: 0.85rem; color: #6b7280; margin: 0;">Certifications</p>
                                <p style="font-size: 0.75rem; color: #10b981; margin: 0; font-weight: 600;">‚úì Available</p>
                            </div>
                        </div>
                    </div>
                    
                    <p style="font-size: 0.9rem; color: #6b7280; margin-bottom: 30px;">
                        <i class="fas fa-info-circle" style="color: #3b82f6;"></i>
                        Your achievements have been recorded and new features are now accessible in your dashboard.
                    </p>
                    
                    <!-- Close Button -->
                    <button onclick="closeProgramCompletionModal()" style="
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        border: none;
                        padding: 15px 40px;
                        border-radius: 10px;
                        font-size: 1.1rem;
                        font-weight: 600;
                        cursor: pointer;
                        transition: transform 0.2s ease, box-shadow 0.2s ease;
                        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
                    " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.6)';" 
                       onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.4)';">
                        <i class="fas fa-check-circle" style="margin-right: 10px;"></i>
                        Awesome!
                    </button>
                </div>
                
                <!-- X Close Button -->
                <button onclick="closeProgramCompletionModal()" style="
                    position: absolute;
                    top: 15px;
                    right: 15px;
                    background: rgba(255, 255, 255, 0.9);
                    border: none;
                    width: 35px;
                    height: 35px;
                    border-radius: 50%;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: all 0.2s ease;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
                " onmouseover="this.style.background='white'; this.style.transform='rotate(90deg)';" 
                   onmouseout="this.style.background='rgba(255, 255, 255, 0.9)'; this.style.transform='rotate(0deg)';">
                    <i class="fas fa-times" style="color: #6b7280; font-size: 1.2rem;"></i>
                </button>
            `;

            modalOverlay.appendChild(modalContent);
            document.body.appendChild(modalOverlay);

            // Close modal when clicking outside
            modalOverlay.addEventListener('click', function(e) {
                if (e.target === modalOverlay) {
                    closeProgramCompletionModal();
                }
            });

            // Add pulse animation style
            if (!document.getElementById('pulse-animation-style')) {
                const style = document.createElement('style');
                style.id = 'pulse-animation-style';
                style.textContent = `
                    @keyframes pulse {
                        0%, 100% { transform: scale(1); }
                        50% { transform: scale(1.05); }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        function closeProgramCompletionModal() {
            const modal = document.getElementById('program-completion-modal');
            if (modal) {
                modal.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => modal.remove(), 300);
            }
        }

        // Add fadeOut animation
        const fadeOutStyle = document.createElement('style');
        fadeOutStyle.textContent = `
            @keyframes fadeOut {
                from { opacity: 1; }
                to { opacity: 0; }
            }
        `;
        document.head.appendChild(fadeOutStyle);

        // Listen for notification clicks to show modal
        document.addEventListener('click', function(e) {
            // Check if clicked element is a notification item with program_completion type
            const notificationItem = e.target.closest('[data-notification-type="program_completion"]');
            if (notificationItem) {
                const programName = notificationItem.dataset.programName;
                const notificationId = notificationItem.dataset.notificationId;
                
                // Mark notification as read
                if (notificationId) {
                    fetch(`/mark-notification-read/${notificationId}/`, {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': '{{ csrf_token }}',
                            'Content-Type': 'application/json'
                        }
                    });
                }
                
                // Show congratulatory modal
                showProgramCompletionModal(programName || 'the program');
            }
        });

        // Generate PDF content for profile
        function generateProfilePDF(profileData) {
            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Profile Information - ${profileData.personalInfo.fullName}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
                        .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 20px; }
                        .section { margin-bottom: 25px; }
                        .section-title { background-color: #f0f0f0; padding: 10px; font-weight: bold; margin-bottom: 15px; }
                        .field { margin-bottom: 10px; }
                        .field-label { font-weight: bold; display: inline-block; width: 200px; }
                        .field-value { display: inline-block; }
                        .two-column { display: flex; }
                        .column { flex: 1; margin-right: 20px; }
                        .column:last-child { margin-right: 0; }
                        @media print { body { margin: 0; } }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>PROFILE INFORMATION</h1>
                        <h2>${profileData.personalInfo.fullName}</h2>
                        <p>Generated on: ${new Date().toLocaleDateString()}</p>
                    </div>

                    <div class="two-column">
                        <div class="column">
                            <div class="section">
                                <div class="section-title">PERSONAL INFORMATION</div>
                                <div class="field"><span class="field-label">Full Name:</span> <span class="field-value">${profileData.personalInfo.fullName}</span></div>
                                <div class="field"><span class="field-label">Email:</span> <span class="field-value">${profileData.personalInfo.email}</span></div>
                                <div class="field"><span class="field-label">Contact Number:</span> <span class="field-value">${profileData.personalInfo.contactNumber}</span></div>
                                <div class="field"><span class="field-label">Sex:</span> <span class="field-value">${profileData.personalInfo.sex}</span></div>
                                <div class="field"><span class="field-label">Civil Status:</span> <span class="field-value">${profileData.personalInfo.civilStatus}</span></div>
                                <div class="field"><span class="field-label">Birthdate:</span> <span class="field-value">${profileData.personalInfo.birthdate}</span></div>
                                <div class="field"><span class="field-label">Age:</span> <span class="field-value">${profileData.personalInfo.age}</span></div>
                                <div class="field"><span class="field-label">Nationality:</span> <span class="field-value">${profileData.personalInfo.nationality}</span></div>
                            </div>

                            <div class="section">
                                <div class="section-title">ADDRESS INFORMATION</div>
                                <div class="field"><span class="field-label">Region:</span> <span class="field-value">${profileData.addressInfo.region}</span></div>
                                <div class="field"><span class="field-label">Province:</span> <span class="field-value">${profileData.addressInfo.province}</span></div>
                                <div class="field"><span class="field-label">City:</span> <span class="field-value">${profileData.addressInfo.city}</span></div>
                                <div class="field"><span class="field-label">Barangay:</span> <span class="field-value">${profileData.addressInfo.barangay}</span></div>
                                <div class="field"><span class="field-label">Street:</span> <span class="field-value">${profileData.addressInfo.street}</span></div>
                                <div class="field"><span class="field-label">District:</span> <span class="field-value">${profileData.addressInfo.district}</span></div>
                            </div>
                        </div>

                        <div class="column">
                            <div class="section">
                                <div class="section-title">EMPLOYMENT INFORMATION</div>
                                <div class="field"><span class="field-label">Employment Status:</span> <span class="field-value">${profileData.employmentInfo.employmentStatus}</span></div>
                                <div class="field"><span class="field-label">Monthly Income:</span> <span class="field-value">${profileData.employmentInfo.monthlyIncome}</span></div>
                                <div class="field"><span class="field-label">Company Name:</span> <span class="field-value">${profileData.employmentInfo.companyName}</span></div>
                                <div class="field"><span class="field-label">Date Hired:</span> <span class="field-value">${profileData.employmentInfo.dateHired}</span></div>
                            </div>

                            <div class="section">
                                <div class="section-title">EDUCATIONAL INFORMATION</div>
                                <div class="field"><span class="field-label">Educational Attainment:</span> <span class="field-value">${profileData.educationalInfo.educationalAttainment}</span></div>
                                <div class="field"><span class="field-label">Course/Qualification:</span> <span class="field-value">${profileData.educationalInfo.courseOrQualification}</span></div>
                                <div class="field"><span class="field-label">Scholarship Package:</span> <span class="field-value">${profileData.educationalInfo.scholarshipPackage}</span></div>
                            </div>
                        </div>
                    </div>
                </body>
                </html>
            `;
        }
    </script>
</body>
</html>